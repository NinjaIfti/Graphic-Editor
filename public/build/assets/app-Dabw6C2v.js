var yd=Object.defineProperty;var xd=(n,t,e)=>t in n?yd(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var pl=(n,t,e)=>xd(n,typeof t!="symbol"?t+"":t,e);function bd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rs={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var wd=rs.exports,ml;function _d(){return ml||(ml=1,function(n){(function(t,e){n.exports=t.document?e(t,!0):function(r){if(!r.document)throw new Error("jQuery requires a window with a document");return e(r)}})(typeof window<"u"?window:wd,function(t,e){var r=[],i=Object.getPrototypeOf,s=r.slice,o=r.flat?function(a){return r.flat.call(a)}:function(a){return r.concat.apply([],a)},l=r.push,h=r.indexOf,u={},p=u.toString,y=u.hasOwnProperty,b=y.toString,_=b.call(Object),w={},S=function(c){return typeof c=="function"&&typeof c.nodeType!="number"&&typeof c.item!="function"},F=function(c){return c!=null&&c===c.window},M=t.document,X={type:!0,src:!0,nonce:!0,noModule:!0};function q(a,c,d){d=d||M;var g,m,v=d.createElement("script");if(v.text=a,c)for(g in X)m=c[g]||c.getAttribute&&c.getAttribute(g),m&&v.setAttribute(g,m);d.head.appendChild(v).parentNode.removeChild(v)}function K(a){return a==null?a+"":typeof a=="object"||typeof a=="function"?u[p.call(a)]||"object":typeof a}var et="3.7.1",ct=/HTML$/i,f=function(a,c){return new f.fn.init(a,c)};f.fn=f.prototype={jquery:et,constructor:f,length:0,toArray:function(){return s.call(this)},get:function(a){return a==null?s.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var c=f.merge(this.constructor(),a);return c.prevObject=this,c},each:function(a){return f.each(this,a)},map:function(a){return this.pushStack(f.map(this,function(c,d){return a.call(c,d,c)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(f.grep(this,function(a,c){return(c+1)%2}))},odd:function(){return this.pushStack(f.grep(this,function(a,c){return c%2}))},eq:function(a){var c=this.length,d=+a+(a<0?c:0);return this.pushStack(d>=0&&d<c?[this[d]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:r.sort,splice:r.splice},f.extend=f.fn.extend=function(){var a,c,d,g,m,v,x=arguments[0]||{},O=1,T=arguments.length,j=!1;for(typeof x=="boolean"&&(j=x,x=arguments[O]||{},O++),typeof x!="object"&&!S(x)&&(x={}),O===T&&(x=this,O--);O<T;O++)if((a=arguments[O])!=null)for(c in a)g=a[c],!(c==="__proto__"||x===g)&&(j&&g&&(f.isPlainObject(g)||(m=Array.isArray(g)))?(d=x[c],m&&!Array.isArray(d)?v=[]:!m&&!f.isPlainObject(d)?v={}:v=d,m=!1,x[c]=f.extend(j,v,g)):g!==void 0&&(x[c]=g));return x},f.extend({expando:"jQuery"+(et+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isPlainObject:function(a){var c,d;return!a||p.call(a)!=="[object Object]"?!1:(c=i(a),c?(d=y.call(c,"constructor")&&c.constructor,typeof d=="function"&&b.call(d)===_):!0)},isEmptyObject:function(a){var c;for(c in a)return!1;return!0},globalEval:function(a,c,d){q(a,{nonce:c&&c.nonce},d)},each:function(a,c){var d,g=0;if(it(a))for(d=a.length;g<d&&c.call(a[g],g,a[g])!==!1;g++);else for(g in a)if(c.call(a[g],g,a[g])===!1)break;return a},text:function(a){var c,d="",g=0,m=a.nodeType;if(!m)for(;c=a[g++];)d+=f.text(c);return m===1||m===11?a.textContent:m===9?a.documentElement.textContent:m===3||m===4?a.nodeValue:d},makeArray:function(a,c){var d=c||[];return a!=null&&(it(Object(a))?f.merge(d,typeof a=="string"?[a]:a):l.call(d,a)),d},inArray:function(a,c,d){return c==null?-1:h.call(c,a,d)},isXMLDoc:function(a){var c=a&&a.namespaceURI,d=a&&(a.ownerDocument||a).documentElement;return!ct.test(c||d&&d.nodeName||"HTML")},merge:function(a,c){for(var d=+c.length,g=0,m=a.length;g<d;g++)a[m++]=c[g];return a.length=m,a},grep:function(a,c,d){for(var g,m=[],v=0,x=a.length,O=!d;v<x;v++)g=!c(a[v],v),g!==O&&m.push(a[v]);return m},map:function(a,c,d){var g,m,v=0,x=[];if(it(a))for(g=a.length;v<g;v++)m=c(a[v],v,d),m!=null&&x.push(m);else for(v in a)m=c(a[v],v,d),m!=null&&x.push(m);return o(x)},guid:1,support:w}),typeof Symbol=="function"&&(f.fn[Symbol.iterator]=r[Symbol.iterator]),f.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,c){u["[object "+c+"]"]=c.toLowerCase()});function it(a){var c=!!a&&"length"in a&&a.length,d=K(a);return S(a)||F(a)?!1:d==="array"||c===0||typeof c=="number"&&c>0&&c-1 in a}function Z(a,c){return a.nodeName&&a.nodeName.toLowerCase()===c.toLowerCase()}var vt=r.pop,kt=r.sort,Tt=r.splice,nt="[\\x20\\t\\r\\n\\f]",yt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g");f.contains=function(a,c){var d=c&&c.parentNode;return a===d||!!(d&&d.nodeType===1&&(a.contains?a.contains(d):a.compareDocumentPosition&&a.compareDocumentPosition(d)&16))};var Xt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Y(a,c){return c?a==="\0"?"ï¿½":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a}f.escapeSelector=function(a){return(a+"").replace(Xt,Y)};var V=M,z=l;(function(){var a,c,d,g,m,v=z,x,O,T,j,W,N=f.expando,R=0,G=0,dt=zn(),wt=zn(),gt=zn(),Zt=zn(),Ut=function(C,P){return C===P&&(m=!0),0},qe="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Ue="(?:\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",bt="\\["+nt+"*("+Ue+")(?:"+nt+"*([*^$|!~]?=)"+nt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Ue+"))|)"+nt+"*\\]",Hr=":("+Ue+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+bt+")*)|.*)\\)|)",St=new RegExp(nt+"+","g"),Wt=new RegExp("^"+nt+"*,"+nt+"*"),qi=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),oo=new RegExp(nt+"|>"),$e=new RegExp(Hr),Ui=new RegExp("^"+Ue+"$"),Ke={ID:new RegExp("^#("+Ue+")"),CLASS:new RegExp("^\\.("+Ue+")"),TAG:new RegExp("^("+Ue+"|[*])"),ATTR:new RegExp("^"+bt),PSEUDO:new RegExp("^"+Hr),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+qe+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},Cr=/^(?:input|select|textarea|button)$/i,Sr=/^h\d$/i,Oe=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ao=/[+~]/,gr=new RegExp("\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\([^\\r\\n\\f])","g"),pr=function(C,P){var I="0x"+C.slice(1)-65536;return P||(I<0?String.fromCharCode(I+65536):String.fromCharCode(I>>10|55296,I&1023|56320))},ud=function(){Tr()},dd=qn(function(C){return C.disabled===!0&&Z(C,"fieldset")},{dir:"parentNode",next:"legend"});function fd(){try{return x.activeElement}catch{}}try{v.apply(r=s.call(V.childNodes),V.childNodes),r[V.childNodes.length].nodeType}catch{v={apply:function(P,I){z.apply(P,s.call(I))},call:function(P){z.apply(P,s.call(arguments,1))}}}function Dt(C,P,I,B){var H,U,J,st,Q,pt,ht,ft=P&&P.ownerDocument,mt=P?P.nodeType:9;if(I=I||[],typeof C!="string"||!C||mt!==1&&mt!==9&&mt!==11)return I;if(!B&&(Tr(P),P=P||x,T)){if(mt!==11&&(Q=Oe.exec(C)))if(H=Q[1]){if(mt===9)if(J=P.getElementById(H)){if(J.id===H)return v.call(I,J),I}else return I;else if(ft&&(J=ft.getElementById(H))&&Dt.contains(P,J)&&J.id===H)return v.call(I,J),I}else{if(Q[2])return v.apply(I,P.getElementsByTagName(C)),I;if((H=Q[3])&&P.getElementsByClassName)return v.apply(I,P.getElementsByClassName(H)),I}if(!Zt[C+" "]&&(!j||!j.test(C))){if(ht=C,ft=P,mt===1&&(oo.test(C)||qi.test(C))){for(ft=ao.test(C)&&lo(P.parentNode)||P,(ft!=P||!w.scope)&&((st=P.getAttribute("id"))?st=f.escapeSelector(st):P.setAttribute("id",st=N)),pt=$i(C),U=pt.length;U--;)pt[U]=(st?"#"+st:":scope")+" "+Gn(pt[U]);ht=pt.join(",")}try{return v.apply(I,ft.querySelectorAll(ht)),I}catch{Zt(C,!0)}finally{st===N&&P.removeAttribute("id")}}}return gl(C.replace(yt,"$1"),P,I,B)}function zn(){var C=[];function P(I,B){return C.push(I+" ")>c.cacheLength&&delete P[C.shift()],P[I+" "]=B}return P}function Fe(C){return C[N]=!0,C}function mi(C){var P=x.createElement("fieldset");try{return!!C(P)}catch{return!1}finally{P.parentNode&&P.parentNode.removeChild(P),P=null}}function gd(C){return function(P){return Z(P,"input")&&P.type===C}}function pd(C){return function(P){return(Z(P,"input")||Z(P,"button"))&&P.type===C}}function dl(C){return function(P){return"form"in P?P.parentNode&&P.disabled===!1?"label"in P?"label"in P.parentNode?P.parentNode.disabled===C:P.disabled===C:P.isDisabled===C||P.isDisabled!==!C&&dd(P)===C:P.disabled===C:"label"in P?P.disabled===C:!1}}function Nr(C){return Fe(function(P){return P=+P,Fe(function(I,B){for(var H,U=C([],I.length,P),J=U.length;J--;)I[H=U[J]]&&(I[H]=!(B[H]=I[H]))})})}function lo(C){return C&&typeof C.getElementsByTagName<"u"&&C}function Tr(C){var P,I=C?C.ownerDocument||C:V;return I==x||I.nodeType!==9||!I.documentElement||(x=I,O=x.documentElement,T=!f.isXMLDoc(x),W=O.matches||O.webkitMatchesSelector||O.msMatchesSelector,O.msMatchesSelector&&V!=x&&(P=x.defaultView)&&P.top!==P&&P.addEventListener("unload",ud),w.getById=mi(function(B){return O.appendChild(B).id=f.expando,!x.getElementsByName||!x.getElementsByName(f.expando).length}),w.disconnectedMatch=mi(function(B){return W.call(B,"*")}),w.scope=mi(function(){return x.querySelectorAll(":scope")}),w.cssHas=mi(function(){try{return x.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),w.getById?(c.filter.ID=function(B){var H=B.replace(gr,pr);return function(U){return U.getAttribute("id")===H}},c.find.ID=function(B,H){if(typeof H.getElementById<"u"&&T){var U=H.getElementById(B);return U?[U]:[]}}):(c.filter.ID=function(B){var H=B.replace(gr,pr);return function(U){var J=typeof U.getAttributeNode<"u"&&U.getAttributeNode("id");return J&&J.value===H}},c.find.ID=function(B,H){if(typeof H.getElementById<"u"&&T){var U,J,st,Q=H.getElementById(B);if(Q){if(U=Q.getAttributeNode("id"),U&&U.value===B)return[Q];for(st=H.getElementsByName(B),J=0;Q=st[J++];)if(U=Q.getAttributeNode("id"),U&&U.value===B)return[Q]}return[]}}),c.find.TAG=function(B,H){return typeof H.getElementsByTagName<"u"?H.getElementsByTagName(B):H.querySelectorAll(B)},c.find.CLASS=function(B,H){if(typeof H.getElementsByClassName<"u"&&T)return H.getElementsByClassName(B)},j=[],mi(function(B){var H;O.appendChild(B).innerHTML="<a id='"+N+"' href='' disabled='disabled'></a><select id='"+N+"-\r\\' disabled='disabled'><option selected=''></option></select>",B.querySelectorAll("[selected]").length||j.push("\\["+nt+"*(?:value|"+qe+")"),B.querySelectorAll("[id~="+N+"-]").length||j.push("~="),B.querySelectorAll("a#"+N+"+*").length||j.push(".#.+[+~]"),B.querySelectorAll(":checked").length||j.push(":checked"),H=x.createElement("input"),H.setAttribute("type","hidden"),B.appendChild(H).setAttribute("name","D"),O.appendChild(B).disabled=!0,B.querySelectorAll(":disabled").length!==2&&j.push(":enabled",":disabled"),H=x.createElement("input"),H.setAttribute("name",""),B.appendChild(H),B.querySelectorAll("[name='']").length||j.push("\\["+nt+"*name"+nt+"*="+nt+`*(?:''|"")`)}),w.cssHas||j.push(":has"),j=j.length&&new RegExp(j.join("|")),Ut=function(B,H){if(B===H)return m=!0,0;var U=!B.compareDocumentPosition-!H.compareDocumentPosition;return U||(U=(B.ownerDocument||B)==(H.ownerDocument||H)?B.compareDocumentPosition(H):1,U&1||!w.sortDetached&&H.compareDocumentPosition(B)===U?B===x||B.ownerDocument==V&&Dt.contains(V,B)?-1:H===x||H.ownerDocument==V&&Dt.contains(V,H)?1:g?h.call(g,B)-h.call(g,H):0:U&4?-1:1)}),x}Dt.matches=function(C,P){return Dt(C,null,null,P)},Dt.matchesSelector=function(C,P){if(Tr(C),T&&!Zt[P+" "]&&(!j||!j.test(P)))try{var I=W.call(C,P);if(I||w.disconnectedMatch||C.document&&C.document.nodeType!==11)return I}catch{Zt(P,!0)}return Dt(P,x,null,[C]).length>0},Dt.contains=function(C,P){return(C.ownerDocument||C)!=x&&Tr(C),f.contains(C,P)},Dt.attr=function(C,P){(C.ownerDocument||C)!=x&&Tr(C);var I=c.attrHandle[P.toLowerCase()],B=I&&y.call(c.attrHandle,P.toLowerCase())?I(C,P,!T):void 0;return B!==void 0?B:C.getAttribute(P)},Dt.error=function(C){throw new Error("Syntax error, unrecognized expression: "+C)},f.uniqueSort=function(C){var P,I=[],B=0,H=0;if(m=!w.sortStable,g=!w.sortStable&&s.call(C,0),kt.call(C,Ut),m){for(;P=C[H++];)P===C[H]&&(B=I.push(H));for(;B--;)Tt.call(C,I[B],1)}return g=null,C},f.fn.uniqueSort=function(){return this.pushStack(f.uniqueSort(s.apply(this)))},c=f.expr={cacheLength:50,createPseudo:Fe,match:Ke,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(C){return C[1]=C[1].replace(gr,pr),C[3]=(C[3]||C[4]||C[5]||"").replace(gr,pr),C[2]==="~="&&(C[3]=" "+C[3]+" "),C.slice(0,4)},CHILD:function(C){return C[1]=C[1].toLowerCase(),C[1].slice(0,3)==="nth"?(C[3]||Dt.error(C[0]),C[4]=+(C[4]?C[5]+(C[6]||1):2*(C[3]==="even"||C[3]==="odd")),C[5]=+(C[7]+C[8]||C[3]==="odd")):C[3]&&Dt.error(C[0]),C},PSEUDO:function(C){var P,I=!C[6]&&C[2];return Ke.CHILD.test(C[0])?null:(C[3]?C[2]=C[4]||C[5]||"":I&&$e.test(I)&&(P=$i(I,!0))&&(P=I.indexOf(")",I.length-P)-I.length)&&(C[0]=C[0].slice(0,P),C[2]=I.slice(0,P)),C.slice(0,3))}},filter:{TAG:function(C){var P=C.replace(gr,pr).toLowerCase();return C==="*"?function(){return!0}:function(I){return Z(I,P)}},CLASS:function(C){var P=dt[C+" "];return P||(P=new RegExp("(^|"+nt+")"+C+"("+nt+"|$)"))&&dt(C,function(I){return P.test(typeof I.className=="string"&&I.className||typeof I.getAttribute<"u"&&I.getAttribute("class")||"")})},ATTR:function(C,P,I){return function(B){var H=Dt.attr(B,C);return H==null?P==="!=":P?(H+="",P==="="?H===I:P==="!="?H!==I:P==="^="?I&&H.indexOf(I)===0:P==="*="?I&&H.indexOf(I)>-1:P==="$="?I&&H.slice(-I.length)===I:P==="~="?(" "+H.replace(St," ")+" ").indexOf(I)>-1:P==="|="?H===I||H.slice(0,I.length+1)===I+"-":!1):!0}},CHILD:function(C,P,I,B,H){var U=C.slice(0,3)!=="nth",J=C.slice(-4)!=="last",st=P==="of-type";return B===1&&H===0?function(Q){return!!Q.parentNode}:function(Q,pt,ht){var ft,mt,lt,Pt,me,Qt=U!==J?"nextSibling":"previousSibling",ke=Q.parentNode,Ze=st&&Q.nodeName.toLowerCase(),vi=!ht&&!st,se=!1;if(ke){if(U){for(;Qt;){for(lt=Q;lt=lt[Qt];)if(st?Z(lt,Ze):lt.nodeType===1)return!1;me=Qt=C==="only"&&!me&&"nextSibling"}return!0}if(me=[J?ke.firstChild:ke.lastChild],J&&vi){for(mt=ke[N]||(ke[N]={}),ft=mt[C]||[],Pt=ft[0]===R&&ft[1],se=Pt&&ft[2],lt=Pt&&ke.childNodes[Pt];lt=++Pt&&lt&&lt[Qt]||(se=Pt=0)||me.pop();)if(lt.nodeType===1&&++se&&lt===Q){mt[C]=[R,Pt,se];break}}else if(vi&&(mt=Q[N]||(Q[N]={}),ft=mt[C]||[],Pt=ft[0]===R&&ft[1],se=Pt),se===!1)for(;(lt=++Pt&&lt&&lt[Qt]||(se=Pt=0)||me.pop())&&!((st?Z(lt,Ze):lt.nodeType===1)&&++se&&(vi&&(mt=lt[N]||(lt[N]={}),mt[C]=[R,se]),lt===Q)););return se-=H,se===B||se%B===0&&se/B>=0}}},PSEUDO:function(C,P){var I,B=c.pseudos[C]||c.setFilters[C.toLowerCase()]||Dt.error("unsupported pseudo: "+C);return B[N]?B(P):B.length>1?(I=[C,C,"",P],c.setFilters.hasOwnProperty(C.toLowerCase())?Fe(function(H,U){for(var J,st=B(H,P),Q=st.length;Q--;)J=h.call(H,st[Q]),H[J]=!(U[J]=st[Q])}):function(H){return B(H,0,I)}):B}},pseudos:{not:Fe(function(C){var P=[],I=[],B=fo(C.replace(yt,"$1"));return B[N]?Fe(function(H,U,J,st){for(var Q,pt=B(H,null,st,[]),ht=H.length;ht--;)(Q=pt[ht])&&(H[ht]=!(U[ht]=Q))}):function(H,U,J){return P[0]=H,B(P,null,J,I),P[0]=null,!I.pop()}}),has:Fe(function(C){return function(P){return Dt(C,P).length>0}}),contains:Fe(function(C){return C=C.replace(gr,pr),function(P){return(P.textContent||f.text(P)).indexOf(C)>-1}}),lang:Fe(function(C){return Ui.test(C||"")||Dt.error("unsupported lang: "+C),C=C.replace(gr,pr).toLowerCase(),function(P){var I;do if(I=T?P.lang:P.getAttribute("xml:lang")||P.getAttribute("lang"))return I=I.toLowerCase(),I===C||I.indexOf(C+"-")===0;while((P=P.parentNode)&&P.nodeType===1);return!1}}),target:function(C){var P=t.location&&t.location.hash;return P&&P.slice(1)===C.id},root:function(C){return C===O},focus:function(C){return C===fd()&&x.hasFocus()&&!!(C.type||C.href||~C.tabIndex)},enabled:dl(!1),disabled:dl(!0),checked:function(C){return Z(C,"input")&&!!C.checked||Z(C,"option")&&!!C.selected},selected:function(C){return C.parentNode&&C.parentNode.selectedIndex,C.selected===!0},empty:function(C){for(C=C.firstChild;C;C=C.nextSibling)if(C.nodeType<6)return!1;return!0},parent:function(C){return!c.pseudos.empty(C)},header:function(C){return Sr.test(C.nodeName)},input:function(C){return Cr.test(C.nodeName)},button:function(C){return Z(C,"input")&&C.type==="button"||Z(C,"button")},text:function(C){var P;return Z(C,"input")&&C.type==="text"&&((P=C.getAttribute("type"))==null||P.toLowerCase()==="text")},first:Nr(function(){return[0]}),last:Nr(function(C,P){return[P-1]}),eq:Nr(function(C,P,I){return[I<0?I+P:I]}),even:Nr(function(C,P){for(var I=0;I<P;I+=2)C.push(I);return C}),odd:Nr(function(C,P){for(var I=1;I<P;I+=2)C.push(I);return C}),lt:Nr(function(C,P,I){var B;for(I<0?B=I+P:I>P?B=P:B=I;--B>=0;)C.push(B);return C}),gt:Nr(function(C,P,I){for(var B=I<0?I+P:I;++B<P;)C.push(B);return C})}},c.pseudos.nth=c.pseudos.eq;for(a in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})c.pseudos[a]=gd(a);for(a in{submit:!0,reset:!0})c.pseudos[a]=pd(a);function fl(){}fl.prototype=c.filters=c.pseudos,c.setFilters=new fl;function $i(C,P){var I,B,H,U,J,st,Q,pt=wt[C+" "];if(pt)return P?0:pt.slice(0);for(J=C,st=[],Q=c.preFilter;J;){(!I||(B=Wt.exec(J)))&&(B&&(J=J.slice(B[0].length)||J),st.push(H=[])),I=!1,(B=qi.exec(J))&&(I=B.shift(),H.push({value:I,type:B[0].replace(yt," ")}),J=J.slice(I.length));for(U in c.filter)(B=Ke[U].exec(J))&&(!Q[U]||(B=Q[U](B)))&&(I=B.shift(),H.push({value:I,type:U,matches:B}),J=J.slice(I.length));if(!I)break}return P?J.length:J?Dt.error(C):wt(C,st).slice(0)}function Gn(C){for(var P=0,I=C.length,B="";P<I;P++)B+=C[P].value;return B}function qn(C,P,I){var B=P.dir,H=P.next,U=H||B,J=I&&U==="parentNode",st=G++;return P.first?function(Q,pt,ht){for(;Q=Q[B];)if(Q.nodeType===1||J)return C(Q,pt,ht);return!1}:function(Q,pt,ht){var ft,mt,lt=[R,st];if(ht){for(;Q=Q[B];)if((Q.nodeType===1||J)&&C(Q,pt,ht))return!0}else for(;Q=Q[B];)if(Q.nodeType===1||J)if(mt=Q[N]||(Q[N]={}),H&&Z(Q,H))Q=Q[B]||Q;else{if((ft=mt[U])&&ft[0]===R&&ft[1]===st)return lt[2]=ft[2];if(mt[U]=lt,lt[2]=C(Q,pt,ht))return!0}return!1}}function co(C){return C.length>1?function(P,I,B){for(var H=C.length;H--;)if(!C[H](P,I,B))return!1;return!0}:C[0]}function md(C,P,I){for(var B=0,H=P.length;B<H;B++)Dt(C,P[B],I);return I}function Un(C,P,I,B,H){for(var U,J=[],st=0,Q=C.length,pt=P!=null;st<Q;st++)(U=C[st])&&(!I||I(U,B,H))&&(J.push(U),pt&&P.push(st));return J}function ho(C,P,I,B,H,U){return B&&!B[N]&&(B=ho(B)),H&&!H[N]&&(H=ho(H,U)),Fe(function(J,st,Q,pt){var ht,ft,mt,lt,Pt=[],me=[],Qt=st.length,ke=J||md(P||"*",Q.nodeType?[Q]:Q,[]),Ze=C&&(J||!P)?Un(ke,Pt,C,Q,pt):ke;if(I?(lt=H||(J?C:Qt||B)?[]:st,I(Ze,lt,Q,pt)):lt=Ze,B)for(ht=Un(lt,me),B(ht,[],Q,pt),ft=ht.length;ft--;)(mt=ht[ft])&&(lt[me[ft]]=!(Ze[me[ft]]=mt));if(J){if(H||C){if(H){for(ht=[],ft=lt.length;ft--;)(mt=lt[ft])&&ht.push(Ze[ft]=mt);H(null,lt=[],ht,pt)}for(ft=lt.length;ft--;)(mt=lt[ft])&&(ht=H?h.call(J,mt):Pt[ft])>-1&&(J[ht]=!(st[ht]=mt))}}else lt=Un(lt===st?lt.splice(Qt,lt.length):lt),H?H(null,st,lt,pt):v.apply(st,lt)})}function uo(C){for(var P,I,B,H=C.length,U=c.relative[C[0].type],J=U||c.relative[" "],st=U?1:0,Q=qn(function(ft){return ft===P},J,!0),pt=qn(function(ft){return h.call(P,ft)>-1},J,!0),ht=[function(ft,mt,lt){var Pt=!U&&(lt||mt!=d)||((P=mt).nodeType?Q(ft,mt,lt):pt(ft,mt,lt));return P=null,Pt}];st<H;st++)if(I=c.relative[C[st].type])ht=[qn(co(ht),I)];else{if(I=c.filter[C[st].type].apply(null,C[st].matches),I[N]){for(B=++st;B<H&&!c.relative[C[B].type];B++);return ho(st>1&&co(ht),st>1&&Gn(C.slice(0,st-1).concat({value:C[st-2].type===" "?"*":""})).replace(yt,"$1"),I,st<B&&uo(C.slice(st,B)),B<H&&uo(C=C.slice(B)),B<H&&Gn(C))}ht.push(I)}return co(ht)}function vd(C,P){var I=P.length>0,B=C.length>0,H=function(U,J,st,Q,pt){var ht,ft,mt,lt=0,Pt="0",me=U&&[],Qt=[],ke=d,Ze=U||B&&c.find.TAG("*",pt),vi=R+=ke==null?1:Math.random()||.1,se=Ze.length;for(pt&&(d=J==x||J||pt);Pt!==se&&(ht=Ze[Pt])!=null;Pt++){if(B&&ht){for(ft=0,!J&&ht.ownerDocument!=x&&(Tr(ht),st=!T);mt=C[ft++];)if(mt(ht,J||x,st)){v.call(Q,ht);break}pt&&(R=vi)}I&&((ht=!mt&&ht)&&lt--,U&&me.push(ht))}if(lt+=Pt,I&&Pt!==lt){for(ft=0;mt=P[ft++];)mt(me,Qt,J,st);if(U){if(lt>0)for(;Pt--;)me[Pt]||Qt[Pt]||(Qt[Pt]=vt.call(Q));Qt=Un(Qt)}v.apply(Q,Qt),pt&&!U&&Qt.length>0&&lt+P.length>1&&f.uniqueSort(Q)}return pt&&(R=vi,d=ke),me};return I?Fe(H):H}function fo(C,P){var I,B=[],H=[],U=gt[C+" "];if(!U){for(P||(P=$i(C)),I=P.length;I--;)U=uo(P[I]),U[N]?B.push(U):H.push(U);U=gt(C,vd(H,B)),U.selector=C}return U}function gl(C,P,I,B){var H,U,J,st,Q,pt=typeof C=="function"&&C,ht=!B&&$i(C=pt.selector||C);if(I=I||[],ht.length===1){if(U=ht[0]=ht[0].slice(0),U.length>2&&(J=U[0]).type==="ID"&&P.nodeType===9&&T&&c.relative[U[1].type]){if(P=(c.find.ID(J.matches[0].replace(gr,pr),P)||[])[0],P)pt&&(P=P.parentNode);else return I;C=C.slice(U.shift().value.length)}for(H=Ke.needsContext.test(C)?0:U.length;H--&&(J=U[H],!c.relative[st=J.type]);)if((Q=c.find[st])&&(B=Q(J.matches[0].replace(gr,pr),ao.test(U[0].type)&&lo(P.parentNode)||P))){if(U.splice(H,1),C=B.length&&Gn(U),!C)return v.apply(I,B),I;break}}return(pt||fo(C,ht))(B,P,!T,I,!P||ao.test(C)&&lo(P.parentNode)||P),I}w.sortStable=N.split("").sort(Ut).join("")===N,Tr(),w.sortDetached=mi(function(C){return C.compareDocumentPosition(x.createElement("fieldset"))&1}),f.find=Dt,f.expr[":"]=f.expr.pseudos,f.unique=f.uniqueSort,Dt.compile=fo,Dt.select=gl,Dt.setDocument=Tr,Dt.tokenize=$i,Dt.escape=f.escapeSelector,Dt.getText=f.text,Dt.isXML=f.isXMLDoc,Dt.selectors=f.expr,Dt.support=f.support,Dt.uniqueSort=f.uniqueSort})();var ot=function(a,c,d){for(var g=[],m=d!==void 0;(a=a[c])&&a.nodeType!==9;)if(a.nodeType===1){if(m&&f(a).is(d))break;g.push(a)}return g},rt=function(a,c){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==c&&d.push(a);return d},xt=f.expr.match.needsContext,Et=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function It(a,c,d){return S(c)?f.grep(a,function(g,m){return!!c.call(g,m,g)!==d}):c.nodeType?f.grep(a,function(g){return g===c!==d}):typeof c!="string"?f.grep(a,function(g){return h.call(c,g)>-1!==d}):f.filter(c,a,d)}f.filter=function(a,c,d){var g=c[0];return d&&(a=":not("+a+")"),c.length===1&&g.nodeType===1?f.find.matchesSelector(g,a)?[g]:[]:f.find.matches(a,f.grep(c,function(m){return m.nodeType===1}))},f.fn.extend({find:function(a){var c,d,g=this.length,m=this;if(typeof a!="string")return this.pushStack(f(a).filter(function(){for(c=0;c<g;c++)if(f.contains(m[c],this))return!0}));for(d=this.pushStack([]),c=0;c<g;c++)f.find(a,m[c],d);return g>1?f.uniqueSort(d):d},filter:function(a){return this.pushStack(It(this,a||[],!1))},not:function(a){return this.pushStack(It(this,a||[],!0))},is:function(a){return!!It(this,typeof a=="string"&&xt.test(a)?f(a):a||[],!1).length}});var Mt,_e=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,ie=f.fn.init=function(a,c,d){var g,m;if(!a)return this;if(d=d||Mt,typeof a=="string")if(a[0]==="<"&&a[a.length-1]===">"&&a.length>=3?g=[null,a,null]:g=_e.exec(a),g&&(g[1]||!c))if(g[1]){if(c=c instanceof f?c[0]:c,f.merge(this,f.parseHTML(g[1],c&&c.nodeType?c.ownerDocument||c:M,!0)),Et.test(g[1])&&f.isPlainObject(c))for(g in c)S(this[g])?this[g](c[g]):this.attr(g,c[g]);return this}else return m=M.getElementById(g[2]),m&&(this[0]=m,this.length=1),this;else return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);else{if(a.nodeType)return this[0]=a,this.length=1,this;if(S(a))return d.ready!==void 0?d.ready(a):a(f)}return f.makeArray(a,this)};ie.prototype=f.fn,Mt=f(M);var ne=/^(?:parents|prev(?:Until|All))/,Ys={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({has:function(a){var c=f(a,this),d=c.length;return this.filter(function(){for(var g=0;g<d;g++)if(f.contains(this,c[g]))return!0})},closest:function(a,c){var d,g=0,m=this.length,v=[],x=typeof a!="string"&&f(a);if(!xt.test(a)){for(;g<m;g++)for(d=this[g];d&&d!==c;d=d.parentNode)if(d.nodeType<11&&(x?x.index(d)>-1:d.nodeType===1&&f.find.matchesSelector(d,a))){v.push(d);break}}return this.pushStack(v.length>1?f.uniqueSort(v):v)},index:function(a){return a?typeof a=="string"?h.call(f(a),this[0]):h.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,c){return this.pushStack(f.uniqueSort(f.merge(this.get(),f(a,c))))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}});function li(a,c){for(;(a=a[c])&&a.nodeType!==1;);return a}f.each({parent:function(a){var c=a.parentNode;return c&&c.nodeType!==11?c:null},parents:function(a){return ot(a,"parentNode")},parentsUntil:function(a,c,d){return ot(a,"parentNode",d)},next:function(a){return li(a,"nextSibling")},prev:function(a){return li(a,"previousSibling")},nextAll:function(a){return ot(a,"nextSibling")},prevAll:function(a){return ot(a,"previousSibling")},nextUntil:function(a,c,d){return ot(a,"nextSibling",d)},prevUntil:function(a,c,d){return ot(a,"previousSibling",d)},siblings:function(a){return rt((a.parentNode||{}).firstChild,a)},children:function(a){return rt(a.firstChild)},contents:function(a){return a.contentDocument!=null&&i(a.contentDocument)?a.contentDocument:(Z(a,"template")&&(a=a.content||a),f.merge([],a.childNodes))}},function(a,c){f.fn[a]=function(d,g){var m=f.map(this,c,d);return a.slice(-5)!=="Until"&&(g=d),g&&typeof g=="string"&&(m=f.filter(g,m)),this.length>1&&(Ys[a]||f.uniqueSort(m),ne.test(a)&&m.reverse()),this.pushStack(m)}});var qt=/[^\x20\t\r\n\f]+/g;function wu(a){var c={};return f.each(a.match(qt)||[],function(d,g){c[g]=!0}),c}f.Callbacks=function(a){a=typeof a=="string"?wu(a):f.extend({},a);var c,d,g,m,v=[],x=[],O=-1,T=function(){for(m=m||a.once,g=c=!0;x.length;O=-1)for(d=x.shift();++O<v.length;)v[O].apply(d[0],d[1])===!1&&a.stopOnFalse&&(O=v.length,d=!1);a.memory||(d=!1),c=!1,m&&(d?v=[]:v="")},j={add:function(){return v&&(d&&!c&&(O=v.length-1,x.push(d)),function W(N){f.each(N,function(R,G){S(G)?(!a.unique||!j.has(G))&&v.push(G):G&&G.length&&K(G)!=="string"&&W(G)})}(arguments),d&&!c&&T()),this},remove:function(){return f.each(arguments,function(W,N){for(var R;(R=f.inArray(N,v,R))>-1;)v.splice(R,1),R<=O&&O--}),this},has:function(W){return W?f.inArray(W,v)>-1:v.length>0},empty:function(){return v&&(v=[]),this},disable:function(){return m=x=[],v=d="",this},disabled:function(){return!v},lock:function(){return m=x=[],!d&&!c&&(v=d=""),this},locked:function(){return!!m},fireWith:function(W,N){return m||(N=N||[],N=[W,N.slice?N.slice():N],x.push(N),c||T()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!g}};return j};function ci(a){return a}function Bn(a){throw a}function Fa(a,c,d,g){var m;try{a&&S(m=a.promise)?m.call(a).done(c).fail(d):a&&S(m=a.then)?m.call(a,c,d):c.apply(void 0,[a].slice(g))}catch(v){d.apply(void 0,[v])}}f.extend({Deferred:function(a){var c=[["notify","progress",f.Callbacks("memory"),f.Callbacks("memory"),2],["resolve","done",f.Callbacks("once memory"),f.Callbacks("once memory"),0,"resolved"],["reject","fail",f.Callbacks("once memory"),f.Callbacks("once memory"),1,"rejected"]],d="pending",g={state:function(){return d},always:function(){return m.done(arguments).fail(arguments),this},catch:function(v){return g.then(null,v)},pipe:function(){var v=arguments;return f.Deferred(function(x){f.each(c,function(O,T){var j=S(v[T[4]])&&v[T[4]];m[T[1]](function(){var W=j&&j.apply(this,arguments);W&&S(W.promise)?W.promise().progress(x.notify).done(x.resolve).fail(x.reject):x[T[0]+"With"](this,j?[W]:arguments)})}),v=null}).promise()},then:function(v,x,O){var T=0;function j(W,N,R,G){return function(){var dt=this,wt=arguments,gt=function(){var Ut,qe;if(!(W<T)){if(Ut=R.apply(dt,wt),Ut===N.promise())throw new TypeError("Thenable self-resolution");qe=Ut&&(typeof Ut=="object"||typeof Ut=="function")&&Ut.then,S(qe)?G?qe.call(Ut,j(T,N,ci,G),j(T,N,Bn,G)):(T++,qe.call(Ut,j(T,N,ci,G),j(T,N,Bn,G),j(T,N,ci,N.notifyWith))):(R!==ci&&(dt=void 0,wt=[Ut]),(G||N.resolveWith)(dt,wt))}},Zt=G?gt:function(){try{gt()}catch(Ut){f.Deferred.exceptionHook&&f.Deferred.exceptionHook(Ut,Zt.error),W+1>=T&&(R!==Bn&&(dt=void 0,wt=[Ut]),N.rejectWith(dt,wt))}};W?Zt():(f.Deferred.getErrorHook?Zt.error=f.Deferred.getErrorHook():f.Deferred.getStackHook&&(Zt.error=f.Deferred.getStackHook()),t.setTimeout(Zt))}}return f.Deferred(function(W){c[0][3].add(j(0,W,S(O)?O:ci,W.notifyWith)),c[1][3].add(j(0,W,S(v)?v:ci)),c[2][3].add(j(0,W,S(x)?x:Bn))}).promise()},promise:function(v){return v!=null?f.extend(v,g):g}},m={};return f.each(c,function(v,x){var O=x[2],T=x[5];g[x[1]]=O.add,T&&O.add(function(){d=T},c[3-v][2].disable,c[3-v][3].disable,c[0][2].lock,c[0][3].lock),O.add(x[3].fire),m[x[0]]=function(){return m[x[0]+"With"](this===m?void 0:this,arguments),this},m[x[0]+"With"]=O.fireWith}),g.promise(m),a&&a.call(m,m),m},when:function(a){var c=arguments.length,d=c,g=Array(d),m=s.call(arguments),v=f.Deferred(),x=function(O){return function(T){g[O]=this,m[O]=arguments.length>1?s.call(arguments):T,--c||v.resolveWith(g,m)}};if(c<=1&&(Fa(a,v.done(x(d)).resolve,v.reject,!c),v.state()==="pending"||S(m[d]&&m[d].then)))return v.then();for(;d--;)Fa(m[d],x(d),v.reject);return v.promise()}});var _u=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;f.Deferred.exceptionHook=function(a,c){t.console&&t.console.warn&&a&&_u.test(a.name)&&t.console.warn("jQuery.Deferred exception: "+a.message,a.stack,c)},f.readyException=function(a){t.setTimeout(function(){throw a})};var zs=f.Deferred();f.fn.ready=function(a){return zs.then(a).catch(function(c){f.readyException(c)}),this},f.extend({isReady:!1,readyWait:1,ready:function(a){(a===!0?--f.readyWait:f.isReady)||(f.isReady=!0,!(a!==!0&&--f.readyWait>0)&&zs.resolveWith(M,[f]))}}),f.ready.then=zs.then;function Wn(){M.removeEventListener("DOMContentLoaded",Wn),t.removeEventListener("load",Wn),f.ready()}M.readyState==="complete"||M.readyState!=="loading"&&!M.documentElement.doScroll?t.setTimeout(f.ready):(M.addEventListener("DOMContentLoaded",Wn),t.addEventListener("load",Wn));var dr=function(a,c,d,g,m,v,x){var O=0,T=a.length,j=d==null;if(K(d)==="object"){m=!0;for(O in d)dr(a,c,O,d[O],!0,v,x)}else if(g!==void 0&&(m=!0,S(g)||(x=!0),j&&(x?(c.call(a,g),c=null):(j=c,c=function(W,N,R){return j.call(f(W),R)})),c))for(;O<T;O++)c(a[O],d,x?g:g.call(a[O],O,c(a[O],d)));return m?a:j?c.call(a):T?c(a[0],d):v},Cu=/^-ms-/,Su=/-([a-z])/g;function Tu(a,c){return c.toUpperCase()}function Ge(a){return a.replace(Cu,"ms-").replace(Su,Tu)}var Wi=function(a){return a.nodeType===1||a.nodeType===9||!+a.nodeType};function Hi(){this.expando=f.expando+Hi.uid++}Hi.uid=1,Hi.prototype={cache:function(a){var c=a[this.expando];return c||(c={},Wi(a)&&(a.nodeType?a[this.expando]=c:Object.defineProperty(a,this.expando,{value:c,configurable:!0}))),c},set:function(a,c,d){var g,m=this.cache(a);if(typeof c=="string")m[Ge(c)]=d;else for(g in c)m[Ge(g)]=c[g];return m},get:function(a,c){return c===void 0?this.cache(a):a[this.expando]&&a[this.expando][Ge(c)]},access:function(a,c,d){return c===void 0||c&&typeof c=="string"&&d===void 0?this.get(a,c):(this.set(a,c,d),d!==void 0?d:c)},remove:function(a,c){var d,g=a[this.expando];if(g!==void 0){if(c!==void 0)for(Array.isArray(c)?c=c.map(Ge):(c=Ge(c),c=c in g?[c]:c.match(qt)||[]),d=c.length;d--;)delete g[c[d]];(c===void 0||f.isEmptyObject(g))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var c=a[this.expando];return c!==void 0&&!f.isEmptyObject(c)}};var at=new Hi,fe=new Hi,Ou=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ku=/[A-Z]/g;function Du(a){return a==="true"?!0:a==="false"?!1:a==="null"?null:a===+a+""?+a:Ou.test(a)?JSON.parse(a):a}function La(a,c,d){var g;if(d===void 0&&a.nodeType===1)if(g="data-"+c.replace(ku,"-$&").toLowerCase(),d=a.getAttribute(g),typeof d=="string"){try{d=Du(d)}catch{}fe.set(a,c,d)}else d=void 0;return d}f.extend({hasData:function(a){return fe.hasData(a)||at.hasData(a)},data:function(a,c,d){return fe.access(a,c,d)},removeData:function(a,c){fe.remove(a,c)},_data:function(a,c,d){return at.access(a,c,d)},_removeData:function(a,c){at.remove(a,c)}}),f.fn.extend({data:function(a,c){var d,g,m,v=this[0],x=v&&v.attributes;if(a===void 0){if(this.length&&(m=fe.get(v),v.nodeType===1&&!at.get(v,"hasDataAttrs"))){for(d=x.length;d--;)x[d]&&(g=x[d].name,g.indexOf("data-")===0&&(g=Ge(g.slice(5)),La(v,g,m[g])));at.set(v,"hasDataAttrs",!0)}return m}return typeof a=="object"?this.each(function(){fe.set(this,a)}):dr(this,function(O){var T;if(v&&O===void 0)return T=fe.get(v,a),T!==void 0||(T=La(v,a),T!==void 0)?T:void 0;this.each(function(){fe.set(this,a,O)})},null,c,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){fe.remove(this,a)})}}),f.extend({queue:function(a,c,d){var g;if(a)return c=(c||"fx")+"queue",g=at.get(a,c),d&&(!g||Array.isArray(d)?g=at.access(a,c,f.makeArray(d)):g.push(d)),g||[]},dequeue:function(a,c){c=c||"fx";var d=f.queue(a,c),g=d.length,m=d.shift(),v=f._queueHooks(a,c),x=function(){f.dequeue(a,c)};m==="inprogress"&&(m=d.shift(),g--),m&&(c==="fx"&&d.unshift("inprogress"),delete v.stop,m.call(a,x,v)),!g&&v&&v.empty.fire()},_queueHooks:function(a,c){var d=c+"queueHooks";return at.get(a,d)||at.access(a,d,{empty:f.Callbacks("once memory").add(function(){at.remove(a,[c+"queue",d])})})}}),f.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?f.queue(this[0],a):c===void 0?this:this.each(function(){var g=f.queue(this,a,c);f._queueHooks(this,a),a==="fx"&&g[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,g=1,m=f.Deferred(),v=this,x=this.length,O=function(){--g||m.resolveWith(v,[v])};for(typeof a!="string"&&(c=a,a=void 0),a=a||"fx";x--;)d=at.get(v[x],a+"queueHooks"),d&&d.empty&&(g++,d.empty.add(O));return O(),m.promise(c)}});var Ia=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ni=new RegExp("^(?:([+-])=|)("+Ia+")([a-z%]*)$","i"),fr=["Top","Right","Bottom","Left"],Rr=M.documentElement,hi=function(a){return f.contains(a.ownerDocument,a)},Au={composed:!0};Rr.getRootNode&&(hi=function(a){return f.contains(a.ownerDocument,a)||a.getRootNode(Au)===a.ownerDocument});var Hn=function(a,c){return a=c||a,a.style.display==="none"||a.style.display===""&&hi(a)&&f.css(a,"display")==="none"};function Ra(a,c,d,g){var m,v,x=20,O=g?function(){return g.cur()}:function(){return f.css(a,c,"")},T=O(),j=d&&d[3]||(f.cssNumber[c]?"":"px"),W=a.nodeType&&(f.cssNumber[c]||j!=="px"&&+T)&&Ni.exec(f.css(a,c));if(W&&W[3]!==j){for(T=T/2,j=j||W[3],W=+T||1;x--;)f.style(a,c,W+j),(1-v)*(1-(v=O()/T||.5))<=0&&(x=0),W=W/v;W=W*2,f.style(a,c,W+j),d=d||[]}return d&&(W=+W||+T||0,m=d[1]?W+(d[1]+1)*d[2]:+d[2],g&&(g.unit=j,g.start=W,g.end=m)),m}var Ba={};function Eu(a){var c,d=a.ownerDocument,g=a.nodeName,m=Ba[g];return m||(c=d.body.appendChild(d.createElement(g)),m=f.css(c,"display"),c.parentNode.removeChild(c),m==="none"&&(m="block"),Ba[g]=m,m)}function ui(a,c){for(var d,g,m=[],v=0,x=a.length;v<x;v++)g=a[v],g.style&&(d=g.style.display,c?(d==="none"&&(m[v]=at.get(g,"display")||null,m[v]||(g.style.display="")),g.style.display===""&&Hn(g)&&(m[v]=Eu(g))):d!=="none"&&(m[v]="none",at.set(g,"display",d)));for(v=0;v<x;v++)m[v]!=null&&(a[v].style.display=m[v]);return a}f.fn.extend({show:function(){return ui(this,!0)},hide:function(){return ui(this)},toggle:function(a){return typeof a=="boolean"?a?this.show():this.hide():this.each(function(){Hn(this)?f(this).show():f(this).hide()})}});var Xi=/^(?:checkbox|radio)$/i,Wa=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ha=/^$|^module$|\/(?:java|ecma)script/i;(function(){var a=M.createDocumentFragment(),c=a.appendChild(M.createElement("div")),d=M.createElement("input");d.setAttribute("type","radio"),d.setAttribute("checked","checked"),d.setAttribute("name","t"),c.appendChild(d),w.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked,c.innerHTML="<textarea>x</textarea>",w.noCloneChecked=!!c.cloneNode(!0).lastChild.defaultValue,c.innerHTML="<option></option>",w.option=!!c.lastChild})();var Te={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Te.tbody=Te.tfoot=Te.colgroup=Te.caption=Te.thead,Te.th=Te.td,w.option||(Te.optgroup=Te.option=[1,"<select multiple='multiple'>","</select>"]);function ge(a,c){var d;return typeof a.getElementsByTagName<"u"?d=a.getElementsByTagName(c||"*"):typeof a.querySelectorAll<"u"?d=a.querySelectorAll(c||"*"):d=[],c===void 0||c&&Z(a,c)?f.merge([a],d):d}function Gs(a,c){for(var d=0,g=a.length;d<g;d++)at.set(a[d],"globalEval",!c||at.get(c[d],"globalEval"))}var Pu=/<|&#?\w+;/;function Na(a,c,d,g,m){for(var v,x,O,T,j,W,N=c.createDocumentFragment(),R=[],G=0,dt=a.length;G<dt;G++)if(v=a[G],v||v===0)if(K(v)==="object")f.merge(R,v.nodeType?[v]:v);else if(!Pu.test(v))R.push(c.createTextNode(v));else{for(x=x||N.appendChild(c.createElement("div")),O=(Wa.exec(v)||["",""])[1].toLowerCase(),T=Te[O]||Te._default,x.innerHTML=T[1]+f.htmlPrefilter(v)+T[2],W=T[0];W--;)x=x.lastChild;f.merge(R,x.childNodes),x=N.firstChild,x.textContent=""}for(N.textContent="",G=0;v=R[G++];){if(g&&f.inArray(v,g)>-1){m&&m.push(v);continue}if(j=hi(v),x=ge(N.appendChild(v),"script"),j&&Gs(x),d)for(W=0;v=x[W++];)Ha.test(v.type||"")&&d.push(v)}return N}var Xa=/^([^.]*)(?:\.(.+)|)/;function di(){return!0}function fi(){return!1}function qs(a,c,d,g,m,v){var x,O;if(typeof c=="object"){typeof d!="string"&&(g=g||d,d=void 0);for(O in c)qs(a,O,d,g,c[O],v);return a}if(g==null&&m==null?(m=d,g=d=void 0):m==null&&(typeof d=="string"?(m=g,g=void 0):(m=g,g=d,d=void 0)),m===!1)m=fi;else if(!m)return a;return v===1&&(x=m,m=function(T){return f().off(T),x.apply(this,arguments)},m.guid=x.guid||(x.guid=f.guid++)),a.each(function(){f.event.add(this,c,m,g,d)})}f.event={global:{},add:function(a,c,d,g,m){var v,x,O,T,j,W,N,R,G,dt,wt,gt=at.get(a);if(Wi(a))for(d.handler&&(v=d,d=v.handler,m=v.selector),m&&f.find.matchesSelector(Rr,m),d.guid||(d.guid=f.guid++),(T=gt.events)||(T=gt.events=Object.create(null)),(x=gt.handle)||(x=gt.handle=function(Zt){return typeof f<"u"&&f.event.triggered!==Zt.type?f.event.dispatch.apply(a,arguments):void 0}),c=(c||"").match(qt)||[""],j=c.length;j--;)O=Xa.exec(c[j])||[],G=wt=O[1],dt=(O[2]||"").split(".").sort(),G&&(N=f.event.special[G]||{},G=(m?N.delegateType:N.bindType)||G,N=f.event.special[G]||{},W=f.extend({type:G,origType:wt,data:g,handler:d,guid:d.guid,selector:m,needsContext:m&&f.expr.match.needsContext.test(m),namespace:dt.join(".")},v),(R=T[G])||(R=T[G]=[],R.delegateCount=0,(!N.setup||N.setup.call(a,g,dt,x)===!1)&&a.addEventListener&&a.addEventListener(G,x)),N.add&&(N.add.call(a,W),W.handler.guid||(W.handler.guid=d.guid)),m?R.splice(R.delegateCount++,0,W):R.push(W),f.event.global[G]=!0)},remove:function(a,c,d,g,m){var v,x,O,T,j,W,N,R,G,dt,wt,gt=at.hasData(a)&&at.get(a);if(!(!gt||!(T=gt.events))){for(c=(c||"").match(qt)||[""],j=c.length;j--;){if(O=Xa.exec(c[j])||[],G=wt=O[1],dt=(O[2]||"").split(".").sort(),!G){for(G in T)f.event.remove(a,G+c[j],d,g,!0);continue}for(N=f.event.special[G]||{},G=(g?N.delegateType:N.bindType)||G,R=T[G]||[],O=O[2]&&new RegExp("(^|\\.)"+dt.join("\\.(?:.*\\.|)")+"(\\.|$)"),x=v=R.length;v--;)W=R[v],(m||wt===W.origType)&&(!d||d.guid===W.guid)&&(!O||O.test(W.namespace))&&(!g||g===W.selector||g==="**"&&W.selector)&&(R.splice(v,1),W.selector&&R.delegateCount--,N.remove&&N.remove.call(a,W));x&&!R.length&&((!N.teardown||N.teardown.call(a,dt,gt.handle)===!1)&&f.removeEvent(a,G,gt.handle),delete T[G])}f.isEmptyObject(T)&&at.remove(a,"handle events")}},dispatch:function(a){var c,d,g,m,v,x,O=new Array(arguments.length),T=f.event.fix(a),j=(at.get(this,"events")||Object.create(null))[T.type]||[],W=f.event.special[T.type]||{};for(O[0]=T,c=1;c<arguments.length;c++)O[c]=arguments[c];if(T.delegateTarget=this,!(W.preDispatch&&W.preDispatch.call(this,T)===!1)){for(x=f.event.handlers.call(this,T,j),c=0;(m=x[c++])&&!T.isPropagationStopped();)for(T.currentTarget=m.elem,d=0;(v=m.handlers[d++])&&!T.isImmediatePropagationStopped();)(!T.rnamespace||v.namespace===!1||T.rnamespace.test(v.namespace))&&(T.handleObj=v,T.data=v.data,g=((f.event.special[v.origType]||{}).handle||v.handler).apply(m.elem,O),g!==void 0&&(T.result=g)===!1&&(T.preventDefault(),T.stopPropagation()));return W.postDispatch&&W.postDispatch.call(this,T),T.result}},handlers:function(a,c){var d,g,m,v,x,O=[],T=c.delegateCount,j=a.target;if(T&&j.nodeType&&!(a.type==="click"&&a.button>=1)){for(;j!==this;j=j.parentNode||this)if(j.nodeType===1&&!(a.type==="click"&&j.disabled===!0)){for(v=[],x={},d=0;d<T;d++)g=c[d],m=g.selector+" ",x[m]===void 0&&(x[m]=g.needsContext?f(m,this).index(j)>-1:f.find(m,this,null,[j]).length),x[m]&&v.push(g);v.length&&O.push({elem:j,handlers:v})}}return j=this,T<c.length&&O.push({elem:j,handlers:c.slice(T)}),O},addProp:function(a,c){Object.defineProperty(f.Event.prototype,a,{enumerable:!0,configurable:!0,get:S(c)?function(){if(this.originalEvent)return c(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(d){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:d})}})},fix:function(a){return a[f.expando]?a:new f.Event(a)},special:{load:{noBubble:!0},click:{setup:function(a){var c=this||a;return Xi.test(c.type)&&c.click&&Z(c,"input")&&Nn(c,"click",!0),!1},trigger:function(a){var c=this||a;return Xi.test(c.type)&&c.click&&Z(c,"input")&&Nn(c,"click"),!0},_default:function(a){var c=a.target;return Xi.test(c.type)&&c.click&&Z(c,"input")&&at.get(c,"click")||Z(c,"a")}},beforeunload:{postDispatch:function(a){a.result!==void 0&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}};function Nn(a,c,d){if(!d){at.get(a,c)===void 0&&f.event.add(a,c,di);return}at.set(a,c,!1),f.event.add(a,c,{namespace:!1,handler:function(g){var m,v=at.get(this,c);if(g.isTrigger&1&&this[c]){if(v)(f.event.special[c]||{}).delegateType&&g.stopPropagation();else if(v=s.call(arguments),at.set(this,c,v),this[c](),m=at.get(this,c),at.set(this,c,!1),v!==m)return g.stopImmediatePropagation(),g.preventDefault(),m}else v&&(at.set(this,c,f.event.trigger(v[0],v.slice(1),this)),g.stopPropagation(),g.isImmediatePropagationStopped=di)}})}f.removeEvent=function(a,c,d){a.removeEventListener&&a.removeEventListener(c,d)},f.Event=function(a,c){if(!(this instanceof f.Event))return new f.Event(a,c);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.defaultPrevented===void 0&&a.returnValue===!1?di:fi,this.target=a.target&&a.target.nodeType===3?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,c&&f.extend(this,c),this.timeStamp=a&&a.timeStamp||Date.now(),this[f.expando]=!0},f.Event.prototype={constructor:f.Event,isDefaultPrevented:fi,isPropagationStopped:fi,isImmediatePropagationStopped:fi,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=di,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=di,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=di,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},f.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},f.event.addProp),f.each({focus:"focusin",blur:"focusout"},function(a,c){function d(g){if(M.documentMode){var m=at.get(this,"handle"),v=f.event.fix(g);v.type=g.type==="focusin"?"focus":"blur",v.isSimulated=!0,m(g),v.target===v.currentTarget&&m(v)}else f.event.simulate(c,g.target,f.event.fix(g))}f.event.special[a]={setup:function(){var g;if(Nn(this,a,!0),M.documentMode)g=at.get(this,c),g||this.addEventListener(c,d),at.set(this,c,(g||0)+1);else return!1},trigger:function(){return Nn(this,a),!0},teardown:function(){var g;if(M.documentMode)g=at.get(this,c)-1,g?at.set(this,c,g):(this.removeEventListener(c,d),at.remove(this,c));else return!1},_default:function(g){return at.get(g.target,a)},delegateType:c},f.event.special[c]={setup:function(){var g=this.ownerDocument||this.document||this,m=M.documentMode?this:g,v=at.get(m,c);v||(M.documentMode?this.addEventListener(c,d):g.addEventListener(a,d,!0)),at.set(m,c,(v||0)+1)},teardown:function(){var g=this.ownerDocument||this.document||this,m=M.documentMode?this:g,v=at.get(m,c)-1;v?at.set(m,c,v):(M.documentMode?this.removeEventListener(c,d):g.removeEventListener(a,d,!0),at.remove(m,c))}}}),f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,c){f.event.special[a]={delegateType:c,bindType:c,handle:function(d){var g,m=this,v=d.relatedTarget,x=d.handleObj;return(!v||v!==m&&!f.contains(m,v))&&(d.type=x.origType,g=x.handler.apply(this,arguments),d.type=c),g}}}),f.fn.extend({on:function(a,c,d,g){return qs(this,a,c,d,g)},one:function(a,c,d,g){return qs(this,a,c,d,g,1)},off:function(a,c,d){var g,m;if(a&&a.preventDefault&&a.handleObj)return g=a.handleObj,f(a.delegateTarget).off(g.namespace?g.origType+"."+g.namespace:g.origType,g.selector,g.handler),this;if(typeof a=="object"){for(m in a)this.off(m,c,a[m]);return this}return(c===!1||typeof c=="function")&&(d=c,c=void 0),d===!1&&(d=fi),this.each(function(){f.event.remove(this,a,d,c)})}});var Mu=/<script|<style|<link/i,ju=/checked\s*(?:[^=]|=\s*.checked.)/i,Fu=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Va(a,c){return Z(a,"table")&&Z(c.nodeType!==11?c:c.firstChild,"tr")&&f(a).children("tbody")[0]||a}function Lu(a){return a.type=(a.getAttribute("type")!==null)+"/"+a.type,a}function Iu(a){return(a.type||"").slice(0,5)==="true/"?a.type=a.type.slice(5):a.removeAttribute("type"),a}function Ya(a,c){var d,g,m,v,x,O,T;if(c.nodeType===1){if(at.hasData(a)&&(v=at.get(a),T=v.events,T)){at.remove(c,"handle events");for(m in T)for(d=0,g=T[m].length;d<g;d++)f.event.add(c,m,T[m][d])}fe.hasData(a)&&(x=fe.access(a),O=f.extend({},x),fe.set(c,O))}}function Ru(a,c){var d=c.nodeName.toLowerCase();d==="input"&&Xi.test(a.type)?c.checked=a.checked:(d==="input"||d==="textarea")&&(c.defaultValue=a.defaultValue)}function gi(a,c,d,g){c=o(c);var m,v,x,O,T,j,W=0,N=a.length,R=N-1,G=c[0],dt=S(G);if(dt||N>1&&typeof G=="string"&&!w.checkClone&&ju.test(G))return a.each(function(wt){var gt=a.eq(wt);dt&&(c[0]=G.call(this,wt,gt.html())),gi(gt,c,d,g)});if(N&&(m=Na(c,a[0].ownerDocument,!1,a,g),v=m.firstChild,m.childNodes.length===1&&(m=v),v||g)){for(x=f.map(ge(m,"script"),Lu),O=x.length;W<N;W++)T=m,W!==R&&(T=f.clone(T,!0,!0),O&&f.merge(x,ge(T,"script"))),d.call(a[W],T,W);if(O)for(j=x[x.length-1].ownerDocument,f.map(x,Iu),W=0;W<O;W++)T=x[W],Ha.test(T.type||"")&&!at.access(T,"globalEval")&&f.contains(j,T)&&(T.src&&(T.type||"").toLowerCase()!=="module"?f._evalUrl&&!T.noModule&&f._evalUrl(T.src,{nonce:T.nonce||T.getAttribute("nonce")},j):q(T.textContent.replace(Fu,""),T,j))}return a}function za(a,c,d){for(var g,m=c?f.filter(c,a):a,v=0;(g=m[v])!=null;v++)!d&&g.nodeType===1&&f.cleanData(ge(g)),g.parentNode&&(d&&hi(g)&&Gs(ge(g,"script")),g.parentNode.removeChild(g));return a}f.extend({htmlPrefilter:function(a){return a},clone:function(a,c,d){var g,m,v,x,O=a.cloneNode(!0),T=hi(a);if(!w.noCloneChecked&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a))for(x=ge(O),v=ge(a),g=0,m=v.length;g<m;g++)Ru(v[g],x[g]);if(c)if(d)for(v=v||ge(a),x=x||ge(O),g=0,m=v.length;g<m;g++)Ya(v[g],x[g]);else Ya(a,O);return x=ge(O,"script"),x.length>0&&Gs(x,!T&&ge(a,"script")),O},cleanData:function(a){for(var c,d,g,m=f.event.special,v=0;(d=a[v])!==void 0;v++)if(Wi(d)){if(c=d[at.expando]){if(c.events)for(g in c.events)m[g]?f.event.remove(d,g):f.removeEvent(d,g,c.handle);d[at.expando]=void 0}d[fe.expando]&&(d[fe.expando]=void 0)}}}),f.fn.extend({detach:function(a){return za(this,a,!0)},remove:function(a){return za(this,a)},text:function(a){return dr(this,function(c){return c===void 0?f.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=c)})},null,a,arguments.length)},append:function(){return gi(this,arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var c=Va(this,a);c.appendChild(a)}})},prepend:function(){return gi(this,arguments,function(a){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var c=Va(this,a);c.insertBefore(a,c.firstChild)}})},before:function(){return gi(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return gi(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,c=0;(a=this[c])!=null;c++)a.nodeType===1&&(f.cleanData(ge(a,!1)),a.textContent="");return this},clone:function(a,c){return a=a??!1,c=c??a,this.map(function(){return f.clone(this,a,c)})},html:function(a){return dr(this,function(c){var d=this[0]||{},g=0,m=this.length;if(c===void 0&&d.nodeType===1)return d.innerHTML;if(typeof c=="string"&&!Mu.test(c)&&!Te[(Wa.exec(c)||["",""])[1].toLowerCase()]){c=f.htmlPrefilter(c);try{for(;g<m;g++)d=this[g]||{},d.nodeType===1&&(f.cleanData(ge(d,!1)),d.innerHTML=c);d=0}catch{}}d&&this.empty().append(c)},null,a,arguments.length)},replaceWith:function(){var a=[];return gi(this,arguments,function(c){var d=this.parentNode;f.inArray(this,a)<0&&(f.cleanData(ge(this)),d&&d.replaceChild(c,this))},a)}}),f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){f.fn[a]=function(d){for(var g,m=[],v=f(d),x=v.length-1,O=0;O<=x;O++)g=O===x?this:this.clone(!0),f(v[O])[c](g),l.apply(m,g.get());return this.pushStack(m)}});var Us=new RegExp("^("+Ia+")(?!px)[a-z%]+$","i"),$s=/^--/,Xn=function(a){var c=a.ownerDocument.defaultView;return(!c||!c.opener)&&(c=t),c.getComputedStyle(a)},Ga=function(a,c,d){var g,m,v={};for(m in c)v[m]=a.style[m],a.style[m]=c[m];g=d.call(a);for(m in c)a.style[m]=v[m];return g},Bu=new RegExp(fr.join("|"),"i");(function(){function a(){if(j){T.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",j.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Rr.appendChild(T).appendChild(j);var W=t.getComputedStyle(j);d=W.top!=="1%",O=c(W.marginLeft)===12,j.style.right="60%",v=c(W.right)===36,g=c(W.width)===36,j.style.position="absolute",m=c(j.offsetWidth/3)===12,Rr.removeChild(T),j=null}}function c(W){return Math.round(parseFloat(W))}var d,g,m,v,x,O,T=M.createElement("div"),j=M.createElement("div");j.style&&(j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",w.clearCloneStyle=j.style.backgroundClip==="content-box",f.extend(w,{boxSizingReliable:function(){return a(),g},pixelBoxStyles:function(){return a(),v},pixelPosition:function(){return a(),d},reliableMarginLeft:function(){return a(),O},scrollboxSize:function(){return a(),m},reliableTrDimensions:function(){var W,N,R,G;return x==null&&(W=M.createElement("table"),N=M.createElement("tr"),R=M.createElement("div"),W.style.cssText="position:absolute;left:-11111px;border-collapse:separate",N.style.cssText="box-sizing:content-box;border:1px solid",N.style.height="1px",R.style.height="9px",R.style.display="block",Rr.appendChild(W).appendChild(N).appendChild(R),G=t.getComputedStyle(N),x=parseInt(G.height,10)+parseInt(G.borderTopWidth,10)+parseInt(G.borderBottomWidth,10)===N.offsetHeight,Rr.removeChild(W)),x}}))})();function Vi(a,c,d){var g,m,v,x,O=$s.test(c),T=a.style;return d=d||Xn(a),d&&(x=d.getPropertyValue(c)||d[c],O&&x&&(x=x.replace(yt,"$1")||void 0),x===""&&!hi(a)&&(x=f.style(a,c)),!w.pixelBoxStyles()&&Us.test(x)&&Bu.test(c)&&(g=T.width,m=T.minWidth,v=T.maxWidth,T.minWidth=T.maxWidth=T.width=x,x=d.width,T.width=g,T.minWidth=m,T.maxWidth=v)),x!==void 0?x+"":x}function qa(a,c){return{get:function(){if(a()){delete this.get;return}return(this.get=c).apply(this,arguments)}}}var Ua=["Webkit","Moz","ms"],$a=M.createElement("div").style,Ka={};function Wu(a){for(var c=a[0].toUpperCase()+a.slice(1),d=Ua.length;d--;)if(a=Ua[d]+c,a in $a)return a}function Ks(a){var c=f.cssProps[a]||Ka[a];return c||(a in $a?a:Ka[a]=Wu(a)||a)}var Hu=/^(none|table(?!-c[ea]).+)/,Nu={position:"absolute",visibility:"hidden",display:"block"},Za={letterSpacing:"0",fontWeight:"400"};function Ja(a,c,d){var g=Ni.exec(c);return g?Math.max(0,g[2]-(d||0))+(g[3]||"px"):c}function Zs(a,c,d,g,m,v){var x=c==="width"?1:0,O=0,T=0,j=0;if(d===(g?"border":"content"))return 0;for(;x<4;x+=2)d==="margin"&&(j+=f.css(a,d+fr[x],!0,m)),g?(d==="content"&&(T-=f.css(a,"padding"+fr[x],!0,m)),d!=="margin"&&(T-=f.css(a,"border"+fr[x]+"Width",!0,m))):(T+=f.css(a,"padding"+fr[x],!0,m),d!=="padding"?T+=f.css(a,"border"+fr[x]+"Width",!0,m):O+=f.css(a,"border"+fr[x]+"Width",!0,m));return!g&&v>=0&&(T+=Math.max(0,Math.ceil(a["offset"+c[0].toUpperCase()+c.slice(1)]-v-T-O-.5))||0),T+j}function Qa(a,c,d){var g=Xn(a),m=!w.boxSizingReliable()||d,v=m&&f.css(a,"boxSizing",!1,g)==="border-box",x=v,O=Vi(a,c,g),T="offset"+c[0].toUpperCase()+c.slice(1);if(Us.test(O)){if(!d)return O;O="auto"}return(!w.boxSizingReliable()&&v||!w.reliableTrDimensions()&&Z(a,"tr")||O==="auto"||!parseFloat(O)&&f.css(a,"display",!1,g)==="inline")&&a.getClientRects().length&&(v=f.css(a,"boxSizing",!1,g)==="border-box",x=T in a,x&&(O=a[T])),O=parseFloat(O)||0,O+Zs(a,c,d||(v?"border":"content"),x,g,O)+"px"}f.extend({cssHooks:{opacity:{get:function(a,c){if(c){var d=Vi(a,"opacity");return d===""?"1":d}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(a,c,d,g){if(!(!a||a.nodeType===3||a.nodeType===8||!a.style)){var m,v,x,O=Ge(c),T=$s.test(c),j=a.style;if(T||(c=Ks(O)),x=f.cssHooks[c]||f.cssHooks[O],d!==void 0){if(v=typeof d,v==="string"&&(m=Ni.exec(d))&&m[1]&&(d=Ra(a,c,m),v="number"),d==null||d!==d)return;v==="number"&&!T&&(d+=m&&m[3]||(f.cssNumber[O]?"":"px")),!w.clearCloneStyle&&d===""&&c.indexOf("background")===0&&(j[c]="inherit"),(!x||!("set"in x)||(d=x.set(a,d,g))!==void 0)&&(T?j.setProperty(c,d):j[c]=d)}else return x&&"get"in x&&(m=x.get(a,!1,g))!==void 0?m:j[c]}},css:function(a,c,d,g){var m,v,x,O=Ge(c),T=$s.test(c);return T||(c=Ks(O)),x=f.cssHooks[c]||f.cssHooks[O],x&&"get"in x&&(m=x.get(a,!0,d)),m===void 0&&(m=Vi(a,c,g)),m==="normal"&&c in Za&&(m=Za[c]),d===""||d?(v=parseFloat(m),d===!0||isFinite(v)?v||0:m):m}}),f.each(["height","width"],function(a,c){f.cssHooks[c]={get:function(d,g,m){if(g)return Hu.test(f.css(d,"display"))&&(!d.getClientRects().length||!d.getBoundingClientRect().width)?Ga(d,Nu,function(){return Qa(d,c,m)}):Qa(d,c,m)},set:function(d,g,m){var v,x=Xn(d),O=!w.scrollboxSize()&&x.position==="absolute",T=O||m,j=T&&f.css(d,"boxSizing",!1,x)==="border-box",W=m?Zs(d,c,m,j,x):0;return j&&O&&(W-=Math.ceil(d["offset"+c[0].toUpperCase()+c.slice(1)]-parseFloat(x[c])-Zs(d,c,"border",!1,x)-.5)),W&&(v=Ni.exec(g))&&(v[3]||"px")!=="px"&&(d.style[c]=g,g=f.css(d,c)),Ja(d,g,W)}}}),f.cssHooks.marginLeft=qa(w.reliableMarginLeft,function(a,c){if(c)return(parseFloat(Vi(a,"marginLeft"))||a.getBoundingClientRect().left-Ga(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),f.each({margin:"",padding:"",border:"Width"},function(a,c){f.cssHooks[a+c]={expand:function(d){for(var g=0,m={},v=typeof d=="string"?d.split(" "):[d];g<4;g++)m[a+fr[g]+c]=v[g]||v[g-2]||v[0];return m}},a!=="margin"&&(f.cssHooks[a+c].set=Ja)}),f.fn.extend({css:function(a,c){return dr(this,function(d,g,m){var v,x,O={},T=0;if(Array.isArray(g)){for(v=Xn(d),x=g.length;T<x;T++)O[g[T]]=f.css(d,g[T],!1,v);return O}return m!==void 0?f.style(d,g,m):f.css(d,g)},a,c,arguments.length>1)}});function pe(a,c,d,g,m){return new pe.prototype.init(a,c,d,g,m)}f.Tween=pe,pe.prototype={constructor:pe,init:function(a,c,d,g,m,v){this.elem=a,this.prop=d,this.easing=m||f.easing._default,this.options=c,this.start=this.now=this.cur(),this.end=g,this.unit=v||(f.cssNumber[d]?"":"px")},cur:function(){var a=pe.propHooks[this.prop];return a&&a.get?a.get(this):pe.propHooks._default.get(this)},run:function(a){var c,d=pe.propHooks[this.prop];return this.options.duration?this.pos=c=f.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=c=a,this.now=(this.end-this.start)*c+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),d&&d.set?d.set(this):pe.propHooks._default.set(this),this}},pe.prototype.init.prototype=pe.prototype,pe.propHooks={_default:{get:function(a){var c;return a.elem.nodeType!==1||a.elem[a.prop]!=null&&a.elem.style[a.prop]==null?a.elem[a.prop]:(c=f.css(a.elem,a.prop,""),!c||c==="auto"?0:c)},set:function(a){f.fx.step[a.prop]?f.fx.step[a.prop](a):a.elem.nodeType===1&&(f.cssHooks[a.prop]||a.elem.style[Ks(a.prop)]!=null)?f.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},pe.propHooks.scrollTop=pe.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},f.easing={linear:function(a){return a},swing:function(a){return .5-Math.cos(a*Math.PI)/2},_default:"swing"},f.fx=pe.prototype.init,f.fx.step={};var pi,Vn,Xu=/^(?:toggle|show|hide)$/,Vu=/queueHooks$/;function Js(){Vn&&(M.hidden===!1&&t.requestAnimationFrame?t.requestAnimationFrame(Js):t.setTimeout(Js,f.fx.interval),f.fx.tick())}function tl(){return t.setTimeout(function(){pi=void 0}),pi=Date.now()}function Yn(a,c){var d,g=0,m={height:a};for(c=c?1:0;g<4;g+=2-c)d=fr[g],m["margin"+d]=m["padding"+d]=a;return c&&(m.opacity=m.width=a),m}function el(a,c,d){for(var g,m=(je.tweeners[c]||[]).concat(je.tweeners["*"]),v=0,x=m.length;v<x;v++)if(g=m[v].call(d,c,a))return g}function Yu(a,c,d){var g,m,v,x,O,T,j,W,N="width"in c||"height"in c,R=this,G={},dt=a.style,wt=a.nodeType&&Hn(a),gt=at.get(a,"fxshow");d.queue||(x=f._queueHooks(a,"fx"),x.unqueued==null&&(x.unqueued=0,O=x.empty.fire,x.empty.fire=function(){x.unqueued||O()}),x.unqueued++,R.always(function(){R.always(function(){x.unqueued--,f.queue(a,"fx").length||x.empty.fire()})}));for(g in c)if(m=c[g],Xu.test(m)){if(delete c[g],v=v||m==="toggle",m===(wt?"hide":"show"))if(m==="show"&&gt&&gt[g]!==void 0)wt=!0;else continue;G[g]=gt&&gt[g]||f.style(a,g)}if(T=!f.isEmptyObject(c),!(!T&&f.isEmptyObject(G))){N&&a.nodeType===1&&(d.overflow=[dt.overflow,dt.overflowX,dt.overflowY],j=gt&&gt.display,j==null&&(j=at.get(a,"display")),W=f.css(a,"display"),W==="none"&&(j?W=j:(ui([a],!0),j=a.style.display||j,W=f.css(a,"display"),ui([a]))),(W==="inline"||W==="inline-block"&&j!=null)&&f.css(a,"float")==="none"&&(T||(R.done(function(){dt.display=j}),j==null&&(W=dt.display,j=W==="none"?"":W)),dt.display="inline-block")),d.overflow&&(dt.overflow="hidden",R.always(function(){dt.overflow=d.overflow[0],dt.overflowX=d.overflow[1],dt.overflowY=d.overflow[2]})),T=!1;for(g in G)T||(gt?"hidden"in gt&&(wt=gt.hidden):gt=at.access(a,"fxshow",{display:j}),v&&(gt.hidden=!wt),wt&&ui([a],!0),R.done(function(){wt||ui([a]),at.remove(a,"fxshow");for(g in G)f.style(a,g,G[g])})),T=el(wt?gt[g]:0,g,R),g in gt||(gt[g]=T.start,wt&&(T.end=T.start,T.start=0))}}function zu(a,c){var d,g,m,v,x;for(d in a)if(g=Ge(d),m=c[g],v=a[d],Array.isArray(v)&&(m=v[1],v=a[d]=v[0]),d!==g&&(a[g]=v,delete a[d]),x=f.cssHooks[g],x&&"expand"in x){v=x.expand(v),delete a[g];for(d in v)d in a||(a[d]=v[d],c[d]=m)}else c[g]=m}function je(a,c,d){var g,m,v=0,x=je.prefilters.length,O=f.Deferred().always(function(){delete T.elem}),T=function(){if(m)return!1;for(var N=pi||tl(),R=Math.max(0,j.startTime+j.duration-N),G=R/j.duration||0,dt=1-G,wt=0,gt=j.tweens.length;wt<gt;wt++)j.tweens[wt].run(dt);return O.notifyWith(a,[j,dt,R]),dt<1&&gt?R:(gt||O.notifyWith(a,[j,1,0]),O.resolveWith(a,[j]),!1)},j=O.promise({elem:a,props:f.extend({},c),opts:f.extend(!0,{specialEasing:{},easing:f.easing._default},d),originalProperties:c,originalOptions:d,startTime:pi||tl(),duration:d.duration,tweens:[],createTween:function(N,R){var G=f.Tween(a,j.opts,N,R,j.opts.specialEasing[N]||j.opts.easing);return j.tweens.push(G),G},stop:function(N){var R=0,G=N?j.tweens.length:0;if(m)return this;for(m=!0;R<G;R++)j.tweens[R].run(1);return N?(O.notifyWith(a,[j,1,0]),O.resolveWith(a,[j,N])):O.rejectWith(a,[j,N]),this}}),W=j.props;for(zu(W,j.opts.specialEasing);v<x;v++)if(g=je.prefilters[v].call(j,a,W,j.opts),g)return S(g.stop)&&(f._queueHooks(j.elem,j.opts.queue).stop=g.stop.bind(g)),g;return f.map(W,el,j),S(j.opts.start)&&j.opts.start.call(a,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),f.fx.timer(f.extend(T,{elem:a,anim:j,queue:j.opts.queue})),j}f.Animation=f.extend(je,{tweeners:{"*":[function(a,c){var d=this.createTween(a,c);return Ra(d.elem,a,Ni.exec(c),d),d}]},tweener:function(a,c){S(a)?(c=a,a=["*"]):a=a.match(qt);for(var d,g=0,m=a.length;g<m;g++)d=a[g],je.tweeners[d]=je.tweeners[d]||[],je.tweeners[d].unshift(c)},prefilters:[Yu],prefilter:function(a,c){c?je.prefilters.unshift(a):je.prefilters.push(a)}}),f.speed=function(a,c,d){var g=a&&typeof a=="object"?f.extend({},a):{complete:d||!d&&c||S(a)&&a,duration:a,easing:d&&c||c&&!S(c)&&c};return f.fx.off?g.duration=0:typeof g.duration!="number"&&(g.duration in f.fx.speeds?g.duration=f.fx.speeds[g.duration]:g.duration=f.fx.speeds._default),(g.queue==null||g.queue===!0)&&(g.queue="fx"),g.old=g.complete,g.complete=function(){S(g.old)&&g.old.call(this),g.queue&&f.dequeue(this,g.queue)},g},f.fn.extend({fadeTo:function(a,c,d,g){return this.filter(Hn).css("opacity",0).show().end().animate({opacity:c},a,d,g)},animate:function(a,c,d,g){var m=f.isEmptyObject(a),v=f.speed(c,d,g),x=function(){var O=je(this,f.extend({},a),v);(m||at.get(this,"finish"))&&O.stop(!0)};return x.finish=x,m||v.queue===!1?this.each(x):this.queue(v.queue,x)},stop:function(a,c,d){var g=function(m){var v=m.stop;delete m.stop,v(d)};return typeof a!="string"&&(d=c,c=a,a=void 0),c&&this.queue(a||"fx",[]),this.each(function(){var m=!0,v=a!=null&&a+"queueHooks",x=f.timers,O=at.get(this);if(v)O[v]&&O[v].stop&&g(O[v]);else for(v in O)O[v]&&O[v].stop&&Vu.test(v)&&g(O[v]);for(v=x.length;v--;)x[v].elem===this&&(a==null||x[v].queue===a)&&(x[v].anim.stop(d),m=!1,x.splice(v,1));(m||!d)&&f.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var c,d=at.get(this),g=d[a+"queue"],m=d[a+"queueHooks"],v=f.timers,x=g?g.length:0;for(d.finish=!0,f.queue(this,a,[]),m&&m.stop&&m.stop.call(this,!0),c=v.length;c--;)v[c].elem===this&&v[c].queue===a&&(v[c].anim.stop(!0),v.splice(c,1));for(c=0;c<x;c++)g[c]&&g[c].finish&&g[c].finish.call(this);delete d.finish})}}),f.each(["toggle","show","hide"],function(a,c){var d=f.fn[c];f.fn[c]=function(g,m,v){return g==null||typeof g=="boolean"?d.apply(this,arguments):this.animate(Yn(c,!0),g,m,v)}}),f.each({slideDown:Yn("show"),slideUp:Yn("hide"),slideToggle:Yn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,c){f.fn[a]=function(d,g,m){return this.animate(c,d,g,m)}}),f.timers=[],f.fx.tick=function(){var a,c=0,d=f.timers;for(pi=Date.now();c<d.length;c++)a=d[c],!a()&&d[c]===a&&d.splice(c--,1);d.length||f.fx.stop(),pi=void 0},f.fx.timer=function(a){f.timers.push(a),f.fx.start()},f.fx.interval=13,f.fx.start=function(){Vn||(Vn=!0,Js())},f.fx.stop=function(){Vn=null},f.fx.speeds={slow:600,fast:200,_default:400},f.fn.delay=function(a,c){return a=f.fx&&f.fx.speeds[a]||a,c=c||"fx",this.queue(c,function(d,g){var m=t.setTimeout(d,a);g.stop=function(){t.clearTimeout(m)}})},function(){var a=M.createElement("input"),c=M.createElement("select"),d=c.appendChild(M.createElement("option"));a.type="checkbox",w.checkOn=a.value!=="",w.optSelected=d.selected,a=M.createElement("input"),a.value="t",a.type="radio",w.radioValue=a.value==="t"}();var rl,Yi=f.expr.attrHandle;f.fn.extend({attr:function(a,c){return dr(this,f.attr,a,c,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})}}),f.extend({attr:function(a,c,d){var g,m,v=a.nodeType;if(!(v===3||v===8||v===2)){if(typeof a.getAttribute>"u")return f.prop(a,c,d);if((v!==1||!f.isXMLDoc(a))&&(m=f.attrHooks[c.toLowerCase()]||(f.expr.match.bool.test(c)?rl:void 0)),d!==void 0){if(d===null){f.removeAttr(a,c);return}return m&&"set"in m&&(g=m.set(a,d,c))!==void 0?g:(a.setAttribute(c,d+""),d)}return m&&"get"in m&&(g=m.get(a,c))!==null?g:(g=f.find.attr(a,c),g??void 0)}},attrHooks:{type:{set:function(a,c){if(!w.radioValue&&c==="radio"&&Z(a,"input")){var d=a.value;return a.setAttribute("type",c),d&&(a.value=d),c}}}},removeAttr:function(a,c){var d,g=0,m=c&&c.match(qt);if(m&&a.nodeType===1)for(;d=m[g++];)a.removeAttribute(d)}}),rl={set:function(a,c,d){return c===!1?f.removeAttr(a,d):a.setAttribute(d,d),d}},f.each(f.expr.match.bool.source.match(/\w+/g),function(a,c){var d=Yi[c]||f.find.attr;Yi[c]=function(g,m,v){var x,O,T=m.toLowerCase();return v||(O=Yi[T],Yi[T]=x,x=d(g,m,v)!=null?T:null,Yi[T]=O),x}});var Gu=/^(?:input|select|textarea|button)$/i,qu=/^(?:a|area)$/i;f.fn.extend({prop:function(a,c){return dr(this,f.prop,a,c,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[f.propFix[a]||a]})}}),f.extend({prop:function(a,c,d){var g,m,v=a.nodeType;if(!(v===3||v===8||v===2))return(v!==1||!f.isXMLDoc(a))&&(c=f.propFix[c]||c,m=f.propHooks[c]),d!==void 0?m&&"set"in m&&(g=m.set(a,d,c))!==void 0?g:a[c]=d:m&&"get"in m&&(g=m.get(a,c))!==null?g:a[c]},propHooks:{tabIndex:{get:function(a){var c=f.find.attr(a,"tabindex");return c?parseInt(c,10):Gu.test(a.nodeName)||qu.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),w.optSelected||(f.propHooks.selected={get:function(a){var c=a.parentNode;return c&&c.parentNode&&c.parentNode.selectedIndex,null},set:function(a){var c=a.parentNode;c&&(c.selectedIndex,c.parentNode&&c.parentNode.selectedIndex)}}),f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this});function Br(a){var c=a.match(qt)||[];return c.join(" ")}function Wr(a){return a.getAttribute&&a.getAttribute("class")||""}function Qs(a){return Array.isArray(a)?a:typeof a=="string"?a.match(qt)||[]:[]}f.fn.extend({addClass:function(a){var c,d,g,m,v,x;return S(a)?this.each(function(O){f(this).addClass(a.call(this,O,Wr(this)))}):(c=Qs(a),c.length?this.each(function(){if(g=Wr(this),d=this.nodeType===1&&" "+Br(g)+" ",d){for(v=0;v<c.length;v++)m=c[v],d.indexOf(" "+m+" ")<0&&(d+=m+" ");x=Br(d),g!==x&&this.setAttribute("class",x)}}):this)},removeClass:function(a){var c,d,g,m,v,x;return S(a)?this.each(function(O){f(this).removeClass(a.call(this,O,Wr(this)))}):arguments.length?(c=Qs(a),c.length?this.each(function(){if(g=Wr(this),d=this.nodeType===1&&" "+Br(g)+" ",d){for(v=0;v<c.length;v++)for(m=c[v];d.indexOf(" "+m+" ")>-1;)d=d.replace(" "+m+" "," ");x=Br(d),g!==x&&this.setAttribute("class",x)}}):this):this.attr("class","")},toggleClass:function(a,c){var d,g,m,v,x=typeof a,O=x==="string"||Array.isArray(a);return S(a)?this.each(function(T){f(this).toggleClass(a.call(this,T,Wr(this),c),c)}):typeof c=="boolean"&&O?c?this.addClass(a):this.removeClass(a):(d=Qs(a),this.each(function(){if(O)for(v=f(this),m=0;m<d.length;m++)g=d[m],v.hasClass(g)?v.removeClass(g):v.addClass(g);else(a===void 0||x==="boolean")&&(g=Wr(this),g&&at.set(this,"__className__",g),this.setAttribute&&this.setAttribute("class",g||a===!1?"":at.get(this,"__className__")||""))}))},hasClass:function(a){var c,d,g=0;for(c=" "+a+" ";d=this[g++];)if(d.nodeType===1&&(" "+Br(Wr(d))+" ").indexOf(c)>-1)return!0;return!1}});var Uu=/\r/g;f.fn.extend({val:function(a){var c,d,g,m=this[0];return arguments.length?(g=S(a),this.each(function(v){var x;this.nodeType===1&&(g?x=a.call(this,v,f(this).val()):x=a,x==null?x="":typeof x=="number"?x+="":Array.isArray(x)&&(x=f.map(x,function(O){return O==null?"":O+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()],(!c||!("set"in c)||c.set(this,x,"value")===void 0)&&(this.value=x))})):m?(c=f.valHooks[m.type]||f.valHooks[m.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(m,"value"))!==void 0?d:(d=m.value,typeof d=="string"?d.replace(Uu,""):d??"")):void 0}}),f.extend({valHooks:{option:{get:function(a){var c=f.find.attr(a,"value");return c??Br(f.text(a))}},select:{get:function(a){var c,d,g,m=a.options,v=a.selectedIndex,x=a.type==="select-one",O=x?null:[],T=x?v+1:m.length;for(v<0?g=T:g=x?v:0;g<T;g++)if(d=m[g],(d.selected||g===v)&&!d.disabled&&(!d.parentNode.disabled||!Z(d.parentNode,"optgroup"))){if(c=f(d).val(),x)return c;O.push(c)}return O},set:function(a,c){for(var d,g,m=a.options,v=f.makeArray(c),x=m.length;x--;)g=m[x],(g.selected=f.inArray(f.valHooks.option.get(g),v)>-1)&&(d=!0);return d||(a.selectedIndex=-1),v}}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(a,c){if(Array.isArray(c))return a.checked=f.inArray(f(a).val(),c)>-1}},w.checkOn||(f.valHooks[this].get=function(a){return a.getAttribute("value")===null?"on":a.value})});var zi=t.location,il={guid:Date.now()},to=/\?/;f.parseXML=function(a){var c,d;if(!a||typeof a!="string")return null;try{c=new t.DOMParser().parseFromString(a,"text/xml")}catch{}return d=c&&c.getElementsByTagName("parsererror")[0],(!c||d)&&f.error("Invalid XML: "+(d?f.map(d.childNodes,function(g){return g.textContent}).join(`
`):a)),c};var nl=/^(?:focusinfocus|focusoutblur)$/,sl=function(a){a.stopPropagation()};f.extend(f.event,{trigger:function(a,c,d,g){var m,v,x,O,T,j,W,N,R=[d||M],G=y.call(a,"type")?a.type:a,dt=y.call(a,"namespace")?a.namespace.split("."):[];if(v=N=x=d=d||M,!(d.nodeType===3||d.nodeType===8)&&!nl.test(G+f.event.triggered)&&(G.indexOf(".")>-1&&(dt=G.split("."),G=dt.shift(),dt.sort()),T=G.indexOf(":")<0&&"on"+G,a=a[f.expando]?a:new f.Event(G,typeof a=="object"&&a),a.isTrigger=g?2:3,a.namespace=dt.join("."),a.rnamespace=a.namespace?new RegExp("(^|\\.)"+dt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a.result=void 0,a.target||(a.target=d),c=c==null?[a]:f.makeArray(c,[a]),W=f.event.special[G]||{},!(!g&&W.trigger&&W.trigger.apply(d,c)===!1))){if(!g&&!W.noBubble&&!F(d)){for(O=W.delegateType||G,nl.test(O+G)||(v=v.parentNode);v;v=v.parentNode)R.push(v),x=v;x===(d.ownerDocument||M)&&R.push(x.defaultView||x.parentWindow||t)}for(m=0;(v=R[m++])&&!a.isPropagationStopped();)N=v,a.type=m>1?O:W.bindType||G,j=(at.get(v,"events")||Object.create(null))[a.type]&&at.get(v,"handle"),j&&j.apply(v,c),j=T&&v[T],j&&j.apply&&Wi(v)&&(a.result=j.apply(v,c),a.result===!1&&a.preventDefault());return a.type=G,!g&&!a.isDefaultPrevented()&&(!W._default||W._default.apply(R.pop(),c)===!1)&&Wi(d)&&T&&S(d[G])&&!F(d)&&(x=d[T],x&&(d[T]=null),f.event.triggered=G,a.isPropagationStopped()&&N.addEventListener(G,sl),d[G](),a.isPropagationStopped()&&N.removeEventListener(G,sl),f.event.triggered=void 0,x&&(d[T]=x)),a.result}},simulate:function(a,c,d){var g=f.extend(new f.Event,d,{type:a,isSimulated:!0});f.event.trigger(g,null,c)}}),f.fn.extend({trigger:function(a,c){return this.each(function(){f.event.trigger(a,c,this)})},triggerHandler:function(a,c){var d=this[0];if(d)return f.event.trigger(a,c,d,!0)}});var $u=/\[\]$/,ol=/\r?\n/g,Ku=/^(?:submit|button|image|reset|file)$/i,Zu=/^(?:input|select|textarea|keygen)/i;function eo(a,c,d,g){var m;if(Array.isArray(c))f.each(c,function(v,x){d||$u.test(a)?g(a,x):eo(a+"["+(typeof x=="object"&&x!=null?v:"")+"]",x,d,g)});else if(!d&&K(c)==="object")for(m in c)eo(a+"["+m+"]",c[m],d,g);else g(a,c)}f.param=function(a,c){var d,g=[],m=function(v,x){var O=S(x)?x():x;g[g.length]=encodeURIComponent(v)+"="+encodeURIComponent(O??"")};if(a==null)return"";if(Array.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){m(this.name,this.value)});else for(d in a)eo(d,a[d],c,m);return g.join("&")},f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=f.prop(this,"elements");return a?f.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!f(this).is(":disabled")&&Zu.test(this.nodeName)&&!Ku.test(a)&&(this.checked||!Xi.test(a))}).map(function(a,c){var d=f(this).val();return d==null?null:Array.isArray(d)?f.map(d,function(g){return{name:c.name,value:g.replace(ol,`\r
`)}}):{name:c.name,value:d.replace(ol,`\r
`)}}).get()}});var Ju=/%20/g,Qu=/#.*$/,td=/([?&])_=[^&]*/,ed=/^(.*?):[ \t]*([^\r\n]*)$/mg,rd=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,id=/^(?:GET|HEAD)$/,nd=/^\/\//,al={},ro={},ll="*/".concat("*"),io=M.createElement("a");io.href=zi.href;function cl(a){return function(c,d){typeof c!="string"&&(d=c,c="*");var g,m=0,v=c.toLowerCase().match(qt)||[];if(S(d))for(;g=v[m++];)g[0]==="+"?(g=g.slice(1)||"*",(a[g]=a[g]||[]).unshift(d)):(a[g]=a[g]||[]).push(d)}}function hl(a,c,d,g){var m={},v=a===ro;function x(O){var T;return m[O]=!0,f.each(a[O]||[],function(j,W){var N=W(c,d,g);if(typeof N=="string"&&!v&&!m[N])return c.dataTypes.unshift(N),x(N),!1;if(v)return!(T=N)}),T}return x(c.dataTypes[0])||!m["*"]&&x("*")}function no(a,c){var d,g,m=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==void 0&&((m[d]?a:g||(g={}))[d]=c[d]);return g&&f.extend(!0,a,g),a}function sd(a,c,d){for(var g,m,v,x,O=a.contents,T=a.dataTypes;T[0]==="*";)T.shift(),g===void 0&&(g=a.mimeType||c.getResponseHeader("Content-Type"));if(g){for(m in O)if(O[m]&&O[m].test(g)){T.unshift(m);break}}if(T[0]in d)v=T[0];else{for(m in d){if(!T[0]||a.converters[m+" "+T[0]]){v=m;break}x||(x=m)}v=v||x}if(v)return v!==T[0]&&T.unshift(v),d[v]}function od(a,c,d,g){var m,v,x,O,T,j={},W=a.dataTypes.slice();if(W[1])for(x in a.converters)j[x.toLowerCase()]=a.converters[x];for(v=W.shift();v;)if(a.responseFields[v]&&(d[a.responseFields[v]]=c),!T&&g&&a.dataFilter&&(c=a.dataFilter(c,a.dataType)),T=v,v=W.shift(),v){if(v==="*")v=T;else if(T!=="*"&&T!==v){if(x=j[T+" "+v]||j["* "+v],!x){for(m in j)if(O=m.split(" "),O[1]===v&&(x=j[T+" "+O[0]]||j["* "+O[0]],x)){x===!0?x=j[m]:j[m]!==!0&&(v=O[0],W.unshift(O[1]));break}}if(x!==!0)if(x&&a.throws)c=x(c);else try{c=x(c)}catch(N){return{state:"parsererror",error:x?N:"No conversion from "+T+" to "+v}}}}return{state:"success",data:c}}f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zi.href,type:"GET",isLocal:rd.test(zi.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ll,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":f.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,c){return c?no(no(a,f.ajaxSettings),c):no(f.ajaxSettings,a)},ajaxPrefilter:cl(al),ajaxTransport:cl(ro),ajax:function(a,c){typeof a=="object"&&(c=a,a=void 0),c=c||{};var d,g,m,v,x,O,T,j,W,N,R=f.ajaxSetup({},c),G=R.context||R,dt=R.context&&(G.nodeType||G.jquery)?f(G):f.event,wt=f.Deferred(),gt=f.Callbacks("once memory"),Zt=R.statusCode||{},Ut={},qe={},Ue="canceled",bt={readyState:0,getResponseHeader:function(St){var Wt;if(T){if(!v)for(v={};Wt=ed.exec(m);)v[Wt[1].toLowerCase()+" "]=(v[Wt[1].toLowerCase()+" "]||[]).concat(Wt[2]);Wt=v[St.toLowerCase()+" "]}return Wt==null?null:Wt.join(", ")},getAllResponseHeaders:function(){return T?m:null},setRequestHeader:function(St,Wt){return T==null&&(St=qe[St.toLowerCase()]=qe[St.toLowerCase()]||St,Ut[St]=Wt),this},overrideMimeType:function(St){return T==null&&(R.mimeType=St),this},statusCode:function(St){var Wt;if(St)if(T)bt.always(St[bt.status]);else for(Wt in St)Zt[Wt]=[Zt[Wt],St[Wt]];return this},abort:function(St){var Wt=St||Ue;return d&&d.abort(Wt),Hr(0,Wt),this}};if(wt.promise(bt),R.url=((a||R.url||zi.href)+"").replace(nd,zi.protocol+"//"),R.type=c.method||c.type||R.method||R.type,R.dataTypes=(R.dataType||"*").toLowerCase().match(qt)||[""],R.crossDomain==null){O=M.createElement("a");try{O.href=R.url,O.href=O.href,R.crossDomain=io.protocol+"//"+io.host!=O.protocol+"//"+O.host}catch{R.crossDomain=!0}}if(R.data&&R.processData&&typeof R.data!="string"&&(R.data=f.param(R.data,R.traditional)),hl(al,R,c,bt),T)return bt;j=f.event&&R.global,j&&f.active++===0&&f.event.trigger("ajaxStart"),R.type=R.type.toUpperCase(),R.hasContent=!id.test(R.type),g=R.url.replace(Qu,""),R.hasContent?R.data&&R.processData&&(R.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(R.data=R.data.replace(Ju,"+")):(N=R.url.slice(g.length),R.data&&(R.processData||typeof R.data=="string")&&(g+=(to.test(g)?"&":"?")+R.data,delete R.data),R.cache===!1&&(g=g.replace(td,"$1"),N=(to.test(g)?"&":"?")+"_="+il.guid+++N),R.url=g+N),R.ifModified&&(f.lastModified[g]&&bt.setRequestHeader("If-Modified-Since",f.lastModified[g]),f.etag[g]&&bt.setRequestHeader("If-None-Match",f.etag[g])),(R.data&&R.hasContent&&R.contentType!==!1||c.contentType)&&bt.setRequestHeader("Content-Type",R.contentType),bt.setRequestHeader("Accept",R.dataTypes[0]&&R.accepts[R.dataTypes[0]]?R.accepts[R.dataTypes[0]]+(R.dataTypes[0]!=="*"?", "+ll+"; q=0.01":""):R.accepts["*"]);for(W in R.headers)bt.setRequestHeader(W,R.headers[W]);if(R.beforeSend&&(R.beforeSend.call(G,bt,R)===!1||T))return bt.abort();if(Ue="abort",gt.add(R.complete),bt.done(R.success),bt.fail(R.error),d=hl(ro,R,c,bt),!d)Hr(-1,"No Transport");else{if(bt.readyState=1,j&&dt.trigger("ajaxSend",[bt,R]),T)return bt;R.async&&R.timeout>0&&(x=t.setTimeout(function(){bt.abort("timeout")},R.timeout));try{T=!1,d.send(Ut,Hr)}catch(St){if(T)throw St;Hr(-1,St)}}function Hr(St,Wt,qi,oo){var $e,Ui,Ke,Cr,Sr,Oe=Wt;T||(T=!0,x&&t.clearTimeout(x),d=void 0,m=oo||"",bt.readyState=St>0?4:0,$e=St>=200&&St<300||St===304,qi&&(Cr=sd(R,bt,qi)),!$e&&f.inArray("script",R.dataTypes)>-1&&f.inArray("json",R.dataTypes)<0&&(R.converters["text script"]=function(){}),Cr=od(R,Cr,bt,$e),$e?(R.ifModified&&(Sr=bt.getResponseHeader("Last-Modified"),Sr&&(f.lastModified[g]=Sr),Sr=bt.getResponseHeader("etag"),Sr&&(f.etag[g]=Sr)),St===204||R.type==="HEAD"?Oe="nocontent":St===304?Oe="notmodified":(Oe=Cr.state,Ui=Cr.data,Ke=Cr.error,$e=!Ke)):(Ke=Oe,(St||!Oe)&&(Oe="error",St<0&&(St=0))),bt.status=St,bt.statusText=(Wt||Oe)+"",$e?wt.resolveWith(G,[Ui,Oe,bt]):wt.rejectWith(G,[bt,Oe,Ke]),bt.statusCode(Zt),Zt=void 0,j&&dt.trigger($e?"ajaxSuccess":"ajaxError",[bt,R,$e?Ui:Ke]),gt.fireWith(G,[bt,Oe]),j&&(dt.trigger("ajaxComplete",[bt,R]),--f.active||f.event.trigger("ajaxStop")))}return bt},getJSON:function(a,c,d){return f.get(a,c,d,"json")},getScript:function(a,c){return f.get(a,void 0,c,"script")}}),f.each(["get","post"],function(a,c){f[c]=function(d,g,m,v){return S(g)&&(v=v||m,m=g,g=void 0),f.ajax(f.extend({url:d,type:c,dataType:v,data:g,success:m},f.isPlainObject(d)&&d))}}),f.ajaxPrefilter(function(a){var c;for(c in a.headers)c.toLowerCase()==="content-type"&&(a.contentType=a.headers[c]||"")}),f._evalUrl=function(a,c,d){return f.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(g){f.globalEval(g,c,d)}})},f.fn.extend({wrapAll:function(a){var c;return this[0]&&(S(a)&&(a=a.call(this[0])),c=f(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&c.insertBefore(this[0]),c.map(function(){for(var d=this;d.firstElementChild;)d=d.firstElementChild;return d}).append(this)),this},wrapInner:function(a){return S(a)?this.each(function(c){f(this).wrapInner(a.call(this,c))}):this.each(function(){var c=f(this),d=c.contents();d.length?d.wrapAll(a):c.append(a)})},wrap:function(a){var c=S(a);return this.each(function(d){f(this).wrapAll(c?a.call(this,d):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){f(this).replaceWith(this.childNodes)}),this}}),f.expr.pseudos.hidden=function(a){return!f.expr.pseudos.visible(a)},f.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},f.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch{}};var ad={0:200,1223:204},Gi=f.ajaxSettings.xhr();w.cors=!!Gi&&"withCredentials"in Gi,w.ajax=Gi=!!Gi,f.ajaxTransport(function(a){var c,d;if(w.cors||Gi&&!a.crossDomain)return{send:function(g,m){var v,x=a.xhr();if(x.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(v in a.xhrFields)x[v]=a.xhrFields[v];a.mimeType&&x.overrideMimeType&&x.overrideMimeType(a.mimeType),!a.crossDomain&&!g["X-Requested-With"]&&(g["X-Requested-With"]="XMLHttpRequest");for(v in g)x.setRequestHeader(v,g[v]);c=function(O){return function(){c&&(c=d=x.onload=x.onerror=x.onabort=x.ontimeout=x.onreadystatechange=null,O==="abort"?x.abort():O==="error"?typeof x.status!="number"?m(0,"error"):m(x.status,x.statusText):m(ad[x.status]||x.status,x.statusText,(x.responseType||"text")!=="text"||typeof x.responseText!="string"?{binary:x.response}:{text:x.responseText},x.getAllResponseHeaders()))}},x.onload=c(),d=x.onerror=x.ontimeout=c("error"),x.onabort!==void 0?x.onabort=d:x.onreadystatechange=function(){x.readyState===4&&t.setTimeout(function(){c&&d()})},c=c("abort");try{x.send(a.hasContent&&a.data||null)}catch(O){if(c)throw O}},abort:function(){c&&c()}}}),f.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return f.globalEval(a),a}}}),f.ajaxPrefilter("script",function(a){a.cache===void 0&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),f.ajaxTransport("script",function(a){if(a.crossDomain||a.scriptAttrs){var c,d;return{send:function(g,m){c=f("<script>").attr(a.scriptAttrs||{}).prop({charset:a.scriptCharset,src:a.url}).on("load error",d=function(v){c.remove(),d=null,v&&m(v.type==="error"?404:200,v.type)}),M.head.appendChild(c[0])},abort:function(){d&&d()}}}});var ul=[],so=/(=)\?(?=&|$)|\?\?/;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=ul.pop()||f.expando+"_"+il.guid++;return this[a]=!0,a}}),f.ajaxPrefilter("json jsonp",function(a,c,d){var g,m,v,x=a.jsonp!==!1&&(so.test(a.url)?"url":typeof a.data=="string"&&(a.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&so.test(a.data)&&"data");if(x||a.dataTypes[0]==="jsonp")return g=a.jsonpCallback=S(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,x?a[x]=a[x].replace(so,"$1"+g):a.jsonp!==!1&&(a.url+=(to.test(a.url)?"&":"?")+a.jsonp+"="+g),a.converters["script json"]=function(){return v||f.error(g+" was not called"),v[0]},a.dataTypes[0]="json",m=t[g],t[g]=function(){v=arguments},d.always(function(){m===void 0?f(t).removeProp(g):t[g]=m,a[g]&&(a.jsonpCallback=c.jsonpCallback,ul.push(g)),v&&S(m)&&m(v[0]),v=m=void 0}),"script"}),w.createHTMLDocument=function(){var a=M.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",a.childNodes.length===2}(),f.parseHTML=function(a,c,d){if(typeof a!="string")return[];typeof c=="boolean"&&(d=c,c=!1);var g,m,v;return c||(w.createHTMLDocument?(c=M.implementation.createHTMLDocument(""),g=c.createElement("base"),g.href=M.location.href,c.head.appendChild(g)):c=M),m=Et.exec(a),v=!d&&[],m?[c.createElement(m[1])]:(m=Na([a],c,v),v&&v.length&&f(v).remove(),f.merge([],m.childNodes))},f.fn.load=function(a,c,d){var g,m,v,x=this,O=a.indexOf(" ");return O>-1&&(g=Br(a.slice(O)),a=a.slice(0,O)),S(c)?(d=c,c=void 0):c&&typeof c=="object"&&(m="POST"),x.length>0&&f.ajax({url:a,type:m||"GET",dataType:"html",data:c}).done(function(T){v=arguments,x.html(g?f("<div>").append(f.parseHTML(T)).find(g):T)}).always(d&&function(T,j){x.each(function(){d.apply(this,v||[T.responseText,j,T])})}),this},f.expr.pseudos.animated=function(a){return f.grep(f.timers,function(c){return a===c.elem}).length},f.offset={setOffset:function(a,c,d){var g,m,v,x,O,T,j,W=f.css(a,"position"),N=f(a),R={};W==="static"&&(a.style.position="relative"),O=N.offset(),v=f.css(a,"top"),T=f.css(a,"left"),j=(W==="absolute"||W==="fixed")&&(v+T).indexOf("auto")>-1,j?(g=N.position(),x=g.top,m=g.left):(x=parseFloat(v)||0,m=parseFloat(T)||0),S(c)&&(c=c.call(a,d,f.extend({},O))),c.top!=null&&(R.top=c.top-O.top+x),c.left!=null&&(R.left=c.left-O.left+m),"using"in c?c.using.call(a,R):N.css(R)}},f.fn.extend({offset:function(a){if(arguments.length)return a===void 0?this:this.each(function(m){f.offset.setOffset(this,a,m)});var c,d,g=this[0];if(g)return g.getClientRects().length?(c=g.getBoundingClientRect(),d=g.ownerDocument.defaultView,{top:c.top+d.pageYOffset,left:c.left+d.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var a,c,d,g=this[0],m={top:0,left:0};if(f.css(g,"position")==="fixed")c=g.getBoundingClientRect();else{for(c=this.offset(),d=g.ownerDocument,a=g.offsetParent||d.documentElement;a&&(a===d.body||a===d.documentElement)&&f.css(a,"position")==="static";)a=a.parentNode;a&&a!==g&&a.nodeType===1&&(m=f(a).offset(),m.top+=f.css(a,"borderTopWidth",!0),m.left+=f.css(a,"borderLeftWidth",!0))}return{top:c.top-m.top-f.css(g,"marginTop",!0),left:c.left-m.left-f.css(g,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&f.css(a,"position")==="static";)a=a.offsetParent;return a||Rr})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=c==="pageYOffset";f.fn[a]=function(g){return dr(this,function(m,v,x){var O;if(F(m)?O=m:m.nodeType===9&&(O=m.defaultView),x===void 0)return O?O[c]:m[v];O?O.scrollTo(d?O.pageXOffset:x,d?x:O.pageYOffset):m[v]=x},a,g,arguments.length)}}),f.each(["top","left"],function(a,c){f.cssHooks[c]=qa(w.pixelPosition,function(d,g){if(g)return g=Vi(d,c),Us.test(g)?f(d).position()[c]+"px":g})}),f.each({Height:"height",Width:"width"},function(a,c){f.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,g){f.fn[g]=function(m,v){var x=arguments.length&&(d||typeof m!="boolean"),O=d||(m===!0||v===!0?"margin":"border");return dr(this,function(T,j,W){var N;return F(T)?g.indexOf("outer")===0?T["inner"+a]:T.document.documentElement["client"+a]:T.nodeType===9?(N=T.documentElement,Math.max(T.body["scroll"+a],N["scroll"+a],T.body["offset"+a],N["offset"+a],N["client"+a])):W===void 0?f.css(T,j,O):f.style(T,j,W,O)},c,x?m:void 0,x)}})}),f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,c){f.fn[c]=function(d){return this.on(c,d)}}),f.fn.extend({bind:function(a,c,d){return this.on(a,null,c,d)},unbind:function(a,c){return this.off(a,null,c)},delegate:function(a,c,d,g){return this.on(c,a,d,g)},undelegate:function(a,c,d){return arguments.length===1?this.off(a,"**"):this.off(c,a||"**",d)},hover:function(a,c){return this.on("mouseenter",a).on("mouseleave",c||a)}}),f.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,c){f.fn[c]=function(d,g){return arguments.length>0?this.on(c,null,d,g):this.trigger(c)}});var ld=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;f.proxy=function(a,c){var d,g,m;if(typeof c=="string"&&(d=a[c],c=a,a=d),!!S(a))return g=s.call(arguments,2),m=function(){return a.apply(c||this,g.concat(s.call(arguments)))},m.guid=a.guid=a.guid||f.guid++,m},f.holdReady=function(a){a?f.readyWait++:f.ready(!0)},f.isArray=Array.isArray,f.parseJSON=JSON.parse,f.nodeName=Z,f.isFunction=S,f.isWindow=F,f.camelCase=Ge,f.type=K,f.now=Date.now,f.isNumeric=function(a){var c=f.type(a);return(c==="number"||c==="string")&&!isNaN(a-parseFloat(a))},f.trim=function(a){return a==null?"":(a+"").replace(ld,"$1")};var cd=t.jQuery,hd=t.$;return f.noConflict=function(a){return t.$===f&&(t.$=hd),a&&t.jQuery===f&&(t.jQuery=cd),f},typeof e>"u"&&(t.jQuery=t.$=f),f})}(rs)),rs.exports}var Cd=_d();const k=bd(Cd);function D(n,t,e){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var h=l.call(s,o);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(r,"string");return typeof i=="symbol"?i:i+""}(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function vl(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,r)}return e}function A(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?vl(Object(e),!0).forEach(function(r){D(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):vl(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function Lt(n,t){if(n==null)return{};var e,r,i=function(o,l){if(o==null)return{};var h={};for(var u in o)if({}.hasOwnProperty.call(o,u)){if(l.indexOf(u)>=0)continue;h[u]=o[u]}return h}(n,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)e=s[r],t.indexOf(e)>=0||{}.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}function jr(n,t){return t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}}))}class yl{constructor(){D(this,"browserShadowBlurConstant",1),D(this,"DPI",96),D(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),D(this,"perfLimitSizeTotal",2097152),D(this,"maxCacheSideLimit",4096),D(this,"minCacheSideLimit",256),D(this,"disableStyleCopyPaste",!1),D(this,"enableGLFiltering",!0),D(this,"textureSize",4096),D(this,"forceGLPutImageData",!1),D(this,"cachesBoundsOfCurve",!1),D(this,"fontPaths",{}),D(this,"NUM_FRACTION_DIGITS",4)}}const Ct=new class extends yl{constructor(n){super(),this.configure(n)}configure(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,n)}addFonts(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=A(A({},this.fontPaths),n)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>{delete this.fontPaths[n]})}clearFonts(){this.fontPaths={}}restoreDefaults(n){const t=new yl,e=(n==null?void 0:n.reduce((r,i)=>(r[i]=t[i],r),{}))||t;this.configure(e)}},br=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return console[n]("fabric",...e)};class or extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class Qo extends or{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class Sd{}class Td extends Sd{testPrecision(t,e){const r="precision ".concat(e,` float;
void main(){}`),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,r),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(r=>this.testPrecision(e,r)),e.getExtension("WEBGL_lose_context").loseContext(),br("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const Od={};let ko;const kd=n=>{ko=n},Xe=()=>ko||(ko={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new Td,dispose(){},copyPasteData:Od}),ii=()=>Xe().document,ar=()=>Xe().window,ac=()=>{var n;return Math.max((n=Ct.devicePixelRatio)!==null&&n!==void 0?n:ar().devicePixelRatio,1)},Ci=new class{constructor(){D(this,"charWidthsCache",{}),D(this,"boundsOfCurveCache",{})}getFontCache(n){let{fontFamily:t,fontStyle:e,fontWeight:r}=n;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const i=this.charWidthsCache[t],s="".concat(e.toLowerCase(),"_").concat((r+"").toLowerCase());return i[s]||(i[s]={}),i[s]}clearFontCache(n){(n=(n||"").toLowerCase())?this.charWidthsCache[n]&&delete this.charWidthsCache[n]:this.charWidthsCache={}}limitDimsByArea(n){const{perfLimitSizeTotal:t}=Ct,e=Math.sqrt(t*n);return[Math.floor(e),Math.floor(t/e)]}},_n="6.6.1";function $r(){}const Er=Math.PI/2,wr=2*Math.PI,ta=Math.PI/180,re=Object.freeze([1,0,0,1,0,0]),ea=16,Or=.4477152502,ut="center",Ot="left",xe="top",Do="bottom",Vt="right",he="none",ra=/\r?\n/,lc="moving",Es="scaling",cc="rotating",ia="rotate",hc="skewing",Cn="resizing",uc="modifyPoly",Dd="modifyPath",hs="changed",Ps="scale",de="scaleX",Se="scaleY",Mi="skewX",ji="skewY",zt="fill",ue="stroke",us="modified",yi="json",go="svg",tt=new class{constructor(){this[yi]=new Map,this[go]=new Map}has(n){return this[yi].has(n)}getClass(n){const t=this[yi].get(n);if(!t)throw new or("No class registered for ".concat(n));return t}setClass(n,t){t?this[yi].set(t,n):(this[yi].set(n.type,n),this[yi].set(n.type.toLowerCase(),n))}getSVGClass(n){return this[go].get(n)}setSVGClass(n,t){this[go].set(t??n.type.toLowerCase(),n)}},Sn=new class extends Array{remove(n){const t=this.indexOf(n);t>-1&&this.splice(t,1)}cancelAll(){const n=this.splice(0);return n.forEach(t=>t.abort()),n}cancelByCanvas(n){if(!n)return[];const t=this.filter(e=>{var r;return e.target===n||typeof e.target=="object"&&((r=e.target)===null||r===void 0?void 0:r.canvas)===n});return t.forEach(e=>e.abort()),t}cancelByTarget(n){if(!n)return[];const t=this.filter(e=>e.target===n);return t.forEach(e=>e.abort()),t}};class dc{constructor(){D(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach(r=>{let[i,s]=r;this.on(i,s)}),()=>this.off(t);if(e){const r=t;return this.__eventListeners[r]||(this.__eventListeners[r]=[]),this.__eventListeners[r].push(e),()=>this.off(r,e)}return()=>!1}once(t,e){if(typeof t=="object"){const r=[];return Object.entries(t).forEach(i=>{let[s,o]=i;r.push(this.once(s,o))}),()=>r.forEach(i=>i())}if(e){const r=this.on(t,function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];e.call(this,...s),r()});return r}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const r=this.__eventListeners[t],i=r.indexOf(e);i>-1&&r.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(const r in this.__eventListeners)this._removeEventListener(r);else typeof t=="object"?Object.entries(t).forEach(r=>{let[i,s]=r;this._removeEventListener(i,s)}):this._removeEventListener(t,e)}fire(t,e){var r;if(!this.__eventListeners)return;const i=(r=this.__eventListeners[t])===null||r===void 0?void 0:r.concat();if(i)for(let s=0;s<i.length;s++)i[s].call(this,e||{})}}const Vr=(n,t)=>{const e=n.indexOf(t);return e!==-1&&n.splice(e,1),n},Ve=n=>{if(n===0)return 1;switch(Math.abs(n)/Er){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},Ye=n=>{if(n===0)return 0;const t=n/Er,e=Math.sign(n);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(n)};class L{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new L(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new L(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new L(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new L(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new L(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new L(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new L(this.x/t.x,this.y/t.y)}scalarDivide(t){return new L(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new L(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)}midPointFrom(t){return this.lerp(t)}min(t){return new L(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new L(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,r=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=r}clone(){return new L(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:na;const r=Ye(t),i=Ve(t),s=this.subtract(e);return new L(s.x*i-s.y*r,s.x*r+s.y*i).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new L(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const na=new L(0,0),is=n=>!!n&&Array.isArray(n._objects);function sa(n){class t extends n{constructor(){super(...arguments),D(this,"_objects",[])}_onObjectAdded(r){}_onObjectRemoved(r){}_onStackOrderChanged(r){}add(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const o=this._objects.push(...i);return i.forEach(l=>this._onObjectAdded(l)),o}insertAt(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return this._objects.splice(r,0,...s),s.forEach(l=>this._onObjectAdded(l)),this._objects.length}remove(){const r=this._objects,i=[];for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];return o.forEach(h=>{const u=r.indexOf(h);u!==-1&&(r.splice(u,1),i.push(h),this._onObjectRemoved(h))}),i}forEachObject(r){this.getObjects().forEach((i,s,o)=>r(i,s,o))}getObjects(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return i.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...i))}item(r){return this._objects[r]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(r,i){return!!this._objects.includes(r)||!!i&&this._objects.some(s=>s instanceof t&&s.contains(r,!0))}complexity(){return this._objects.reduce((r,i)=>r+=i.complexity?i.complexity():0,0)}sendObjectToBack(r){return!(!r||r===this._objects[0])&&(Vr(this._objects,r),this._objects.unshift(r),this._onStackOrderChanged(r),!0)}bringObjectToFront(r){return!(!r||r===this._objects[this._objects.length-1])&&(Vr(this._objects,r),this._objects.push(r),this._onStackOrderChanged(r),!0)}sendObjectBackwards(r,i){if(!r)return!1;const s=this._objects.indexOf(r);if(s!==0){const o=this.findNewLowerIndex(r,s,i);return Vr(this._objects,r),this._objects.splice(o,0,r),this._onStackOrderChanged(r),!0}return!1}bringObjectForward(r,i){if(!r)return!1;const s=this._objects.indexOf(r);if(s!==this._objects.length-1){const o=this.findNewUpperIndex(r,s,i);return Vr(this._objects,r),this._objects.splice(o,0,r),this._onStackOrderChanged(r),!0}return!1}moveObjectTo(r,i){return r!==this._objects[i]&&(Vr(this._objects,r),this._objects.splice(i,0,r),this._onStackOrderChanged(r),!0)}findNewLowerIndex(r,i,s){let o;if(s){o=i;for(let l=i-1;l>=0;--l)if(r.isOverlapping(this._objects[l])){o=l;break}}else o=i-1;return o}findNewUpperIndex(r,i,s){let o;if(s){o=i;for(let l=i+1;l<this._objects.length;++l)if(r.isOverlapping(this._objects[l])){o=l;break}}else o=i+1;return o}collectObjects(r){let{left:i,top:s,width:o,height:l}=r,{includeIntersecting:h=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u=[],p=new L(i,s),y=p.add(new L(o,l));for(let b=this._objects.length-1;b>=0;b--){const _=this._objects[b];_.selectable&&_.visible&&(h&&_.intersectsWithRect(p,y)||_.isContainedWithinRect(p,y)||h&&_.containsPoint(p)||h&&_.containsPoint(y))&&u.push(_)}return u}}return t}class fc extends dc{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function mn(n){return ar().requestAnimationFrame(n)}function gc(n){return ar().cancelAnimationFrame(n)}let Ad=0;const Pr=()=>Ad++,we=()=>{const n=ii().createElement("canvas");if(!n||n.getContext===void 0)throw new or("Failed to create `canvas` element");return n},pc=()=>ii().createElement("img"),Me=n=>{const t=we();return t.width=n.width,t.height=n.height,t},oa=(n,t,e)=>n.toDataURL("image/".concat(t),e),aa=(n,t,e)=>new Promise((r,i)=>{n.toBlob(r,"image/".concat(t),e)}),Nt=n=>n*ta,Mr=n=>n/ta,mc=n=>n.every((t,e)=>t===re[e]),te=(n,t,e)=>new L(n).transform(t,e),ye=n=>{const t=1/(n[0]*n[3]-n[1]*n[2]),e=[t*n[3],-t*n[1],-t*n[2],t*n[0],0,0],{x:r,y:i}=new L(n[4],n[5]).transform(e,!0);return e[4]=-r,e[5]=-i,e},Bt=(n,t,e)=>[n[0]*t[0]+n[2]*t[1],n[1]*t[0]+n[3]*t[1],n[0]*t[2]+n[2]*t[3],n[1]*t[2]+n[3]*t[3],e?0:n[0]*t[4]+n[2]*t[5]+n[4],e?0:n[1]*t[4]+n[3]*t[5]+n[5]],Ms=(n,t)=>n.reduceRight((e,r)=>r&&e?Bt(r,e,t):r||e,void 0)||re.concat(),vc=n=>{let[t,e]=n;return Math.atan2(e,t)},Zr=n=>{const t=vc(n),e=Math.pow(n[0],2)+Math.pow(n[1],2),r=Math.sqrt(e),i=(n[0]*n[3]-n[2]*n[1])/r,s=Math.atan2(n[0]*n[2]+n[1]*n[3],e);return{angle:Mr(t),scaleX:r,scaleY:i,skewX:Mr(s),skewY:0,translateX:n[4]||0,translateY:n[5]||0}},Fi=function(n){return[1,0,0,1,n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Li(){let{angle:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=Nt(n),i=Ve(r),s=Ye(r);return[i,s,-s,i,t?t-(i*t-s*e):0,e?e-(s*t+i*e):0]}const js=function(n){return[n,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:n,0,0]},yc=n=>Math.tan(Nt(n)),la=n=>[1,0,yc(n),1,0,0],ca=n=>[1,yc(n),0,1,0,0],Mn=n=>{let{scaleX:t=1,scaleY:e=1,flipX:r=!1,flipY:i=!1,skewX:s=0,skewY:o=0}=n,l=js(r?-t:t,i?-e:e);return s&&(l=Bt(l,la(s),!0)),o&&(l=Bt(l,ca(o),!0)),l},xc=n=>{const{translateX:t=0,translateY:e=0,angle:r=0}=n;let i=Fi(t,e);r&&(i=Bt(i,Li({angle:r})));const s=Mn(n);return mc(s)||(i=Bt(i,s)),i},vn=function(n){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(r,i){if(t&&t.aborted)return i(new Qo("loadImage"));const s=pc();let o;t&&(o=function(h){s.src="",i(h)},t.addEventListener("abort",o,{once:!0}));const l=function(){s.onload=s.onerror=null,o&&(t==null||t.removeEventListener("abort",o)),r(s)};n?(s.onload=l,s.onerror=function(){o&&(t==null||t.removeEventListener("abort",o)),i(new or("Error loading ".concat(s.src)))},e&&(s.crossOrigin=e),s.src=n):l()})},ki=function(n){let{signal:t,reviver:e=$r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,i)=>{const s=[];t&&t.addEventListener("abort",i,{once:!0}),Promise.all(n.map(o=>tt.getClass(o.type).fromObject(o,{signal:t}).then(l=>(e(o,l),s.push(l),l)))).then(r).catch(o=>{s.forEach(l=>{l.dispose&&l.dispose()}),i(o)}).finally(()=>{t&&t.removeEventListener("abort",i)})})},jn=function(n){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,r)=>{const i=[];t&&t.addEventListener("abort",r,{once:!0});const s=Object.values(n).map(l=>l&&l.type&&tt.has(l.type)?ki([l],{signal:t}).then(h=>{let[u]=h;return i.push(u),u}):l),o=Object.keys(n);Promise.all(s).then(l=>l.reduce((h,u,p)=>(h[o[p]]=u,h),{})).then(e).catch(l=>{i.forEach(h=>{h.dispose&&h.dispose()}),r(l)}).finally(()=>{t&&t.removeEventListener("abort",r)})})},ni=function(n){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((t,e)=>(e in n&&(t[e]=n[e]),t),{})},ha=(n,t)=>Object.keys(n).reduce((e,r)=>(t(n[r],r,n)&&(e[r]=n[r]),e),{}),xl={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},po=(n,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+6*(t-n)*e:e<.5?t:e<2/3?n+(t-n)*(2/3-e)*6:n),bl=(n,t,e,r)=>{n/=255,t/=255,e/=255;const i=Math.max(n,t,e),s=Math.min(n,t,e);let o,l;const h=(i+s)/2;if(i===s)o=l=0;else{const u=i-s;switch(l=h>.5?u/(2-i-s):u/(i+s),i){case n:o=(t-e)/u+(t<e?6:0);break;case t:o=(e-n)/u+2;break;case e:o=(n-t)/u+4}o/=6}return[Math.round(360*o),Math.round(100*l),Math.round(100*h),r]},wl=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(n)/(n.endsWith("%")?100:1)},$n=n=>Math.min(Math.round(n),255).toString(16).toUpperCase().padStart(2,"0"),_l=n=>{let[t,e,r,i=1]=n;const s=Math.round(.3*t+.59*e+.11*r);return[s,s,s,i]};class _t{constructor(t){if(D(this,"isUnrecognised",!1),t)if(t instanceof _t)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,r,i,s=1]=t;this.setSource([e,r,i,s])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in xl&&(t=xl[t]),t==="transparent"?[255,255,255,0]:_t.sourceFromHex(t)||_t.sourceFromRgb(t)||_t.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,r]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(r,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,r]=bl(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(r,"%)")}toHsla(){const[t,e,r,i]=bl(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(r,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,r,i]=this.getSource();return"".concat($n(t)).concat($n(e)).concat($n(r)).concat($n(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(_l(this.getSource())),this}toBlackWhite(t){const[e,,,r]=_l(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,r]),this}overlayWith(t){t instanceof _t||(t=new _t(t));const e=this.getSource(),r=t.getSource(),[i,s,o]=e.map((l,h)=>Math.round(.5*l+.5*r[h]));return this.setSource([i,s,o,e[3]]),this}static fromRgb(t){return _t.fromRgba(t)}static fromRgba(t){return new _t(_t.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[r,i,s]=e.slice(1,4).map(o=>{const l=parseFloat(o);return o.endsWith("%")?Math.round(2.55*l):l});return[r,i,s,wl(e[4])]}}static fromHsl(t){return _t.fromHsla(t)}static fromHsla(t){return new _t(_t.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const r=(_t.parseAngletoDegrees(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,s=parseFloat(e[3])/100;let o,l,h;if(i===0)o=l=h=s;else{const u=s<=.5?s*(i+1):s+i-s*i,p=2*s-u;o=po(p,u,r+1/3),l=po(p,u,r),h=po(p,u,r-1/3)}return[Math.round(255*o),Math.round(255*l),Math.round(255*h),wl(e[4])]}static fromHex(t){return new _t(_t.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let r;r=e.length<=4?e.split("").map(h=>h+h):e.match(/.{2}/g);const[i,s,o,l=255]=r.map(h=>parseInt(h,16));return[i,s,o,l/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),r=parseFloat(e);return e.includes("rad")?Mr(r):e.includes("turn")?360*r:r}}const Ft=(n,t)=>parseFloat(Number(n).toFixed(t)),oe=function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ea;const e=/\D{0,2}$/.exec(n),r=parseFloat(n),i=Ct.DPI;switch(e==null?void 0:e[0]){case"mm":return r*i/25.4;case"cm":return r*i/2.54;case"in":return r*i;case"pt":return r*i/72;case"pc":return r*i/72*12;case"em":return r*t;default:return r}},ua=n=>{const[t,e]=n.trim().split(" "),[r,i]=(s=t)&&s!==he?[s.slice(1,4),s.slice(5,8)]:s===he?[s,s]:["Mid","Mid"];var s;return{meetOrSlice:e||"meet",alignX:r,alignY:i}},Tn=n=>"matrix("+n.map(t=>Ft(t,Ct.NUM_FRACTION_DIGITS)).join(" ")+")",On=function(n,t){let e,r,i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{const s=new _t(t),o=s.getAlpha();e=s.toRgb(),o!==1&&(r=o.toString())}else e="none";return i?"".concat(n,": ").concat(e,"; ").concat(r?"".concat(n,"-opacity: ").concat(r,"; "):""):"".concat(n,'="').concat(e,'" ').concat(r?"".concat(n,'-opacity="').concat(r,'" '):"")},Pe=n=>!!n&&n.toLive!==void 0,Cl=n=>!!n&&typeof n.toObject=="function",Sl=n=>!!n&&n.offsetX!==void 0&&"source"in n,Yr=n=>!!n&&"multiSelectionStacking"in n;function bc(n){const t=n&&Be(n);let e=0,r=0;if(!n||!t)return{left:e,top:r};let i=n;const s=t.documentElement,o=t.body||{scrollLeft:0,scrollTop:0};for(;i&&(i.parentNode||i.host)&&(i=i.parentNode||i.host,i===t?(e=o.scrollLeft||s.scrollLeft||0,r=o.scrollTop||s.scrollTop||0):(e+=i.scrollLeft||0,r+=i.scrollTop||0),i.nodeType!==1||i.style.position!=="fixed"););return{left:e,top:r}}const Be=n=>n.ownerDocument||null,wc=n=>{var t;return((t=n.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null},_c=function(n,t,e){let{width:r,height:i}=e,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;n.width=r,n.height=i,s>1&&(n.setAttribute("width",(r*s).toString()),n.setAttribute("height",(i*s).toString()),t.scale(s,s))},Ao=(n,t)=>{let{width:e,height:r}=t;e&&(n.style.width=typeof e=="number"?"".concat(e,"px"):e),r&&(n.style.height=typeof r=="number"?"".concat(r,"px"):r)};function Tl(n){return n.onselectstart!==void 0&&(n.onselectstart=()=>!1),n.style.userSelect=he,n}class da{constructor(t){D(this,"_originalCanvasStyle",void 0),D(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(r=t)&&r.getContext!==void 0?t:t&&ii().getElementById(t)||we();var r;if(e.hasAttribute("data-fabric"))throw new or("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:r}=t;const{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(r)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:r,ctx:i}=this.lower;_c(r,i,t,e)}setCSSDimensions(t){Ao(this.lower.el,t)}calcOffset(){return function(t){var e;const r=t&&Be(t),i={left:0,top:0};if(!r)return i;const s=((e=wc(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};i.left+=parseInt(s.borderLeftWidth,10)||0,i.top+=parseInt(s.borderTopWidth,10)||0,i.left+=parseInt(s.paddingLeft,10)||0,i.top+=parseInt(s.paddingTop,10)||0;let o={left:0,top:0};const l=r.documentElement;t.getBoundingClientRect!==void 0&&(o=t.getBoundingClientRect());const h=bc(t);return{left:o.left+h.left-(l.clientLeft||0)+i.left,top:o.top+h.top-(l.clientTop||0)+i.top}}(this.lower.el)}dispose(){Xe().dispose(this.lower.el),delete this.lower}}const Ed={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...re]};class Ii extends sa(fc){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return Ii.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new da(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];const s=super.insertAt(t,...r);return r.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(br("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?ac():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:r=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const i=A({width:this.width,height:this.height},t);this.elements.setDimensions(i,this.getRetinaScaling()),this.hasLostContext=!0,this.width=i.width,this.height=i.height}r||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const r=t,i=[...this.viewportTransform],s=te(t,ye(i));i[0]=e,i[3]=e;const o=te(s,i);i[4]+=r.x-o.x,i[5]+=r.y-o.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new L(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new L(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=mn(()=>this.renderAndReset()))}calcViewportBoundaries(){const t=this.width,e=this.height,r=ye(this.viewportTransform),i=te({x:0,y:0},r),s=te({x:t,y:e},r),o=i.min(s),l=i.max(s);return this.vptCoords={tl:o,tr:new L(l.x,o.y),bl:new L(o.x,l.y),br:l}}cancelRequestedRender(){this.nextRenderHandle&&(gc(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const r=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const r=this.viewportTransform;t.save(),t.transform(...r),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let r=0,i=e.length;r<i;++r)e[r]&&e[r].render(t)}_renderBackgroundOrOverlay(t,e){const r=this["".concat(e,"Color")],i=this["".concat(e,"Image")],s=this.viewportTransform,o=this["".concat(e,"Vpt")];if(!r&&!i)return;const l=Pe(r);if(r){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=l?r.toLive(t):r,o&&t.transform(...s),l){t.transform(1,0,0,1,r.offsetX||0,r.offsetY||0);const h=r.gradientTransform||r.patternTransform;h&&t.transform(...h)}t.fill(),t.restore()}if(i){t.save();const{skipOffscreen:h}=this;this.skipOffscreen=o,o&&t.transform(...s),i.render(t),this.skipOffscreen=h,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new L(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new L(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new L(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new L(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new L(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return te(this.getCenterPoint(),ye(this.viewportTransform))}_centerObject(t,e){t.setXY(e,ut,ut),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const r=this.clipPath,i=r&&!r.excludeFromExport?this._toObject(r,t,e):null;return A(A(A({version:_n},ni(this,e)),{},{objects:this._objects.filter(s=>!s.excludeFromExport).map(s=>this._toObject(s,t,e))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,r){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const s=t[e](r);return this.includeDefaultValues||(t.includeDefaultValues=!!i),s}__serializeBgOverlay(t,e){const r={},i=this.backgroundImage,s=this.overlayImage,o=this.backgroundColor,l=this.overlayColor;return Pe(o)?o.excludeFromExport||(r.background=o.toObject(e)):o&&(r.background=o),Pe(l)?l.excludeFromExport||(r.overlay=l.toObject(e)):l&&(r.overlay=l),i&&!i.excludeFromExport&&(r.backgroundImage=this._toObject(i,t,e)),s&&!s.excludeFromExport&&(r.overlayImage=this._toObject(s,t,e)),r}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const r=[];return this._setSVGPreamble(r,t),this._setSVGHeader(r,t),this.clipPath&&r.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(r,"background"),this._setSVGBgOverlayImage(r,"backgroundImage",e),this._setSVGObjects(r,e),this.clipPath&&r.push(`</g>
`),this._setSVGBgOverlayColor(r,"overlay"),this._setSVGBgOverlayImage(r,"overlayImage",e),r.push("</svg>"),r.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const r=e.width||"".concat(this.width),i=e.height||"".concat(this.height),s=Ct.NUM_FRACTION_DIGITS,o=e.viewBox;let l;if(o)l='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const h=this.viewportTransform;l='viewBox="'.concat(Ft(-h[4]/h[0],s)," ").concat(Ft(-h[5]/h[3],s)," ").concat(Ft(this.width/h[0],s)," ").concat(Ft(this.height/h[3],s),'" ')}else l='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',i,'" ',l,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",_n,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Pr()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{const e=this["".concat(t,"Color")];if(Pe(e)){const r=this["".concat(t,"Vpt")],i=this.viewportTransform,s={isType:()=>!1,width:this.width/(r?i[0]:1),height:this.height/(r?i[3]:1)};return e.toSVG(s,{additionalTransform:r?Tn(i):""})}}).join("")}createSVGFontFacesMarkup(){const t=[],e={},r=Ct.fontPaths;this._objects.forEach(function s(o){t.push(o),is(o)&&o._objects.forEach(s)}),t.forEach(s=>{if(!(o=s)||typeof o._renderText!="function")return;var o;const{styles:l,fontFamily:h}=s;!e[h]&&r[h]&&(e[h]=!0,l&&Object.values(l).forEach(u=>{Object.values(u).forEach(p=>{let{fontFamily:y=""}=p;!e[y]&&r[y]&&(e[y]=!0)})}))});const i=Object.keys(e).map(s=>`		@font-face {
			font-family: '`.concat(s,`';
			src: url('`).concat(r[s],`');
		}
`)).join("");return i?`	<style type="text/css"><![CDATA[
`.concat(i,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(r=>{r.excludeFromExport||this._setSVGObject(t,r,e)})}_setSVGObject(t,e,r){t.push(e.toSVG(r))}_setSVGBgOverlayImage(t,e,r){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(r))}_setSVGBgOverlayColor(t,e){const r=this["".concat(e,"Color")];if(r)if(Pe(r)){const i=r.repeat||"",s=this.width,o=this.height,l=this["".concat(e,"Vpt")]?Tn(ye(this.viewportTransform)):"";t.push('<rect transform="'.concat(l," translate(").concat(s/2,",").concat(o/2,')" x="').concat(r.offsetX-s/2,'" y="').concat(r.offsetY-o/2,'" width="').concat(i!=="repeat-y"&&i!=="no-repeat"||!Sl(r)?s:r.source.width,'" height="').concat(i!=="repeat-x"&&i!=="no-repeat"||!Sl(r)?o:r.source.height,'" fill="url(#SVGID_').concat(r.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',r,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new or("`json` is undefined"));const i=typeof t=="string"?JSON.parse(t):t,{objects:s=[],backgroundImage:o,background:l,overlayImage:h,overlay:u,clipPath:p}=i,y=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([ki(s,{reviver:e,signal:r}),jn({backgroundImage:o,backgroundColor:l,overlayImage:h,overlayColor:u,clipPath:p},{signal:r})]).then(b=>{let[_,w]=b;return this.clear(),this.add(..._),this.set(i),this.set(w),this.renderOnAddRemove=y,this})}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=Me(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:r=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,o=i*(s?this.getRetinaScaling():1);return oa(this.toCanvasElement(o,t),e,r)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:r=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,o=i*(s?this.getRetinaScaling():1);return aa(this.toCanvasElement(o,t),e,r)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:r,left:i,top:s,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=(e||this.width)*t,h=(r||this.height)*t,u=this.getZoom(),p=this.width,y=this.height,b=this.skipControlsDrawing,_=u*t,w=this.viewportTransform,S=[_,0,0,_,(w[4]-(i||0))*t,(w[5]-(s||0))*t],F=this.enableRetinaScaling,M=Me({width:l,height:h}),X=o?this._objects.filter(q=>o(q)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=S,this.width=l,this.height=h,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(M.getContext("2d"),X),this.viewportTransform=w,this.width=p,this.height=y,this.calcViewportBoundaries(),this.enableRetinaScaling=F,this.skipControlsDrawing=b,M}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Sn.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{const r=()=>{this.destroy(),t(!0)};r.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=r:r()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}D(Ii,"ownDefaults",Ed);const Pd=["touchstart","touchmove","touchend"],Cc=n=>{const t=bc(n.target),e=function(r){const i=r.changedTouches;return i&&i[0]?i[0]:r}(n);return new L(e.clientX+t.left,e.clientY+t.top)},ds=n=>Pd.includes(n.type)||n.pointerType==="touch",Eo=n=>{n.preventDefault(),n.stopPropagation()},cr=n=>{let t=0,e=0,r=0,i=0;for(let s=0,o=n.length;s<o;s++){const{x:l,y:h}=n[s];(l>r||!s)&&(r=l),(l<t||!s)&&(t=l),(h>i||!s)&&(i=h),(h<e||!s)&&(e=h)}return{left:t,top:e,width:r-t,height:i-e}},Md=["translateX","translateY","scaleX","scaleY"],Sc=(n,t)=>Di(n,Bt(t,n.calcOwnMatrix())),Di=(n,t)=>{const e=Zr(t),{translateX:r,translateY:i,scaleX:s,scaleY:o}=e,l=Lt(e,Md),h=new L(r,i);n.flipX=!1,n.flipY=!1,Object.assign(n,l),n.set({scaleX:s,scaleY:o}),n.setPositionByOrigin(h,ut,ut)},Tc=n=>{n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},fa=n=>({scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}),Fs=(n,t,e)=>{const r=n/2,i=t/2,s=[new L(-r,-i),new L(r,-i),new L(-r,i),new L(r,i)].map(l=>l.transform(e)),o=cr(s);return new L(o.width,o.height)},Fn=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re;return Bt(ye(arguments.length>1&&arguments[1]!==void 0?arguments[1]:re),n)},xr=function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:re,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:re;return n.transform(Fn(t,e))},Oc=function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:re,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:re;return n.transform(Fn(t,e),!0)},Po=(n,t,e)=>{const r=Fn(t,e);return Di(n,Bt(r,n.calcOwnMatrix())),r},ga=(n,t)=>{var e;const{transform:{target:r}}=t;(e=r.canvas)===null||e===void 0||e.fire("object:".concat(n),A(A({},t),{},{target:r})),r.fire(n,t)},jd={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Yt=n=>typeof n=="string"?jd[n]:n-.5,fs="not-allowed";function kc(n){return Yt(n.originX)===Yt(ut)&&Yt(n.originY)===Yt(ut)}function Ol(n){return .5-Yt(n)}const Ne=(n,t)=>n[t],pa=(n,t,e,r)=>({e:n,transform:t,pointer:new L(e,r)});function Dc(n,t){const e=n.getTotalAngle()+Mr(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function Ls(n,t,e,r,i){var s;let{target:o,corner:l}=n;const h=o.controls[l],u=((s=o.canvas)===null||s===void 0?void 0:s.getZoom())||1,p=o.padding/u,y=function(b,_,w,S){const F=b.getRelativeCenterPoint(),M=w!==void 0&&S!==void 0?b.translateToGivenOrigin(F,ut,ut,w,S):new L(b.left,b.top);return(b.angle?_.rotate(-Nt(b.angle),F):_).subtract(M)}(o,new L(r,i),t,e);return y.x>=p&&(y.x-=p),y.x<=-p&&(y.x+=p),y.y>=p&&(y.y-=p),y.y<=p&&(y.y+=p),y.x-=h.offsetX,y.y-=h.offsetY,y}const Ac=(n,t,e,r)=>{const{target:i,offsetX:s,offsetY:o}=t,l=e-s,h=r-o,u=!Ne(i,"lockMovementX")&&i.left!==l,p=!Ne(i,"lockMovementY")&&i.top!==h;return u&&i.set(Ot,l),p&&i.set(xe,h),(u||p)&&ga(lc,pa(n,t,e,r)),u||p};class Ec{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):he,s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",l=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",u=this.opacity!==void 0?this.opacity:"1",p=this.visible?"":" visibility: hidden;",y=t?"":this.getSvgFilter(),b=On(zt,this.fill);return[On(ue,this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",l,"; ","stroke-miterlimit: ",h,"; ",b,"fill-rule: ",e,"; ","opacity: ",u,";",y,p].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(Tn(r));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:r=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:r,withShadow:i,additionalTransform:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=e?"":'style="'.concat(this.getSvgStyles(),'" '),l=i?'style="'.concat(this.getSvgFilter(),'" '):"",h=this.clipPath,u=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",p=h&&h.absolutePositioned,y=this.stroke,b=this.fill,_=this.shadow,w=[],S=t.indexOf("COMMON_PARTS");let F;h&&(h.clipPathId="CLIPPATH_".concat(Pr()),F='<clipPath id="'.concat(h.clipPathId,`" >
`).concat(h.toClipPathSVG(r),`</clipPath>
`)),p&&w.push("<g ",l,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),p?"":l+this.getSvgCommons(),` >
`);const M=[o,u,e?"":this.addPaintOrder()," ",s?'transform="'.concat(s,'" '):""].join("");return t[S]=M,Pe(b)&&w.push(b.toSVG(this)),Pe(y)&&w.push(y.toSVG(this)),_&&w.push(_.toSVG(this)),h&&w.push(F),w.push(t.join("")),w.push(`</g>
`),p&&w.push(`</g>
`),r?r(w.join("")):w.join("")}addPaintOrder(){return this.paintFirst!==zt?' paint-order="'.concat(this.paintFirst,'" '):""}}function Is(n){return new RegExp("^("+n.join("|")+")\\b","i")}var kl;const We=String.raw(kl||(kl=jr(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),Mo="http://www.w3.org/2000/svg",Fd=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+We+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+We+"))?\\s+(.*)"),Ld={cx:Ot,x:Ot,r:"radius",cy:xe,y:xe,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},mo="font-size",vo="clip-path",Id=Is(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),Rd=Is(["symbol","image","marker","pattern","view","svg"]),Dl=Is(["symbol","g","a","svg","clipPath","defs"]),Al=new RegExp("^\\s*("+We+"+)\\s*,?\\s*("+We+"+)\\s*,?\\s*("+We+"+)\\s*,?\\s*("+We+"+)\\s*$"),Bd=new L(1,0),Pc=new L,ma=(n,t)=>n.rotate(t),gs=(n,t)=>new L(t).subtract(n),ps=n=>n.distanceFrom(Pc),ms=(n,t)=>Math.atan2(Si(n,t),jc(n,t)),Mc=n=>ms(Bd,n),Rs=n=>n.eq(Pc)?n:n.scalarDivide(ps(n)),va=function(n){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return Rs(new L(-n.y,n.x).scalarMultiply(t?1:-1))},Si=(n,t)=>n.x*t.y-n.y*t.x,jc=(n,t)=>n.x*t.x+n.y*t.y,jo=(n,t,e)=>{if(n.eq(t)||n.eq(e))return!0;const r=Si(t,e),i=Si(t,n),s=Si(e,n);return r>=0?i>=0&&s<=0:!(i<=0&&s>=0)},El="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",Pl=new RegExp("(?:\\s|^)"+El+El+"("+We+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class be{constructor(t){const e=typeof t=="string"?be.parseShadow(t):t;Object.assign(this,be.ownDefaults,e),this.id=Pr()}static parseShadow(t){const e=t.trim(),[,r=0,i=0,s=0]=(Pl.exec(e)||[]).map(o=>parseFloat(o)||0);return{color:(e.replace(Pl,"")||"rgb(0,0,0)").trim(),offsetX:r,offsetY:i,blur:s}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=ma(new L(this.offsetX,this.offsetY),Nt(-t.angle)),r=new _t(this.color);let i=40,s=40;return t.width&&t.height&&(i=100*Ft((Math.abs(e.x)+this.blur)/t.width,Ct.NUM_FRACTION_DIGITS)+20,s=100*Ft((Math.abs(e.y)+this.blur)/t.height,Ct.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(s,'%" height="').concat(100+2*s,'%" x="-').concat(i,'%" width="').concat(100+2*i,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Ft(this.blur?this.blur/2:0,Ct.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Ft(e.x,Ct.NUM_FRACTION_DIGITS),'" dy="').concat(Ft(e.y,Ct.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(r.toRgb(),'" flood-opacity="').concat(r.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=be.ownDefaults;return this.includeDefaultValues?t:ha(t,(r,i)=>r!==e[i])}static async fromObject(t){return new this(t)}}D(be,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),D(be,"type","shadow"),tt.setClass(be,"shadow");const Jr=(n,t,e)=>Math.max(n,Math.min(t,e)),Wd=[xe,Ot,de,Se,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Mi,ji],_r=[zt,ue,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Hd={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:Ot,originY:xe,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:zt,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},yo=(n,t,e,r)=>(n<Math.abs(t)?(n=t,r=e/4):r=t===0&&n===0?e/wr*Math.asin(1):e/wr*Math.asin(t/n),{a:n,c:t,p:e,s:r}),Ml=(n,t,e,r,i)=>n*Math.pow(2,10*(r-=1))*Math.sin((r*i-t)*wr/e),Fc=(n,t,e,r)=>-e*Math.cos(n/r*Er)+e+t,Fo=(n,t,e,r)=>(n/=r)<1/2.75?e*(7.5625*n*n)+t:n<2/2.75?e*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?e*(7.5625*(n-=2.25/2.75)*n+.9375)+t:e*(7.5625*(n-=2.625/2.75)*n+.984375)+t,jl=(n,t,e,r)=>e-Fo(r-n,0,e,r)+t;var Nd=Object.freeze({__proto__:null,defaultEasing:Fc,easeInBack:function(n,t,e,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*(n/=r)*n*((i+1)*n-i)+t},easeInBounce:jl,easeInCirc:(n,t,e,r)=>-e*(Math.sqrt(1-(n/=r)*n)-1)+t,easeInCubic:(n,t,e,r)=>e*(n/r)**3+t,easeInElastic:(n,t,e,r)=>{const i=e;let s=0;if(n===0)return t;if((n/=r)===1)return t+e;s||(s=.3*r);const{a:o,s:l,p:h}=yo(i,e,s,1.70158);return-Ml(o,l,h,n,r)+t},easeInExpo:(n,t,e,r)=>n===0?t:e*2**(10*(n/r-1))+t,easeInOutBack:function(n,t,e,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return(n/=r/2)<1?e/2*(n*n*((1+(i*=1.525))*n-i))+t:e/2*((n-=2)*n*((1+(i*=1.525))*n+i)+2)+t},easeInOutBounce:(n,t,e,r)=>n<r/2?.5*jl(2*n,0,e,r)+t:.5*Fo(2*n-r,0,e,r)+.5*e+t,easeInOutCirc:(n,t,e,r)=>(n/=r/2)<1?-e/2*(Math.sqrt(1-n**2)-1)+t:e/2*(Math.sqrt(1-(n-=2)*n)+1)+t,easeInOutCubic:(n,t,e,r)=>(n/=r/2)<1?e/2*n**3+t:e/2*((n-2)**3+2)+t,easeInOutElastic:(n,t,e,r)=>{const i=e;let s=0;if(n===0)return t;if((n/=r/2)===2)return t+e;s||(s=r*(.3*1.5));const{a:o,s:l,p:h,c:u}=yo(i,e,s,1.70158);return n<1?-.5*Ml(o,l,h,n,r)+t:o*Math.pow(2,-10*(n-=1))*Math.sin((n*r-l)*wr/h)*.5+u+t},easeInOutExpo:(n,t,e,r)=>n===0?t:n===r?t+e:(n/=r/2)<1?e/2*2**(10*(n-1))+t:e/2*-(2**(-10*--n)+2)+t,easeInOutQuad:(n,t,e,r)=>(n/=r/2)<1?e/2*n**2+t:-e/2*(--n*(n-2)-1)+t,easeInOutQuart:(n,t,e,r)=>(n/=r/2)<1?e/2*n**4+t:-e/2*((n-=2)*n**3-2)+t,easeInOutQuint:(n,t,e,r)=>(n/=r/2)<1?e/2*n**5+t:e/2*((n-2)**5+2)+t,easeInOutSine:(n,t,e,r)=>-e/2*(Math.cos(Math.PI*n/r)-1)+t,easeInQuad:(n,t,e,r)=>e*(n/=r)*n+t,easeInQuart:(n,t,e,r)=>e*(n/=r)*n**3+t,easeInQuint:(n,t,e,r)=>e*(n/r)**5+t,easeInSine:(n,t,e,r)=>-e*Math.cos(n/r*Er)+e+t,easeOutBack:function(n,t,e,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*((n=n/r-1)*n*((i+1)*n+i)+1)+t},easeOutBounce:Fo,easeOutCirc:(n,t,e,r)=>e*Math.sqrt(1-(n=n/r-1)*n)+t,easeOutCubic:(n,t,e,r)=>e*((n/r-1)**3+1)+t,easeOutElastic:(n,t,e,r)=>{const i=e;let s=0;if(n===0)return t;if((n/=r)===1)return t+e;s||(s=.3*r);const{a:o,s:l,p:h,c:u}=yo(i,e,s,1.70158);return o*2**(-10*n)*Math.sin((n*r-l)*wr/h)+u+t},easeOutExpo:(n,t,e,r)=>n===r?t+e:e*-(2**(-10*n/r)+1)+t,easeOutQuad:(n,t,e,r)=>-e*(n/=r)*(n-2)+t,easeOutQuart:(n,t,e,r)=>-e*((n=n/r-1)*n**3-1)+t,easeOutQuint:(n,t,e,r)=>e*((n/r-1)**5+1)+t,easeOutSine:(n,t,e,r)=>e*Math.sin(n/r*Er)+t});const Xd=()=>!1;class ya{constructor(t){let{startValue:e,byValue:r,duration:i=500,delay:s=0,easing:o=Fc,onStart:l=$r,onChange:h=$r,onComplete:u=$r,abort:p=Xd,target:y}=t;D(this,"_state","pending"),D(this,"durationProgress",0),D(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=s,this.easing=o,this._onStart=l,this._onChange=h,this._onComplete=u,this._abort=p,this.target=y,this.startValue=e,this.byValue=r,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>mn(t),this.delay):mn(t)}tick(t){const e=(t||+new Date)-this.startTime,r=Math.min(e,this.duration);this.durationProgress=r/this.duration;const{value:i,valueProgress:s}=this.calculate(r);this.value=Object.freeze(i),this.valueProgress=s,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),mn(this.tick)))}register(){Sn.push(this)}unregister(){Sn.remove(this)}abort(){this._state="aborted",this.unregister()}}const Vd=["startValue","endValue"];class Yd extends ya{constructor(t){let{startValue:e=0,endValue:r=100}=t;super(A(A({},Lt(t,Vd)),{},{startValue:e,byValue:r-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const zd=["startValue","endValue"];class Gd extends ya{constructor(t){let{startValue:e=[0],endValue:r=[100]}=t;super(A(A({},Lt(t,zd)),{},{startValue:e,byValue:r.map((i,s)=>i-e[s])}))}calculate(t){const e=this.startValue.map((r,i)=>this.easing(t,r,this.byValue[i],this.duration,i));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const qd=["startValue","endValue","easing","onChange","onComplete","abort"],Ud=(n,t,e,r)=>t+e*(1-Math.cos(n/r*Er)),xo=n=>n&&((t,e,r)=>n(new _t(t).toRgba(),e,r));class $d extends ya{constructor(t){let{startValue:e,endValue:r,easing:i=Ud,onChange:s,onComplete:o,abort:l}=t,h=Lt(t,qd);const u=new _t(e).getSource(),p=new _t(r).getSource();super(A(A({},h),{},{startValue:u,byValue:p.map((y,b)=>y-u[b]),easing:i,onChange:xo(s),onComplete:xo(o),abort:xo(l)}))}calculate(t){const[e,r,i,s]=this.startValue.map((l,h)=>this.easing(t,l,this.byValue[h],this.duration,h)),o=[...[e,r,i].map(Math.round),Jr(0,s,1)];return{value:o,valueProgress:o.map((l,h)=>this.byValue[h]!==0?Math.abs((l-this.startValue[h])/this.byValue[h]):0).find(l=>l!==0)||0}}}function xa(n){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(n)?new Gd(n):new Yd(n);return t.start(),t}function Lc(n){const t=new $d(n);return t.start(),t}class jt{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.points=this.points.concat(e.filter(i=>!this.includes(i))),this}static isPointContained(t,e,r){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(r))return t.eq(e);if(e.x===r.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,r.y)&&t.y<=Math.max(e.y,r.y));if(e.y===r.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,r.x)&&t.x<=Math.max(e.x,r.x));{const s=gs(e,r),o=gs(e,t).divide(s);return i?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(t,e){const r=new L(t).setX(Math.min(t.x-1,...e.map(s=>s.x)));let i=0;for(let s=0;s<e.length;s++){const o=this.intersectSegmentSegment(e[s],e[(s+1)%e.length],t,r);if(o.includes(t))return!0;i+=+(o.status==="Intersection")}return i%2==1}static intersectLineLine(t,e,r,i){let s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const l=e.x-t.x,h=e.y-t.y,u=i.x-r.x,p=i.y-r.y,y=t.x-r.x,b=t.y-r.y,_=u*b-p*y,w=l*b-h*y,S=p*l-u*h;if(S!==0){const F=_/S,M=w/S;return(s||0<=F&&F<=1)&&(o||0<=M&&M<=1)?new jt("Intersection").append(new L(t.x+F*l,t.y+F*h)):new jt}if(_===0||w===0){const F=s||o||jt.isPointContained(t,r,i)||jt.isPointContained(e,r,i)||jt.isPointContained(r,t,e)||jt.isPointContained(i,t,e);return new jt(F?"Coincident":void 0)}return new jt("Parallel")}static intersectSegmentLine(t,e,r,i){return jt.intersectLineLine(t,e,r,i,!1,!0)}static intersectSegmentSegment(t,e,r,i){return jt.intersectLineLine(t,e,r,i,!1,!1)}static intersectLinePolygon(t,e,r){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const s=new jt,o=r.length;for(let l,h,u,p=0;p<o;p++){if(l=r[p],h=r[(p+1)%o],u=jt.intersectLineLine(t,e,l,h,i,!1),u.status==="Coincident")return u;s.append(...u.points)}return s.points.length>0&&(s.status="Intersection"),s}static intersectSegmentPolygon(t,e,r){return jt.intersectLinePolygon(t,e,r,!1)}static intersectPolygonPolygon(t,e){const r=new jt,i=t.length,s=[];for(let o=0;o<i;o++){const l=t[o],h=t[(o+1)%i],u=jt.intersectSegmentPolygon(l,h,e);u.status==="Coincident"?(s.push(u),r.append(l,h)):r.append(...u.points)}return s.length>0&&s.length===t.length?new jt("Coincident"):(r.points.length>0&&(r.status="Intersection"),r)}static intersectPolygonRectangle(t,e,r){const i=e.min(r),s=e.max(r),o=new L(s.x,i.y),l=new L(i.x,s.y);return jt.intersectPolygonPolygon(t,[i,o,s,l])}}class Kd extends fc{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?te(t,this.group.calcTransformMatrix()):t}setXY(t,e,r){this.group&&(t=te(t,ye(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,r)}getRelativeXY(){return new L(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,r)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:r,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),s=[t,e,r,i];if(this.group){const o=this.group.calcTransformMatrix();return s.map(l=>te(l,o))}return s}intersectsWithRect(t,e){return jt.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){const e=jt.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e))}isContainedWithinRect(t,e){const{left:r,top:i,width:s,height:o}=this.getBoundingRect();return r>=t.x&&r+s<=e.x&&i>=t.y&&i+o<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return jt.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(r=>r.x<=e.x&&r.x>=t.x&&r.y<=e.y&&r.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every(r=>(r.x>=e.x||r.x<=t.x)&&(r.y>=e.y||r.y<=t.y))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return cr(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(de,t),this._set(Se,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Mr(vc(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||re.concat()}calcACoords(){const t=Li({angle:this.angle}),{x:e,y:r}=this.getRelativeCenterPoint(),i=Fi(e,r),s=Bt(i,t),o=this._getTransformedDimensions(),l=o.x/2,h=o.y/2;return{tl:te({x:-l,y:-h},s),tr:te({x:l,y:-h},s),bl:te({x:-l,y:h},s),br:te({x:l,y:h},s)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Yt(this.originX),Yt(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const r=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key.every((s,o)=>s===r[o])?i.value:(this.group&&(e=Bt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:r,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const r=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:r.x,translateY:r.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},s=xc(i);return this.ownMatrixCache={key:t,value:s},s}_getNonTransformedDimensions(){return new L(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=A({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),r=e.strokeWidth;let i=r,s=0;this.strokeUniform&&(i=0,s=r);const o=e.width+i,l=e.height+i;let h;return h=e.skewX===0&&e.skewY===0?new L(o*e.scaleX,l*e.scaleY):Fs(o,l,Mn(e)),h.scalarAdd(s)}translateToGivenOrigin(t,e,r,i,s){let o=t.x,l=t.y;const h=Yt(i)-Yt(e),u=Yt(s)-Yt(r);if(h||u){const p=this._getTransformedDimensions();o+=h*p.x,l+=u*p.y}return new L(o,l)}translateToCenterPoint(t,e,r){if(e===ut&&r===ut)return t;const i=this.translateToGivenOrigin(t,e,r,ut,ut);return this.angle?i.rotate(Nt(this.angle),t):i}translateToOriginPoint(t,e,r){const i=this.translateToGivenOrigin(t,ut,ut,e,r);return this.angle?i.rotate(Nt(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?te(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new L(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,r){const i=this.translateToCenterPoint(t,e,r),s=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:s.x,top:s.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),Ot,xe)}}const Zd=["type"],Jd=["extraParam"];let Qe=class ns extends Kd{static getDefaults(){return ns.ownDefaults}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){br("warn","Setting type has no effect",t)}constructor(t){super(),D(this,"_cacheContext",null),Object.assign(this,ns.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=we(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,r=t.height,i=Ct.maxCacheSideLimit,s=Ct.minCacheSideLimit;if(e<=i&&r<=i&&e*r<=Ct.perfLimitSizeTotal)return e<s&&(t.width=s),r<s&&(t.height=s),t;const o=e/r,[l,h]=Ci.limitDimsByArea(o),u=Jr(s,l,i),p=Jr(s,h,i);return e>u&&(t.zoomX/=e/u,t.width=u,t.capped=!0),r>p&&(t.zoomY/=r/p,t.height=p,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),r=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:Math.ceil(r+2),height:Math.ceil(i+2),zoomX:t.x,zoomY:t.y,x:r,y:i}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:r,height:i,zoomX:s,zoomY:o,x:l,y:h}=this._limitCacheSize(this._getCacheCanvasDimensions()),u=r!==t.width||i!==t.height,p=this.zoomX!==s||this.zoomY!==o;if(!t||!e)return!1;if(u||p){r!==t.width||i!==t.height?(t.width=r,t.height=i):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const y=l/2,b=h/2;return this.cacheTranslationX=Math.round(t.width/2-y)+y,this.cacheTranslationY=Math.round(t.height/2-b)+b,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(s,o),this.zoomX=s,this.zoomY=o,!0}return!1}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,r=this.calcTransformMatrix(!e);t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}getObjectScaling(){if(!this.group)return new L(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Zr(this.calcTransformMatrix());return new L(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),r=this.getCanvasRetinaScaling();return t.scalarMultiply(e*r)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!==de&&t!==Se||(e=this._constrainScale(e)),t===de&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof be||(e=new be(e));const r=this[t]!==e;return this[t]=e,r&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||r&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:r,cacheTranslationX:i,cacheTranslationY:s}=this,{width:o,height:l}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:r,cacheTranslationX:i,cacheTranslationY:s,width:o,height:l,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===ue&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e,r){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(r,0,0),t.restore()}drawObject(t,e,r){const i=this.fill,s=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,r),this.fill=i,this.stroke=s}createClipPathLayer(t,e){const r=Me(e),i=r.getContext("2d");if(i.translate(e.cacheTranslationX,e.cacheTranslationY),i.scale(e.zoomX,e.zoomY),t._cacheCanvas=r,e.parentClipPaths.forEach(s=>{s.transform(i)}),e.parentClipPaths.push(t),t.absolutePositioned){const s=ye(this.calcTransformMatrix());i.transform(s[0],s[1],s[2],s[3],s[4],s[5])}return t.transform(i),t.drawObject(i,!0,e),r}_drawClipPath(t,e,r){if(!e)return;e._transformDone=!0;const i=this.createClipPathLayer(e,r);this.drawClipPathOnCache(t,e,i)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,r=this._cacheContext;return!(!e||!r||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&r&&!t&&(r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,e.width,e.height),r.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const r=e.stroke;r&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Pe(r)?r.gradientUnits==="percentage"||r.gradientTransform||r.patternTransform?this._applyPatternForTransformedGradient(t,r):(t.strokeStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:r}=e;r&&(Pe(r)?(t.fillStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.fillStyle=r)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,r=this.canvas,i=this.getCanvasRetinaScaling(),[s,,,o]=(r==null?void 0:r.viewportTransform)||re,l=s*i,h=o*i,u=e.nonScaling?new L(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*Ct.browserShadowBlurConstant*(l+h)*(u.x+u.y)/4,t.shadowOffsetX=e.offsetX*l*u.x,t.shadowOffsetY=e.offsetY*h*u.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Pe(e))return{offsetX:0,offsetY:0};const r=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,i,s):t.transform(1,0,0,1,i,s),r&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),{offsetX:i,offsetY:s}}_renderPaintInOrder(t){this.paintFirst===ue?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var r;const i=this._limitCacheSize(this._getCacheCanvasDimensions()),s=this.getCanvasRetinaScaling(),o=i.x/this.scaleX/s,l=i.y/this.scaleY/s,h=Me({width:Math.ceil(o),height:Math.ceil(l)}),u=h.getContext("2d");u&&(u.beginPath(),u.moveTo(0,0),u.lineTo(o,0),u.lineTo(o,l),u.lineTo(0,l),u.closePath(),u.translate(o/2,l/2),u.scale(i.zoomX/this.scaleX/s,i.zoomY/this.scaleY/s),this._applyPatternGradientTransform(u,e),u.fillStyle=e.toLive(t),u.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/i.zoomX,s*this.scaleY/i.zoomY),t.strokeStyle=(r=u.createPattern(h,"no-repeat"))!==null&&r!==void 0?r:"")}_findCenterFromElement(){return new L(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(tt.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=fa(this),r=this.group,i=this.shadow,s=Math.abs,o=t.enableRetinaScaling?ac():1,l=(t.multiplier||1)*o,h=t.canvasProvider||(X=>new Ii(X,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&Tc(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Po(this,this.getViewportTransform()),this.setCoords();const u=we(),p=this.getBoundingRect(),y=this.shadow,b=new L;if(y){const X=y.blur,q=y.nonScaling?new L(1,1):this.getObjectScaling();b.x=2*Math.round(s(y.offsetX)+X)*s(q.x),b.y=2*Math.round(s(y.offsetY)+X)*s(q.y)}const _=p.width+b.x,w=p.height+b.y;u.width=Math.ceil(_),u.height=Math.ceil(w);const S=h(u);t.format==="jpeg"&&(S.backgroundColor="#fff"),this.setPositionByOrigin(new L(S.width/2,S.height/2),ut,ut);const F=this.canvas;S._objects=[this],this.set("canvas",S),this.setCoords();const M=S.toCanvasElement(l||1,t);return this.set("canvas",F),this.shadow=i,r&&(this.group=r),this.set(e),this.setCoords(),S._objects=[],S.destroy(),M}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return oa(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return aa(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:r,originY:i}=this;if(e){const{x:s,y:o}=this.getRelativeCenterPoint();this.originX=ut,this.originY=ut,this.left=s,this.top=o}if(this.set("angle",t),e){const{x:s,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),r,i);this.left=s,this.top=o,this.originX=r,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Sn.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Xe().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce((r,i)=>{let[s,o]=i;return r[s]=this._animate(s,o,e),r},{})}_animate(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=t.split("."),s=this.constructor.colorProperties.includes(i[i.length-1]),{abort:o,startValue:l,onChange:h,onComplete:u}=r,p=A(A({},r),{},{target:this,startValue:l??i.reduce((y,b)=>y[b],this),endValue:e,abort:o==null?void 0:o.bind(this),onChange:(y,b,_)=>{i.reduce((w,S,F)=>(F===i.length-1&&(w[S]=y),w[S]),this),h&&h(y,b,_)},onComplete:(y,b,_)=>{this.setCoords(),u&&u(y,b,_)}});return s?Lc(p):xa(p)}isDescendantOf(t){const{parent:e,group:r}=this;return e===t||r===t||!!e&&e.isDescendantOf(t)||!!r&&r!==e&&r.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do e=e.parent,e&&t.push(e);while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),r=t.getAncestors();if(e.length===0&&r.length>0&&this===r[r.length-1])return{fork:[],otherFork:[t,...r.slice(0,r.length-1)],common:[this]};for(let i,s=0;s<e.length;s++){if(i=e[s],i===t)return{fork:[this,...e.slice(0,s)],otherFork:[],common:e.slice(s)};for(let o=0;o<r.length;o++){if(this===r[o])return{fork:[],otherFork:[t,...r.slice(0,o)],common:[this,...e]};if(i===r[o])return{fork:[this,...e.slice(0,s)],otherFork:[t,...r.slice(0,o)],common:e.slice(s)}}}return{fork:[this,...e],otherFork:[t,...r],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const r=e.common[0]||this.canvas;if(!r)return;const i=e.fork.pop(),s=e.otherFork.pop(),o=r._objects.indexOf(i),l=r._objects.indexOf(s);return o>-1&&o>l}toObject(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(ns.customProperties,this.constructor.customProperties||[]);let e;const r=Ct.NUM_FRACTION_DIGITS,{clipPath:i,fill:s,stroke:o,shadow:l,strokeDashArray:h,left:u,top:p,originX:y,originY:b,width:_,height:w,strokeWidth:S,strokeLineCap:F,strokeDashOffset:M,strokeLineJoin:X,strokeUniform:q,strokeMiterLimit:K,scaleX:et,scaleY:ct,angle:f,flipX:it,flipY:Z,opacity:vt,visible:kt,backgroundColor:Tt,fillRule:nt,paintFirst:yt,globalCompositeOperation:Xt,skewX:Y,skewY:V}=this;i&&!i.excludeFromExport&&(e=i.toObject(t.concat("inverted","absolutePositioned")));const z=rt=>Ft(rt,r),ot=A(A({},ni(this,t)),{},{type:this.constructor.type,version:_n,originX:y,originY:b,left:z(u),top:z(p),width:z(_),height:z(w),fill:Cl(s)?s.toObject():s,stroke:Cl(o)?o.toObject():o,strokeWidth:z(S),strokeDashArray:h&&h.concat(),strokeLineCap:F,strokeDashOffset:M,strokeLineJoin:X,strokeUniform:q,strokeMiterLimit:z(K),scaleX:z(et),scaleY:z(ct),angle:z(f),flipX:it,flipY:Z,opacity:z(vt),shadow:l&&l.toObject(),visible:kt,backgroundColor:Tt,fillRule:nt,paintFirst:yt,globalCompositeOperation:Xt,skewX:z(Y),skewY:z(V)},e?{clipPath:e}:null);return this.includeDefaultValues?ot:this._removeDefaultValues(ot)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),r=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return ha(t,(i,s)=>{if(s===Ot||s===xe||s==="type")return!0;const o=r[s];return i!==o&&!(Array.isArray(i)&&Array.isArray(o)&&i.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=Lt(t,Zd),r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:i}=r,s=Lt(r,Jd);return jn(e,s).then(o=>i?(delete o[i],new this(e[i],o)):new this(o))}static fromObject(t,e){return this._fromObject(t,e)}};D(Qe,"stateProperties",Wd),D(Qe,"cacheProperties",_r),D(Qe,"ownDefaults",Hd),D(Qe,"type","FabricObject"),D(Qe,"colorProperties",[zt,ue,"backgroundColor"]),D(Qe,"customProperties",[]),tt.setClass(Qe),tt.setClass(Qe,"object");const Fr=(n,t,e)=>(r,i,s,o)=>{const l=t(r,i,s,o);return l&&ga(n,A(A({},pa(r,i,s,o)),e)),l};function si(n){return(t,e,r,i)=>{const{target:s,originX:o,originY:l}=e,h=s.getRelativeCenterPoint(),u=s.translateToOriginPoint(h,o,l),p=n(t,e,r,i);return s.setPositionByOrigin(u,e.originX,e.originY),p}}const Lo=Fr(Cn,si((n,t,e,r)=>{const i=Ls(t,t.originX,t.originY,e,r);if(Yt(t.originX)===Yt(ut)||Yt(t.originX)===Yt(Vt)&&i.x<0||Yt(t.originX)===Yt(Ot)&&i.x>0){const{target:s}=t,o=s.strokeWidth/(s.strokeUniform?s.scaleX:1),l=kc(t)?2:1,h=s.width,u=Math.abs(i.x*l/s.scaleX)-o;return s.set("width",Math.max(u,1)),h!==s.width}return!1}));function Ic(n,t,e,r,i){r=r||{};const s=this.sizeX||r.cornerSize||i.cornerSize,o=this.sizeY||r.cornerSize||i.cornerSize,l=r.transparentCorners!==void 0?r.transparentCorners:i.transparentCorners,h=l?ue:zt,u=!l&&(r.cornerStrokeColor||i.cornerStrokeColor);let p,y=t,b=e;n.save(),n.fillStyle=r.cornerColor||i.cornerColor||"",n.strokeStyle=r.cornerStrokeColor||i.cornerStrokeColor||"",s>o?(p=s,n.scale(1,o/s),b=e*s/o):o>s?(p=o,n.scale(s/o,1),y=t*o/s):p=s,n.beginPath(),n.arc(y,b,p/2,0,wr,!1),n[h](),u&&n.stroke(),n.restore()}function Rc(n,t,e,r,i){r=r||{};const s=this.sizeX||r.cornerSize||i.cornerSize,o=this.sizeY||r.cornerSize||i.cornerSize,l=r.transparentCorners!==void 0?r.transparentCorners:i.transparentCorners,h=l?ue:zt,u=!l&&(r.cornerStrokeColor||i.cornerStrokeColor),p=s/2,y=o/2;n.save(),n.fillStyle=r.cornerColor||i.cornerColor||"",n.strokeStyle=r.cornerStrokeColor||i.cornerStrokeColor||"",n.translate(t,e);const b=i.getTotalAngle();n.rotate(Nt(b)),n["".concat(h,"Rect")](-p,-y,s,o),u&&n.strokeRect(-p,-y,s,o),n.restore()}class ve{constructor(t){D(this,"visible",!0),D(this,"actionName",Ps),D(this,"angle",0),D(this,"x",0),D(this,"y",0),D(this,"offsetX",0),D(this,"offsetY",0),D(this,"sizeX",0),D(this,"sizeY",0),D(this,"touchSizeX",0),D(this,"touchSizeY",0),D(this,"cursorStyle","crosshair"),D(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,r,i){var s;let{tl:o,tr:l,br:h,bl:u}=i;return((s=e.canvas)===null||s===void 0?void 0:s.getActiveObject())===e&&e.isControlVisible(t)&&jt.isPointInPolygon(r,[o,l,h,u])}getActionHandler(t,e,r){return this.actionHandler}getMouseDownHandler(t,e,r){return this.mouseDownHandler}getMouseUpHandler(t,e,r){return this.mouseUpHandler}cursorStyleHandler(t,e,r){return e.cursorStyle}getActionName(t,e,r){return e.actionName}getVisibility(t,e){var r,i;return(r=(i=t._controlsVisibility)===null||i===void 0?void 0:i[e])!==null&&r!==void 0?r:this.visible}setVisibility(t,e,r){this.visible=t}positionHandler(t,e,r,i){return new L(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,r,i,s,o){const l=Ms([Fi(r,i),Li({angle:t}),js((s?this.touchSizeX:this.sizeX)||e,(s?this.touchSizeY:this.sizeY)||e)]);return{tl:new L(-.5,-.5).transform(l),tr:new L(.5,-.5).transform(l),br:new L(.5,.5).transform(l),bl:new L(-.5,.5).transform(l)}}render(t,e,r,i,s){((i=i||{}).cornerStyle||s.cornerStyle)==="circle"?Ic.call(this,t,e,r,i,s):Rc.call(this,t,e,r,i,s)}}const Bc=(n,t,e)=>e.lockRotation?fs:t.cursorStyle,Wc=Fr(cc,si((n,t,e,r)=>{let{target:i,ex:s,ey:o,theta:l,originX:h,originY:u}=t;const p=i.translateToOriginPoint(i.getRelativeCenterPoint(),h,u);if(Ne(i,"lockRotation"))return!1;const y=Math.atan2(o-p.y,s-p.x),b=Math.atan2(r-p.y,e-p.x);let _=Mr(b-y+l);if(i.snapAngle&&i.snapAngle>0){const S=i.snapAngle,F=i.snapThreshold||S,M=Math.ceil(_/S)*S,X=Math.floor(_/S)*S;Math.abs(_-X)<F?_=X:Math.abs(_-M)<F&&(_=M)}_<0&&(_=360+_),_%=360;const w=i.angle!==_;return i.angle=_,w}));function Hc(n,t){const e=t.canvas,r=n[e.uniScaleKey];return e.uniformScaling&&!r||!e.uniformScaling&&r}function Nc(n,t,e){const r=Ne(n,"lockScalingX"),i=Ne(n,"lockScalingY");if(r&&i||!t&&(r||i)&&e||r&&t==="x"||i&&t==="y")return!0;const{width:s,height:o,strokeWidth:l}=n;return s===0&&l===0&&t!=="y"||o===0&&l===0&&t!=="x"}const Qd=["e","se","s","sw","w","nw","n","ne","e"],bi=(n,t,e)=>{const r=Hc(n,e);if(Nc(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",r))return fs;const i=Dc(e,t);return"".concat(Qd[i],"-resize")};function ba(n,t,e,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const s=t.target,o=i.by,l=Hc(n,s);let h,u,p,y,b,_;if(Nc(s,o,l))return!1;if(t.gestureScale)u=t.scaleX*t.gestureScale,p=t.scaleY*t.gestureScale;else{if(h=Ls(t,t.originX,t.originY,e,r),b=o!=="y"?Math.sign(h.x||t.signX||1):1,_=o!=="x"?Math.sign(h.y||t.signY||1):1,t.signX||(t.signX=b),t.signY||(t.signY=_),Ne(s,"lockScalingFlip")&&(t.signX!==b||t.signY!==_))return!1;if(y=s._getTransformedDimensions(),l&&!o){const F=Math.abs(h.x)+Math.abs(h.y),{original:M}=t,X=F/(Math.abs(y.x*M.scaleX/s.scaleX)+Math.abs(y.y*M.scaleY/s.scaleY));u=M.scaleX*X,p=M.scaleY*X}else u=Math.abs(h.x*s.scaleX/y.x),p=Math.abs(h.y*s.scaleY/y.y);kc(t)&&(u*=2,p*=2),t.signX!==b&&o!=="y"&&(t.originX=Ol(t.originX),u*=-1,t.signX=b),t.signY!==_&&o!=="x"&&(t.originY=Ol(t.originY),p*=-1,t.signY=_)}const w=s.scaleX,S=s.scaleY;return o?(o==="x"&&s.set(de,u),o==="y"&&s.set(Se,p)):(!Ne(s,"lockScalingX")&&s.set(de,u),!Ne(s,"lockScalingY")&&s.set(Se,p)),w!==s.scaleX||S!==s.scaleY}const Zi=Fr(Es,si((n,t,e,r)=>ba(n,t,e,r))),Xc=Fr(Es,si((n,t,e,r)=>ba(n,t,e,r,{by:"x"}))),Vc=Fr(Es,si((n,t,e,r)=>ba(n,t,e,r,{by:"y"}))),tf=["target","ex","ey","skewingSide"],bo={x:{counterAxis:"y",scale:de,skew:Mi,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:Se,skew:ji,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},ef=["ns","nesw","ew","nwse"],Yc=(n,t,e)=>{if(t.x!==0&&Ne(e,"lockSkewingY")||t.y!==0&&Ne(e,"lockSkewingX"))return fs;const r=Dc(e,t)%4;return"".concat(ef[r],"-resize")};function zc(n,t,e,r,i){const{target:s}=e,{counterAxis:o,origin:l,lockSkewing:h,skew:u,flip:p}=bo[n];if(Ne(s,h))return!1;const{origin:y,flip:b}=bo[o],_=Yt(e[y])*(s[b]?-1:1),w=-Math.sign(_)*(s[p]?-1:1),S=.5*-((s[u]===0&&Ls(e,ut,ut,r,i)[n]>0||s[u]>0?1:-1)*w)+.5;return Fr(hc,si((M,X,q,K)=>function(et,ct,f){let{target:it,ex:Z,ey:vt,skewingSide:kt}=ct,Tt=Lt(ct,tf);const{skew:nt}=bo[et],yt=f.subtract(new L(Z,vt)).divide(new L(it.scaleX,it.scaleY))[et],Xt=it[nt],Y=Tt[nt],V=Math.tan(Nt(Y)),z=et==="y"?it._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:it._getTransformedDimensions({scaleX:1,scaleY:1}).y,ot=2*yt*kt/Math.max(z,1)+V,rt=Mr(Math.atan(ot));it.set(nt,rt);const xt=Xt!==it[nt];if(xt&&et==="y"){const{skewX:Et,scaleX:It}=it,Mt=it._getTransformedDimensions({skewY:Xt}),_e=it._getTransformedDimensions(),ie=Et!==0?Mt.x/_e.x:1;ie!==1&&it.set(de,ie*It)}return xt}(n,X,new L(q,K))))(t,A(A({},e),{},{[l]:S,skewingSide:w}),r,i)}const Gc=(n,t,e,r)=>zc("x",n,t,e,r),qc=(n,t,e,r)=>zc("y",n,t,e,r);function Bs(n,t){return n[t.canvas.altActionKey]}const Ji=(n,t,e)=>{const r=Bs(n,e);return t.x===0?r?Mi:Se:t.y===0?r?ji:de:""},zr=(n,t,e)=>Bs(n,e)?Yc(0,t,e):bi(n,t,e),Io=(n,t,e,r)=>Bs(n,t.target)?qc(n,t,e,r):Xc(n,t,e,r),Ro=(n,t,e,r)=>Bs(n,t.target)?Gc(n,t,e,r):Vc(n,t,e,r),wa=()=>({ml:new ve({x:-.5,y:0,cursorStyleHandler:zr,actionHandler:Io,getActionName:Ji}),mr:new ve({x:.5,y:0,cursorStyleHandler:zr,actionHandler:Io,getActionName:Ji}),mb:new ve({x:0,y:.5,cursorStyleHandler:zr,actionHandler:Ro,getActionName:Ji}),mt:new ve({x:0,y:-.5,cursorStyleHandler:zr,actionHandler:Ro,getActionName:Ji}),tl:new ve({x:-.5,y:-.5,cursorStyleHandler:bi,actionHandler:Zi}),tr:new ve({x:.5,y:-.5,cursorStyleHandler:bi,actionHandler:Zi}),bl:new ve({x:-.5,y:.5,cursorStyleHandler:bi,actionHandler:Zi}),br:new ve({x:.5,y:.5,cursorStyleHandler:bi,actionHandler:Zi}),mtr:new ve({x:0,y:-.5,actionHandler:Wc,cursorStyleHandler:Bc,offsetY:-40,withConnection:!0,actionName:ia})}),Uc=()=>({mr:new ve({x:.5,y:0,actionHandler:Lo,cursorStyleHandler:zr,actionName:Cn}),ml:new ve({x:-.5,y:0,actionHandler:Lo,cursorStyleHandler:zr,actionName:Cn})}),$c=()=>A(A({},wa()),Uc());class Ai extends Qe{static getDefaults(){return A(A({},super.getDefaults()),Ai.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Ai.ownDefaults),this.setOptions(t)}static createControls(){return{controls:wa()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,r=e.target,i=e.action;if(this===r&&i&&i.startsWith(Ps))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const r=Object.entries(this.oCoords);for(let i=r.length-1;i>=0;i--){const[s,o]=r[i],l=this.controls[s];if(l.shouldActivate(s,this,t,e?o.touchCorner:o.corner))return this.__corner=s,{key:s,control:l,coord:this.oCoords[s]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),r=Fi(e.x,e.y),i=Li({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),s=Bt(r,i),o=Bt(t,s),l=Bt(o,[1/t[0],0,0,1/t[3],0,0]),h=this.group?Zr(this.calcTransformMatrix()):void 0;h&&(h.scaleX=Math.abs(h.scaleX),h.scaleY=Math.abs(h.scaleY));const u=this._calculateCurrentDimensions(h),p={};return this.forEachControl((y,b)=>{const _=y.positionHandler(u,l,this,y);p[b]=Object.assign(_,this._calcCornerCoords(y,_))}),p}_calcCornerCoords(t,e){const r=this.getTotalAngle();return{corner:t.calcCornerCoords(r,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(r,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),r=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(Nt(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-r.x/2,-r.y/2,r.x,r.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=A({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},r);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:r,hasControls:i}=this,s=A({hasBorders:r,hasControls:i},e),o=this.getViewportTransform(),l=s.hasBorders,h=s.hasControls,u=Bt(o,this.calcTransformMatrix()),p=Zr(u);t.save(),t.translate(p.translateX,p.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(p.angle-=180),t.rotate(Nt(this.group?p.angle:this.angle)),l&&this.drawBorders(t,p,e),h&&this.drawControls(t,e),t.restore()}drawBorders(t,e,r){let i;if(r&&r.forActiveSelection||this.group){const s=Fs(this.width,this.height,Mn(e)),o=this.isStrokeAccountedForInDimensions()?na:(this.strokeUniform?new L().scalarAdd(this.canvas?this.canvas.getZoom():1):new L(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=s.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,r)}drawControlsConnectingLines(t,e){let r=!1;t.beginPath(),this.forEachControl((i,s)=>{i.withConnection&&i.getVisibility(this,s)&&(r=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))}),r&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const r=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:s,cornerColor:o}=this,l=A({cornerStrokeColor:i,cornerDashArray:s,cornerColor:o},e);t.setTransform(r,0,0,r,0,0),t.strokeStyle=t.fillStyle=l.cornerColor,this.transparentCorners||(t.strokeStyle=l.cornerStrokeColor),this._setLineDash(t,l.cornerDashArray),this.forEachControl((h,u)=>{if(h.getVisibility(this,u)){const p=this.oCoords[u];h.render(t,p.x,p.y,l,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[r,i]=e;return this.setControlVisible(r,i)})}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const r=this.canvas.viewportTransform;e.save(),e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(e);const i=this.width+4,s=this.height+4;return e.clearRect(-i/2,-s/2,i,s),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Kc(n,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(r=>{r!=="constructor"&&Object.defineProperty(n.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r)||Object.create(null))})}),n}D(Ai,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class At extends Ai{}Kc(At,[Ec]),tt.setClass(At),tt.setClass(At,"object");const Zc=(n,t,e,r)=>{const i=2*(r=Math.round(r))+1,{data:s}=n.getImageData(t-r,e-r,i,i);for(let o=3;o<s.length;o+=4)if(s[o]>0)return!1;return!0};class Jc{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new L(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new L(1/this.options.scaleX,1/this.options.scaleY):new L(1,1)}createSideVector(t,e){const r=gs(t,e);return this.options.strokeUniform?r.multiply(this.scale):r}projectOrthogonally(t,e,r){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,r)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new L(t);return e.y+=e.x*Math.tan(Nt(this.options.skewY)),e.x+=e.y*Math.tan(Nt(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const rf=new L;class Ti extends Jc{static getOrthogonalRotationFactor(t,e){const r=e?ms(t,e):Mc(t);return Math.abs(r)<Er?-1:1}constructor(t,e,r,i){super(i),D(this,"AB",void 0),D(this,"AC",void 0),D(this,"alpha",void 0),D(this,"bisector",void 0),this.A=new L(t),this.B=new L(e),this.C=new L(r),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=ms(this.AB,this.AC),this.bisector=Rs(ma(this.AB.eq(rf)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e),s=va(i),o=Ti.getOrthogonalRotationFactor(s,this.bisector);return this.scaleUnitVector(s,r*o)}projectBevel(){const t=[];return(this.alpha%wr==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))}),t}projectMiter(){const t=[],e=Math.abs(this.alpha),r=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*r),s=this.options.strokeUniform?ps(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ps(i)/this.strokeProjectionMagnitude<=s&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const r=[],i=new L(Ti.getOrthogonalRotationFactor(this.bisector),Ti.getOrthogonalRotationFactor(new L(this.bisector.y,this.bisector.x)));return[new L(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new L(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach(s=>{jo(s,t,e)&&r.push(this.A.add(s))}),r}projectRoundWithSkew(t,e){const r=[],{skewX:i,skewY:s,scaleX:o,scaleY:l,strokeUniform:h}=this.options,u=new L(Math.tan(Nt(i)),Math.tan(Nt(s))),p=this.strokeProjectionMagnitude,y=h?p/l/Math.sqrt(1/l**2+1/o**2*u.y**2):p/Math.sqrt(1+u.y**2),b=new L(Math.sqrt(Math.max(p**2-y**2,0)),y),_=h?p/Math.sqrt(1+u.x**2*(1/l)**2/(1/o+1/o*u.x*u.y)**2):p/Math.sqrt(1+u.x**2/(1+u.x*u.y)**2),w=new L(_,Math.sqrt(Math.max(p**2-_**2,0)));return[w,w.scalarMultiply(-1),b,b.scalarMultiply(-1)].map(S=>this.applySkew(h?S.multiply(this.strokeUniformScalar):S)).forEach(S=>{jo(S,t,e)&&r.push(this.applySkew(this.A).add(S))}),r}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%wr==0,r=this.applySkew(this.A),i=t[e?0:2].subtract(r),s=t[e?1:0].subtract(r),o=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),l=Si(i,o)>0,h=l?i:s,u=l?s:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(h,u)):t.push(...this.projectRoundNoSkew(h,u)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}))}}class Fl extends Jc{constructor(t,e,r){super(r),this.A=new L(t),this.T=new L(e)}calcOrthogonalProjection(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e);return this.scaleUnitVector(va(i),r)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new L(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Ti(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new L(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),r=this.scaleUnitVector(Rs(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(r);t.push(i.add(e),i.subtract(e))}return t.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}}const Qc=function(n,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const r=[];if(n.length===0)return r;const i=n.reduce((s,o)=>(s[s.length-1].eq(o)||s.push(new L(o)),s),[new L(n[0])]);if(i.length===1)e=!0;else if(!e){const s=i[0],o=((l,h)=>{for(let u=l.length-1;u>=0;u--)if(h(l[u],u,l))return u;return-1})(i,l=>!l.eq(s));i.splice(o+1)}return i.forEach((s,o,l)=>{let h,u;o===0?(u=l[1],h=e?s:l[l.length-1]):o===l.length-1?(h=l[o-1],u=e?s:l[0]):(h=l[o-1],u=l[o+1]),e&&l.length===1?r.push(...new Fl(s,s,t).project()):!e||o!==0&&o!==l.length-1?r.push(...new Ti(s,h,u,t).project()):r.push(...new Fl(s,o===0?u:h,t).project())}),r},_a=n=>{const t={};return Object.keys(n).forEach(e=>{t[e]={},Object.keys(n[e]).forEach(r=>{t[e][r]=A({},n[e][r])})}),t},th=n=>n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Ws=n=>{const t=[];for(let e,r=0;r<n.length;r++)(e=nf(n,r))!==!1&&t.push(e);return t},nf=(n,t)=>{const e=n.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return n.charAt(t);if(55296<=e&&e<=56319){if(n.length<=t+1)throw"High surrogate without following low surrogate";const i=n.charCodeAt(t+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return n.charAt(t)+n.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const r=n.charCodeAt(t-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1};var sf=Object.freeze({__proto__:null,capitalize:function(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return"".concat(n.charAt(0).toUpperCase()).concat(t?n.slice(1):n.slice(1).toLowerCase())},escapeXml:th,graphemeSplit:Ws});const Hs=function(n,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return n.fill!==t.fill||n.stroke!==t.stroke||n.strokeWidth!==t.strokeWidth||n.fontSize!==t.fontSize||n.fontFamily!==t.fontFamily||n.fontWeight!==t.fontWeight||n.fontStyle!==t.fontStyle||n.textBackgroundColor!==t.textBackgroundColor||n.deltaY!==t.deltaY||e&&(n.overline!==t.overline||n.underline!==t.underline||n.linethrough!==t.linethrough)},eh=(n,t)=>{const e=t.split(`
`),r=[];let i=-1,s={};n=_a(n);for(let o=0;o<e.length;o++){const l=Ws(e[o]);if(n[o])for(let h=0;h<l.length;h++){i++;const u=n[o][h];u&&Object.keys(u).length>0&&(Hs(s,u,!0)?r.push({start:i,end:i+1,style:u}):r[r.length-1].end++),s=u||{}}else i+=l.length,s={}}return r},rh=(n,t)=>{if(!Array.isArray(n))return _a(n);const e=t.split(ra),r={};let i=-1,s=0;for(let o=0;o<e.length;o++){const l=Ws(e[o]);for(let h=0;h<l.length;h++)i++,n[s]&&n[s].start<=i&&i<n[s].end&&(r[o]=r[o]||{},r[o][h]=A({},n[s].style),i===n[s].end-1&&s++)}return r},Lr=["display","transform",zt,"fill-opacity","fill-rule","opacity",ue,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Ll(n,t){const e=n.nodeName,r=n.getAttribute("class"),i=n.getAttribute("id"),s="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+e,"i"),t=t.replace(o,""),i&&t.length&&(o=new RegExp("#"+i+s,"i"),t=t.replace(o,"")),r&&t.length){const l=r.split(" ");for(let h=l.length;h--;)o=new RegExp("\\."+l[h]+s,"i"),t=t.replace(o,"")}return t.length===0}function of(n,t){let e=!0;const r=Ll(n,t.pop());return r&&t.length&&(e=function(i,s){let o,l=!0;for(;i.parentElement&&i.parentElement.nodeType===1&&s.length;)l&&(o=s.pop()),l=Ll(i=i.parentElement,o);return s.length===0}(n,t)),r&&e&&t.length===0}const af=n=>{var t;return(t=Ld[n])!==null&&t!==void 0?t:n},lf=new RegExp("(".concat(We,")"),"gi"),cf=n=>n.replace(lf," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Il,Rl,Bl,Wl,Hl,Nl,Xl;const ae="(".concat(We,")"),hf=String.raw(Il||(Il=jr(["(skewX)(",")"],["(skewX)\\(","\\)"])),ae),uf=String.raw(Rl||(Rl=jr(["(skewY)(",")"],["(skewY)\\(","\\)"])),ae),df=String.raw(Bl||(Bl=jr(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),ae,ae,ae),ff=String.raw(Wl||(Wl=jr(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),ae,ae),gf=String.raw(Hl||(Hl=jr(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),ae,ae),pf=String.raw(Nl||(Nl=jr(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),ae,ae,ae,ae,ae,ae),Ca="(?:".concat(pf,"|").concat(gf,"|").concat(df,"|").concat(ff,"|").concat(hf,"|").concat(uf,")"),mf="(?:".concat(Ca,"*)"),vf=String.raw(Xl||(Xl=jr(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),mf),yf=new RegExp(vf),xf=new RegExp(Ca),bf=new RegExp(Ca,"g");function kn(n){const t=[];if(!(n=cf(n).replace(/\s*([()])\s*/gi,"$1"))||n&&!yf.test(n))return[...re];for(const e of n.matchAll(bf)){const r=xf.exec(e[0]);if(!r)continue;let i=re;const s=r.filter(w=>!!w),[,o,...l]=s,[h,u,p,y,b,_]=l.map(w=>parseFloat(w));switch(o){case"translate":i=Fi(h,u);break;case ia:i=Li({angle:h},{x:u,y:p});break;case Ps:i=js(h,u);break;case Mi:i=la(h);break;case ji:i=ca(h);break;case"matrix":i=[h,u,p,y,b,_]}t.push(i)}return Ms(t)}function wf(n,t,e,r){const i=Array.isArray(t);let s,o=t;if(n!==zt&&n!==ue||t!==he){if(n==="strokeUniform")return t==="non-scaling-stroke";if(n==="strokeDashArray")o=t===he?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(n==="transformMatrix")o=e&&e.transformMatrix?Bt(e.transformMatrix,kn(t)):kn(t);else if(n==="visible")o=t!==he&&t!=="hidden",e&&e.visible===!1&&(o=!1);else if(n==="opacity")o=parseFloat(t),e&&e.opacity!==void 0&&(o*=e.opacity);else if(n==="textAnchor")o=t==="start"?Ot:t==="end"?Vt:ut;else if(n==="charSpacing")s=oe(t,r)/r*1e3;else if(n==="paintFirst"){const l=t.indexOf(zt),h=t.indexOf(ue);o=zt,(l>-1&&h>-1&&h<l||l===-1&&h>-1)&&(o=ue)}else{if(n==="href"||n==="xlink:href"||n==="font"||n==="id")return t;if(n==="imageSmoothing")return t==="optimizeQuality";s=i?t.map(oe):oe(t,r)}}else o="";return!i&&isNaN(s)?o:s}function ih(n,t){const e=n.match(Fd);if(!e)return;const r=e[1],i=e[3],s=e[4],o=e[5],l=e[6];r&&(t.fontStyle=r),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),s&&(t.fontSize=oe(s)),l&&(t.fontFamily=l),o&&(t.lineHeight=o==="normal"?1:o)}function Bo(n,t){n.replace(/;\s*$/,"").split(";").forEach(e=>{if(!e)return;const[r,i]=e.split(":");t[r.trim().toLowerCase()]=i.trim()})}function nh(n){const t={},e=n.getAttribute("style");return e&&(typeof e=="string"?Bo(e,t):function(r,i){Object.entries(r).forEach(s=>{let[o,l]=s;l!==void 0&&(i[o.toLowerCase()]=l)})}(e,t)),t}const _f={stroke:"strokeOpacity",fill:"fillOpacity"};function ur(n,t,e){if(!n)return{};let r,i={},s=ea;n.parentNode&&Dl.test(n.parentNode.nodeName)&&(i=ur(n.parentElement,t,e),i.fontSize&&(r=s=oe(i.fontSize)));const o=A(A(A({},t.reduce((u,p)=>{const y=n.getAttribute(p);return y&&(u[p]=y),u},{})),function(u){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y={};for(const b in p)of(u,b.split(" "))&&(y=A(A({},y),p[b]));return y}(n,e)),nh(n));o[vo]&&n.setAttribute(vo,o[vo]),o[mo]&&(r=oe(o[mo],s),o[mo]="".concat(r));const l={};for(const u in o){const p=af(u),y=wf(p,o[u],i,r);l[p]=y}l&&l.font&&ih(l.font,l);const h=A(A({},i),l);return Dl.test(n.nodeName)?h:function(u){const p=At.getDefaults();return Object.entries(_f).forEach(y=>{let[b,_]=y;if(u[_]===void 0||u[b]==="")return;if(u[b]===void 0){if(!p[b])return;u[b]=p[b]}if(u[b].indexOf("url(")===0)return;const w=new _t(u[b]);u[b]=w.setAlpha(Ft(w.getAlpha()*u[_],2)).toRgba()}),u}(h)}const Cf=["left","top","width","height","visible"],sh=["rx","ry"];class le extends At{static getDefaults(){return A(A({},super.getDefaults()),le.ownDefaults)}constructor(t){super(),Object.assign(this,le.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:r}=this,i=-e/2,s=-r/2,o=this.rx?Math.min(this.rx,e/2):0,l=this.ry?Math.min(this.ry,r/2):0,h=o!==0||l!==0;t.beginPath(),t.moveTo(i+o,s),t.lineTo(i+e-o,s),h&&t.bezierCurveTo(i+e-Or*o,s,i+e,s+Or*l,i+e,s+l),t.lineTo(i+e,s+r-l),h&&t.bezierCurveTo(i+e,s+r-Or*l,i+e-Or*o,s+r,i+e-o,s+r),t.lineTo(i+o,s+r),h&&t.bezierCurveTo(i+Or*o,s+r,i,s+r-Or*l,i,s+r-l),t.lineTo(i,s+l),h&&t.bezierCurveTo(i,s+Or*l,i+Or*o,s,i+o,s),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...sh,...t])}_toSVG(){const{width:t,height:e,rx:r,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(r,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e,r){const i=ur(t,this.ATTRIBUTE_NAMES,r),{left:s=0,top:o=0,width:l=0,height:h=0,visible:u=!0}=i,p=Lt(i,Cf);return new this(A(A(A({},e),p),{},{left:s,top:o,width:l,height:h,visible:!!(u&&l&&h)}))}}D(le,"type","Rect"),D(le,"cacheProperties",[..._r,...sh]),D(le,"ownDefaults",{rx:0,ry:0}),D(le,"ATTRIBUTE_NAMES",[...Lr,"x","y","rx","ry","width","height"]),tt.setClass(le),tt.setSVGClass(le);const yr="initialization",vs="added",Sa="removed",ys="imperative",oh=(n,t)=>{const{strokeUniform:e,strokeWidth:r,width:i,height:s,group:o}=t,l=o&&o!==n?Fn(o.calcTransformMatrix(),n.calcTransformMatrix()):null,h=l?t.getRelativeCenterPoint().transform(l):t.getRelativeCenterPoint(),u=!t.isStrokeAccountedForInDimensions(),p=e&&u?Oc(new L(r,r),void 0,n.calcTransformMatrix()):na,y=!e&&u?r:0,b=Fs(i+y,s+y,Ms([l,t.calcOwnMatrix()],!0)).add(p).scalarDivide(2);return[h.subtract(b),h.add(b)]};class Ln{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:r,strategy:i}=t;return e===yr||e===ys||!!r&&i!==r}shouldLayoutClipPath(t){let{type:e,target:{clipPath:r}}=t;return e!==yr&&r&&!r.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:r,target:i}=e;if(r===ys&&e.overrides)return e.overrides;if(t.length===0)return;const{left:s,top:o,width:l,height:h}=cr(t.map(y=>oh(i,y)).reduce((y,b)=>y.concat(b),[])),u=new L(l,h),p=new L(s,o).add(u.scalarDivide(2));if(r===yr){const y=this.getInitialSize(e,{size:u,center:p});return{center:p,relativeCorrection:new L(0,0),size:y}}return{center:p.transform(i.calcOwnMatrix()),size:u}}}D(Ln,"type","strategy");class xs extends Ln{shouldPerformLayout(t){return!0}}D(xs,"type","fit-content"),tt.setClass(xs);const Sf=["strategy"],Tf=["target","strategy","bubbles","prevStrategy"],ah="layoutManager";class Qr{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new xs;D(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=A(A({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const r=this.getLayoutResult(e);r&&this.commitLayout(e,r),this.onAfterLayout(e,r),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:r}=e;return[us,lc,Cn,cc,Es,hc,hs,uc,Dd].map(i=>t.on(i,s=>this.performLayout(i===us?{type:"object_modified",trigger:i,e:s,target:r}:{type:"object_modifying",trigger:i,e:s,target:r})))}subscribe(t,e){this.unsubscribe(t,e);const r=this.attachHandlers(t,e);this._subscriptions.set(t,r)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(r=>r()),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t))}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t))}onBeforeLayout(t){const{target:e,type:r}=t,{canvas:i}=e;if(r===yr||r===vs?this.subscribeTargets(t):r===Sa&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),r===ys&&t.deep){const s=Lt(t,Sf);e.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(A(A({},s),{},{bubbles:!1,target:o})))}}getLayoutResult(t){const{target:e,strategy:r,type:i}=t,s=r.calcLayoutResult(t,e.getObjects());if(!s)return;const o=i===yr?new L:e.getRelativeCenterPoint(),{center:l,correction:h=new L,relativeCorrection:u=new L}=s,p=o.subtract(l).add(h).transform(i===yr?re:ye(e.calcOwnMatrix()),!0).add(u);return{result:s,prevCenter:o,nextCenter:l,offset:p}}commitLayout(t,e){const{target:r}=t,{result:{size:i},nextCenter:s}=e;var o,l;r.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===yr?r.set({left:(o=t.x)!==null&&o!==void 0?o:s.x+i.x*Yt(r.originX),top:(l=t.y)!==null&&l!==void 0?l:s.y+i.y*Yt(r.originY)}):(r.setPositionByOrigin(s,ut,ut),r.setCoords(),r.set("dirty",!0))}layoutObjects(t,e){const{target:r}=t;r.forEachObject(i=>{i.group===r&&this.layoutObject(t,e,i)}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,r.clipPath)}layoutObject(t,e,r){let{offset:i}=e;r.set({left:r.left+i.x,top:r.top+i.y})}onAfterLayout(t,e){const{target:r,strategy:i,bubbles:s,prevStrategy:o}=t,l=Lt(t,Tf),{canvas:h}=r;r.fire("layout:after",{context:t,result:e}),h&&h.fire("object:layout:after",{context:t,result:e,target:r});const u=r.parent;s&&u!=null&&u.layoutManager&&((l.path||(l.path=[])).push(r),u.layoutManager.performLayout(A(A({},l),{},{target:u}))),r.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach(e=>e.forEach(r=>r())),t.clear()}toObject(){return{type:ah,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}tt.setClass(Qr,ah);const Of=["type","objects","layoutManager"];class kf extends Qr{performLayout(){}}class $t extends sa(At){static getDefaults(){return A(A({},super.getDefaults()),$t.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),D(this,"_activeObjects",[]),D(this,"__objectSelectionTracker",void 0),D(this,"__objectSelectionDisposer",void 0),Object.assign(this,$t.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var r;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(i=>{this.enterGroup(i,!1)}),this.layoutManager=(r=e.layoutManager)!==null&&r!==void 0?r:new Qr,this.layoutManager.performLayout({type:yr,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(br("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(br("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,r,i)=>this.canEnterGroup(e)&&i.indexOf(e)===r)}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const i=this._filterObjectsBeforeEnteringGroup(e),s=super.add(...i);return this._onAfterObjectsChange(vs,i),s}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];const s=this._filterObjectsBeforeEnteringGroup(r),o=super.insertAt(t,...s);return this._onAfterObjectsChange(vs,s),o}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Sa,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const r=this[t];return super._set(t,e),t==="canvas"&&r!==e&&(this._objects||[]).forEach(i=>{i._set(t,e)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:r}=e;const i=this._activeObjects;if(t)i.push(r),this._set("dirty",!0);else if(i.length>0){const s=i.indexOf(r);s>-1&&(i.splice(s,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&Di(t,Bt(ye(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const r=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();r&&(r===t||t.isDescendantOf(r))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Di(t,Bt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const r=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;r>-1&&this._activeObjects.splice(r,1)}shouldCache(){const t=At.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,r){this._renderBackground(t);for(let s=0;s<this._objects.length;s++){var i;const o=this._objects[s];(i=this.canvas)!==null&&i!==void 0&&i.preserveObjectStacking&&o.group!==this?(t.save(),t.transform(...ye(this.calcTransformMatrix())),o.render(t),t.restore()):o.group===this&&o.render(t)}this._drawClipPath(t,this.clipPath,r)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(A({target:this,type:ys},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const r=this.includeDefaultValues;return this._objects.filter(function(i){return!i.excludeFromExport}).map(function(i){const s=i.includeDefaultValues;i.includeDefaultValues=r;const o=i[t||"toObject"](e);return i.includeDefaultValues=s,o})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.layoutManager.toObject();return A(A(A({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=le.prototype._toSVG.call(this),r=e.indexOf("COMMON_PARTS");e[r]='for="group" ';const i=e.join("");return t?t(i):i}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],r=this._createSVGBgRect(t);r&&e.push("		",r);for(let i=0;i<this._objects.length;i++)e.push("		",this._objects[i].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],r=this._createSVGBgRect(t);r&&e.push("	",r);for(let i=0;i<this._objects.length;i++)e.push("	",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:r,objects:i=[],layoutManager:s}=t,o=Lt(t,Of);return Promise.all([ki(i,e),jn(o,e)]).then(l=>{let[h,u]=l;const p=new this(h,A(A(A({},o),u),{},{layoutManager:new kf}));if(s){const y=tt.getClass(s.type),b=tt.getClass(s.strategy);p.layoutManager=new y(new b)}else p.layoutManager=new Qr;return p.layoutManager.subscribeTargets({type:yr,target:p,targets:p.getObjects()}),p.setCoords(),p})}}D($t,"type","Group"),D($t,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),tt.setClass($t);const lh=(n,t)=>Math.min(t.width/n.width,t.height/n.height),ch=(n,t)=>Math.max(t.width/n.width,t.height/n.height),Wo="\\s*,?\\s*",Ki="".concat(Wo,"(").concat(We,")"),Df="".concat(Ki).concat(Ki).concat(Ki).concat(Wo,"([01])").concat(Wo,"([01])").concat(Ki).concat(Ki),Af={m:"l",M:"L"},Ef=(n,t,e,r,i,s,o,l,h,u,p)=>{const y=Ve(n),b=Ye(n),_=Ve(t),w=Ye(t),S=e*i*_-r*s*w+o,F=r*i*_+e*s*w+l;return["C",u+h*(-e*i*b-r*s*y),p+h*(-r*i*b+e*s*y),S+h*(e*i*w+r*s*_),F+h*(r*i*w-e*s*_),S,F]},Vl=(n,t,e,r)=>{const i=Math.atan2(t,n),s=Math.atan2(r,e);return s>=i?s-i:2*Math.PI-(i-s)};function Ho(n,t,e,r,i,s,o,l){let h;if(Ct.cachesBoundsOfCurve&&(h=[...arguments].join(),Ci.boundsOfCurveCache[h]))return Ci.boundsOfCurveCache[h];const u=Math.sqrt,p=Math.abs,y=[],b=[[0,0],[0,0]];let _=6*n-12*e+6*i,w=-3*n+9*e-9*i+3*o,S=3*e-3*n;for(let K=0;K<2;++K){if(K>0&&(_=6*t-12*r+6*s,w=-3*t+9*r-9*s+3*l,S=3*r-3*t),p(w)<1e-12){if(p(_)<1e-12)continue;const Z=-S/_;0<Z&&Z<1&&y.push(Z);continue}const et=_*_-4*S*w;if(et<0)continue;const ct=u(et),f=(-_+ct)/(2*w);0<f&&f<1&&y.push(f);const it=(-_-ct)/(2*w);0<it&&it<1&&y.push(it)}let F=y.length;const M=F,X=uh(n,t,e,r,i,s,o,l);for(;F--;){const{x:K,y:et}=X(y[F]);b[0][F]=K,b[1][F]=et}b[0][M]=n,b[1][M]=t,b[0][M+1]=o,b[1][M+1]=l;const q=[new L(Math.min(...b[0]),Math.min(...b[1])),new L(Math.max(...b[0]),Math.max(...b[1]))];return Ct.cachesBoundsOfCurve&&(Ci.boundsOfCurveCache[h]=q),q}const Pf=(n,t,e)=>{let[r,i,s,o,l,h,u,p]=e;const y=((b,_,w,S,F,M,X)=>{if(w===0||S===0)return[];let q=0,K=0,et=0;const ct=Math.PI,f=X*ta,it=Ye(f),Z=Ve(f),vt=.5*(-Z*b-it*_),kt=.5*(-Z*_+it*b),Tt=w**2,nt=S**2,yt=kt**2,Xt=vt**2,Y=Tt*nt-Tt*yt-nt*Xt;let V=Math.abs(w),z=Math.abs(S);if(Y<0){const qt=Math.sqrt(1-Y/(Tt*nt));V*=qt,z*=qt}else et=(F===M?-1:1)*Math.sqrt(Y/(Tt*yt+nt*Xt));const ot=et*V*kt/z,rt=-et*z*vt/V,xt=Z*ot-it*rt+.5*b,Et=it*ot+Z*rt+.5*_;let It=Vl(1,0,(vt-ot)/V,(kt-rt)/z),Mt=Vl((vt-ot)/V,(kt-rt)/z,(-vt-ot)/V,(-kt-rt)/z);M===0&&Mt>0?Mt-=2*ct:M===1&&Mt<0&&(Mt+=2*ct);const _e=Math.ceil(Math.abs(Mt/ct*2)),ie=[],ne=Mt/_e,Ys=8/3*Math.sin(ne/4)*Math.sin(ne/4)/Math.sin(ne/2);let li=It+ne;for(let qt=0;qt<_e;qt++)ie[qt]=Ef(It,li,Z,it,V,z,xt,Et,Ys,q,K),q=ie[qt][5],K=ie[qt][6],It=li,li+=ne;return ie})(u-n,p-t,i,s,l,h,o);for(let b=0,_=y.length;b<_;b++)y[b][1]+=n,y[b][2]+=t,y[b][3]+=n,y[b][4]+=t,y[b][5]+=n,y[b][6]+=t;return y},hh=n=>{let t=0,e=0,r=0,i=0;const s=[];let o,l=0,h=0;for(const u of n){const p=[...u];let y;switch(p[0]){case"l":p[1]+=t,p[2]+=e;case"L":t=p[1],e=p[2],y=["L",t,e];break;case"h":p[1]+=t;case"H":t=p[1],y=["L",t,e];break;case"v":p[1]+=e;case"V":e=p[1],y=["L",t,e];break;case"m":p[1]+=t,p[2]+=e;case"M":t=p[1],e=p[2],r=p[1],i=p[2],y=["M",t,e];break;case"c":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e,p[5]+=t,p[6]+=e;case"C":l=p[3],h=p[4],t=p[5],e=p[6],y=["C",p[1],p[2],l,h,t,e];break;case"s":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e;case"S":o==="C"?(l=2*t-l,h=2*e-h):(l=t,h=e),t=p[3],e=p[4],y=["C",l,h,p[1],p[2],t,e],l=y[3],h=y[4];break;case"q":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e;case"Q":l=p[1],h=p[2],t=p[3],e=p[4],y=["Q",l,h,t,e];break;case"t":p[1]+=t,p[2]+=e;case"T":o==="Q"?(l=2*t-l,h=2*e-h):(l=t,h=e),t=p[1],e=p[2],y=["Q",l,h,t,e];break;case"a":p[6]+=t,p[7]+=e;case"A":Pf(t,e,p).forEach(b=>s.push(b)),t=p[6],e=p[7];break;case"z":case"Z":t=r,e=i,y=["Z"]}y?(s.push(y),o=y[0]):o=""}return s},bs=(n,t,e,r)=>Math.sqrt((e-n)**2+(r-t)**2),uh=(n,t,e,r,i,s,o,l)=>h=>{const u=h**3,p=(_=>3*_**2*(1-_))(h),y=(_=>3*_*(1-_)**2)(h),b=(_=>(1-_)**3)(h);return new L(o*u+i*p+e*y+n*b,l*u+s*p+r*y+t*b)},dh=n=>n**2,fh=n=>2*n*(1-n),gh=n=>(1-n)**2,Mf=(n,t,e,r,i,s,o,l)=>h=>{const u=dh(h),p=fh(h),y=gh(h),b=3*(y*(e-n)+p*(i-e)+u*(o-i)),_=3*(y*(r-t)+p*(s-r)+u*(l-s));return Math.atan2(_,b)},jf=(n,t,e,r,i,s)=>o=>{const l=dh(o),h=fh(o),u=gh(o);return new L(i*l+e*h+n*u,s*l+r*h+t*u)},Ff=(n,t,e,r,i,s)=>o=>{const l=1-o,h=2*(l*(e-n)+o*(i-e)),u=2*(l*(r-t)+o*(s-r));return Math.atan2(u,h)},Yl=(n,t,e)=>{let r=new L(t,e),i=0;for(let s=1;s<=100;s+=1){const o=n(s/100);i+=bs(r.x,r.y,o.x,o.y),r=o}return i},Lf=(n,t)=>{let e,r=0,i=0,s={x:n.x,y:n.y},o=A({},s),l=.01,h=0;const u=n.iterator,p=n.angleFinder;for(;i<t&&l>1e-4;)o=u(r),h=r,e=bs(s.x,s.y,o.x,o.y),e+i>t?(r-=l,l/=2):(s=o,r+=l,i+=e);return A(A({},o),{},{angle:p(h)})},Ta=n=>{let t,e,r=0,i=0,s=0,o=0,l=0;const h=[];for(const u of n){const p={x:i,y:s,command:u[0],length:0};switch(u[0]){case"M":e=p,e.x=o=i=u[1],e.y=l=s=u[2];break;case"L":e=p,e.length=bs(i,s,u[1],u[2]),i=u[1],s=u[2];break;case"C":t=uh(i,s,u[1],u[2],u[3],u[4],u[5],u[6]),e=p,e.iterator=t,e.angleFinder=Mf(i,s,u[1],u[2],u[3],u[4],u[5],u[6]),e.length=Yl(t,i,s),i=u[5],s=u[6];break;case"Q":t=jf(i,s,u[1],u[2],u[3],u[4]),e=p,e.iterator=t,e.angleFinder=Ff(i,s,u[1],u[2],u[3],u[4]),e.length=Yl(t,i,s),i=u[3],s=u[4];break;case"Z":e=p,e.destX=o,e.destY=l,e.length=bs(i,s,o,l),i=o,s=l}r+=e.length,h.push(e)}return h.push({length:r,x:i,y:s}),h},ph=function(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ta(n),r=0;for(;t-e[r].length>0&&r<e.length-2;)t-=e[r].length,r++;const i=e[r],s=t/i.length,o=n[r];switch(i.command){case"M":return{x:i.x,y:i.y,angle:0};case"Z":return A(A({},new L(i.x,i.y).lerp(new L(i.destX,i.destY),s)),{},{angle:Math.atan2(i.destY-i.y,i.destX-i.x)});case"L":return A(A({},new L(i.x,i.y).lerp(new L(o[1],o[2]),s)),{},{angle:Math.atan2(o[2]-i.y,o[1]-i.x)});case"C":case"Q":return Lf(i,t)}},If=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),zl=new RegExp(Df,"g"),Rf=new RegExp(We,"gi"),Bf={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},mh=n=>{var t;const e=[],r=(t=n.match(If))!==null&&t!==void 0?t:[];for(const i of r){const s=i[0];if(s==="z"||s==="Z"){e.push([s]);continue}const o=Bf[s.toLowerCase()];let l=[];if(s==="a"||s==="A"){zl.lastIndex=0;for(let h=null;h=zl.exec(i);)l.push(...h.slice(1))}else l=i.match(Rf)||[];for(let h=0;h<l.length;h+=o){const u=new Array(o),p=Af[s];u[0]=h>0&&p?p:s;for(let y=0;y<o;y++)u[y+1]=parseFloat(l[h+y]);e.push(u)}}return e},vh=function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new L(n[0]),r=new L(n[1]),i=1,s=0;const o=[],l=n.length,h=l>2;let u;for(h&&(i=n[2].x<r.x?-1:n[2].x===r.x?0:1,s=n[2].y<r.y?-1:n[2].y===r.y?0:1),o.push(["M",e.x-i*t,e.y-s*t]),u=1;u<l;u++){if(!e.eq(r)){const p=e.midPointFrom(r);o.push(["Q",e.x,e.y,p.x,p.y])}e=n[u],u+1<n.length&&(r=n[u+1])}return h&&(i=e.x>n[u-2].x?1:e.x===n[u-2].x?0:-1,s=e.y>n[u-2].y?1:e.y===n[u-2].y?0:-1),o.push(["L",e.x+i*t,e.y+s*t]),o},Oa=(n,t)=>n.map(e=>e.map((r,i)=>i===0||t===void 0?r:Ft(r,t)).join(" ")).join(" ");function ws(n,t){const e=n.style;e&&t&&(typeof t=="string"?e.cssText+=";"+t:Object.entries(t).forEach(r=>{let[i,s]=r;return e.setProperty(i,s)}))}const Gr=(n,t)=>Math.floor(Math.random()*(t-n+1))+n;function yh(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t.onComplete||$r,r=new(ar()).XMLHttpRequest,i=t.signal,s=function(){r.abort()},o=function(){i&&i.removeEventListener("abort",s),r.onerror=r.ontimeout=$r};if(i&&i.aborted)throw new Qo("request");return i&&i.addEventListener("abort",s,{once:!0}),r.onreadystatechange=function(){r.readyState===4&&(o(),e(r),r.onreadystatechange=$r)},r.onerror=r.ontimeout=o,r.open("get",n,!0),r.send(),r}const ss=(n,t)=>{let e=n._findCenterFromElement();n.transformMatrix&&((r=>{if(r.transformMatrix){const{scaleX:i,scaleY:s,angle:o,skewX:l}=Zr(r.transformMatrix);r.flipX=!1,r.flipY=!1,r.set(de,i),r.set(Se,s),r.angle=o,r.skewX=l,r.skewY=0}})(n),e=e.transform(n.transformMatrix)),delete n.transformMatrix,t&&(n.scaleX*=t.scaleX,n.scaleY*=t.scaleY,n.cropX=t.cropX,n.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,n.width=t.width,n.height=t.height),n.setPositionByOrigin(e,ut,ut)};var ti=Object.freeze({__proto__:null,addTransformToObject:Sc,animate:xa,animateColor:Lc,applyTransformToObject:Di,calcAngleBetweenVectors:ms,calcDimensionsMatrix:Mn,calcPlaneChangeMatrix:Fn,calcVectorRotation:Mc,cancelAnimFrame:gc,capValue:Jr,composeMatrix:xc,copyCanvasElement:n=>{var t;const e=Me(n);return(t=e.getContext("2d"))===null||t===void 0||t.drawImage(n,0,0),e},cos:Ve,createCanvasElement:we,createImage:pc,createRotateMatrix:Li,createScaleMatrix:js,createSkewXMatrix:la,createSkewYMatrix:ca,createTranslateMatrix:Fi,createVector:gs,crossProduct:Si,degreesToRadians:Nt,dotProduct:jc,ease:Nd,enlivenObjectEnlivables:jn,enlivenObjects:ki,findScaleToCover:ch,findScaleToFit:lh,getBoundsOfCurve:Ho,getOrthonormalVector:va,getPathSegmentsInfo:Ta,getPointOnPath:ph,getPointer:Cc,getRandomInt:Gr,getRegularPolygonPath:(n,t)=>{const e=2*Math.PI/n;let r=-Er;n%2==0&&(r+=e/2);const i=new Array(n+1);for(let s=0;s<n;s++){const o=s*e+r,{x:l,y:h}=new L(Ve(o),Ye(o)).scalarMultiply(t);i[s]=[s===0?"M":"L",l,h]}return i[n]=["Z"],i},getSmoothPathFromPoints:vh,getSvgAttributes:n=>{const t=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":return t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return t.concat(["offset","stop-color","stop-opacity"])}return t},getUnitVector:Rs,groupSVGElements:(n,t)=>n&&n.length===1?n[0]:new $t(n,t),hasStyleChanged:Hs,invertTransform:ye,isBetweenVectors:jo,isIdentityMatrix:mc,isTouchEvent:ds,isTransparent:Zc,joinPath:Oa,loadImage:vn,magnitude:ps,makeBoundingBoxFromPoints:cr,makePathSimpler:hh,matrixToSVG:Tn,mergeClipPaths:(n,t)=>{var e;let r=n,i=t;r.inverted&&!i.inverted&&(r=t,i=n),Po(i,(e=i.group)===null||e===void 0?void 0:e.calcTransformMatrix(),r.calcTransformMatrix());const s=r.inverted&&i.inverted;return s&&(r.inverted=i.inverted=!1),new $t([r],{clipPath:i,inverted:s})},multiplyTransformMatrices:Bt,multiplyTransformMatrixArray:Ms,parsePath:mh,parsePreserveAspectRatioAttribute:ua,parseUnit:oe,pick:ni,projectStrokeOnPoints:Qc,qrDecompose:Zr,radiansToDegrees:Mr,removeFromArray:Vr,removeTransformFromObject:(n,t)=>{const e=ye(t),r=Bt(e,n.calcOwnMatrix());Di(n,r)},removeTransformMatrixForSvgParsing:ss,request:yh,requestAnimFrame:mn,resetObjectTransform:Tc,rotatePoint:(n,t,e)=>n.rotate(e,t),rotateVector:ma,saveObjectTransform:fa,sendObjectToPlane:Po,sendPointToPlane:xr,sendVectorToPlane:Oc,setStyle:ws,sin:Ye,sizeAfterTransform:Fs,string:sf,stylesFromArray:rh,stylesToArray:eh,toBlob:aa,toDataURL:oa,toFixed:Ft,transformPath:(n,t,e)=>(e&&(t=Bt(t,[1,0,0,1,-e.x,-e.y])),n.map(r=>{const i=[...r];for(let s=1;s<r.length-1;s+=2){const{x:o,y:l}=te({x:r[s],y:r[s+1]},t);i[s]=o,i[s+1]=l}return i})),transformPoint:te});class xh extends da{constructor(t){let{allowTouchScrolling:e=!1,containerClass:r=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),D(this,"upper",void 0),D(this,"container",void 0);const{el:i}=this.lower,s=this.createUpperCanvas();this.upper={el:s,ctx:s.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(s,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(r),i.parentNode&&i.parentNode.replaceChild(o,i),o.append(i,s),this.container=o}createUpperCanvas(){const{el:t}=this.lower,e=we();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=ii().createElement("div");return t.setAttribute("data-fabric","wrapper"),ws(t,{position:"relative"}),Tl(t),t}applyCanvasStyle(t,e){const{styles:r,allowTouchScrolling:i}=e;ws(t,A(A({},r),{},{"touch-action":i?"manipulation":he})),Tl(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:r,ctx:i}=this.upper;_c(r,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),Ao(this.upper.el,t),Ao(this.container,t)}cleanupDOM(t){const e=this.container,{el:r}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(r),e.parentNode&&e.parentNode.replaceChild(r,e)}dispose(){super.dispose(),Xe().dispose(this.upper.el),delete this.upper,delete this.container}}class Ns extends Ii{constructor(){super(...arguments),D(this,"targets",[]),D(this,"_hoveredTargets",[]),D(this,"_objectsToRender",void 0),D(this,"_currentTransform",null),D(this,"_groupSelector",null),D(this,"contextTopDirty",!1)}static getDefaults(){return A(A({},super.getDefaults()),Ns.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new xh(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),r=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=r,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,r){const i=this.targetFindTolerance,s=this.pixelFindContext;this.clearContext(s),s.save(),s.translate(-e+i,-r+i),s.transform(...this.viewportTransform);const o=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(s),t.selectionBackgroundColor=o,s.restore();const l=Math.round(i*this.getRetinaScaling());return Zc(s,l,l,l)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(r=>!!r&&t[r]===!0):t[e])}_shouldClearSelection(t,e){const r=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&r.length>1&&r.indexOf(e)===-1&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,r){if(!t)return;let i;return e===Ps||e===de||e===Se||e===Cn?i=this.centeredScaling||t.centeredScaling:e===ia&&(i=this.centeredRotation||t.centeredRotation),i?!r:r}_getOriginFromCorner(t,e){const r={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?r.x=Vt:["mr","tr","br"].includes(e)&&(r.x=Ot),["tl","mt","tr"].includes(e)?r.y=Do:["bl","mb","br"].includes(e)&&(r.y=xe)),r}_setupCurrentTransform(t,e,r){var i;const s=e.group?xr(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:o="",control:l}=e.getActiveControl()||{},h=r&&l?(i=l.getActionHandler(t,e,l))===null||i===void 0?void 0:i.bind(l):Ac,u=((_,w,S,F)=>{if(!w||!_)return"drag";const M=F.controls[w];return M.getActionName(S,M,F)})(r,o,t,e),p=t[this.centeredKey],y=this._shouldCenterTransform(e,u,p)?{x:ut,y:ut}:this._getOriginFromCorner(e,o),b={target:e,action:u,actionHandler:h,actionPerformed:!1,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:s.x-e.left,offsetY:s.y-e.top,originX:y.x,originY:y.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:Nt(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:p,original:A(A({},fa(e)),{},{originX:y.x,originY:y.y})};this._currentTransform=b,this.fire("before:transform",{e:t,transform:b})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:r,deltaX:i,deltaY:s}=this._groupSelector,o=new L(e,r).transform(this.viewportTransform),l=new L(e+i,r+s).transform(this.viewportTransform),h=this.selectionLineWidth/2;let u=Math.min(o.x,l.x),p=Math.min(o.y,l.y),y=Math.max(o.x,l.x),b=Math.max(o.y,l.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(u,p,y-u,b-p)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,u+=h,p+=h,y-=h,b-=h,At.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(u,p,y-u,b-p))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),r=this._activeObject,i=this.getActiveObjects();if(this.targets=[],r&&i.length>=1){if(r.findControl(e,ds(t))||i.length>1&&this.searchPossibleTargets([r],e))return r;if(r===this.searchPossibleTargets([r],e)){if(this.preserveObjectStacking){const s=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&o&&o!==r?(this.targets=s,r):o}return r}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let r=t.getCoords();const i=this.getZoom(),s=t.padding/i;if(s){const[o,l,h,u]=r,p=Math.atan2(l.y-o.y,l.x-o.x),y=Ve(p)*s,b=Ye(p)*s,_=y+b,w=y-b;r=[new L(o.x-w,o.y-_),new L(l.x+_,l.y-w),new L(h.x+w,h.y+_),new L(u.x-_,u.y+w)]}return jt.isPointInPolygon(e,r)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,xr(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let r=t.length;for(;r--;){const i=t[r];if(this._checkTarget(i,e)){if(is(i)&&i.subTargetCheck){const s=this._searchPossibleTargets(i._objects,e);s&&this.targets.push(s)}return i}}}searchPossibleTargets(t,e){const r=this._searchPossibleTargets(t,e);if(r&&is(r)&&r.interactive&&this.targets[0]){const i=this.targets;for(let s=i.length-1;s>0;s--){const o=i[s];if(!is(o)||!o.interactive)return o}return i[0]}return r}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=this.upperCanvasEl,i=r.getBoundingClientRect();let s=Cc(t),o=i.width||0,l=i.height||0;o&&l||(xe in i&&Do in i&&(l=Math.abs(i.top-i.bottom)),Vt in i&&Ot in i&&(o=Math.abs(i.right-i.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=xr(s,void 0,this.viewportTransform));const h=this.getRetinaScaling();h!==1&&(s.x/=h,s.y/=h);const u=o===0||l===0?new L(1,1):new L(r.width/o,r.height/l);return s.multiply(u)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=we(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return Yr(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let r=!1,i=!1;const s=this.getActiveObjects(),o=[],l=[];t.forEach(h=>{s.includes(h)||(r=!0,h.fire("deselected",{e,target:h}),l.push(h))}),s.forEach(h=>{t.includes(h)||(r=!0,h.fire("selected",{e,target:h}),o.push(h))}),t.length>0&&s.length>0?(i=!0,r&&this.fire("selection:updated",{e,selected:o,deselected:l})):s.length>0?(i=!0,this.fire("selection:created",{e,selected:o})):t.length>0&&(i=!0,this.fire("selection:cleared",{e,deselected:l})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const r=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(r,e),i}_setActiveObject(t,e){const r=this._activeObject;return r!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,Yr(t)&&r!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const r=this._activeObject;return!!r&&!r.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===r&&this.endCurrentTransform(t),Yr(r)&&r===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),r=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[r]});const i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,r=e.target,i={e:t,target:r,transform:e,action:e.action};r._scaling&&(r._scaling=!1),r.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),r.fire(us,i))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;Yr(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,r){const i=this._realizeGroupTransformOnObject(t),s=super._toObject(t,e,r);return t.set(i),s}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&Yr(e)&&this._activeObject===e){const r=ni(t,["angle","flipX","flipY",Ot,de,Se,Mi,ji,xe]);return Sc(t,e.calcOwnMatrix()),r}return{}}_setSVGObject(t,e,r){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,r),e.set(i)}}D(Ns,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class Wf{constructor(t){D(this,"targets",[]),D(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:i}=t.getActiveObject()||{};i&&i.focus()},r=t.upperCanvasEl;r.addEventListener("click",e),this.__disposer=()=>r.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),Vr(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Hf=["target","oldTarget","fireCanvas","e"],Ce={passive:!1},xi=(n,t)=>{const e=n.getViewportPoint(t),r=n.getScenePoint(t);return{viewportPoint:e,scenePoint:r,pointer:e,absolutePointer:r}},kr=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return n.addEventListener(...e)},De=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return n.removeEventListener(...e)},Nf={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class _s extends Ns{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),D(this,"_isClick",void 0),D(this,"textEditingManager",new Wf(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(kr,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const r=this.upperCanvasEl,i=this._getEventPrefix();t(wc(r),"resize",this._onResize),t(r,i+"down",this._onMouseDown),t(r,"".concat(i,"move"),this._onMouseMove,Ce),t(r,"".concat(i,"out"),this._onMouseOut),t(r,"".concat(i,"enter"),this._onMouseEnter),t(r,"wheel",this._onMouseWheel),t(r,"contextmenu",this._onContextMenu),t(r,"dblclick",this._onDoubleClick),t(r,"dragstart",this._onDragStart),t(r,"dragend",this._onDragEnd),t(r,"dragover",this._onDragOver),t(r,"dragenter",this._onDragEnter),t(r,"dragleave",this._onDragLeave),t(r,"drop",this._onDrop),this.enablePointerEvents||t(r,"touchstart",this._onTouchStart,Ce)}removeListeners(){this.addOrRemove(De,"remove");const t=this._getEventPrefix(),e=Be(this.upperCanvasEl);De(e,"".concat(t,"up"),this._onMouseUp),De(e,"touchend",this._onTouchEnd,Ce),De(e,"".concat(t,"move"),this._onMouseMove,Ce),De(e,"touchmove",this._onMouseMove,Ce),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,r=A({e:t},xi(this,t));this.fire("mouse:out",A(A({},r),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",A({},r)),this._hoveredTargets.forEach(i=>{this.fire("mouse:out",A(A({},r),{},{target:i})),i&&i.fire("mouseout",A({},r))}),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",A({e:t},xi(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const r={e:t,target:e};return this.fire("dragstart",r),e.fire("dragstart",r),void kr(this.upperCanvasEl,"drag",this._onDragProgress)}Eo(t)}_renderDragEffects(t,e,r){let i=!1;const s=this._dropTarget;s&&s!==e&&s!==r&&(s.clearContextTop(),i=!0),e==null||e.clearContextTop(),r!==e&&(r==null||r.clearContextTop());const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),e&&(o.save(),e.transform(o),e.renderDragSourceEffect(t),o.restore(),i=!0),r&&(o.save(),r.transform(o),r.renderDropTargetEffect(t),o.restore(),i=!0),o.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==he,r=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:r};De(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:r,targets:i}=this.findDragTargets(t),s=this._dragSource,o={e:t,target:r,subTargets:i,dragSource:s,canDrop:!1,dropTarget:void 0};let l;this.fire(e,o),this._fireEnterLeaveEvents(r,o),r&&(r.canDrop(t)&&(l=r),r.fire(e,o));for(let h=0;h<i.length;h++){const u=i[h];u.canDrop(t)&&(l=u),u.fire(e,o)}this._renderDragEffects(t,s,l),this._dropTarget=l}_onDragEnter(t){const{target:e,targets:r}=this.findDragTargets(t),i={e:t,target:e,subTargets:r,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:r}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",A({e:t,target:e,subTargets:r,dragSource:this._dragSource},xi(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){const e=this.findTarget(t),r=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:r});return this.stopContextMenu&&Eo(t),this._basicEventHandler("contextmenu",i),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const r=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||r&&this._target===r)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const i=this.upperCanvasEl,s=this._getEventPrefix(),o=Be(i);kr(o,"touchend",this._onTouchEnd,Ce),e&&kr(o,"touchmove",this._onMouseMove,Ce),De(i,"".concat(s,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,r=this._getEventPrefix();De(e,"".concat(r,"move"),this._onMouseMove,Ce);const i=Be(e);kr(i,"".concat(r,"up"),this._onMouseUp),kr(i,"".concat(r,"move"),this._onMouseMove,Ce)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),r=Be(this.upperCanvasEl);De(r,"touchend",this._onTouchEnd,Ce),De(r,"touchmove",this._onMouseMove,Ce),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{kr(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,r=this._getEventPrefix();if(this._isMainEvent(t)){const i=Be(this.upperCanvasEl);De(i,"".concat(r,"up"),this._onMouseUp),De(i,"".concat(r,"move"),this._onMouseMove,Ce),kr(e,"".concat(r,"move"),this._onMouseMove,Ce)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const r=this._currentTransform,i=this._isClick,s=this._target,{button:o}=t;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let l,h,u=!1;if(r&&(this._finalizeCurrentTransform(t),u=r.actionPerformed),!i){const p=s===this._activeObject;this.handleSelection(t),u||(u=this._shouldRender(s)||!p&&s===this._activeObject)}if(s){const p=s.findControl(this.getViewportPoint(t),ds(t)),{key:y,control:b}=p||{};if(h=y,s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,t),u=!0;else if(b){const _=b.getMouseUpHandler(t,s,b);_&&(l=this.getScenePoint(t),_.call(b,t,r,l.x,l.y))}s.isMoving=!1}if(r&&(r.target!==s||r.corner!==h)){const p=r.target&&r.target.controls[r.corner],y=p&&p.getMouseUpHandler(t,r.target,p);l=l||this.getScenePoint(t),y&&y.call(p,t,r,l.x,l.y)}this._setCursorFromEvent(t,s),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=void 0),u?this.requestRenderAll():i||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:r,subTargets:i=[]}=e;this.fire(t,e),r&&r.fire(t,e);for(let s=0;s<i.length;s++)i[s]!==r&&i[s].fire(t,e);return e}_handleEvent(t,e){const r=this._target,i=this.targets||[],s=A(A({e:t,target:r,subTargets:i},xi(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(e),s),r&&r.fire("mouse".concat(e),s);for(let o=0;o<i.length;o++)i[o]!==r&&i[o].fire("mouse".concat(e),s)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;const{button:r}=t;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(t,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let i=this._shouldRender(e),s=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,s=!0,i=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const o=this.getScenePoint(t);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(e){const o=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const l=e.findControl(this.getViewportPoint(t),ds(t));if(e===this._activeObject&&(l||!s)){this._setupCurrentTransform(t,e,o);const h=l?l.control:void 0,u=this.getScenePoint(t),p=h&&h.getMouseDownHandler(t,e,h);p&&p.call(h,t,this._currentTransform,u.x,u.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=xr(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const r=this.getScenePoint(t);e.deltaX=r.x-e.x,e.deltaY=r.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const r=this.findTarget(t);this._setCursorFromEvent(t,r),this._fireOverOutEvents(t,r)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const r=this._hoveredTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:r,fireCanvas:!0});for(let l=0;l<o;l++)this.fireSyntheticInOutEvents("mouse",{e:t,target:s[l],oldTarget:i[l]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const r=this._draggedoverTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("drag",A(A({},e),{},{target:t,oldTarget:r,fireCanvas:!0}));for(let l=0;l<o;l++)this.fireSyntheticInOutEvents("drag",A(A({},e),{},{target:s[l],oldTarget:i[l]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:r,oldTarget:i,fireCanvas:s,e:o}=e,l=Lt(e,Hf);const{targetIn:h,targetOut:u,canvasIn:p,canvasOut:y}=Nf[t],b=i!==r;if(i&&b){const _=A(A({},l),{},{e:o,target:i,nextTarget:r},xi(this,o));s&&this.fire(y,_),i.fire(u,_)}if(r&&b){const _=A(A({},l),{},{e:o,target:r,previousTarget:i},xi(this,o));s&&this.fire(p,_),r.fire(h,_)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),r=this._currentTransform,i=r.target,s=i.group?xr(e,void 0,i.group.calcTransformMatrix()):e;r.shiftKey=t.shiftKey,r.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,r,s),r.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,r){const{action:i,actionHandler:s,target:o}=e,l=!!s&&s(t,e,r.x,r.y);l&&o.setCoords(),i==="drag"&&l&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||l}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let r=e.hoverCursor||this.hoverCursor;const i=Yr(this._activeObject)?this._activeObject:null,s=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(s){const o=s.control;this.setCursor(o.cursorStyleHandler(t,o,e))}else e.subTargetCheck&&this.targets.concat().reverse().map(o=>{r=o.hoverCursor||r}),this.setCursor(r)}handleMultiSelection(t,e){const r=this._activeObject,i=Yr(r);if(r&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(r!==e||i)&&(i||!e.isDescendantOf(r)&&!r.isDescendantOf(e))&&!e.onSelect({e:t})&&!r.getActiveControl()){if(i){const s=r.getObjects();if(e===r){const o=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(s,o)||this.searchPossibleTargets(this._objects,o))||!e.selectable)return!1}e.group===r?(r.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],r.size()===1&&this._setActiveObject(r.item(0),t)):(r.multiSelectAdd(e),this._hoveredTarget=r,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(s,t)}else{r.isEditing&&r.exitEditing();const s=new(tt.getClass("ActiveSelection"))([],{canvas:this});s.multiSelectAdd(r,e),this._hoveredTarget=s,this._setActiveObject(s,t),this._fireSelectionEvents([r],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:r,deltaX:i,deltaY:s}=this._groupSelector,o=new L(e,r),l=o.add(new L(i,s)),h=o.min(l),u=o.max(l).subtract(h),p=this.collectObjects({left:h.x,top:h.y,width:u.x,height:u.y},{includeIntersecting:!this.selectionFullyContained}),y=o.eq(l)?p[0]?[p[0]]:[]:p.length>1?p.filter(b=>!b.onSelect({e:t})).reverse():p;if(y.length===1)this.setActiveObject(y[0],t);else if(y.length>1){const b=tt.getClass("ActiveSelection");this.setActiveObject(new b(y,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const bh={x1:0,y1:0,x2:0,y2:0},Xf=A(A({},bh),{},{r1:0,r2:0}),wi=(n,t)=>isNaN(n)&&typeof t=="number"?t:n,Vf=/^(\d+\.\d+)%|(\d+)%$/;function wh(n){return n&&Vf.test(n)}function _h(n,t){const e=typeof n=="number"?n:typeof n=="string"?parseFloat(n)/(wh(n)?100:1):NaN;return Jr(0,wi(e,t),1)}const Yf=/\s*;\s*/,zf=/\s*:\s*/;function Gf(n,t){let e,r;const i=n.getAttribute("style");if(i){const o=i.split(Yf);o[o.length-1]===""&&o.pop();for(let l=o.length;l--;){const[h,u]=o[l].split(zf).map(p=>p.trim());h==="stop-color"?e=u:h==="stop-opacity"&&(r=u)}}const s=new _t(e||n.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:_h(n.getAttribute("offset"),0),color:s.toRgb(),opacity:wi(parseFloat(r||n.getAttribute("stop-opacity")||""),1)*s.getAlpha()*t}}function qf(n,t){const e=[],r=n.getElementsByTagName("stop"),i=_h(t,1);for(let s=r.length;s--;)e.push(Gf(r[s],i));return e}function Ch(n){return n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?"linear":"radial"}function Sh(n){return n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Le(n,t){return n.getAttribute(t)}function Uf(n,t){return function(e,r){let i,{width:s,height:o,gradientUnits:l}=r;return Object.keys(e).reduce((h,u)=>{const p=e[u];return p==="Infinity"?i=1:p==="-Infinity"?i=0:(i=typeof p=="string"?parseFloat(p):p,typeof p=="string"&&wh(p)&&(i*=.01,l==="pixels"&&(u!=="x1"&&u!=="x2"&&u!=="r2"||(i*=s),u!=="y1"&&u!=="y2"||(i*=o)))),h[u]=i,h},{})}(Ch(n)==="linear"?function(e){return{x1:Le(e,"x1")||0,y1:Le(e,"y1")||0,x2:Le(e,"x2")||"100%",y2:Le(e,"y2")||0}}(n):function(e){return{x1:Le(e,"fx")||Le(e,"cx")||"50%",y1:Le(e,"fy")||Le(e,"cy")||"50%",r1:0,x2:Le(e,"cx")||"50%",y2:Le(e,"cy")||"50%",r2:Le(e,"r")||"50%"}}(n),A(A({},t),{},{gradientUnits:Sh(n)}))}class _i{constructor(t){const{type:e="linear",gradientUnits:r="pixels",coords:i={},colorStops:s=[],offsetX:o=0,offsetY:l=0,gradientTransform:h,id:u}=t||{};Object.assign(this,{type:e,gradientUnits:r,coords:A(A({},e==="radial"?Xf:bh),i),colorStops:s,offsetX:o,offsetY:l,gradientTransform:h,id:u?"".concat(u,"_").concat(Pr()):Pr()})}addColorStop(t){for(const e in t){const r=new _t(t[e]);this.colorStops.push({offset:parseFloat(e),color:r.toRgb(),opacity:r.getAlpha()})}return this}toObject(t){return A(A({},ni(this,t)),{},{type:this.type,coords:A({},this.coords),colorStops:this.colorStops.map(e=>A({},e)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[],i=this.gradientTransform?this.gradientTransform.concat():re.concat(),s=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(y=>A({},y)).sort((y,b)=>y.offset-b.offset);let l=-this.offsetX,h=-this.offsetY;var u;s==="objectBoundingBox"?(l/=t.width,h/=t.height):(l+=t.width/2,h+=t.height/2),(u=t)&&typeof u._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(l-=t.pathOffset.x,h-=t.pathOffset.y),i[4]-=l,i[5]-=h;const p=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(s,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(Tn(i),'"'),""].join(" ");if(this.type==="linear"){const{x1:y,y1:b,x2:_,y2:w}=this.coords;r.push("<linearGradient ",p,' x1="',y,'" y1="',b,'" x2="',_,'" y2="',w,`">
`)}else if(this.type==="radial"){const{x1:y,y1:b,x2:_,y2:w,r1:S,r2:F}=this.coords,M=S>F;r.push("<radialGradient ",p,' cx="',M?y:_,'" cy="',M?b:w,'" r="',M?S:F,'" fx="',M?_:y,'" fy="',M?w:b,`">
`),M&&(o.reverse(),o.forEach(q=>{q.offset=1-q.offset}));const X=Math.min(S,F);if(X>0){const q=X/Math.max(S,F);o.forEach(K=>{K.offset+=q*(1-K.offset)})}}return o.forEach(y=>{let{color:b,offset:_,opacity:w}=y;r.push("<stop ",'offset="',100*_+"%",'" style="stop-color:',b,w!==void 0?";stop-opacity: "+w:";",`"/>
`)}),r.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),r.join("")}toLive(t){const{x1:e,y1:r,x2:i,y2:s,r1:o,r2:l}=this.coords,h=this.type==="linear"?t.createLinearGradient(e,r,i,s):t.createRadialGradient(e,r,o,i,s,l);return this.colorStops.forEach(u=>{let{color:p,opacity:y,offset:b}=u;h.addColorStop(b,y!==void 0?new _t(p).setAlpha(y).toRgba():p)}),h}static async fromObject(t){const{colorStops:e,gradientTransform:r}=t;return new this(A(A({},t),{},{colorStops:e?e.map(i=>A({},i)):void 0,gradientTransform:r?[...r]:void 0}))}static fromElement(t,e,r){const i=Sh(t),s=e._findCenterFromElement();return new this(A({id:t.getAttribute("id")||void 0,type:Ch(t),coords:Uf(t,{width:r.viewBoxWidth||r.width,height:r.viewBoxHeight||r.height}),colorStops:qf(t,r.opacity),gradientUnits:i,gradientTransform:kn(t.getAttribute("gradientTransform")||"")},i==="pixels"?{offsetX:e.width/2-s.x,offsetY:e.height/2-s.y}:{offsetX:0,offsetY:0}))}}D(_i,"type","Gradient"),tt.setClass(_i,"gradient"),tt.setClass(_i,"linear"),tt.setClass(_i,"radial");const $f=["type","source","patternTransform"];class yn{get type(){return"pattern"}set type(t){br("warn","Setting type has no effect",t)}constructor(t){D(this,"repeat","repeat"),D(this,"offsetX",0),D(this,"offsetY",0),D(this,"crossOrigin",""),this.id=Pr(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:r}=this;return A(A({},ni(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:r,offsetX:Ft(this.offsetX,Ct.NUM_FRACTION_DIGITS),offsetY:Ft(this.offsetY,Ct.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:r}=t;const{source:i,repeat:s,id:o}=this,l=wi(this.offsetX/e,0),h=wi(this.offsetY/r,0),u=s==="repeat-y"||s==="no-repeat"?1+Math.abs(l||0):wi(i.width/e,0),p=s==="repeat-x"||s==="no-repeat"?1+Math.abs(h||0):wi(i.height/r,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(l,'" y="').concat(h,'" width="').concat(u,'" height="').concat(p,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{type:r,source:i,patternTransform:s}=t,o=Lt(t,$f);const l=await vn(i,A(A({},e),{},{crossOrigin:o.crossOrigin}));return new this(A(A({},o),{},{patternTransform:s&&s.slice(0),source:l}))}}D(yn,"type","Pattern"),tt.setClass(yn),tt.setClass(yn,"pattern");class Xs{constructor(t){D(this,"color","rgb(0, 0, 0)"),D(this,"width",1),D(this,"shadow",null),D(this,"strokeLineCap","round"),D(this,"strokeLineJoin","round"),D(this,"strokeMiterLimit",10),D(this,"strokeDashArray",null),D(this,"limitedToCanvasSize",!1),this.canvas=t}_setBrushStyles(t){t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,t.setLineDash(this.strokeDashArray||[])}_saveAndTransform(t){const e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])}needsFullRender(){return new _t(this.color).getAlpha()<1||!!this.shadow}_setShadow(){if(!this.shadow||!this.canvas)return;const t=this.canvas,e=this.shadow,r=t.contextTop,i=t.getZoom()*t.getRetinaScaling();r.shadowColor=e.color,r.shadowBlur=e.blur*i,r.shadowOffsetX=e.offsetX*i,r.shadowOffsetY=e.offsetY*i}_resetShadow(){const t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}_isOutSideCanvas(t){return t.x<0||t.x>this.canvas.getWidth()||t.y<0||t.y>this.canvas.getHeight()}}const Kf=["path","left","top"],Zf=["d"];class nr extends At{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:r,left:i,top:s}=e,o=Lt(e,Kf);super(),Object.assign(this,nr.ownDefaults),this.setOptions(o),this._setPath(t||[],!0),typeof i=="number"&&this.set(Ot,i),typeof s=="number"&&this.set(xe,s)}_setPath(t,e){this.path=hh(Array.isArray(t)?t:mh(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new L(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,r=-this.pathOffset.y;t.beginPath();for(const i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+r);break;case"M":t.moveTo(i[1]+e,i[2]+r);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+r,i[3]+e,i[4]+r,i[5]+e,i[6]+r);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+r,i[3]+e,i[4]+r);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A(A({},super.toObject(t)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Oa(this.path,Ct.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=Ct.NUM_FRACTION_DIGITS;return" translate(".concat(Ft(-this.pathOffset.x,t),", ").concat(Ft(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:r,pathOffset:i}=this._calcDimensions();this.set({width:e,height:r,pathOffset:i}),t&&this.setPositionByOrigin(i,ut,ut)}_calcBoundsFromPath(){const t=[];let e=0,r=0,i=0,s=0;for(const o of this.path)switch(o[0]){case"L":i=o[1],s=o[2],t.push({x:e,y:r},{x:i,y:s});break;case"M":i=o[1],s=o[2],e=i,r=s;break;case"C":t.push(...Ho(i,s,o[1],o[2],o[3],o[4],o[5],o[6])),i=o[5],s=o[6];break;case"Q":t.push(...Ho(i,s,o[1],o[2],o[1],o[2],o[3],o[4])),i=o[3],s=o[4];break;case"Z":i=e,s=r}return cr(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return A(A({},t),{},{pathOffset:new L(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,r){const i=ur(t,this.ATTRIBUTE_NAMES,r),{d:s}=i;return new this(s,A(A(A({},Lt(i,Zf)),e),{},{left:void 0,top:void 0}))}}D(nr,"type","Path"),D(nr,"cacheProperties",[..._r,"path","fillRule"]),D(nr,"ATTRIBUTE_NAMES",[...Lr,"d"]),tt.setClass(nr),tt.setSVGClass(nr);class ei extends Xs{constructor(t){super(t),D(this,"decimate",.4),D(this,"drawStraightLine",!1),D(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1}needsFullRender(){return super.needsFullRender()||this._hasStraightLine}static drawSegment(t,e,r){const i=e.midPointFrom(r);return t.quadraticCurveTo(e.x,e.y,i.x,i.y),i}onMouseDown(t,e){let{e:r}=e;this.canvas._isMainEvent(r)&&(this.drawStraightLine=!!this.straightLineKey&&r[this.straightLineKey],this._prepareForDrawing(t),this._addPoint(t),this._render())}onMouseMove(t,e){let{e:r}=e;if(this.canvas._isMainEvent(r)&&(this.drawStraightLine=!!this.straightLineKey&&r[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(t))&&this._addPoint(t)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{const i=this._points,s=i.length,o=this.canvas.contextTop;this._saveAndTransform(o),this.oldEnd&&(o.beginPath(),o.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=ei.drawSegment(o,i[s-2],i[s-1]),o.stroke(),o.restore()}}onMouseUp(t){let{e}=t;return!this.canvas._isMainEvent(e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)}_prepareForDrawing(t){this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)}_addPoint(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(t),!0)}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1}_render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.canvas.contextTop,e=this._points[0],r=this._points[1];if(this._saveAndTransform(t),t.beginPath(),this._points.length===2&&e.x===r.x&&e.y===r.y){const i=this.width/1e3;e.x-=i,r.x+=i}t.moveTo(e.x,e.y);for(let i=1;i<this._points.length;i++)ei.drawSegment(t,e,r),e=this._points[i],r=this._points[i+1];t.lineTo(e.x,e.y),t.stroke(),t.restore()}convertPointsToSVGPath(t){const e=this.width/1e3;return vh(t,e)}createPath(t){const e=new nr(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new be(this.shadow)),e}decimatePoints(t,e){if(t.length<=2)return t;let r,i=t[0];const s=this.canvas.getZoom(),o=Math.pow(e/s,2),l=t.length-1,h=[i];for(let u=1;u<l-1;u++)r=Math.pow(i.x-t[u].x,2)+Math.pow(i.y-t[u].y,2),r>=o&&(i=t[u],h.push(i));return h.push(t[l]),h}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));const t=this.convertPointsToSVGPath(this._points);if(function(r){return Oa(r)==="M 0 0 Q 0 0 0 0 L 0 0"}(t))return void this.canvas.requestRenderAll();const e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.requestRenderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}}const Jf=["left","top","radius"],Th=["radius","startAngle","endAngle","counterClockwise"];class Ie extends At{static getDefaults(){return A(A({},super.getDefaults()),Ie.ownDefaults)}constructor(t){super(),Object.assign(this,Ie.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Nt(this.startAngle),Nt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(de)}getRadiusY(){return this.get("radius")*this.get(Se)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Th,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:e}=this,r=Nt(this.startAngle),i=Nt(this.endAngle),s=Ve(r)*e,o=Ye(r)*e,l=Ve(i)*e,h=Ye(i)*e,u=t>180?1:0,p=this.counterClockwise?0:1;return['<path d="M '.concat(s," ").concat(o," A ").concat(e," ").concat(e," 0 ").concat(u," ").concat(p," ").concat(l," ").concat(h,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(t,e,r){const i=ur(t,this.ATTRIBUTE_NAMES,r),{left:s=0,top:o=0,radius:l=0}=i;return new this(A(A({},Lt(i,Jf)),{},{radius:l,left:s-l,top:o-l}))}static fromObject(t){return super._fromObject(t)}}D(Ie,"type","Circle"),D(Ie,"cacheProperties",[..._r,...Th]),D(Ie,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),D(Ie,"ATTRIBUTE_NAMES",["cx","cy","r",...Lr]),tt.setClass(Ie),tt.setSVGClass(Ie);class Qf extends Xs{constructor(t){super(t),D(this,"width",10),this.points=[]}drawDot(t){const e=this.addPoint(t),r=this.canvas.contextTop;this._saveAndTransform(r),this.dot(r,e),r.restore()}dot(t,e){t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill()}onMouseDown(t){this.points=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)}_render(){const t=this.canvas.contextTop,e=this.points;this._saveAndTransform(t);for(let r=0;r<e.length;r++)this.dot(t,e[r]);t.restore()}onMouseMove(t){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(t)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t))}onMouseUp(){const t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const e=[];for(let i=0;i<this.points.length;i++){const s=this.points[i],o=new Ie({radius:s.radius,left:s.x,top:s.y,originX:ut,originY:ut,fill:s.fill});this.shadow&&(o.shadow=new be(this.shadow)),e.push(o)}const r=new $t(e,{canvas:this.canvas});this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.fire("path:created",{path:r}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()}addPoint(t){let{x:e,y:r}=t;const i={x:e,y:r,radius:Gr(Math.max(0,this.width-20),this.width+20)/2,fill:new _t(this.color).setAlpha(Gr(0,100)/100).toRgba()};return this.points.push(i),i}}class tg extends Xs{constructor(t){super(t),D(this,"width",10),D(this,"density",20),D(this,"dotWidth",1),D(this,"dotWidthVariance",1),D(this,"randomOpacity",!1),D(this,"optimizeOverlapping",!0),this.sprayChunks=[],this.sprayChunk=[]}onMouseDown(t){this.sprayChunks=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.renderChunck(this.sprayChunk)}onMouseMove(t){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(t)||(this.addSprayChunk(t),this.renderChunck(this.sprayChunk))}onMouseUp(){const t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const e=[];for(let i=0;i<this.sprayChunks.length;i++){const s=this.sprayChunks[i];for(let o=0;o<s.length;o++){const l=s[o],h=new le({width:l.width,height:l.width,left:l.x+1,top:l.y+1,originX:ut,originY:ut,fill:this.color});e.push(h)}}const r=new $t(this.optimizeOverlapping?function(i){const s={},o=[];for(let l,h=0;h<i.length;h++)l="".concat(i[h].left).concat(i[h].top),s[l]||(s[l]=!0,o.push(i[h]));return o}(e):e,{objectCaching:!0,subTargetCheck:!1,interactive:!1});this.shadow&&r.set("shadow",new be(this.shadow)),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.fire("path:created",{path:r}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()}renderChunck(t){const e=this.canvas.contextTop;e.fillStyle=this.color,this._saveAndTransform(e);for(let r=0;r<t.length;r++){const i=t[r];e.globalAlpha=i.opacity,e.fillRect(i.x,i.y,i.width,i.width)}e.restore()}_render(){const t=this.canvas.contextTop;t.fillStyle=this.color,this._saveAndTransform(t);for(let e=0;e<this.sprayChunks.length;e++)this.renderChunck(this.sprayChunks[e]);t.restore()}addSprayChunk(t){this.sprayChunk=[];const e=this.width/2;for(let r=0;r<this.density;r++)this.sprayChunk.push({x:Gr(t.x-e,t.x+e),y:Gr(t.y-e,t.y+e),width:this.dotWidthVariance?Gr(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,opacity:this.randomOpacity?Gr(0,100)/100:1});this.sprayChunks.push(this.sprayChunk)}}class Oh extends ei{constructor(t){super(t)}getPatternSrc(){const t=we(),e=t.getContext("2d");return t.width=t.height=25,e&&(e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill()),t}getPattern(t){return t.createPattern(this.source||this.getPatternSrc(),"repeat")}_setBrushStyles(t){super._setBrushStyles(t);const e=this.getPattern(t);e&&(t.strokeStyle=e)}createPath(t){const e=super.createPath(t),r=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new yn({source:this.source||this.getPatternSrc(),offsetX:-r.x,offsetY:-r.y}),e}}const eg=["x1","y1","x2","y2"],rg=["x1","y1","x2","y2"],No=["x1","x2","y1","y2"];class vr extends At{constructor(){let[t,e,r,i]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,vr.ownDefaults),this.setOptions(s),this.x1=t,this.x2=r,this.y1=e,this.y2=i,this._setWidthHeight();const{left:o,top:l}=s;typeof o=="number"&&this.set(Ot,o),typeof l=="number"&&this.set(xe,l)}_setWidthHeight(){const{x1:t,y1:e,x2:r,y2:i}=this;this.width=Math.abs(r-t),this.height=Math.abs(i-e);const{left:s,top:o,width:l,height:h}=cr([{x:t,y:e},{x:r,y:i}]),u=new L(s+l/2,o+h/2);this.setPositionByOrigin(u,ut,ut)}_set(t,e){return super._set(t,e),No.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const r=t.strokeStyle;var i;Pe(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(i=this.stroke)!==null&&i!==void 0?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r}_findCenterFromElement(){return new L((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A(A({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:r,y2:i,width:s,height:o}=this,l=t<=e?-1:1,h=r<=i?-1:1;return{x1:l*s/2,x2:l*-s/2,y1:h*o/2,y2:h*-o/2}}_toSVG(){const{x1:t,x2:e,y1:r,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(r,'" x2="').concat(e,'" y2="').concat(i,`" />
`)]}static async fromElement(t,e,r){const i=ur(t,this.ATTRIBUTE_NAMES,r),{x1:s=0,y1:o=0,x2:l=0,y2:h=0}=i;return new this([s,o,l,h],Lt(i,eg))}static fromObject(t){let{x1:e,y1:r,x2:i,y2:s}=t,o=Lt(t,rg);return this._fromObject(A(A({},o),{},{points:[e,r,i,s]}),{extraParam:"points"})}}D(vr,"type","Line"),D(vr,"cacheProperties",[..._r,...No]),D(vr,"ATTRIBUTE_NAMES",Lr.concat(No)),tt.setClass(vr),tt.setSVGClass(vr);class Dr extends At{static getDefaults(){return A(A({},super.getDefaults()),Dr.ownDefaults)}constructor(t){super(),Object.assign(this,Dr.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,r),t.lineTo(0,-r),t.lineTo(e,r),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}D(Dr,"type","Triangle"),D(Dr,"ownDefaults",{width:100,height:100}),tt.setClass(Dr),tt.setSVGClass(Dr);const kh=["rx","ry"];class rr extends At{static getDefaults(){return A(A({},super.getDefaults()),rr.ownDefaults)}constructor(t){super(),Object.assign(this,rr.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(de)}getRy(){return this.get("ry")*this.get(Se)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...kh,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,wr,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,r){const i=ur(t,this.ATTRIBUTE_NAMES,r);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)}}function Dh(n){if(!n)return[];const t=n.replace(/,/g," ").trim().split(/\s+/),e=[];for(let r=0;r<t.length;r+=2)e.push({x:parseFloat(t[r]),y:parseFloat(t[r+1])});return e}D(rr,"type","Ellipse"),D(rr,"cacheProperties",[..._r,...kh]),D(rr,"ownDefaults",{rx:0,ry:0}),D(rr,"ATTRIBUTE_NAMES",[...Lr,"cx","cy","rx","ry"]),tt.setClass(rr),tt.setSVGClass(rr);const ig=["left","top"],Ah={exactBoundingBox:!1};class Ae extends At{static getDefaults(){return A(A({},super.getDefaults()),Ae.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),D(this,"strokeDiff",void 0),Object.assign(this,Ae.ownDefaults),this.setOptions(e),this.points=t;const{left:r,top:i}=e;this.initialized=!0,this.setBoundingBox(!0),typeof r=="number"&&this.set(Ot,r),typeof i=="number"&&this.set(xe,i)}isOpen(){return!0}_projectStrokeOnPoints(t){return Qc(this.points,t,this.isOpen())}_calcDimensions(t){t=A({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(u=>u.projectedPoint):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new L,strokeOffset:new L,strokeDiff:new L};const r=cr(e),i=Mn(A(A({},t),{},{scaleX:1,scaleY:1})),s=cr(this.points.map(u=>te(u,i,!0))),o=new L(this.scaleX,this.scaleY);let l=r.left+r.width/2,h=r.top+r.height/2;return this.exactBoundingBox&&(l-=h*Math.tan(Nt(this.skewX)),h-=l*Math.tan(Nt(this.skewY))),A(A({},r),{},{pathOffset:new L(l,h),strokeOffset:new L(s.left,s.top).subtract(new L(r.left,r.top)).multiply(o),strokeDiff:new L(r.width,r.height).subtract(new L(s.width,s.height)).multiply(o)})}_findCenterFromElement(){const t=cr(this.points);return new L(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:r,width:i,height:s,pathOffset:o,strokeOffset:l,strokeDiff:h}=this._calcDimensions();this.set({width:i,height:s,pathOffset:o,strokeOffset:l,strokeDiff:h}),t&&this.setPositionByOrigin(new L(e+i/2,r+s/2),ut,ut)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new L(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(t).some(l=>this.strokeUniform||this.constructor.layoutProperties.includes(l))){var e,r;const{width:l,height:h}=this._calcDimensions(t);o=new L((e=t.width)!==null&&e!==void 0?e:l,(r=t.height)!==null&&r!==void 0?r:h)}else{var i,s;o=new L((i=t.width)!==null&&i!==void 0?i:this.width,(s=t.height)!==null&&s!==void 0?s:this.height)}return o.multiply(new L(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const r=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&r&&((t===de||t===Se)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A(A({},super.toObject(t)),{},{points:this.points.map(e=>{let{x:r,y:i}=e;return{x:r,y:i}})})}_toSVG(){const t=[],e=this.pathOffset.x,r=this.pathOffset.y,i=Ct.NUM_FRACTION_DIGITS;for(let s=0,o=this.points.length;s<o;s++)t.push(Ft(this.points[s].x-e,i),",",Ft(this.points[s].y-r,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,r=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-r,this.points[0].y-i);for(let s=0;s<e;s++){const o=this.points[s];t.lineTo(o.x-r,o.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,r){return new this(Dh(t.getAttribute("points")),A(A({},Lt(ur(t,this.ATTRIBUTE_NAMES,r),ig)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}D(Ae,"ownDefaults",Ah),D(Ae,"type","Polyline"),D(Ae,"layoutProperties",[Mi,ji,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),D(Ae,"cacheProperties",[..._r,"points"]),D(Ae,"ATTRIBUTE_NAMES",[...Lr]),tt.setClass(Ae),tt.setSVGClass(Ae);class Qi extends Ae{isOpen(){return!1}}D(Qi,"ownDefaults",Ah),D(Qi,"type","Polygon"),tt.setClass(Qi),tt.setSVGClass(Qi);const Eh=["fontSize","fontWeight","fontFamily","fontStyle"],Ph=["underline","overline","linethrough"],Mh=[...Eh,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],jh=[...Mh,...Ph,"textBackgroundColor","direction"],ng=[...Eh,...Ph,ue,"strokeWidth",zt,"deltaY","textBackgroundColor"],sg={_reNewline:ra,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:Ot,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:Ot,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},sr="justify",Cs="justify-left",xn="justify-right",bn="justify-center";class Fh extends At{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;const e=t===void 0?this.styles:{line:this.styles[t]};for(const r in e)for(const i in e[r])for(const s in e[r][i])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;const r=e===void 0?this.styles:{0:this.styles[e]};for(const i in r)for(const s in r[i])if(r[i][s][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let r,i,s=0,o=!0,l=0;for(const h in e){r=0;for(const u in e[h]){const p=e[h][u]||{};s++,p[t]!==void 0?(i?p[t]!==i&&(o=!1):i=p[t],p[t]===this[t]&&delete p[t]):o=!1,Object.keys(p).length!==0?r++:delete e[h][u]}r===0&&delete e[h]}for(let h=0;h<this._textLines.length;h++)l+=this._textLines[h].length;o&&s===l&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let r,i,s;for(i in e){for(s in r=e[i],r)delete r[s][t],Object.keys(r[s]).length===0&&delete r[s];Object.keys(r).length===0&&delete e[i]}}_extendStyles(t,e){const{lineIndex:r,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(r)||this._setLineStyle(r);const s=ha(A(A({},this._getStyleDeclaration(r,i)),e),o=>o!==void 0);this._setStyleDeclaration(r,i,s)}getSelectionStyles(t,e,r){const i=[];for(let s=t;s<(e||t);s++)i.push(this.getStyleAtPosition(s,r));return i}getStyleAtPosition(t,e){const{lineIndex:r,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(r,i):this._getStyleDeclaration(r,i)}setSelectionStyles(t,e,r){for(let i=e;i<(r||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var r;const i=this.styles&&this.styles[t];return i&&(r=i[e])!==null&&r!==void 0?r:{}}getCompleteStyleDeclaration(t,e){return A(A({},ni(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,r){this.styles[t][e]=r}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}D(Fh,"_styleProperties",ng);const og=/  +/g,ag=/"/g;function wo(n,t,e,r,i){return"		".concat(function(s,o){let{left:l,top:h,width:u,height:p}=o,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ct.NUM_FRACTION_DIGITS;const b=On(zt,s,!1),[_,w,S,F]=[l,h,u,p].map(M=>Ft(M,y));return"<rect ".concat(b,' x="').concat(_,'" y="').concat(w,'" width="').concat(S,'" height="').concat(F,'"></rect>')}(n,{left:t,top:e,width:r,height:i}),`
`)}const lg=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let _o;class Jt extends Fh{static getDefaults(){return A(A({},super.getDefaults()),Jt.ownDefaults)}constructor(t,e){super(),D(this,"__charBounds",[]),Object.assign(this,Jt.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=Ta(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(sr)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,r,i,s,o,l;for(let h=0,u=this._textLines.length;h<u;h++)if((this.textAlign===sr||h!==u-1&&!this.isEndOfWrapping(h))&&(i=0,s=this._textLines[h],e=this.getLineWidth(h),e<this.width&&(l=this.textLines[h].match(this._reSpacesAndTabs)))){r=l.length,t=(this.width-e)/r;for(let p=0;p<=s.length;p++)o=this.__charBounds[h][p],this._reSpaceAndTab.test(s[p])?(o.width+=t,o.kernedWidth+=t,o.left+=i,i+=t):o.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const r=e?this._unwrappedTextLines:this._textLines;let i;for(i=0;i<r.length;i++){if(t<=r[i].length)return{lineIndex:i,charIndex:t};t-=r[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:r[i-1].length<t?r[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===ue?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,r){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case ut:t.textBaseline="middle";break;case"ascender":t.textBaseline=xe;break;case"descender":t.textBaseline=Do}t.font=this._getFontDeclaration(e,r)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,r=this._textLines.length;e<r;e++){const i=this.getLineWidth(e);i>t&&(t=i)}return t}_renderTextLine(t,e,r,i,s,o){this._renderChars(t,e,r,i,s,o)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,r=this._getLeftOffset();let i=this._getTopOffset();for(let s=0,o=this._textLines.length;s<o;s++){const l=this.getHeightOfLine(s);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",s)){i+=l;continue}const h=this._textLines[s].length,u=this._getLineLeftOffset(s);let p,y,b=0,_=0,w=this.getValueOfPropertyAt(s,0,"textBackgroundColor");for(let S=0;S<h;S++){const F=this.__charBounds[s][S];y=this.getValueOfPropertyAt(s,S,"textBackgroundColor"),this.path?(t.save(),t.translate(F.renderLeft,F.renderTop),t.rotate(F.angle),t.fillStyle=y,y&&t.fillRect(-F.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),F.width,l/this.lineHeight),t.restore()):y!==w?(p=r+u+_,this.direction==="rtl"&&(p=this.width-p-b),t.fillStyle=w,w&&t.fillRect(p,i,b,l/this.lineHeight),_=F.left,b=F.width,w=y):b+=F.kernedWidth}y&&!this.path&&(p=r+u+_,this.direction==="rtl"&&(p=this.width-p-b),t.fillStyle=y,t.fillRect(p,i,b,l/this.lineHeight)),i+=l}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,r,i){const s=Ci.getFontCache(e),o=this._getFontDeclaration(e),l=r+t,h=r&&o===this._getFontDeclaration(i),u=e.fontSize/this.CACHE_FONT_SIZE;let p,y,b,_;if(r&&s[r]!==void 0&&(b=s[r]),s[t]!==void 0&&(_=p=s[t]),h&&s[l]!==void 0&&(y=s[l],_=y-b),p===void 0||b===void 0||y===void 0){const w=function(){return _o||(_o=Me({width:0,height:0}).getContext("2d")),_o}();this._setTextStyles(w,e,!0),p===void 0&&(_=p=w.measureText(t).width,s[t]=p),b===void 0&&h&&r&&(b=w.measureText(r).width,s[r]=b),h&&y===void 0&&(y=w.measureText(l).width,s[l]=y,_=y-b)}return{width:p*u,kernedWidth:_*u}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,r,i=0;const s=this.pathSide===Vt,o=this.path,l=this._textLines[t],h=l.length,u=new Array(h);this.__charBounds[t]=u;for(let p=0;p<h;p++){const y=l[p];r=this._getGraphemeBox(y,t,p,e),u[p]=r,i+=r.kernedWidth,e=y}if(u[h]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let p=0;const y=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case Ot:p=s?y-i:0;break;case ut:p=(y-i)/2;break;case Vt:p=s?0:y-i}p+=this.pathStartOffset*(s?-1:1);for(let b=s?h-1:0;s?b>=0:b<h;s?b--:b++)r=u[b],p>y?p%=y:p<0&&(p+=y),this._setGraphemeOnPath(p,r),p+=r.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){const r=t+e.kernedWidth/2,i=this.path,s=ph(i.path,r,i.segmentsInfo);e.renderLeft=s.x-i.pathOffset.x,e.renderTop=s.y-i.pathOffset.y,e.angle=s.angle+(this.pathSide===Vt?Math.PI:0)}_getGraphemeBox(t,e,r,i,s){const o=this.getCompleteStyleDeclaration(e,r),l=i?this.getCompleteStyleDeclaration(e,r-1):{},h=this._measureChar(t,o,i,l);let u,p=h.kernedWidth,y=h.width;this.charSpacing!==0&&(u=this._getWidthOfCharSpacing(),y+=u,p+=u);const b={width:y,left:0,height:o.fontSize,kernedWidth:p,deltaY:o.deltaY};if(r>0&&!s){const _=this.__charBounds[e][r-1];b.left=_.left+_.width+h.kernedWidth-h.width}return b}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let r=1,i=this._textLines[t].length;r<i;r++)e=Math.max(this.getHeightOfChar(t,r),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let r=0,i=this._textLines.length;r<i;r++)t=this.getHeightOfLine(r),e+=r===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let r=0;const i=this._getLeftOffset(),s=this._getTopOffset();for(let o=0,l=this._textLines.length;o<l;o++){const h=this.getHeightOfLine(o),u=h/this.lineHeight,p=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],i+p,s+r+u,o),r+=h}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(zt))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,r,i,s,o){const l=this.getHeightOfLine(o),h=this.textAlign.includes(sr),u=this.path,p=!h&&this.charSpacing===0&&this.isEmptyStyles(o)&&!u,y=this.direction==="ltr",b=this.direction==="ltr"?1:-1,_=e.direction;let w,S,F,M,X,q="",K=0;if(e.save(),_!==this.direction&&(e.canvas.setAttribute("dir",y?"ltr":"rtl"),e.direction=y?"ltr":"rtl",e.textAlign=y?Ot:Vt),s-=l*this._fontSizeFraction/this.lineHeight,p)return this._renderChar(t,e,o,0,r.join(""),i,s),void e.restore();for(let et=0,ct=r.length-1;et<=ct;et++)M=et===ct||this.charSpacing||u,q+=r[et],F=this.__charBounds[o][et],K===0?(i+=b*(F.kernedWidth-F.width),K+=F.width):K+=F.kernedWidth,h&&!M&&this._reSpaceAndTab.test(r[et])&&(M=!0),M||(w=w||this.getCompleteStyleDeclaration(o,et),S=this.getCompleteStyleDeclaration(o,et+1),M=Hs(w,S,!1)),M&&(u?(e.save(),e.translate(F.renderLeft,F.renderTop),e.rotate(F.angle),this._renderChar(t,e,o,et,q,-K/2,0),e.restore()):(X=i,this._renderChar(t,e,o,et,q,X,s)),q="",w=S,i+=b*K,K=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,r=this.height+this.strokeWidth,i=Me({width:e,height:r}),s=i.getContext("2d");return i.width=e,i.height=r,s.beginPath(),s.moveTo(0,0),s.lineTo(e,0),s.lineTo(e,r),s.lineTo(0,r),s.closePath(),s.translate(e/2,r/2),s.fillStyle=t.toLive(s),this._applyPatternGradientTransform(s,t),s.fill(),s.createPattern(i,"no-repeat")}handleFiller(t,e,r){let i,s;return Pe(r)?r.gradientUnits==="percentage"||r.gradientTransform||r.patternTransform?(i=-this.width/2,s=-this.height/2,t.translate(i,s),t[e]=this._applyPatternGradientTransformText(r),{offsetX:i,offsetY:s}):(t[e]=r.toLive(t),this._applyPatternGradientTransform(t,r)):(t[e]=r,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:r,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",r)}_setFillStyles(t,e){let{fill:r}=e;return this.handleFiller(t,"fillStyle",r)}_renderChar(t,e,r,i,s,o,l){const h=this._getStyleDeclaration(r,i),u=this.getCompleteStyleDeclaration(r,i),p=t==="fillText"&&u.fill,y=t==="strokeText"&&u.stroke&&u.strokeWidth;if(y||p){if(e.save(),e.font=this._getFontDeclaration(u),h.textBackgroundColor&&this._removeShadow(e),h.deltaY&&(l+=h.deltaY),p){const b=this._setFillStyles(e,u);e.fillText(s,o-b.offsetX,l-b.offsetY)}if(y){const b=this._setStrokeStyles(e,u);e.strokeText(s,o-b.offsetX,l-b.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,r){const i=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),o=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),l={fontSize:s*r.size,deltaY:o+s*r.baseline};this.setSelectionStyles(l,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),r=this.width-e,i=this.textAlign,s=this.direction,o=this.isEndOfWrapping(t);let l=0;return i===sr||i===bn&&!o||i===xn&&!o||i===Cs&&!o?0:(i===ut&&(l=r/2),i===Vt&&(l=r),i===bn&&(l=r/2),i===xn&&(l=r),s==="rtl"&&(i===Vt||i===sr||i===xn?l=0:i===Ot||i===Cs?l=-r:i!==ut&&i!==bn||(l=-r/2)),l)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,r){var i;return(i=this._getStyleDeclaration(t,e)[r])!==null&&i!==void 0?i:this[r]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let r=this._getTopOffset();const i=this._getLeftOffset(),s=this.path,o=this._getWidthOfCharSpacing(),l=this.offsets[e];for(let h=0,u=this._textLines.length;h<u;h++){const p=this.getHeightOfLine(h);if(!this[e]&&!this.styleHas(e,h)){r+=p;continue}const y=this._textLines[h],b=p/this.lineHeight,_=this._getLineLeftOffset(h);let w,S,F=0,M=0,X=this.getValueOfPropertyAt(h,0,e),q=this.getValueOfPropertyAt(h,0,zt);const K=r+b*(1-this._fontSizeFraction);let et=this.getHeightOfChar(h,0),ct=this.getValueOfPropertyAt(h,0,"deltaY");for(let it=0,Z=y.length;it<Z;it++){const vt=this.__charBounds[h][it];w=this.getValueOfPropertyAt(h,it,e),S=this.getValueOfPropertyAt(h,it,zt);const kt=this.getHeightOfChar(h,it),Tt=this.getValueOfPropertyAt(h,it,"deltaY");if(s&&w&&S)t.save(),t.fillStyle=q,t.translate(vt.renderLeft,vt.renderTop),t.rotate(vt.angle),t.fillRect(-vt.kernedWidth/2,l*kt+Tt,vt.kernedWidth,this.fontSize/15),t.restore();else if((w!==X||S!==q||kt!==et||Tt!==ct)&&M>0){let nt=i+_+F;this.direction==="rtl"&&(nt=this.width-nt-M),X&&q&&(t.fillStyle=q,t.fillRect(nt,K+l*et+ct,M,this.fontSize/15)),F=vt.left,M=vt.width,X=w,q=S,et=kt,ct=Tt}else M+=vt.kernedWidth}let f=i+_+F;this.direction==="rtl"&&(f=this.width-f-M),t.fillStyle=S,w&&S&&t.fillRect(f,K+l*et+ct,M-o,this.fontSize/15),r+=p}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:r=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;const o=t.includes("'")||t.includes('"')||t.includes(",")||Jt.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,r,"".concat(s?this.CACHE_FONT_SIZE:i,"px"),o].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return Ws(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),r=new Array(e.length),i=[`
`];let s=[];for(let o=0;o<e.length;o++)r[o]=this.graphemeSplit(e[o]),s=s.concat(r[o],i);return s.pop(),{_unwrappedLines:r,lines:e,graphemeText:s,graphemeLines:r}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A(A({},super.toObject([...jh,...t])),{},{styles:eh(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:r}=this.constructor;super.set(t,e);let i=!1,s=!1;if(typeof t=="object")for(const o in t)o==="path"&&this.setPathInfo(),i=i||r.includes(o),s=s||o==="path";else i=r.includes(t),s=t==="path";return s&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,r){const i=ur(t,Jt.ATTRIBUTE_NAMES,r),s=A(A({},e),i),{textAnchor:o=Ot,textDecoration:l="",dx:h=0,dy:u=0,top:p=0,left:y=0,fontSize:b=ea,strokeWidth:_=1}=s,w=Lt(s,lg),S=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),A({left:y+h,top:p+u,underline:l.includes("underline"),overline:l.includes("overline"),linethrough:l.includes("line-through"),strokeWidth:0,fontSize:b},w)),F=S.getScaledHeight()/S.height,M=((S.height+S.strokeWidth)*S.lineHeight-S.height)*F,X=S.getScaledHeight()+M;let q=0;return o===ut&&(q=S.getScaledWidth()/2),o===Vt&&(q=S.getScaledWidth()),S.set({left:S.left-q,top:S.top-(X-S.fontSize*(.07+S._fontSizeFraction))/S.lineHeight,strokeWidth:_}),S}static fromObject(t){return this._fromObject(A(A({},t),{},{styles:rh(t.styles||{},t.text)}),{extraParam:"text"})}}D(Jt,"textLayoutProperties",Mh),D(Jt,"cacheProperties",[..._r,...jh]),D(Jt,"ownDefaults",sg),D(Jt,"type","Text"),D(Jt,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),D(Jt,"ATTRIBUTE_NAMES",Lr.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Kc(Jt,[class extends Ec{_toSVG(){const n=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(n){return this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(n){let{textBgRects:t,textSpans:e}=n;const r=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(ag,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",r?'text-decoration="'.concat(r,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(n,t){const e=[],r=[];let i,s=n;this.backgroundColor&&r.push(...wo(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,l=this._textLines.length;o<l;o++)i=this._getLineLeftOffset(o),this.direction==="rtl"&&(i+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(r,o,t+i,s),this._setSVGTextLineText(e,o,t+i,s),s+=this.getHeightOfLine(o);return{textSpans:e,textBgRects:r}}_createTextCharSpan(n,t,e,r){const i=this.getSvgSpanStyles(t,n!==n.trim()||!!n.match(og)),s=i?'style="'.concat(i,'"'):"",o=t.deltaY,l=o?' dy="'.concat(Ft(o,Ct.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(Ft(e,Ct.NUM_FRACTION_DIGITS),'" y="').concat(Ft(r,Ct.NUM_FRACTION_DIGITS),'" ').concat(l).concat(s,">").concat(th(n),"</tspan>")}_setSVGTextLineText(n,t,e,r){const i=this.getHeightOfLine(t),s=this.textAlign.includes(sr),o=this._textLines[t];let l,h,u,p,y,b="",_=0;r+=i*(1-this._fontSizeFraction)/this.lineHeight;for(let w=0,S=o.length-1;w<=S;w++)y=w===S||this.charSpacing,b+=o[w],u=this.__charBounds[t][w],_===0?(e+=u.kernedWidth-u.width,_+=u.width):_+=u.kernedWidth,s&&!y&&this._reSpaceAndTab.test(o[w])&&(y=!0),y||(l=l||this.getCompleteStyleDeclaration(t,w),h=this.getCompleteStyleDeclaration(t,w+1),y=Hs(l,h,!0)),y&&(p=this._getStyleDeclaration(t,w),n.push(this._createTextCharSpan(b,p,e,r)),b="",l=h,this.direction==="rtl"?e-=_:e+=_,_=0)}_setSVGTextLineBg(n,t,e,r){const i=this._textLines[t],s=this.getHeightOfLine(t)/this.lineHeight;let o,l=0,h=0,u=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let p=0;p<i.length;p++){const{left:y,width:b,kernedWidth:_}=this.__charBounds[t][p];o=this.getValueOfPropertyAt(t,p,"textBackgroundColor"),o!==u?(u&&n.push(...wo(u,e+h,r,l,s)),h=y,l=b,u=o):l+=_}o&&n.push(...wo(u,e+h,r,l,s))}_getSVGLineTopOffset(n){let t,e=0;for(t=0;t<n;t++)e+=this.getHeightOfLine(t);const r=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(n){return"".concat(super.getSvgStyles(n)," white-space: pre;")}getSvgSpanStyles(n,t){const{fontFamily:e,strokeWidth:r,stroke:i,fill:s,fontSize:o,fontStyle:l,fontWeight:h,deltaY:u}=n,p=this.getSvgTextDecoration(n);return[i?On(ue,i):"",r?"stroke-width: ".concat(r,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",l?"font-style: ".concat(l,"; "):"",h?"font-weight: ".concat(h,"; "):"",p&&"text-decoration: ".concat(p,"; "),s?On(zt,s):"",u?"baseline-shift: ".concat(-u,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(n){return["overline","underline","line-through"].filter(t=>n[t.replace("-","")]).join(" ")}}]),tt.setClass(Jt),tt.setSVGClass(Jt);class cg{constructor(t){D(this,"target",void 0),D(this,"__mouseDownInPlace",!1),D(this,"__dragStartFired",!1),D(this,"__isDraggingOver",!1),D(this,"__dragStartSelection",void 0),D(this,"__dragImageDisposer",void 0),D(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(r=>r()),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,r=e.getSelectionStartFromPointer(t);return e.isEditing&&r>=e.selectionStart&&r<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var r;let{selectionStart:i,selectionEnd:s}=e;const o=this.target,l=o.canvas,h=new L(o.flipX?-1:1,o.flipY?-1:1),u=o._getCursorBoundaries(i),p=new L(u.left+u.leftOffset,u.top+u.topOffset).multiply(h).transform(o.calcTransformMatrix()),y=l.getScenePoint(t).subtract(p),b=o.getCanvasRetinaScaling(),_=o.getBoundingRect(),w=p.subtract(new L(_.left,_.top)),S=l.viewportTransform,F=w.add(y).transform(S,!0),M=o.backgroundColor,X=_a(o.styles);o.backgroundColor="";const q={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(q,0,i),o.setSelectionStyles(q,s,o.text.length),o.dirty=!0;const K=o.toCanvasElement({enableRetinaScaling:l.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=M,o.styles=X,o.dirty=!0,ws(K,{position:"fixed",left:"".concat(-K.width,"px"),border:he,width:"".concat(K.width/b,"px"),height:"".concat(K.height/b,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{K.remove()},Be(t.target||this.target.hiddenTextarea).body.appendChild(K),(r=t.dataTransfer)===null||r===void 0||r.setDragImage(K,F.x,F.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,r=this.isActive();if(r&&t.dataTransfer){const i=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},s=e._text.slice(i.selectionStart,i.selectionEnd).join(""),o=A({text:e.text,value:s},i);t.dataTransfer.setData("text/plain",s),t.dataTransfer.setData("application/fabric",JSON.stringify({value:s,styles:e.getSelectionStyles(i.selectionStart,i.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,o)}return e.abortCursorAnimation(),r}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),r=this.__dragStartSelection;return e<r.selectionStart||e>r.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const r=this.targetCanDrop(e);!this.__isDraggingOver&&r&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,r=this.targetCanDrop(e);!this.__isDraggingOver&&r?this.__isDraggingOver=!0:this.__isDraggingOver&&!r&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:r}=t,i=r.defaultPrevented;this.__isDraggingOver=!1,r.preventDefault();let s=(e=r.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(s&&!i){const o=this.target,l=o.canvas;let h=o.getSelectionStartFromPointer(r);const{styles:u}=r.dataTransfer.types.includes("application/fabric")?JSON.parse(r.dataTransfer.getData("application/fabric")):{},p=s[Math.max(0,s.length-1)],y=0;if(this.__dragStartSelection){const b=this.__dragStartSelection.selectionStart,_=this.__dragStartSelection.selectionEnd;h>b&&h<=_?h=b:h>_&&(h-=_-b),o.removeChars(b,_),delete this.__dragStartSelection}o._reNewline.test(p)&&(o._reNewline.test(o._text[h])||h===o._text.length)&&(s=s.trimEnd()),t.didDrop=!0,t.dropTarget=o,o.insertChars(s,u,h),l.setActiveObject(o),o.enterEditing(r),o.selectionStart=Math.min(h+y,o._text.length),o.selectionEnd=Math.min(o.selectionStart+s.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(hs,{index:h+y,action:"drop"}),l.fire("text:changed",{target:o}),l.contextTopDirty=!0,l.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var r;const i=this.target,s=this.target.canvas,{selectionStart:o,selectionEnd:l}=this.__dragStartSelection,h=((r=e.dataTransfer)===null||r===void 0?void 0:r.dropEffect)||he;h===he?(i.selectionStart=o,i.selectionEnd=l,i._updateTextarea(),i.hiddenTextarea.focus()):(i.clearContextTop(),h==="move"&&(i.removeChars(o,l),i.selectionStart=i.selectionEnd=o,i.hiddenTextarea&&(i.hiddenTextarea.value=i.text),i._updateTextarea(),i.fire(hs,{index:o,action:"dragend"}),s.fire("text:changed",{target:i}),s.requestRenderAll()),i.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Gl=/[ \n\.,;!\?\-]/;class hg extends Jt{constructor(){super(...arguments),D(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:r,delay:i,onComplete:s}=t;return xa({startValue:this._currentCursorOpacity,endValue:e,duration:r,delay:i,onComplete:s,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,r=t-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r--;for(;/\S/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findWordBoundaryRight(t){let e=0,r=t;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}findLineBoundaryLeft(t){let e=0,r=t-1;for(;!/\n/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findLineBoundaryRight(t){let e=0,r=t;for(;!/\n/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}searchWordBoundary(t,e){const r=this._text;let i=t>0&&this._reSpace.test(r[t])&&(e===-1||!ra.test(r[t-1]))?t-1:t,s=r[i];for(;i>0&&i<r.length&&!Gl.test(s);)i+=e,s=r[i];return e===-1&&Gl.test(s)&&i++,i}selectWord(t){t=t||this.selectionStart;const e=this.searchWordBoundary(t,-1),r=Math.max(e,this.searchWordBoundary(t,1));this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;const e=this.findLineBoundaryLeft(t),r=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;Be(e).activeElement!==e&&e.focus();const r=this.getSelectionStartFromPointer(t),i=this.selectionStart,s=this.selectionEnd;(r===this.__selectionStartOnMouseDown&&i!==s||i!==r&&s!==r)&&(r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===s||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,r){const i=r.slice(0,t),s=this.graphemeSplit(i).length;if(t===e)return{selectionStart:s,selectionEnd:s};const o=r.slice(t,e);return{selectionStart:s,selectionEnd:s+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(t,e,r){const i=r.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+r.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),r=this.get2DCursorLocation(t),i=r.lineIndex,s=r.charIndex,o=this.getValueOfPropertyAt(i,s,"fontSize")*this.lineHeight,l=e.leftOffset,h=this.getCanvasRetinaScaling(),u=this.canvas.upperCanvasEl,p=u.width/h,y=u.height/h,b=p-o,_=y-o,w=new L(e.left+l,e.top+e.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new L(u.clientWidth/p,u.clientHeight/y));return w.x<0&&(w.x=0),w.x>b&&(w.x=b),w.y<0&&(w.y=0),w.y>_&&(w.y=_),w.x+=this.canvas._offset.left,w.y+=this.canvas._offset.top,{left:"".concat(w.x,"px"),top:"".concat(w.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(us),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:r,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:s,charIndex:o}=this.get2DCursorLocation(e,!0);if(r!==s){if(this.styles[r])for(let l=i;l<this._unwrappedTextLines[r].length;l++)delete this.styles[r][l];if(this.styles[s])for(let l=o;l<this._unwrappedTextLines[s].length;l++){const h=this.styles[s][l];h&&(this.styles[r]||(this.styles[r]={}),this.styles[r][i+l-o]=h)}for(let l=r+1;l<=s;l++)delete this.styles[l];this.shiftLineStyles(s,r-s)}else if(this.styles[r]){const l=this.styles[r],h=o-i;for(let u=i;u<o;u++)delete l[u];for(const u in this.styles[r]){const p=parseInt(u,10);p>=o&&(l[p-h]=l[u],delete l[u])}}}shiftLineStyles(t,e){const r=Object.assign({},this.styles);for(const i in this.styles){const s=parseInt(i,10);s>t&&(this.styles[s+e]=r[s],r[s-e]||delete this.styles[s])}}insertNewlineStyleObject(t,e,r,i){const s={},o=this._unwrappedTextLines[t].length,l=o===e;let h=!1;r||(r=1),this.shiftLineStyles(t,r);const u=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const y in this.styles[t]){const b=parseInt(y,10);b>=e&&(h=!0,s[b-e]=this.styles[t][y],l&&e===0||delete this.styles[t][y])}let p=!1;for(h&&!l&&(this.styles[t+r]=s,p=!0),(p||o>e)&&r--;r>0;)i&&i[r-1]?this.styles[t+r]={0:A({},i[r-1])}:u?this.styles[t+r]={0:A({},u)}:delete this.styles[t+r],r--;this._forceClearCache=!0}insertCharStyleObject(t,e,r,i){this.styles||(this.styles={});const s=this.styles[t],o=s?A({},s):{};r||(r=1);for(const h in o){const u=parseInt(h,10);u>=e&&(s[u+r]=o[u],o[u-r]||delete s[u])}if(this._forceClearCache=!0,i){for(;r--;)Object.keys(i[r]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+r]=A({},i[r]));return}if(!s)return;const l=s[e?e-1:1];for(;l&&r--;)this.styles[t][e+r]=A({},l)}insertNewStyleBlock(t,e,r){const i=this.get2DCursorLocation(e,!0),s=[0];let o,l=0;for(let h=0;h<t.length;h++)t[h]===`
`?(l++,s[l]=0):s[l]++;for(s[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,s[0],r),r=r&&r.slice(s[0]+1)),l&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+s[0],l),o=1;o<l;o++)s[o]>0?this.insertCharStyleObject(i.lineIndex+o,0,s[o],r):r&&this.styles[i.lineIndex+o]&&r[0]&&(this.styles[i.lineIndex+o][0]=r[0]),r=r&&r.slice(s[o]+1);s[o]>0&&this.insertCharStyleObject(i.lineIndex+o,0,s[o],r)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:r;i>r&&this.removeStyleFromTo(r,i);const s=this.graphemeSplit(t);this.insertNewStyleBlock(s,r,e),this._text=[...this._text.slice(0,r),...s,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,r){r<=t?(e===t?this._selectionDirection=Ot:this._selectionDirection===Vt&&(this._selectionDirection=Ot,this.selectionEnd=t),this.selectionStart=r):r>t&&r<e?this._selectionDirection===Vt?this.selectionEnd=r:this.selectionStart=r:(e===t?this._selectionDirection=Vt:this._selectionDirection===Ot&&(this._selectionDirection=Vt,this.selectionStart=e),this.selectionEnd=r)}}class ug extends hg{initHiddenTextarea(){const t=this.canvas&&Be(this.canvas.getElement())||ii(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[l,h]=o;return e.setAttribute(l,h)});const{top:r,left:i,fontSize:s}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(r,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(s,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[l,h]=o;return e.addEventListener(l,this[h].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(hs),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void r();const i=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,s=this._text.length,o=i.length,l=this.selectionStart,h=this.selectionEnd,u=l!==h;let p,y,b,_,w=o-s;const S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),F=l>S.selectionStart;u?(y=this._text.slice(l,h),w+=h-l):o<s&&(y=F?this._text.slice(h+w,h):this._text.slice(l,l-w));const M=i.slice(S.selectionEnd-w,S.selectionEnd);if(y&&y.length&&(M.length&&(p=this.getSelectionStyles(l,l+1,!1),p=M.map(()=>p[0])),u?(b=l,_=h):F?(b=h-y.length,_=h):(b=h,_=h+y.length),this.removeStyleFromTo(b,_)),M.length){const{copyPasteData:X}=Xe();e&&M.join("")===X.copiedText&&!Ct.disableStyleCopyPaste&&(p=X.copiedTextStyle),this.insertNewStyleBlock(M,l,p)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:r,selectionEnd:i}=e;this.compositionStart=r,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=Xe();t.copiedText=this.getSelectedText(),Ct.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let r,i=this._getLineLeftOffset(t);return e>0&&(r=this.__charBounds[t][e-1],i+=r.left+r.width),i}getDownCursorOffset(t,e){const r=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(r),s=i.lineIndex;if(s===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-r;const o=i.charIndex,l=this._getWidthBeforeCursor(s,o),h=this._getIndexOnLine(s+1,l);return this._textLines[s].slice(o).length+h+1+this.missingNewlineOffset(s)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const r=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(r),s=i.lineIndex;if(s===0||t.metaKey||t.keyCode===33)return-r;const o=i.charIndex,l=this._getWidthBeforeCursor(s,o),h=this._getIndexOnLine(s-1,l),u=this._textLines[s].slice(0,o),p=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+h-u.length+(1-p)}_getIndexOnLine(t,e){const r=this._textLines[t];let i,s,o=this._getLineLeftOffset(t),l=0;for(let h=0,u=r.length;h<u;h++)if(i=this.__charBounds[t][h].width,o+=i,o>e){s=!0;const p=o-i,y=o,b=Math.abs(p-e);l=Math.abs(y-e)<b?h:h-1;break}return s||(l=r.length-1),l}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const r=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===Vt);if(e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),r!==0){const i=this.text.length;this.selectionStart=Jr(0,this.selectionStart,i),this.selectionEnd=Jr(0,this.selectionEnd,i),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===Ot?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,r){let i;if(t.altKey)i=this["findWordBoundary".concat(r)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=r==="Left"?-1:1,!0;i=this["findLineBoundary".concat(r)](this[e])}return i!==void 0&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=Ot,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===Vt&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=Ot,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const r="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[r](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===Ot&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Vt,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=Vt,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const Co=n=>!!n.button;class dg extends ug{constructor(){super(...arguments),D(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new cg(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;const e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),Eo(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;this.canvas&&this.editable&&!Co(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){let{e}=t;this.canvas&&this.editable&&!Co(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:r}=t;const i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const s=this.canvas._activeObject;if(s&&s!==this)return}!this.editable||this.group&&!this.group.interactive||r&&r.actionPerformed||Co(e)||i||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),r=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(r,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(ye(this.calcTransformMatrix())).add(new L(-this._getLeftOffset(),-this._getTopOffset()));let r=0,i=0,s=0;for(let u=0;u<this._textLines.length&&r<=e.y;u++)r+=this.getHeightOfLine(u),s=u,u>0&&(i+=this._textLines[u-1].length+this.missingNewlineOffset(u-1));let o=Math.abs(this._getLineLeftOffset(s));const l=this._textLines[s].length,h=this.__charBounds[s];for(let u=0;u<l;u++){const p=o+h[u].kernedWidth;if(e.x<=p){Math.abs(e.x-p)<=Math.abs(e.x-o)&&i++;break}o=p,i++}return Math.min(this.flipX?l-i:i,this._text.length)}}const Kn="moveCursorUp",Zn="moveCursorDown",Jn="moveCursorLeft",Qn="moveCursorRight",ts="exitEditing",fg=A({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:ts,27:ts,33:Kn,34:Zn,35:Qn,36:Jn,37:Jn,38:Kn,39:Qn,40:Zn},keysMapRtl:{9:ts,27:ts,33:Kn,34:Zn,35:Jn,36:Qn,37:Qn,38:Kn,39:Jn,40:Zn},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class lr extends dg{static getDefaults(){return A(A({},super.getDefaults()),lr.ownDefaults)}get type(){const t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,A(A({},lr.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof _s&&this.canvas.textEditingManager.remove(this),e instanceof _s&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,r=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,r)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,r)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const r=super.toCanvasElement(t);return this.isEditing=e,r}renderCursorOrSelection(){if(!this.isEditing)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries();this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(t,e):this.renderCursor(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const r=this._getLeftOffset(),i=this._getTopOffset(),s=this._getCursorBoundariesOffsets(t,e);return{left:r,top:i,leftOffset:s.left,topOffset:s.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,r=0;const{charIndex:i,lineIndex:s}=this.get2DCursorLocation(t);for(let u=0;u<s;u++)e+=this.getHeightOfLine(u);const o=this._getLineLeftOffset(s),l=this.__charBounds[s][i];l&&(r=l.left),this.charSpacing!==0&&i===this._textLines[s].length&&(r-=this._getWidthOfCharSpacing());const h={top:e,left:o+(r>0?r:0)};return this.direction==="rtl"&&(this.textAlign===Vt||this.textAlign===sr||this.textAlign===xn?h.left*=-1:this.textAlign===Ot||this.textAlign===Cs?h.left=o-(r>0?r:0):this.textAlign!==ut&&this.textAlign!==bn||(h.left=o-(r>0?r:0))),h}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(t);const r=this.get2DCursorLocation(t),i=r.lineIndex,s=r.charIndex>0?r.charIndex-1:0,o=this.getValueOfPropertyAt(i,s,"fontSize"),l=this.getObjectScaling().x*this.canvas.getZoom(),h=this.cursorWidth/l,u=this.getValueOfPropertyAt(i,s,"deltaY"),p=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(i,s,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-h/2,top:p+e.top+u,width:h,height:o}}_renderCursor(t,e,r){const{color:i,opacity:s,left:o,top:l,width:h,height:u}=this.getCursorRenderingData(r,e);t.fillStyle=i,t.globalAlpha=s,t.fillRect(o,l,h,u)}renderSelection(t,e){const r={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,r,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,r){const i=e.selectionStart,s=e.selectionEnd,o=this.textAlign.includes(sr),l=this.get2DCursorLocation(i),h=this.get2DCursorLocation(s),u=l.lineIndex,p=h.lineIndex,y=l.charIndex<0?0:l.charIndex,b=h.charIndex<0?0:h.charIndex;for(let _=u;_<=p;_++){const w=this._getLineLeftOffset(_)||0;let S=this.getHeightOfLine(_),F=0,M=0,X=0;if(_===u&&(M=this.__charBounds[u][y].left),_>=u&&_<p)X=o&&!this.isEndOfWrapping(_)?this.width:this.getLineWidth(_)||5;else if(_===p)if(b===0)X=this.__charBounds[p][b].left;else{const f=this._getWidthOfCharSpacing();X=this.__charBounds[p][b-1].left+this.__charBounds[p][b-1].width-f}F=S,(this.lineHeight<1||_===p&&this.lineHeight>1)&&(S/=this.lineHeight);let q=r.left+w+M,K=S,et=0;const ct=X-M;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",K=1,et=S):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Vt||this.textAlign===sr||this.textAlign===xn?q=this.width-q-ct:this.textAlign===Ot||this.textAlign===Cs?q=r.left+w-X:this.textAlign!==ut&&this.textAlign!==bn||(q=r.left+w-X)),t.fillRect(q,r.top+r.topOffset+et,ct,K),r.topOffset+=F}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,zt)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}D(lr,"ownDefaults",fg),D(lr,"type","IText"),tt.setClass(lr),tt.setClass(lr,"i-text");class He extends lr{static getDefaults(){return A(A({},super.getDefaults()),He.ownDefaults)}constructor(t,e){super(t,A(A({},He.ownDefaults),e))}static createControls(){return{controls:$c()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(sr)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,r=0,i=0;const s={};for(let o=0;o<t.graphemeLines.length;o++)t.graphemeText[i]===`
`&&o>0?(r=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&o>0&&(r++,i++),s[o]={line:e,offset:r},i+=t.graphemeLines[o].length,r+=t.graphemeLines[o].length;return s}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const r=this._styleMap[e];r&&(e=r.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,r=0,i=t+1,s=!1;const o=this._styleMap[t],l=this._styleMap[t+1];o&&(t=o.line,r=o.offset),l&&(i=l.line,s=i===t,e=l.offset);const h=t===void 0?this.styles:{line:this.styles[t]};for(const u in h)for(const p in h[u]){const y=parseInt(p,10);if(y>=r&&(!s||y<e))for(const b in h[u][p])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const r=this._styleMap[t];if(!r)return{};t=r.line,e=r.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,r){const i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,r)}_deleteStyleDeclaration(t,e){const r=this._styleMap[t];super._deleteStyleDeclaration(r.line,r.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const r=this.getGraphemeDataForRender(t),i=[];for(let s=0;s<r.wordsData.length;s++)i.push(...this._wrapLine(s,e,r));return this.isWrapping=!1,i}getGraphemeDataForRender(t){const e=this.splitByGrapheme,r=e?"":" ";let i=0;return{wordsData:t.map((s,o)=>{let l=0;const h=e?this.graphemeSplit(s):this.wordSplit(s);return h.length===0?[{word:[],width:0}]:h.map(u=>{const p=e?[u]:this.graphemeSplit(u),y=this._measureWord(p,o,l);return i=Math.max(y,i),l+=p.length+r.length,{word:p,width:y}})}),largestWordWidth:i}}_measureWord(t,e){let r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=0;for(let o=0,l=t.length;o<l;o++)s+=this._getGraphemeBox(t[o],e,o+i,r,!0).kernedWidth,r=t[o];return s}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,r){let{largestWordWidth:i,wordsData:s}=r,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const l=this._getWidthOfCharSpacing(),h=this.splitByGrapheme,u=[],p=h?"":" ";let y=0,b=[],_=0,w=0,S=!0;e-=o;const F=Math.max(e,i,this.dynamicMinWidth),M=s[t];let X;for(_=0,X=0;X<M.length;X++){const{word:q,width:K}=M[X];_+=q.length,y+=w+K-l,y>F&&!S?(u.push(b),b=[],y=K,S=!0):y+=l,S||h||b.push(p),b=b.concat(q),w=h?0:this._measureWord([p],t,_),_++,S=!1}return X&&u.push(b),i+o>this.dynamicMinWidth&&(this.dynamicMinWidth=i-l+o),u}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),r=this._wrapText(e.lines,this.width),i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=r[s].join("");return e.lines=i,e.graphemeLines=r,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const r=parseInt(e,10);if(this._textLines[r]){const i=this._styleMap[e].line;t.set("".concat(i),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}D(He,"type","Textbox"),D(He,"textLayoutProperties",[...lr.textLayoutProperties,"width"]),D(He,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),tt.setClass(He);class Xo extends Ln{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:r}=t,{clipPath:i,group:s}=r;if(!i||!this.shouldPerformLayout(t))return;const{width:o,height:l}=cr(oh(r,i)),h=new L(o,l);if(i.absolutePositioned)return{center:xr(i.getRelativeCenterPoint(),void 0,s?s.calcTransformMatrix():void 0),size:h};{const u=i.getRelativeCenterPoint().transform(r.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:p=new L,correction:y=new L}=this.calcBoundingBox(e,t)||{};return{center:p.add(u),correction:y.subtract(u),size:h}}return{center:r.getRelativeCenterPoint().add(u),size:h}}}}D(Xo,"type","clip-path"),tt.setClass(Xo);class Ss extends Ln{getInitialSize(t,e){let{target:r}=t,{size:i}=e;return new L(r.width||i.x,r.height||i.y)}}D(Ss,"type","fixed"),tt.setClass(Ss);class gg extends Qr{subscribeTargets(t){const e=t.target;t.targets.reduce((r,i)=>(i.parent&&r.add(i.parent),r),new Set).forEach(r=>{r.layoutManager.subscribeTargets({target:r,targets:[e]})})}unsubscribeTargets(t){const e=t.target,r=e.getObjects();t.targets.reduce((i,s)=>(s.parent&&i.add(s.parent),i),new Set).forEach(i=>{!r.some(s=>s.parent===i)&&i.layoutManager.unsubscribeTargets({target:i,targets:[e]})})}}class Ar extends $t{static getDefaults(){return A(A({},super.getDefaults()),Ar.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Ar.ownDefaults),this.setOptions(e);const{left:r,top:i,layoutManager:s}=e;this.groupInit(t,{left:r,top:i,layoutManager:s??new gg})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(i=>{const s=this._objects.findIndex(l=>l.isInFrontOf(i)),o=s===-1?this.size():s;this.insertAt(o,i)})}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(br("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const r=new Set;e.forEach(i=>{const{parent:s}=i;s&&r.add(s)}),t===Sa?r.forEach(i=>{i._onAfterObjectsChange(vs,e)}):r.forEach(i=>{i._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,r){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const i=A(A({hasControls:!1},r),{},{forActiveSelection:!0});for(let s=0;s<this._objects.length;s++)this._objects[s]._renderControls(t,i);super._renderControls(t,e),t.restore()}}D(Ar,"type","ActiveSelection"),D(Ar,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),tt.setClass(Ar),tt.setClass(Ar,"activeSelection");class Lh{constructor(){D(this,"resources",{})}applyFilters(t,e,r,i,s){const o=s.getContext("2d");if(!o)return;o.drawImage(e,0,0,r,i);const l={sourceWidth:r,sourceHeight:i,imageData:o.getImageData(0,0,r,i),originalEl:e,originalImageData:o.getImageData(0,0,r,i),canvasEl:s,ctx:o,filterBackend:this};t.forEach(u=>{u.applyTo(l)});const{imageData:h}=l;return h.width===r&&h.height===i||(s.width=h.width,s.height=h.height),o.putImageData(h,0,0),l}}class Dn{constructor(){let{tileSize:t=Ct.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};D(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),D(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const r=Me({width:t,height:e}),i=r.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)}applyFilters(t,e,r,i,s,o){const l=this.gl,h=s.getContext("2d");if(!l||!h)return;let u;o&&(u=this.getCachedTexture(o,e));const p={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:r,sourceHeight:i,destinationWidth:r,destinationHeight:i,context:l,sourceTexture:this.createTexture(l,r,i,u?void 0:e),targetTexture:this.createTexture(l,r,i),originalTexture:u||this.createTexture(l,r,i,u?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},y=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,y),t.forEach(b=>{b&&b.applyTo(p)}),function(b){const _=b.targetCanvas,w=_.width,S=_.height,F=b.destinationWidth,M=b.destinationHeight;w===F&&S===M||(_.width=F,_.height=M)}(p),this.copyGLTo2D(l,p),l.bindTexture(l.TEXTURE_2D,null),l.deleteTexture(p.sourceTexture),l.deleteTexture(p.targetTexture),l.deleteFramebuffer(y),h.setTransform(1,0,0,1,0,0),p}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,r,i,s){const{NEAREST:o,TEXTURE_2D:l,RGBA:h,UNSIGNED_BYTE:u,CLAMP_TO_EDGE:p,TEXTURE_MAG_FILTER:y,TEXTURE_MIN_FILTER:b,TEXTURE_WRAP_S:_,TEXTURE_WRAP_T:w}=t,S=t.createTexture();return t.bindTexture(l,S),t.texParameteri(l,y,s||o),t.texParameteri(l,b,s||o),t.texParameteri(l,_,p),t.texParameteri(l,w,p),i?t.texImage2D(l,0,h,h,u,i):t.texImage2D(l,0,h,e,r,0,h,u,null),S}getCachedTexture(t,e,r){const{textureCache:i}=this;if(i[t])return i[t];{const s=this.createTexture(this.gl,e.width,e.height,e,r);return s&&(i[t]=s),s}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const r=t.canvas,i=e.targetCanvas,s=i.getContext("2d");if(!s)return;s.translate(0,i.height),s.scale(1,-1);const o=r.height-i.height;s.drawImage(r,0,o,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){const r=e.targetCanvas.getContext("2d"),i=e.destinationWidth,s=e.destinationHeight,o=i*s*4;if(!r)return;const l=new Uint8Array(this.imageBuffer,0,o),h=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,i,s,t.RGBA,t.UNSIGNED_BYTE,l);const u=new ImageData(h,i,s);r.putImageData(u,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const r=t.getExtension("WEBGL_debug_renderer_info");if(r){const i=t.getParameter(r.UNMASKED_RENDERER_WEBGL),s=t.getParameter(r.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),s&&(e.vendor=s.toLowerCase())}return this.gpuInfo=e,e}}let os;function Ih(){const{WebGLProbe:n}=Xe();return n.queryWebGL(we()),Ct.enableGLFiltering&&n.isSupported(Ct.textureSize)?new Dn({tileSize:Ct.textureSize}):new Lh}function as(){return!os&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(os=Ih()),os}function pg(n){os=n}const mg=["filters","resizeFilter","src","crossOrigin","type"],Rh=["cropX","cropY"];class ee extends At{static getDefaults(){return A(A({},super.getDefaults()),ee.ownDefaults)}constructor(t,e){super(),D(this,"_lastScaleX",1),D(this,"_lastScaleY",1),D(this,"_filterScalingX",1),D(this,"_filterScalingY",1),this.filters=[],Object.assign(this,ee.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Pr()),this.setElement(typeof t=="string"?(this.canvas&&Be(this.canvas.getElement())||ii()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(r),(e=t.classList)===null||e===void 0||e.add(ee.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=as(!1);e instanceof Dn&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{const e=this[t];e&&Xe().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,-r),t.lineTo(e,-r),t.lineTo(e,r),t.lineTo(-e,r),t.lineTo(-e,-r),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach(r=>{r&&e.push(r.toObject())}),A(A({},super.toObject([...Rh,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,r=-this.width/2,i=-this.height/2;let s=[],o=[],l="",h="";if(!e)return[];if(this.hasCrop()){const u=Pr();s.push('<clipPath id="imageCrop_'+u+`">
`,'	<rect x="'+r+'" y="'+i+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),l=' clip-path="url(#imageCrop_'+u+')" '}if(this.imageSmoothing||(h=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(r-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(h).concat(l,`></image>
`)),this.stroke||this.strokeDashArray){const u=this.fill;this.fill=null,o=['	<rect x="'.concat(r,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=u}return s=this.paintFirst!==zt?s.concat(o,t):s.concat(t,o),s}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return vn(t,{crossOrigin:e,signal:r}).then(i=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(i)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),i=r.x,s=r.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&s>e)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=s);const l=Me(o),{width:h,height:u}=o;this._element=l,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=s,as().applyFilters([t],o,h,u,this._element),this._filterScalingX=l.width/this._originalElement.width,this._filterScalingY=l.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(s=>s&&!s.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,r=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){const s=Me({width:r,height:i});this._element=s,this._filteredEl=s}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,i),this._lastScaleX=1,this._lastScaleY=1);as().applyFilters(t,this._originalElement,r,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const r=this._filterScalingX,i=this._filterScalingY,s=this.width,o=this.height,l=Math.max(this.cropX,0),h=Math.max(this.cropY,0),u=e.naturalWidth||e.width,p=e.naturalHeight||e.height,y=l*r,b=h*i,_=Math.min(s*r,u-y),w=Math.min(o*i,p-b),S=-s/2,F=-o/2,M=Math.min(s,u/r-l),X=Math.min(o,p/i-h);e&&t.drawImage(e,y,b,_,w,S,F,M,X)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.getOriginalSize();this.width=t||r.width,this.height=e||r.height}parsePreserveAspectRatioAttribute(){const t=ua(this.preserveAspectRatio||""),e=this.width,r=this.height,i={width:e,height:r};let s,o=this._element.width,l=this._element.height,h=1,u=1,p=0,y=0,b=0,_=0;return!t||t.alignX===he&&t.alignY===he?(h=e/o,u=r/l):(t.meetOrSlice==="meet"&&(h=u=lh(this._element,i),s=(e-o*h)/2,t.alignX==="Min"&&(p=-s),t.alignX==="Max"&&(p=s),s=(r-l*u)/2,t.alignY==="Min"&&(y=-s),t.alignY==="Max"&&(y=s)),t.meetOrSlice==="slice"&&(h=u=ch(this._element,i),s=o-e/h,t.alignX==="Mid"&&(b=s/2),t.alignX==="Max"&&(b=s),s=l-r/u,t.alignY==="Mid"&&(_=s/2),t.alignY==="Max"&&(_=s),o=e/h,l=r/u)),{width:o,height:l,scaleX:h,scaleY:u,offsetLeft:p,offsetTop:y,cropX:b,cropY:_}}static fromObject(t,e){let{filters:r,resizeFilter:i,src:s,crossOrigin:o,type:l}=t,h=Lt(t,mg);return Promise.all([vn(s,A(A({},e),{},{crossOrigin:o})),r&&ki(r,e),i&&ki([i],e),jn(h,e)]).then(u=>{let[p,y=[],[b]=[],_={}]=u;return new this(p,A(A({},h),{},{src:s,filters:y,resizeFilter:b},_))})}static fromURL(t){let{crossOrigin:e=null,signal:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return vn(t,{crossOrigin:e,signal:r}).then(s=>new this(s,i))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const i=ur(t,this.ATTRIBUTE_NAMES,r);return this.fromURL(i["xlink:href"],e,i).catch(s=>(br("log","Unable to parse Image",s),null))}}function So(n){if(!Rd.test(n.nodeName))return{};const t=n.getAttribute("viewBox");let e,r,i=1,s=1,o=0,l=0;const h=n.getAttribute("width"),u=n.getAttribute("height"),p=n.getAttribute("x")||0,y=n.getAttribute("y")||0,b=!(t&&Al.test(t)),_=!h||!u||h==="100%"||u==="100%";let w="",S=0,F=0;if(b&&(p||y)&&n.parentNode&&n.parentNode.nodeName!=="#document"&&(w=" translate("+oe(p||"0")+" "+oe(y||"0")+") ",e=(n.getAttribute("transform")||"")+w,n.setAttribute("transform",e),n.removeAttribute("x"),n.removeAttribute("y")),b&&_)return{width:0,height:0};const M={width:0,height:0};if(b)return M.width=oe(h),M.height=oe(u),M;const X=t.match(Al);o=-parseFloat(X[1]),l=-parseFloat(X[2]);const q=parseFloat(X[3]),K=parseFloat(X[4]);M.minX=o,M.minY=l,M.viewBoxWidth=q,M.viewBoxHeight=K,_?(M.width=q,M.height=K):(M.width=oe(h),M.height=oe(u),i=M.width/q,s=M.height/K);const et=ua(n.getAttribute("preserveAspectRatio")||"");if(et.alignX!==he&&(et.meetOrSlice==="meet"&&(s=i=i>s?s:i),et.meetOrSlice==="slice"&&(s=i=i>s?i:s),S=M.width-q*i,F=M.height-K*i,et.alignX==="Mid"&&(S/=2),et.alignY==="Mid"&&(F/=2),et.alignX==="Min"&&(S=0),et.alignY==="Min"&&(F=0)),i===1&&s===1&&o===0&&l===0&&p===0&&y===0)return M;if((p||y)&&n.parentNode.nodeName!=="#document"&&(w=" translate("+oe(p||"0")+" "+oe(y||"0")+") "),e=w+" matrix("+i+" 0 0 "+s+" "+(o*i+S)+" "+(l*s+F)+") ",n.nodeName==="svg"){for(r=n.ownerDocument.createElementNS(Mo,"g");n.firstChild;)r.appendChild(n.firstChild);n.appendChild(r)}else r=n,r.removeAttribute("x"),r.removeAttribute("y"),e=r.getAttribute("transform")+e;return r.setAttribute("transform",e),M}D(ee,"type","Image"),D(ee,"cacheProperties",[..._r,...Rh]),D(ee,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),D(ee,"CSS_CANVAS","canvas-img"),D(ee,"ATTRIBUTE_NAMES",[...Lr,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),tt.setClass(ee),tt.setSVGClass(ee);const Ts=n=>n.tagName.replace("svg:",""),vg=Is(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function Bh(n,t){let e,r,i,s,o=[];for(i=0,s=t.length;i<s;i++)e=t[i],r=n.getElementsByTagNameNS("http://www.w3.org/2000/svg",e),o=o.concat(Array.from(r));return o}const yg=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],To="xlink:href";function Wh(n,t){var e;const r=((e=t.getAttribute(To))===null||e===void 0?void 0:e.slice(1))||"",i=n.getElementById(r);if(i&&i.getAttribute(To)&&Wh(n,i),i&&(yg.forEach(s=>{const o=i.getAttribute(s);!t.hasAttribute(s)&&o&&t.setAttribute(s,o)}),!t.children.length)){const s=i.cloneNode(!0);for(;s.firstChild;)t.appendChild(s.firstChild)}t.removeAttribute(To)}const xg=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function Hh(n){const t=n.getElementsByTagName("style");let e,r;const i={};for(e=0,r=t.length;e<r;e++){const s=(t[e].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");s.trim()!==""&&s.split("}").filter((o,l,h)=>h.length>1&&o.trim()).forEach(o=>{if((o.match(/{/g)||[]).length>1&&o.trim().startsWith("@"))return;const l=o.split("{"),h={},u=l[1].trim().split(";").filter(function(p){return p.trim()});for(e=0,r=u.length;e<r;e++){const p=u[e].split(":"),y=p[0].trim(),b=p[1].trim();h[y]=b}(o=l[0].trim()).split(",").forEach(p=>{(p=p.replace(/^svg/i,"").trim())!==""&&(i[p]=A(A({},i[p]||{}),h))})})}return i}const ql=n=>tt.getSVGClass(Ts(n).toLowerCase());class bg{constructor(t,e,r,i,s){this.elements=t,this.options=e,this.reviver=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i,this.clipPaths=s,this.gradientDefs=function(o){const l=Bh(o,xg),h={};let u=l.length;for(;u--;){const p=l[u];p.getAttribute("xlink:href")&&Wh(o,p);const y=p.getAttribute("id");y&&(h[y]=p)}return h}(i),this.cssRules=Hh(i)}parse(){return Promise.all(this.elements.map(t=>this.createObject(t)))}async createObject(t){const e=ql(t);if(e){const r=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(r,t,zt),this.resolveGradient(r,t,ue),r instanceof ee&&r._originalElement?ss(r,r.parsePreserveAspectRatioAttribute()):ss(r),await this.resolveClipPath(r,t),this.reviver&&this.reviver(t,r),r}return null}extractPropertyDefinition(t,e,r){const i=t[e],s=this.regexUrl;if(!s.test(i))return;s.lastIndex=0;const o=s.exec(i)[1];return s.lastIndex=0,r[o]}resolveGradient(t,e,r){const i=this.extractPropertyDefinition(t,r,this.gradientDefs);if(i){const s=e.getAttribute(r+"-opacity"),o=_i.fromElement(i,t,A(A({},this.options),{},{opacity:s}));t.set(r,o)}}async resolveClipPath(t,e,r){const i=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(i){const s=ye(t.calcTransformMatrix()),o=i[0].parentElement;let l=e;for(;!r&&l.parentElement&&l.getAttribute("clip-path")!==t.clipPath;)l=l.parentElement;l.parentElement.appendChild(o);const h=kn("".concat(l.getAttribute("transform")||""," ").concat(o.getAttribute("originalTransform")||""));o.setAttribute("transform","matrix(".concat(h.join(","),")"));const u=await Promise.all(i.map(X=>ql(X).fromElement(X,this.options,this.cssRules).then(q=>(ss(q),q.fillRule=q.clipRule,delete q.clipRule,q)))),p=u.length===1?u[0]:new $t(u),y=Bt(s,p.calcTransformMatrix());p.clipPath&&await this.resolveClipPath(p,l,o.getAttribute("clip-path")?l:void 0);const{scaleX:b,scaleY:_,angle:w,skewX:S,translateX:F,translateY:M}=Zr(y);p.set({flipX:!1,flipY:!1}),p.set({scaleX:b,scaleY:_,angle:w,skewX:S,skewY:0}),p.setPositionByOrigin(new L(F,M),ut,ut),t.clipPath=p}else delete t.clipPath}}const Ul=n=>Id.test(Ts(n)),Vo=()=>({objects:[],elements:[],options:{},allElements:[]});async function ka(n,t){let{crossOrigin:e,signal:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r&&r.aborted)return br("log",new Qo("parseSVGDocument")),Vo();const i=n.documentElement;(function(p){const y=Bh(p,["use","svg:use"]),b=["x","y","xlink:href","href","transform"];for(const _ of y){const w=_.attributes,S={};for(const Z of w)Z.value&&(S[Z.name]=Z.value);const F=(S["xlink:href"]||S.href||"").slice(1);if(F==="")return;const M=p.getElementById(F);if(M===null)return;let X=M.cloneNode(!0);const q=X.attributes,K={};for(const Z of q)Z.value&&(K[Z.name]=Z.value);const{x:et=0,y:ct=0,transform:f=""}=S,it="".concat(f," ").concat(K.transform||""," translate(").concat(et,", ").concat(ct,")");if(So(X),/^svg$/i.test(X.nodeName)){const Z=X.ownerDocument.createElementNS(Mo,"g");Object.entries(K).forEach(vt=>{let[kt,Tt]=vt;return Z.setAttributeNS(Mo,kt,Tt)}),Z.append(...X.childNodes),X=Z}for(const Z of w){if(!Z)continue;const{name:vt,value:kt}=Z;if(!b.includes(vt))if(vt==="style"){const Tt={};Bo(kt,Tt),Object.entries(K).forEach(yt=>{let[Xt,Y]=yt;Tt[Xt]=Y}),Bo(K.style||"",Tt);const nt=Object.entries(Tt).map(yt=>yt.join(":")).join(";");X.setAttribute(vt,nt)}else!K[vt]&&X.setAttribute(vt,kt)}X.setAttribute("transform",it),X.setAttribute("instantiated_by_use","1"),X.removeAttribute("id"),_.parentNode.replaceChild(X,_)}})(n);const s=Array.from(i.getElementsByTagName("*")),o=A(A({},So(i)),{},{crossOrigin:e,signal:r}),l=s.filter(p=>(So(p),Ul(p)&&!function(y){let b=y;for(;b&&(b=b.parentElement);)if(b&&b.nodeName&&vg.test(Ts(b))&&!b.getAttribute("instantiated_by_use"))return!0;return!1}(p)));if(!l||l&&!l.length)return A(A({},Vo()),{},{options:o,allElements:s});const h={};return s.filter(p=>Ts(p)==="clipPath").forEach(p=>{p.setAttribute("originalTransform",p.getAttribute("transform")||"");const y=p.getAttribute("id");h[y]=Array.from(p.getElementsByTagName("*")).filter(b=>Ul(b))}),{objects:await new bg(l,o,t,n,h).parse(),elements:l,options:o,allElements:s}}function wg(n,t,e){return ka(new(ar()).DOMParser().parseFromString(n.trim(),"text/xml"),t,e)}function Nh(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((r,i)=>{yh(n.replace(/^\n\s*/,"").trim(),{onComplete:s=>{const o=s.responseXML;o&&r(o),i()},signal:e.signal})}).then(r=>ka(r,t,e)).catch(()=>Vo())}const Xh=uc,$l=n=>function(t,e,r){const{points:i,pathOffset:s}=r;return new L(i[n]).subtract(s).transform(Bt(r.getViewportTransform(),r.calcTransformMatrix()))},Vh=(n,t,e,r)=>{const{target:i,pointIndex:s}=t,o=i,l=xr(new L(e,r),void 0,o.calcOwnMatrix());return o.points[s]=l.add(o.pathOffset),o.setDimensions(),!0},Yh=(n,t)=>function(e,r,i,s){const o=r.target,l=new L(o.points[(n>0?n:o.points.length)-1]),h=l.subtract(o.pathOffset).transform(o.calcOwnMatrix()),u=t(e,A(A({},r),{},{pointIndex:n}),i,s),p=l.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(h);return o.left-=p.x,o.top-=p.y,u},Kl=n=>Fr(Xh,Yh(n,Vh)),Yo=(n,t,e)=>{const{path:r,pathOffset:i}=n,s=r[t];return new L(s[e]-i.x,s[e+1]-i.y).transform(Bt(n.getViewportTransform(),n.calcTransformMatrix()))};function _g(n,t,e){const{commandIndex:r,pointIndex:i}=this;return Yo(e,r,i)}function Cg(n,t,e,r){const{target:i}=t,{commandIndex:s,pointIndex:o}=this,l=((h,u,p,y,b)=>{const{path:_,pathOffset:w}=h,S=_[(y>0?y:_.length)-1],F=new L(S[b],S[b+1]),M=F.subtract(w).transform(h.calcOwnMatrix()),X=xr(new L(u,p),void 0,h.calcOwnMatrix());_[y][b]=X.x+w.x,_[y][b+1]=X.y+w.y,h.setDimensions();const q=F.subtract(h.pathOffset).transform(h.calcOwnMatrix()).subtract(M);return h.left-=q.x,h.top-=q.y,h.set("dirty",!0),!0})(i,e,r,s,o);return ga(this.actionName,A(A({},pa(n,t,e,r)),{},{commandIndex:s,pointIndex:o})),l}class zh extends ve{constructor(t){super(t)}render(t,e,r,i,s){const o=A(A({},i),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,r,o,s)}}class Sg extends zh{constructor(t){super(t)}render(t,e,r,i,s){const{path:o}=s,{commandIndex:l,pointIndex:h,connectToCommandIndex:u,connectToPointIndex:p}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[y]=o[l],b=Yo(s,u,p);if(y==="Q"){const _=Yo(s,l,h+2);t.moveTo(_.x,_.y),t.lineTo(e,r)}else t.moveTo(e,r);t.lineTo(b.x,b.y),t.stroke(),t.restore(),super.render(t,e,r,i,s)}}const es=(n,t,e,r,i,s)=>new(e?Sg:zh)(A(A({commandIndex:n,pointIndex:t,actionName:"modifyPath",positionHandler:_g,actionHandler:Cg,connectToCommandIndex:i,connectToPointIndex:s},r),e?r.controlPointStyle:r.pointStyle));var Tg=Object.freeze({__proto__:null,changeWidth:Lo,createObjectDefaultControls:wa,createPathControls:function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={};let r="M";return n.path.forEach((i,s)=>{const o=i[0];switch(o!=="Z"&&(e["c_".concat(s,"_").concat(o)]=es(s,i.length-2,!1,t)),o){case"C":e["c_".concat(s,"_C_CP_1")]=es(s,1,!0,t,s-1,(l=>l==="C"?5:l==="Q"?3:1)(r)),e["c_".concat(s,"_C_CP_2")]=es(s,3,!0,t,s,5);break;case"Q":e["c_".concat(s,"_Q_CP_1")]=es(s,1,!0,t,s,3)}r=o}),e},createPolyActionHandler:Kl,createPolyControls:function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={};for(let r=0;r<(typeof n=="number"?n:n.points.length);r++)e["p".concat(r)]=new ve(A({actionName:Xh,positionHandler:$l(r),actionHandler:Kl(r)},t));return e},createPolyPositionHandler:$l,createResizeControls:Uc,createTextboxDefaultControls:$c,dragHandler:Ac,factoryPolyActionHandler:Yh,getLocalPoint:Ls,polyActionHandler:Vh,renderCircleControl:Ic,renderSquareControl:Rc,rotationStyleHandler:Bc,rotationWithSnapping:Wc,scaleCursorStyleHandler:bi,scaleOrSkewActionName:Ji,scaleSkewCursorStyleHandler:zr,scalingEqually:Zi,scalingX:Xc,scalingXOrSkewingY:Io,scalingY:Vc,scalingYOrSkewingX:Ro,skewCursorStyleHandler:Yc,skewHandlerX:Gc,skewHandlerY:qc,wrapWithFireEvent:Fr,wrapWithFixedAnchor:si});const In=n=>n.webgl!==void 0,Og=(n,t)=>{const e=Me({width:n,height:t}),r=we().getContext("webgl"),i={imageBuffer:new ArrayBuffer(n*t*4)},s={destinationWidth:n,destinationHeight:t,targetCanvas:e};let o;o=ar().performance.now(),Dn.prototype.copyGLTo2D.call(i,r,s);const l=ar().performance.now()-o;return o=ar().performance.now(),Dn.prototype.copyGLTo2DPutImageData.call(i,r,s),l>ar().performance.now()-o},Da="precision highp float",kg=`
    `.concat(Da,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),Dg=["type"],Ag=["type"],Eg=new RegExp(Da,"g");class Gt{get type(){return this.constructor.type}constructor(){let t=Lt(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Dg);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return kg}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:i="highp"}}=Xe();i!=="highp"&&(e=e.replace(Eg,Da.replace("highp",i)));const s=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER),l=t.createProgram();if(!s||!o||!l)throw new or("Vertex, fragment shader or program creation error");if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new or("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new or("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.attachShader(l,s),t.attachShader(l,o),t.linkProgram(l),!t.getProgramParameter(l,t.LINK_STATUS))throw new or('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(l)));const h=this.getUniformLocations(t,l)||{};return h.uStepW=t.getUniformLocation(l,"uStepW"),h.uStepH=t.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:this.getAttributeLocations(t,l),uniformLocations:h}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const r=this.constructor.uniformLocations,i={};for(let s=0;s<r.length;s++)i[r[s]]=t.getUniformLocation(e,r[s]);return i}sendAttributeData(t,e,r){const i=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const r=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===r&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,r,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){In(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,r=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(r.program),this.sendAttributeData(e,r.attributeLocations,t.aPosition),e.uniform1f(r.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(r.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,r.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,r){t.activeTexture(r),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:r}=t,i=Me({width:e,height:r});t.helpLayer=i}}toObject(){const t=Object.keys(this.constructor.defaults||{});return A({type:this.type},t.reduce((e,r)=>(e[r]=this[r],e),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(Lt(t,Ag))}}D(Gt,"type","BaseFilter"),D(Gt,"uniformLocations",[]);const Pg={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class tn extends Gt{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(Pg[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const r=new _t(this.color).getSource(),i=this.alpha,s=r[0]*i,o=r[1]*i,l=r[2]*i,h=1-i;for(let u=0;u<e.length;u+=4){const p=e[u],y=e[u+1],b=e[u+2];let _,w,S;switch(this.mode){case"multiply":_=p*s/255,w=y*o/255,S=b*l/255;break;case"screen":_=255-(255-p)*(255-s)/255,w=255-(255-y)*(255-o)/255,S=255-(255-b)*(255-l)/255;break;case"add":_=p+s,w=y+o,S=b+l;break;case"difference":_=Math.abs(p-s),w=Math.abs(y-o),S=Math.abs(b-l);break;case"subtract":_=p-s,w=y-o,S=b-l;break;case"darken":_=Math.min(p,s),w=Math.min(y,o),S=Math.min(b,l);break;case"lighten":_=Math.max(p,s),w=Math.max(y,o),S=Math.max(b,l);break;case"overlay":_=s<128?2*p*s/255:255-2*(255-p)*(255-s)/255,w=o<128?2*y*o/255:255-2*(255-y)*(255-o)/255,S=l<128?2*b*l/255:255-2*(255-b)*(255-l)/255;break;case"exclusion":_=s+p-2*s*p/255,w=o+y-2*o*y/255,S=l+b-2*l*b/255;break;case"tint":_=s+p*h,w=o+y*h,S=l+b*h}e[u]=_,e[u+1]=w,e[u+2]=S}}sendUniformData(t,e){const r=new _t(this.color).getSource();r[0]=this.alpha*r[0]/255,r[1]=this.alpha*r[1]/255,r[2]=this.alpha*r[2]/255,r[3]=this.alpha,t.uniform4fv(e.uColor,r)}}D(tn,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),D(tn,"type","BlendColor"),D(tn,"uniformLocations",["uColor"]),tt.setClass(tn);const Mg={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},jg=["type","image"];class en extends Gt{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Mg[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(t){const e=t.context,r=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,r,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:r}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/r,1]}applyTo2d(t){let{imageData:{data:e,width:r,height:i},filterBackend:{resources:s}}=t;const o=this.image;s.blendImage||(s.blendImage=we());const l=s.blendImage,h=l.getContext("2d");l.width!==r||l.height!==i?(l.width=r,l.height=i):h.clearRect(0,0,r,i),h.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),h.drawImage(o.getElement(),0,0,r,i);const u=h.getImageData(0,0,r,i).data;for(let p=0;p<e.length;p+=4){const y=e[p],b=e[p+1],_=e[p+2],w=e[p+3],S=u[p],F=u[p+1],M=u[p+2],X=u[p+3];switch(this.mode){case"multiply":e[p]=y*S/255,e[p+1]=b*F/255,e[p+2]=_*M/255,e[p+3]=w*X/255;break;case"mask":e[p+3]=X}}}sendUniformData(t,e){const r=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,r)}toObject(){return A(A({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:r,image:i}=t,s=Lt(t,jg);return ee.fromObject(i,e).then(o=>new this(A(A({},s),{},{image:o})))}}D(en,"type","BlendImage"),D(en,"defaults",{mode:"multiply",alpha:1}),D(en,"uniformLocations",["uTransformMatrix","uImage"]),tt.setClass(en);class rn extends Gt{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(t){In(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:r,filterBackend:{resources:i}}=t;const{width:s,height:o}=r;i.blurLayer1||(i.blurLayer1=we(),i.blurLayer2=we());const l=i.blurLayer1,h=i.blurLayer2;l.width===s&&l.height===o||(h.width=l.width=s,h.height=l.height=o);const u=l.getContext("2d"),p=h.getContext("2d"),y=15,b=.06*this.blur*.5;let _,w,S,F;for(u.putImageData(r,0,0),p.clearRect(0,0,s,o),F=-15;F<=y;F++)_=(Math.random()-.5)/4,w=F/y,S=b*w*s+_,p.globalAlpha=1-Math.abs(w),p.drawImage(l,S,_),u.drawImage(h,0,0),p.globalAlpha=1,p.clearRect(0,0,h.width,h.height);for(F=-15;F<=y;F++)_=(Math.random()-.5)/4,w=F/y,S=b*w*o+_,p.globalAlpha=1-Math.abs(w),p.drawImage(l,_,S),u.drawImage(h,0,0),p.globalAlpha=1,p.clearRect(0,0,h.width,h.height);e.drawImage(l,0,0);const M=e.getImageData(0,0,l.width,l.height);return u.globalAlpha=1,u.clearRect(0,0,l.width,l.height),M}sendUniformData(t,e){const r=this.chooseRightDelta();t.uniform2fv(e.uDelta,r)}isNeutralState(){return this.blur===0}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const r=t*this.blur*.12;return this.horizontal?e[0]=r:e[1]=r,e}}D(rn,"type","Blur"),D(rn,"defaults",{blur:0}),D(rn,"uniformLocations",["uDelta"]),tt.setClass(rn);class nn extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]+=r,e[i+1]+=r,e[i+2]+=r}isNeutralState(){return this.brightness===0}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}D(nn,"type","Brightness"),D(nn,"defaults",{brightness:0}),D(nn,"uniformLocations",["uBrightness"]),tt.setClass(nn);const Gh={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class qr extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){const e=t.imageData.data,r=this.matrix,i=this.colorsOnly;for(let s=0;s<e.length;s+=4){const o=e[s],l=e[s+1],h=e[s+2];if(e[s]=o*r[0]+l*r[1]+h*r[2]+255*r[4],e[s+1]=o*r[5]+l*r[6]+h*r[7]+255*r[9],e[s+2]=o*r[10]+l*r[11]+h*r[12]+255*r[14],!i){const u=e[s+3];e[s]+=u*r[3],e[s+1]+=u*r[8],e[s+2]+=u*r[13],e[s+3]=o*r[15]+l*r[16]+h*r[17]+u*r[18]+255*r[19]}}}sendUniformData(t,e){const r=this.matrix,i=[r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]],s=[r[4],r[9],r[14],r[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,s)}toObject(){return A(A({},super.toObject()),{},{matrix:[...this.matrix]})}}function oi(n,t){var e;const r=(D(e=class extends qr{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",n),D(e,"defaults",{colorsOnly:!1,matrix:t}),e);return tt.setClass(r,n),r}D(qr,"type","ColorMatrix"),D(qr,"defaults",Gh),D(qr,"uniformLocations",["uColorMatrix","uConstants"]),tt.setClass(qr);const Fg=oi("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Lg=oi("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),Ig=oi("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),Rg=oi("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),Bg=oi("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),Wg=oi("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),Hg=oi("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class zo extends Gt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){In(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(t=>t.toObject())}}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(r=>tt.getClass(r.type).fromObject(r,e))).then(r=>new this({subFilters:r}))}}D(zo,"type","Composed"),tt.setClass(zo);class sn extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(t){let{imageData:{data:e}}=t;const r=Math.floor(255*this.contrast),i=259*(r+255)/(255*(259-r));for(let s=0;s<e.length;s+=4)e[s]=i*(e[s]-128)+128,e[s+1]=i*(e[s+1]-128)+128,e[s+2]=i*(e[s+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}D(sn,"type","Contrast"),D(sn,"defaults",{contrast:0}),D(sn,"uniformLocations",["uContrast"]),tt.setClass(sn);const Ng={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class on extends Gt{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return Ng[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,r=e.data,i=this.matrix,s=Math.round(Math.sqrt(i.length)),o=Math.floor(s/2),l=e.width,h=e.height,u=t.ctx.createImageData(l,h),p=u.data,y=this.opaque?1:0;let b,_,w,S,F,M,X,q,K,et,ct,f,it;for(ct=0;ct<h;ct++)for(et=0;et<l;et++){for(F=4*(ct*l+et),b=0,_=0,w=0,S=0,it=0;it<s;it++)for(f=0;f<s;f++)X=ct+it-o,M=et+f-o,X<0||X>=h||M<0||M>=l||(q=4*(X*l+M),K=i[it*s+f],b+=r[q]*K,_+=r[q+1]*K,w+=r[q+2]*K,y||(S+=r[q+3]*K));p[F]=b,p[F+1]=_,p[F+2]=w,p[F+3]=y?r[F+3]:S}t.imageData=u}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return A(A({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}D(on,"type","Convolute"),D(on,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),D(on,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),tt.setClass(on);const qh="Gamma";class an extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const r=this.gamma,i=1/r[0],s=1/r[1],o=1/r[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const l=this.rgbValues;for(let h=0;h<256;h++)l.r[h]=255*Math.pow(h/255,i),l.g[h]=255*Math.pow(h/255,s),l.b[h]=255*Math.pow(h/255,o);for(let h=0;h<e.length;h+=4)e[h]=l.r[e[h]],e[h+1]=l.g[e[h+1]],e[h+2]=l.b[e[h+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return t[0]===1&&t[1]===1&&t[2]===1}toObject(){return{type:qh,gamma:this.gamma.concat()}}}D(an,"type",qh),D(an,"defaults",{gamma:[1,1,1]}),D(an,"uniformLocations",["uGamma"]),tt.setClass(an);const Xg={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class ln extends Gt{applyTo2d(t){let{imageData:{data:e}}=t;for(let r,i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],l=e[i+2];switch(this.mode){case"average":r=(s+o+l)/3;break;case"lightness":r=(Math.min(s,o,l)+Math.max(s,o,l))/2;break;case"luminosity":r=.21*s+.72*o+.07*l}e[i+2]=e[i+1]=e[i]=r}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Xg[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}D(ln,"type","Grayscale"),D(ln,"defaults",{mode:"average"}),D(ln,"uniformLocations",["uMode"]),tt.setClass(ln);const Vg=A(A({},Gh),{},{rotation:0});class ls extends qr{calculateMatrix(){const t=this.rotation*Math.PI,e=Ve(t),r=Ye(t),i=1/3,s=Math.sqrt(i)*r,o=1-e;this.matrix=[e+o/3,i*o-s,i*o+s,0,0,i*o+s,e+i*o,i*o-s,0,0,i*o-s,i*o+s,e+i*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}D(ls,"type","HueRotation"),D(ls,"defaults",Vg),tt.setClass(ls);class cn extends Gt{applyTo2d(t){let{imageData:{data:e}}=t;for(let r=0;r<e.length;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2],this.alpha&&(e[r+3]=255-e[r+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}D(cn,"type","Invert"),D(cn,"defaults",{alpha:!1,invert:!0}),D(cn,"uniformLocations",["uInvert","uAlpha"]),tt.setClass(cn);class hn extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=this.noise;for(let i=0;i<e.length;i+=4){const s=(.5-Math.random())*r;e[i]+=s,e[i+1]+=s,e[i+2]+=s}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return this.noise===0}}D(hn,"type","Noise"),D(hn,"defaults",{noise:0}),D(hn,"uniformLocations",["uNoise","uSeed"]),tt.setClass(hn);class un extends Gt{applyTo2d(t){let{imageData:{data:e,width:r,height:i}}=t;for(let s=0;s<i;s+=this.blocksize)for(let o=0;o<r;o+=this.blocksize){const l=4*s*r+4*o,h=e[l],u=e[l+1],p=e[l+2],y=e[l+3];for(let b=s;b<Math.min(s+this.blocksize,i);b++)for(let _=o;_<Math.min(o+this.blocksize,r);_++){const w=4*b*r+4*_;e[w]=h,e[w+1]=u,e[w+2]=p,e[w+3]=y}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}D(un,"type","Pixelate"),D(un,"defaults",{blocksize:4}),D(un,"uniformLocations",["uBlocksize"]),tt.setClass(un);class dn extends Gt{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=255*this.distance,i=new _t(this.color).getSource(),s=[i[0]-r,i[1]-r,i[2]-r],o=[i[0]+r,i[1]+r,i[2]+r];for(let l=0;l<e.length;l+=4){const h=e[l],u=e[l+1],p=e[l+2];h>s[0]&&u>s[1]&&p>s[2]&&h<o[0]&&u<o[1]&&p<o[2]&&(e[l+3]=0)}}sendUniformData(t,e){const r=new _t(this.color).getSource(),i=this.distance,s=[0+r[0]/255-i,0+r[1]/255-i,0+r[2]/255-i,1],o=[r[0]/255+i,r[1]/255+i,r[2]/255+i,1];t.uniform4fv(e.uLow,s),t.uniform4fv(e.uHigh,o)}}D(dn,"type","RemoveColor"),D(dn,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),D(dn,"uniformLocations",["uLow","uHigh"]),tt.setClass(dn);class fn extends Gt{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,r=this.getFilterWindow(),i=new Array(r);for(let s=1;s<=r;s++)i[s-1]=t(s*e);return i}generateShader(t){const e=new Array(t);for(let r=1;r<=t;r++)e[r-1]="".concat(r,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((r,i)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(r,") * uTaps[").concat(i,"] + texture2D(uTexture, vTexCoord - ").concat(r,") * uTaps[").concat(i,`];
              sum += 2.0 * uTaps[`).concat(i,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){In(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;const r=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(r)/r}}applyTo2d(t){const e=t.imageData,r=this.scaleX,i=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/i;const s=e.width,o=e.height,l=Math.round(s*r),h=Math.round(o*i);let u;u=this.resizeType==="sliceHack"?this.sliceByTwo(t,s,o,l,h):this.resizeType==="hermite"?this.hermiteFastResize(t,s,o,l,h):this.resizeType==="bilinear"?this.bilinearFiltering(t,s,o,l,h):this.resizeType==="lanczos"?this.lanczosResize(t,s,o,l,h):new ImageData(l,h),t.imageData=u}sliceByTwo(t,e,r,i,s){const o=t.imageData,l=.5;let h=!1,u=!1,p=e*l,y=r*l;const b=t.filterBackend.resources;let _=0,w=0;const S=e;let F=0;b.sliceByTwo||(b.sliceByTwo=we());const M=b.sliceByTwo;(M.width<1.5*e||M.height<r)&&(M.width=1.5*e,M.height=r);const X=M.getContext("2d");for(X.clearRect(0,0,1.5*e,r),X.putImageData(o,0,0),i=Math.floor(i),s=Math.floor(s);!h||!u;)e=p,r=y,i<Math.floor(p*l)?p=Math.floor(p*l):(p=i,h=!0),s<Math.floor(y*l)?y=Math.floor(y*l):(y=s,u=!0),X.drawImage(M,_,w,e,r,S,F,p,y),_=S,w=F,F+=y;return X.getImageData(_,w,i,s)}lanczosResize(t,e,r,i,s){const o=t.imageData.data,l=t.ctx.createImageData(i,s),h=l.data,u=this.lanczosCreate(this.lanczosLobes),p=this.rcpScaleX,y=this.rcpScaleY,b=2/this.rcpScaleX,_=2/this.rcpScaleY,w=Math.ceil(p*this.lanczosLobes/2),S=Math.ceil(y*this.lanczosLobes/2),F={},M={x:0,y:0},X={x:0,y:0};return function q(K){let et,ct,f,it,Z,vt,kt,Tt,nt,yt,Xt;for(M.x=(K+.5)*p,X.x=Math.floor(M.x),et=0;et<s;et++){for(M.y=(et+.5)*y,X.y=Math.floor(M.y),Z=0,vt=0,kt=0,Tt=0,nt=0,ct=X.x-w;ct<=X.x+w;ct++)if(!(ct<0||ct>=e)){yt=Math.floor(1e3*Math.abs(ct-M.x)),F[yt]||(F[yt]={});for(let Y=X.y-S;Y<=X.y+S;Y++)Y<0||Y>=r||(Xt=Math.floor(1e3*Math.abs(Y-M.y)),F[yt][Xt]||(F[yt][Xt]=u(Math.sqrt(Math.pow(yt*b,2)+Math.pow(Xt*_,2))/1e3)),f=F[yt][Xt],f>0&&(it=4*(Y*e+ct),Z+=f,vt+=f*o[it],kt+=f*o[it+1],Tt+=f*o[it+2],nt+=f*o[it+3]))}it=4*(et*i+K),h[it]=vt/Z,h[it+1]=kt/Z,h[it+2]=Tt/Z,h[it+3]=nt/Z}return++K<i?q(K):l}(0)}bilinearFiltering(t,e,r,i,s){let o,l,h,u,p,y,b,_,w,S,F,M,X,q=0;const K=this.rcpScaleX,et=this.rcpScaleY,ct=4*(e-1),f=t.imageData.data,it=t.ctx.createImageData(i,s),Z=it.data;for(b=0;b<s;b++)for(_=0;_<i;_++)for(p=Math.floor(K*_),y=Math.floor(et*b),w=K*_-p,S=et*b-y,X=4*(y*e+p),F=0;F<4;F++)o=f[X+F],l=f[X+4+F],h=f[X+ct+F],u=f[X+ct+4+F],M=o*(1-w)*(1-S)+l*w*(1-S)+h*S*(1-w)+u*w*S,Z[q++]=M;return it}hermiteFastResize(t,e,r,i,s){const o=this.rcpScaleX,l=this.rcpScaleY,h=Math.ceil(o/2),u=Math.ceil(l/2),p=t.imageData.data,y=t.ctx.createImageData(i,s),b=y.data;for(let _=0;_<s;_++)for(let w=0;w<i;w++){const S=4*(w+_*i);let F=0,M=0,X=0,q=0,K=0,et=0,ct=0;const f=(_+.5)*l;for(let it=Math.floor(_*l);it<(_+1)*l;it++){const Z=Math.abs(f-(it+.5))/u,vt=(w+.5)*o,kt=Z*Z;for(let Tt=Math.floor(w*o);Tt<(w+1)*o;Tt++){let nt=Math.abs(vt-(Tt+.5))/h;const yt=Math.sqrt(kt+nt*nt);yt>1&&yt<-1||(F=2*yt*yt*yt-3*yt*yt+1,F>0&&(nt=4*(Tt+it*e),ct+=F*p[nt+3],X+=F,p[nt+3]<255&&(F=F*p[nt+3]/250),q+=F*p[nt],K+=F*p[nt+1],et+=F*p[nt+2],M+=F))}}b[S]=q/M,b[S+1]=K/M,b[S+2]=et/M,b[S+3]=ct/X}return y}}D(fn,"type","Resize"),D(fn,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),D(fn,"uniformLocations",["uDelta","uTaps"]),tt.setClass(fn);class gn extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=-this.saturation;for(let i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],l=e[i+2],h=Math.max(s,o,l);e[i]+=h!==s?(h-s)*r:0,e[i+1]+=h!==o?(h-o)*r:0,e[i+2]+=h!==l?(h-l)*r:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}D(gn,"type","Saturation"),D(gn,"defaults",{saturation:0}),D(gn,"uniformLocations",["uSaturation"]),tt.setClass(gn);class pn extends Gt{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const r=-this.vibrance;for(let i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],l=e[i+2],h=Math.max(s,o,l),u=(s+o+l)/3,p=2*Math.abs(h-u)/255*r;e[i]+=h!==s?(h-s)*p:0,e[i+1]+=h!==o?(h-o)*p:0,e[i+2]+=h!==l?(h-l)*p:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}D(pn,"type","Vibrance"),D(pn,"defaults",{vibrance:0}),D(pn,"uniformLocations",["uVibrance"]),tt.setClass(pn);var Ht=Object.freeze({__proto__:null,BaseFilter:Gt,BlackWhite:Hg,BlendColor:tn,BlendImage:en,Blur:rn,Brightness:nn,Brownie:Fg,ColorMatrix:qr,Composed:zo,Contrast:sn,Convolute:on,Gamma:an,Grayscale:ln,HueRotation:ls,Invert:cn,Kodachrome:Ig,Noise:hn,Pixelate:un,Polaroid:Bg,RemoveColor:dn,Resize:fn,Saturation:gn,Sepia:Wg,Technicolor:Rg,Vibrance:pn,Vintage:Lg});const Yg=Object.freeze(Object.defineProperty({__proto__:null,ActiveSelection:Ar,BaseBrush:Xs,BaseFabricObject:Qe,Canvas:_s,Canvas2dFilterBackend:Lh,CanvasDOMManager:xh,Circle:Ie,CircleBrush:Qf,ClipPathLayout:Xo,Color:_t,Control:ve,Ellipse:rr,FabricImage:ee,FabricObject:At,FabricText:Jt,FitContentLayout:xs,FixedLayout:Ss,Gradient:_i,Group:$t,IText:lr,Image:ee,InteractiveFabricObject:Ai,Intersection:jt,LayoutManager:Qr,LayoutStrategy:Ln,Line:vr,Object:At,Observable:dc,Path:nr,Pattern:yn,PatternBrush:Oh,PencilBrush:ei,Point:L,Polygon:Qi,Polyline:Ae,Rect:le,Shadow:be,SprayBrush:tg,StaticCanvas:Ii,StaticCanvasDOMManager:da,Text:Jt,Textbox:He,Triangle:Dr,WebGLFilterBackend:Dn,cache:Ci,classRegistry:tt,config:Ct,controlsUtils:Tg,createCollectionMixin:sa,filters:Ht,getCSSRules:Hh,getEnv:Xe,getFabricDocument:ii,getFabricWindow:ar,getFilterBackend:as,iMatrix:re,initFilterBackend:Ih,isPutImageFaster:Og,isWebGLPipelineState:In,loadSVGFromString:wg,loadSVGFromURL:Nh,parseAttributes:ur,parseFontDeclaration:ih,parsePointsAttribute:Dh,parseSVGDocument:ka,parseStyleAttribute:nh,parseTransformAttribute:kn,runningAnimations:Sn,setEnv:kd,setFilterBackend:pg,util:ti,version:_n},Symbol.toStringTag,{value:"Module"}));k.fn.hasAttr=function(n){let t=!1;return k(this).length>0&&k(this).get(0).hasAttribute(n)&&(t=!0),t};k.fn.dataVal=function(n,t=!1){let e=t;return k(this).hasAttr("data-"+n)&&(e=k(this).attr("data-"+n)),e};k.fn.dnone=function(n=!0){n?k(this).addClass("d-none"):k(this).removeClass("d-none")};k.fn.inputType=function(){let n=k(this).tagName(),t=n;return n==="input"&&(["checkbox","radio"].includes(k(this).attr("type"))?t=k(this).attr("type"):k(this).attr("type")=="file"&&(t="file")),t};k.fn.isChecked=function(){return k(this).is(":checked")};k.fn.tagName=function(){return k(this).get(0).tagName.toLowerCase()};function Aa(n){return zg(n)}function zg(n){let t="adeh9i8jklw6xo4bcmnp5q2rs3tu1fgv7yz0ABCDEFGHIJKLMNOPQRSTUVWXYZ",e="";for(let r=0;r<n;r++)e+=t[Math.floor(Math.random()*(t.length-1+1))];return e}function Ea(n){try{JSON.parse(n)}catch{return!1}return!0}function Uh(n){return typeof n=="boolean"?n:(Ea(n)&&(n=JSON.parse(n)),!!n)}function Gg(n){let t=["jpg","png","jpeg","gif","jfif"],e=n.name.split(".").pop().toLowerCase();return!!t.includes(e)}function $h(n){let t=n.split(/[\\/]/).pop(),e=t.lastIndexOf(".");return t===""||e<1?"":t.slice(e+1)}function qg(n){return new Promise(async(t,e)=>{let r=new FileReader;r.readAsDataURL(n),r.onload=function(){t(r.result)},r.onerror=function(i){t(!1)}})}function Kh(n){let t=n.find(".card-header"),e=n.find(".card-body");t.toggleClass("active");let r=t.hasClass("active")?"slideDown":"slideUp";e[r](200)}k(document).on("click",".folding-card .card-header:not(:has(.switch-btn))",function(n){Kh(k(this).parents(".folding-card"))});k(document).ready(function(){const n=document.querySelectorAll("[data-horizontal-scroll='true']");n&&Array.from(n).forEach(t=>{t.addEventListener("wheel",function(e){e.preventDefault(),this.scrollLeft+=e.deltaY},{passive:!1})})});k(document).on("click",".editor-dropdown .dropdown-toggle-item",function(){k(this).parents(".editor-dropdown").first().toggleClass("active")});k(document).on("click",".editor-dropdown .dropdown-body .menu .item",function(){let n=k(this).attr("value"),t=k(this).clone().html(),e=k(this).parents(".editor-dropdown");e.attr("value",n),e.find(".dropdown-toggle-item .item-html").html(t),e.removeClass("active"),e.find(".menu .item").removeClass("selected"),k(this).addClass("selected"),e.trigger("change")});k(document).on("click",function(n){if(k(n.target).parents(".editor-dropdown").length)return!1;k(".editor-dropdown").removeClass("active")});k(document).on("input","[data-sync-with]",function(){let n=k(this).dataVal("radius","body"),t=k(this).parents(n).find(k(this).dataVal("sync-with")),e=k(this).val();t.val(e)});k(document).on("change",".switch-btn .toggle-input",function(n){n.stopPropagation(),n.preventDefault();let t=k(this).parents(".folding-card");k(this).is(":checked"),t.length&&Kh(t)});k(document).on("click",".nav-tabs .tab-items .tab-btn",function(){let n=k(this).dataVal("panel"),t=k(this).parents(".nav-tabs"),e=t.find(`.tab-panels .tab-panel#${n}`);t.find(".tab-panels .tab-panel").removeClass("active"),k(".nav-tabs .tab-items .tab-btn").removeClass("active"),k(this).addClass("active"),e.addClass("active")});const Ug=["id","name","originalItem","lockMovementX","lockMovementY","isPositioningLine","name"];let E=new _s("image-editor",{preserveObjectStacking:!0,selectionKey:"ctrlKey",selection:!0,width:k(".canvas-area").width(),height:k(".canvas-area").height(),backgroundColor:"#fff"});E.backgroundColor="white";E.renderAll();const Xr={folder:`<svg width='17' height='17' fill='#000' xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M464 128H272l-64-64H48C21.5 64 0 85.5 0 112v288c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V176c0-26.5-21.5-48-48-48z"/></svg>`,text:`<svg width='17' height='17' fill='#000' height="64px" width="64px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 189.127 189.127" xml:space="preserve" fill="#262626"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path style="fill:#262626;" d="M177.688,0H11.438c-4.143,0-7.5,3.358-7.5,7.5v46.23c0,4.142,3.357,7.5,7.5,7.5s7.5-3.358,7.5-7.5V15 h68.125v159.127H62.688c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h63.75c4.143,0,7.5-3.358,7.5-7.5s-3.357-7.5-7.5-7.5h-24.375 V15h68.125v38.73c0,4.142,3.357,7.5,7.5,7.5s7.5-3.358,7.5-7.5V7.5C185.188,3.358,181.831,0,177.688,0z"></path> </g></svg>`,"trash-alt":`<svg width='17' height='17' fill='#000' fill="#5f6368" xmlns="http://www.w3.org/2000/svg" height="16" width="14" viewBox="0 0 448 512"><path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1 -32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1 -32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1 -32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.7 23.7 0 0 0 -21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0 -16-16z"/></svg>`,drawing:`<svg width='17' height='17' fill='#000' width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.07 3.456a3.135 3.135 0 0 0-4.434 0L10.25 8.843a3.38 3.38 0 0 0-.884 1.55l-.845 3.292c-.205.8.522 1.527 1.322 1.323l3.278-.837a3.384 3.384 0 0 0 1.555-.886L20.07 7.89a3.135 3.135 0 0 0 0-4.434Zm-2.117 4.43 1.057-1.057a1.635 1.635 0 0 0-2.313-2.313l-1.056 1.057 2.312 2.312Zm-1.166 1.166-3.172 3.172c-.24.24-.539.41-.866.493l-2.602.665.67-2.616a1.88 1.88 0 0 1 .492-.862l3.165-3.164 2.313 2.312Z"></path><path d="M5.144 15.022a.641.641 0 1 0 0 1.282h13.751a2.109 2.109 0 0 1 0 4.218H9.194a.75.75 0 0 1 0-1.5h9.701a.609.609 0 1 0 0-1.218H5.144a2.141 2.141 0 0 1 0-4.282h1.862v1.5H5.144Z"></path></svg>`,"eye-open":`<svg width='17' height='17' fill='#000' xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#5f6368"><path d="M480-312q70 0 119-49t49-119q0-70-49-119t-119-49q-70 0-119 49t-49 119q0 70 49 119t119 49Zm0-72q-40 0-68-28t-28-68q0-40 28-68t68-28q40 0 68 28t28 68q0 40-28 68t-68 28Zm0 192q-142.6 0-259.8-78.5Q103-349 48-480q55-131 172.2-209.5Q337.4-768 480-768q142.6 0 259.8 78.5Q857-611 912-480q-55 131-172.2 209.5Q622.6-192 480-192Zm0-288Zm0 216q112 0 207-58t146-158q-51-100-146-158t-207-58q-112 0-207 58T127-480q51 100 146 158t207 58Z"/></svg>`,"eye-close":`<svg width='17' height='17' fill='#000' xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#5f6368"><path d="m637-425-62-62q4-38-23-65.5T487-576l-62-62q13-5 27-7.5t28-2.5q70 0 119 49t49 119q0 14-2.5 28t-8.5 27Zm133 133-52-52q36-28 65.5-61.5T833-480q-49-101-144.5-158.5T480-696q-26 0-51 3t-49 10l-58-58q38-15 77.5-21t80.5-6q143 0 261.5 77.5T912-480q-22 57-58.5 103.5T770-292Zm-2 202L638-220q-38 14-77.5 21t-80.5 7q-143 0-261.5-77.5T48-480q22-57 58-104t84-85L90-769l51-51 678 679-51 51ZM241-617q-35 28-65 61.5T127-480q49 101 144.5 158.5T480-264q26 0 51-3.5t50-9.5l-45-45q-14 5-28 7.5t-28 2.5q-70 0-119-49t-49-119q0-14 3.5-28t6.5-28l-81-81Zm287 89Zm-96 96Z"/></svg>`};At.ownDefaults.transparentCorners=!1;At.ownDefaults.borderColor="#007bff";At.ownDefaults.borderScaleFactor=.5;At.ownDefaults.cornerStrokeColor="#007bff";At.ownDefaults.cornerColor="#fff";At.ownDefaults.cornerStyle="circle";At.ownDefaults.cornerSize=10;At.ownDefaults.padding=0;At.prototype.setControlsVisibility({mt:!1,mb:!1,ml:!0,mr:!0,bl:!0,br:!0,tl:!0,tr:!0,mtr:!0});function $g(n,t){let e=Zh(n,t),r=n/e,i=t/e;return{width:r,height:i}}function Zh(n,t){return t==0?n:Zh(t,n%t)}function Zl(n,t){let e;return n.width?e=n.width/t.width*t.height:e=n.height/t.height*t.width,Math.round(e)}let Rt={};k(document).ready(function(){Rt={orgWidth:E.getWidth(),orgHeight:E.getHeight(),resizedWidth:E.getWidth(),resizedHeight:E.getHeight(),adjustedWidth:E.getWidth(),adjustedHeight:E.getHeight(),zoom:E.getZoom(),defaultZoom:E.getZoom()}});function Pa(n){let t=n.isZoomResized||!1,e=parseInt(n.width),r=parseInt(n.height),i=$g(e,r),s=Rt.orgHeight,o=Rt.orgWidth;r>s&&(o=Zl({height:s},i)),e>o&&(s=Zl({width:o},i)),e<=o&&r<=s&&(o=e,s=r);let l=o/e*100,h=l/100*1;console.log(o,s),Rt.resizedWidth=e,Rt.resizedHeight=r,Rt.adjustedWidth=o,Rt.adjustedHeight=s,Rt.zoom=h,t||(Rt.defaultZoom=h),E.setZoom(h),E.setWidth(o),E.setHeight(s),E.renderAll()}function Jh(){let n=E.getZoom();Rt.tmpZoom=n,E.setWidth(Rt.resizedWidth),E.setHeight(Rt.resizedHeight),E.setZoom(1),E.renderAll()}function Qh(){E.setZoom(Rt.tmpZoom),E.setWidth(Rt.adjustedWidth),E.setHeight(Rt.adjustedHeight),E.renderAll()}class tu extends He{constructor(t,e={}){super(t,e),this.text=t||"",this.diameter=e.diameter||250,this.kerning=e.kerning||0,this.flipped=e.flipped||!1,this.strokeStyle=e.strokeStyle||null,this.strokeWidth=e.strokeWidth||0,this._cachedCanvas=null,this._needsRecalculate=!0,this._refresh=!0,this.set("lockUniScaling",!0),this._initializeCanvas()}_initializeCanvas(){let t=this.getCircularText();t=this._trimCanvas(t),this.set({width:t.width,height:t.height})}_getFontDeclaration(){return[this.fontStyle,this.fontWeight,`${this.fontSize}px`,this.fontFamily].join(" ")}_trimCanvas(t){try{for(var e=t.getContext("2d",{willReadFrequently:!0}),r=t.width,i=t.height,s={x:[],y:[]},o,l=e.getImageData(0,0,r,i),h=function(b,_){return b-_},u=0;u<i;u++)for(var p=0;p<r;p++)l.data[(u*r+p)*4+3]>0&&(s.x.push(p),s.y.push(u));s.x.sort(h),s.y.sort(h),o=s.x.length-1,r=s.x[o]-s.x[0],i=s.y[o]-s.y[0];var y=e.getImageData(s.x[0],s.y[0],r,i);return t.width=r,t.height=i,e.putImageData(y,0,0),t}catch{return!1}}getCircularText(){if(this._cachedCanvas&&!this._needsRecalculate)return this._cachedCanvas;var t=this.text.trim().length>1?this.text:"You don't set empty value in curved text",e=this.diameter,r=this.flipped,i=this.kerning,s=this.fill,o=!0,l=0,h=ti.createCanvasElement(),u=h.getContext("2d",{willReadFrequently:!0}),p,y,b=-1;r&&(l=180,o=!1),l*=Math.PI/180;var _=document.createElement("div");_.style.fontFamily=this.fontFamily,_.style.whiteSpace="nowrap",_.style.fontSize=this.fontSize+"px",_.style.fontWeight=this.fontWeight,_.style.fontStyle=this.fontStyle,_.textContent=t,document.body.appendChild(_);var w=_.offsetHeight;for(document.body.removeChild(_),h.width=h.height=e,u.font=this._getFontDeclaration(),o&&(t=t.split("").reverse().join("")),u.translate(e/2,e/2),l+=Math.PI*!o,u.textBaseline="middle",u.textAlign="center",y=0;y<t.length;y++)p=u.measureText(t[y]).width,l+=(p+(y==t.length-1?0:i))/(e/2-w)/2*1;for(u.rotate(l),y=0;y<t.length;y++)p=u.measureText(t[y]).width,u.rotate(p/2/(e/2-w)*b),this.strokeStyle&&this.strokeWidth&&(u.strokeStyle=this.strokeStyle,u.lineWidth=this.strokeWidth,u.miterLimit=2,u.strokeText(t[y],0,(o?1:-1)*(0-e/2+w/2))),u.fillStyle=s,u.fillText(t[y],0,(o?1:-1)*(0-e/2+w/2)),u.rotate((p/2+i)/(e/2-w)*b);return this._cachedCanvas=h,this._needsRecalculate=!1,this._cachedCanvas}_measureTextHeight(t){const e=document.createElement("div");e.style.fontFamily=this.fontFamily,e.style.whiteSpace="nowrap",e.style.fontSize=`${this.fontSize}px`,e.style.fontWeight=this.fontWeight,e.style.fontStyle=this.fontStyle,e.textContent=t,document.body.appendChild(e);const r=e.offsetHeight;return document.body.removeChild(e),r}_set(t,e){super._set(t,e),this._needsRecalculate=!0}_updateObj(t,e){switch(t){case"scaleX":this.fontSize*=e,this.diameter*=e,this.width*=e,this.scaleX=1,this.width=Math.max(this.width,1);break;case"scaleY":this.height*=e,this.scaleY=1,this.height=Math.max(this.height,1);break;default:super._set(t,e);break}this._needsRecalculate=!0}refreshCtx(t=!1){this._refresh=t}_render(t){if(!this._refresh&&this._cachedCanvas){t.drawImage(this._cachedCanvas,-this.width/2,-this.height/2,this.width,this.height);return}if(!this._cachedCanvas||this._needsRecalculate){var e=this.getCircularText();e=this._trimCanvas(e),this.set("width",e.width),this.set("height",e.height)}t.drawImage(e,-this.width/2,-this.height/2,this.width,this.height),this.setCoords()}toObject(t=[]){return{...super.toObject(t),text:this.text,diameter:this.diameter,kerning:this.kerning,flipped:this.flipped,fill:this.fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontWeight:this.fontWeight,fontStyle:this.fontStyle,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth}}}pl(tu,"type","curved-text");const Kg=(n,t,e=null)=>{let r={...n,originalItem:{text:n.text,type:"curved-text",class:"text",fileType:"curved-text"},left:n.left,top:n.top,caching:!1,scaleX:n.scaleX,scaleY:n.scaleY,diameter:parseInt(t),fill:n.fill,shadow:n.shadow,shadowCheck:n==null?void 0:n.shadowCheck,percentage:e,rotateAngle:0,strokeStyle:n.stroke,strokeWidth:n.strokeWidth,fontSize:n.fontSize,objectCaching:!1,ownCaching:!1},i=parseInt(n.charSpacing)/100*3;i=i.toFixed(1),i<-1&&(i=-1),r.kerning=parseInt(i);const s=new tu(n.text,r);console.log(s);let o=E.getObjects().indexOf(n);E.remove(n),E.moveObjectTo(s,o),E.setActiveObject(s),E.requestRenderAll()},eu=()=>{let n=E.getActiveObject();if(!n)return 0;let t=Ei("#text-curve-range").value,e=t>=2500?(t-2500)/25:-((2500-t)/25);e=e.toFixed(0),(e==-0||e=="-0")&&(e=0),e>90&&(e=90,t=Os(e)),e<-90&&(e=-90,t=Os(e));let r=e<0,i=parseInt(e)!=0;t>=2500&&(t=2500-(t-2500));const s=(e*3.6).toFixed(0);let o=n.type=="curved-text";if(i&&!o)Kg(n,t,e);else if(i)i&&o&&(n.set("_cachedCanvas",null),n.set("diameter",t),n.set("flipped",r),n.set("percentage",e),n.set("rotateAngle",s),n._updateObj("scaleX",n.scaleX),n._updateObj("scaleY",n.scaleY));else{n.stroke=n.strokeStyle;const l=new He(n.text,{...n,percentage:e});let h=E.getObjects().indexOf(n);E.remove(n),E.add(l),E.setActiveObject(l),E.moveObjectTo(l,h)}return E.requestRenderAll(),s};function Os(n){n=parseInt(n)||0;let t=2500;return n>0?t=2500+n*25:n<0&&(t=2500-Math.abs(n)*25),t}const Ei=n=>document.querySelector(n);Ei("#text-curve-range").addEventListener("input",n=>{E.requestRenderAll();let t=n.target.value;eu();let e=t>=2500?(t-2500)/25:-((2500-t)/25),r=(e*3.6).toFixed(0);Ei("#curve-text").value=r,E.requestRenderAll()});Ei("#text-curve-range").addEventListener("change",n=>{E.requestRenderAll();const t=E.getActiveObject();if(!t||t.type!=="curved-text")return!1;t._updateObj("scaleX",t.scaleX),t._updateObj("scaleY",t.scaleY),E.requestRenderAll()});Ei("#curve-text").addEventListener("change",function(n){E.requestRenderAll();let t=n.target,e=parseInt(t.value);e>360?t.value=360:e<-360&&(t.value=-360);let r=parseInt(t.value)/360*100;r>90?r=90:r<-90&&(r=-90);let i=Os(r),s=i,o=Ei("#text-curve-range");r>=90?i=5e3:r<=-90&&(i=0),o.value=s,eu(),o.value=i,E.requestRenderAll()});function ru(n,t,e){return t=Ee(t),ep(n,iu()?Reflect.construct(t,e||[],Ee(n).constructor):t.apply(n,e))}function iu(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iu=function(){return!!n})()}function Zg(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var r,i,s,o,l=[],h=!0,u=!1;try{if(s=(e=e.call(n)).next,t===0){if(Object(e)!==e)return;h=!1}else for(;!(h=(r=s.call(e)).done)&&(l.push(r.value),l.length!==t);h=!0);}catch(p){u=!0,i=p}finally{try{if(!h&&e.return!=null&&(o=e.return(),Object(o)!==o))return}finally{if(u)throw i}}return l}}function Jl(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,r)}return e}function Jg(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Jl(Object(e),!0).forEach(function(r){An(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Jl(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function Re(){Re=function(){return t};var n,t={},e=Object.prototype,r=e.hasOwnProperty,i=Object.defineProperty||function(Y,V,z){Y[V]=z.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function u(Y,V,z){return Object.defineProperty(Y,V,{value:z,enumerable:!0,configurable:!0,writable:!0}),Y[V]}try{u({},"")}catch{u=function(V,z,ot){return V[z]=ot}}function p(Y,V,z,ot){var rt=V&&V.prototype instanceof M?V:M,xt=Object.create(rt.prototype),Et=new yt(ot||[]);return i(xt,"_invoke",{value:vt(Y,z,Et)}),xt}function y(Y,V,z){try{return{type:"normal",arg:Y.call(V,z)}}catch(ot){return{type:"throw",arg:ot}}}t.wrap=p;var b="suspendedStart",_="suspendedYield",w="executing",S="completed",F={};function M(){}function X(){}function q(){}var K={};u(K,o,function(){return this});var et=Object.getPrototypeOf,ct=et&&et(et(Xt([])));ct&&ct!==e&&r.call(ct,o)&&(K=ct);var f=q.prototype=M.prototype=Object.create(K);function it(Y){["next","throw","return"].forEach(function(V){u(Y,V,function(z){return this._invoke(V,z)})})}function Z(Y,V){function z(rt,xt,Et,It){var Mt=y(Y[rt],Y,xt);if(Mt.type!=="throw"){var _e=Mt.arg,ie=_e.value;return ie&&typeof ie=="object"&&r.call(ie,"__await")?V.resolve(ie.__await).then(function(ne){z("next",ne,Et,It)},function(ne){z("throw",ne,Et,It)}):V.resolve(ie).then(function(ne){_e.value=ne,Et(_e)},function(ne){return z("throw",ne,Et,It)})}It(Mt.arg)}var ot;i(this,"_invoke",{value:function(rt,xt){function Et(){return new V(function(It,Mt){z(rt,xt,It,Mt)})}return ot=ot?ot.then(Et,Et):Et()}})}function vt(Y,V,z){var ot=b;return function(rt,xt){if(ot===w)throw new Error("Generator is already running");if(ot===S){if(rt==="throw")throw xt;return{value:n,done:!0}}for(z.method=rt,z.arg=xt;;){var Et=z.delegate;if(Et){var It=kt(Et,z);if(It){if(It===F)continue;return It}}if(z.method==="next")z.sent=z._sent=z.arg;else if(z.method==="throw"){if(ot===b)throw ot=S,z.arg;z.dispatchException(z.arg)}else z.method==="return"&&z.abrupt("return",z.arg);ot=w;var Mt=y(Y,V,z);if(Mt.type==="normal"){if(ot=z.done?S:_,Mt.arg===F)continue;return{value:Mt.arg,done:z.done}}Mt.type==="throw"&&(ot=S,z.method="throw",z.arg=Mt.arg)}}}function kt(Y,V){var z=V.method,ot=Y.iterator[z];if(ot===n)return V.delegate=null,z==="throw"&&Y.iterator.return&&(V.method="return",V.arg=n,kt(Y,V),V.method==="throw")||z!=="return"&&(V.method="throw",V.arg=new TypeError("The iterator does not provide a '"+z+"' method")),F;var rt=y(ot,Y.iterator,V.arg);if(rt.type==="throw")return V.method="throw",V.arg=rt.arg,V.delegate=null,F;var xt=rt.arg;return xt?xt.done?(V[Y.resultName]=xt.value,V.next=Y.nextLoc,V.method!=="return"&&(V.method="next",V.arg=n),V.delegate=null,F):xt:(V.method="throw",V.arg=new TypeError("iterator result is not an object"),V.delegate=null,F)}function Tt(Y){var V={tryLoc:Y[0]};1 in Y&&(V.catchLoc=Y[1]),2 in Y&&(V.finallyLoc=Y[2],V.afterLoc=Y[3]),this.tryEntries.push(V)}function nt(Y){var V=Y.completion||{};V.type="normal",delete V.arg,Y.completion=V}function yt(Y){this.tryEntries=[{tryLoc:"root"}],Y.forEach(Tt,this),this.reset(!0)}function Xt(Y){if(Y||Y===""){var V=Y[o];if(V)return V.call(Y);if(typeof Y.next=="function")return Y;if(!isNaN(Y.length)){var z=-1,ot=function rt(){for(;++z<Y.length;)if(r.call(Y,z))return rt.value=Y[z],rt.done=!1,rt;return rt.value=n,rt.done=!0,rt};return ot.next=ot}}throw new TypeError(typeof Y+" is not iterable")}return X.prototype=q,i(f,"constructor",{value:q,configurable:!0}),i(q,"constructor",{value:X,configurable:!0}),X.displayName=u(q,h,"GeneratorFunction"),t.isGeneratorFunction=function(Y){var V=typeof Y=="function"&&Y.constructor;return!!V&&(V===X||(V.displayName||V.name)==="GeneratorFunction")},t.mark=function(Y){return Object.setPrototypeOf?Object.setPrototypeOf(Y,q):(Y.__proto__=q,u(Y,h,"GeneratorFunction")),Y.prototype=Object.create(f),Y},t.awrap=function(Y){return{__await:Y}},it(Z.prototype),u(Z.prototype,l,function(){return this}),t.AsyncIterator=Z,t.async=function(Y,V,z,ot,rt){rt===void 0&&(rt=Promise);var xt=new Z(p(Y,V,z,ot),rt);return t.isGeneratorFunction(V)?xt:xt.next().then(function(Et){return Et.done?Et.value:xt.next()})},it(f),u(f,h,"Generator"),u(f,o,function(){return this}),u(f,"toString",function(){return"[object Generator]"}),t.keys=function(Y){var V=Object(Y),z=[];for(var ot in V)z.push(ot);return z.reverse(),function rt(){for(;z.length;){var xt=z.pop();if(xt in V)return rt.value=xt,rt.done=!1,rt}return rt.done=!0,rt}},t.values=Xt,yt.prototype={constructor:yt,reset:function(Y){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(nt),!Y)for(var V in this)V.charAt(0)==="t"&&r.call(this,V)&&!isNaN(+V.slice(1))&&(this[V]=n)},stop:function(){this.done=!0;var Y=this.tryEntries[0].completion;if(Y.type==="throw")throw Y.arg;return this.rval},dispatchException:function(Y){if(this.done)throw Y;var V=this;function z(Mt,_e){return xt.type="throw",xt.arg=Y,V.next=Mt,_e&&(V.method="next",V.arg=n),!!_e}for(var ot=this.tryEntries.length-1;ot>=0;--ot){var rt=this.tryEntries[ot],xt=rt.completion;if(rt.tryLoc==="root")return z("end");if(rt.tryLoc<=this.prev){var Et=r.call(rt,"catchLoc"),It=r.call(rt,"finallyLoc");if(Et&&It){if(this.prev<rt.catchLoc)return z(rt.catchLoc,!0);if(this.prev<rt.finallyLoc)return z(rt.finallyLoc)}else if(Et){if(this.prev<rt.catchLoc)return z(rt.catchLoc,!0)}else{if(!It)throw new Error("try statement without catch or finally");if(this.prev<rt.finallyLoc)return z(rt.finallyLoc)}}}},abrupt:function(Y,V){for(var z=this.tryEntries.length-1;z>=0;--z){var ot=this.tryEntries[z];if(ot.tryLoc<=this.prev&&r.call(ot,"finallyLoc")&&this.prev<ot.finallyLoc){var rt=ot;break}}rt&&(Y==="break"||Y==="continue")&&rt.tryLoc<=V&&V<=rt.finallyLoc&&(rt=null);var xt=rt?rt.completion:{};return xt.type=Y,xt.arg=V,rt?(this.method="next",this.next=rt.finallyLoc,F):this.complete(xt)},complete:function(Y,V){if(Y.type==="throw")throw Y.arg;return Y.type==="break"||Y.type==="continue"?this.next=Y.arg:Y.type==="return"?(this.rval=this.arg=Y.arg,this.method="return",this.next="end"):Y.type==="normal"&&V&&(this.next=V),F},finish:function(Y){for(var V=this.tryEntries.length-1;V>=0;--V){var z=this.tryEntries[V];if(z.finallyLoc===Y)return this.complete(z.completion,z.afterLoc),nt(z),F}},catch:function(Y){for(var V=this.tryEntries.length-1;V>=0;--V){var z=this.tryEntries[V];if(z.tryLoc===Y){var ot=z.completion;if(ot.type==="throw"){var rt=ot.arg;nt(z)}return rt}}throw new Error("illegal catch attempt")},delegateYield:function(Y,V,z){return this.delegate={iterator:Xt(Y),resultName:V,nextLoc:z},this.method==="next"&&(this.arg=n),F}},t}function Qg(n,t){if(typeof n!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var r=e.call(n,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function nu(n){var t=Qg(n,"string");return typeof t=="symbol"?t:String(t)}function Ql(n,t,e,r,i,s,o){try{var l=n[s](o),h=l.value}catch(u){e(u);return}l.done?t(h):Promise.resolve(h).then(r,i)}function wn(n){return function(){var t=this,e=arguments;return new Promise(function(r,i){var s=n.apply(t,e);function o(h){Ql(s,r,i,o,l,"next",h)}function l(h){Ql(s,r,i,o,l,"throw",h)}o(void 0)})}}function su(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function tp(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,nu(r.key),r)}}function ou(n,t,e){return t&&tp(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function An(n,t,e){return t=nu(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function au(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Go(n,t)}function Ee(n){return Ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(n)}function Go(n,t){return Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},Go(n,t)}function ks(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ep(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ks(n)}function rp(n,t){for(;!Object.prototype.hasOwnProperty.call(n,t)&&(n=Ee(n),n!==null););return n}function er(){return typeof Reflect<"u"&&Reflect.get?er=Reflect.get.bind():er=function(t,e,r){var i=rp(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(arguments.length<3?t:r):s.value}},er.apply(this,arguments)}function tc(n,t){return np(n)||Zg(n,t)||lu(n,t)||ap()}function En(n){return ip(n)||sp(n)||lu(n)||op()}function ip(n){if(Array.isArray(n))return qo(n)}function np(n){if(Array.isArray(n))return n}function sp(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function lu(n,t){if(n){if(typeof n=="string")return qo(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qo(n,t)}}function qo(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function op(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ap(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Pn=function(n){au(t,n);function t(e,r){var i;return su(this,t),i=ru(this,t,[e,Jg({originX:"center",originY:"center",left:0,top:0,layoutManager:new Qr(new Ss)},r)]),An(ks(i),"blockErasing",!1),i}return ou(t,[{key:"drawObject",value:function(r){var i=[],s=[];this._objects.forEach(function(o){return(o instanceof nr?i:s).push(o)}),r.save(),r.fillStyle="black",r.fillRect(-this.width/2,-this.height/2,this.width,this.height),r.restore(),!this.blockErasing&&i.forEach(function(o){o.render(r)}),s.forEach(function(o){o.globalCompositeOperation=o.inverted?"destination-out":"source-in",o.render(r)})}}]),t}($t);An(Pn,"type","clipping");tt.setClass(Pn);var ec=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"source-over";t.save(),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.globalCompositeOperation=r,t.resetTransform(),t.drawImage(e.canvas,0,0),t.restore()},lp=function(t,e,r){ec(t,e,"destination-out"),r?ec(e,r,"source-in"):(e.save(),e.resetTransform(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore())};function cu(n){return n.flatMap(function(t){return!t.erasable||t.isNotVisible()?[]:t instanceof $t&&t.erasable==="deep"?cu(t.getObjects()):[t]})}function cp(n,t,e){t.clearContext(n),n.imageSmoothingEnabled=t.imageSmoothingEnabled,n.imageSmoothingQuality="high",n.patternQuality="best",t._renderBackground(n),n.save(),n.transform.apply(n,En(t.viewportTransform)),e.forEach(function(i){return i.render(n)}),n.restore();var r=t.clipPath;r&&(r._set("canvas",t),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),t.drawClipPathOnCanvas(n,r)),t._renderOverlay(n)}function hp(n,t,e){var r=t.inverted,i=t.opacity,s=e.canvas,o=e.objects,l=o===void 0?s._objectsToRender||s._objects:o,h=e.background,u=h===void 0?s.backgroundImage:h,p=e.overlay,y=p===void 0?s.overlayImage:p,b=1-i,_=cu([].concat(En(l),En([u,y].filter(function(w){return!!w})))).map(function(w){if(r){if(w.clipPath instanceof Pn)return w.clipPath.blockErasing=!0,w.clipPath.set("dirty",!0),w.set("dirty",!0),{object:w,clipPath:w.clipPath}}else{var S,F=w.opacity;return w.opacity*=b,(S=w.parent)===null||S===void 0||S.set("dirty",!0),{object:w,opacity:F}}});cp(n,s,l),_.forEach(function(w){if(w)if(w.opacity){var S;w.object.opacity=w.opacity,(S=w.object.parent)===null||S===void 0||S.set("dirty",!0)}else w.clipPath&&(w.clipPath.blockErasing=!1,w.clipPath.set("dirty",!0),w.object.set("dirty",!0))})}function hu(n,t){return n.flatMap(function(e){return!e.erasable||!e.intersectsWithObject(t)?[]:e instanceof $t&&e.erasable==="deep"?hu(e.getObjects(),t):[e]})}var up=function(t){var e=t.clipPath;if(e instanceof Pn)return e;var r=t.strokeWidth,i=new L(r,r),s=t.strokeUniform?i.divide(t.getObjectScaling()):i,o=new Pn([],{width:t.width+s.x,height:t.height+s.y});if(e){var l=e.translateToOriginPoint(new L,e.originX,e.originY),h=l.x,u=l.y;e.originX=e.originY="center",ti.sendObjectToPlane(e,void 0,ti.createTranslateMatrix(h,u)),o.add(e)}return t.clipPath=o};function uu(n,t){var e=up(n);e.add(t),e.set("dirty",!0),n.set("dirty",!0)}function dp(n,t){return Uo.apply(this,arguments)}function Uo(){return Uo=wn(Re().mark(function n(t,e){var r;return Re().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.clone();case 2:return r=s.sent,ti.sendObjectToPlane(r,void 0,t.calcTransformMatrix()),uu(t,r),s.abrupt("return",r);case 6:case"end":return s.stop()}},n)})),Uo.apply(this,arguments)}function fp(n,t,e){return $o.apply(this,arguments)}function $o(){return $o=wn(Re().mark(function n(t,e,r){var i,s;return Re().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,r.clone();case 2:return i=l.sent,s=e&&t.translateToOriginPoint(new L,t.originX,t.originY),ti.sendObjectToPlane(i,void 0,s?ti.multiplyTransformMatrixArray([[1,0,0,1,s.x,s.y],e,[1,0,0,1,-s.x,-s.y],t.calcTransformMatrix()]):t.calcTransformMatrix()),uu(t,i),l.abrupt("return",i);case 7:case"end":return l.stop()}},n)})),$o.apply(this,arguments)}var gp=function(t,e,r){var i=r.width,s=r.height,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;t.width=i,t.height=s,o>1&&(t.setAttribute("width",(i*o).toString()),t.setAttribute("height",(s*o).toString()),e.scale(o,o))},pp=function(n){au(t,n);function t(e){var r;su(this,t),r=ru(this,t,[e]),An(ks(r),"inverted",!1),An(ks(r),"active",!1);var i=document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("Failed to get context");return gp(i,s,e,r.canvas.getRetinaScaling()),r.effectContext=s,r.eventEmitter=new EventTarget,r}return ou(t,[{key:"on",value:function(r,i,s){var o=this;return this.eventEmitter.addEventListener(r,i,s),function(){return o.eventEmitter.removeEventListener(r,i,s)}}},{key:"drawEffect",value:function(){hp(this.effectContext,{opacity:new _t(this.color).getAlpha(),inverted:this.inverted},{canvas:this.canvas})}},{key:"_setBrushStyles",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.canvas.contextTop;er(Ee(t.prototype),"_setBrushStyles",this).call(this,r),r.strokeStyle="black"}},{key:"needsFullRender",value:function(){return!0}},{key:"_render",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.canvas.getTopContext();er(Ee(t.prototype),"_render",this).call(this,r),lp(this.canvas.getContext(),r,this.effectContext)}},{key:"onMouseDown",value:function(r,i){var s=this;this.eventEmitter.dispatchEvent(new CustomEvent("start",{detail:i,cancelable:!0}))&&(this.active=!0,this.eventEmitter.dispatchEvent(new CustomEvent("redraw",{detail:{type:"start"},cancelable:!0}))&&this.drawEffect(),this._disposer=this.canvas.on("after:render",function(o){var l=o.ctx;l===s.canvas.getContext()&&(s.eventEmitter.dispatchEvent(new CustomEvent("redraw",{detail:{type:"render"},cancelable:!0}))&&s.drawEffect(),s._render())}),er(Ee(t.prototype),"onMouseDown",this).call(this,r,i))}},{key:"onMouseMove",value:function(r,i){this.active&&this.eventEmitter.dispatchEvent(new CustomEvent("move",{detail:i,cancelable:!0}))&&er(Ee(t.prototype),"onMouseMove",this).call(this,r,i)}},{key:"onMouseUp",value:function(r){var i;return this.active&&er(Ee(t.prototype),"onMouseUp",this).call(this,r),this.active=!1,(i=this._disposer)===null||i===void 0||i.call(this),delete this._disposer,!1}},{key:"convertPointsToSVGPath",value:function(r){return er(Ee(t.prototype),"convertPointsToSVGPath",this).call(this,this.decimate?this.decimatePoints(r,this.decimate):r)}},{key:"createPath",value:function(r){var i=er(Ee(t.prototype),"createPath",this).call(this,r);return i.set(this.inverted?{globalCompositeOperation:"source-over",stroke:"white"}:{globalCompositeOperation:"destination-out",stroke:"black",opacity:new _t(this.color).getAlpha()}),i}},{key:"commit",value:function(){var e=wn(Re().mark(function i(s){var o,l;return Re().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return o=s.path,l=s.targets,u.t0=Map,u.next=4,Promise.all([].concat(En(l.map(function(){var p=wn(Re().mark(function y(b){return Re().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.t0=b,w.next=3,dp(b,o);case 3:return w.t1=w.sent,w.abrupt("return",[w.t0,w.t1]);case 5:case"end":return w.stop()}},y)}));return function(y){return p.apply(this,arguments)}}())),En([[this.canvas.backgroundImage,this.canvas.backgroundVpt?void 0:this.canvas.viewportTransform],[this.canvas.overlayImage,this.canvas.overlayVpt?void 0:this.canvas.viewportTransform]].filter(function(p){var y=tc(p,1),b=y[0];return!!(b!=null&&b.erasable)}).map(function(){var p=wn(Re().mark(function y(b){var _,w,S;return Re().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return _=tc(b,2),w=_[0],S=_[1],M.t0=w,M.next=4,fp(w,S,o);case 4:return M.t1=M.sent,M.abrupt("return",[M.t0,M.t1]);case 6:case"end":return M.stop()}},y)}));return function(y){return p.apply(this,arguments)}}()))));case 4:return u.t1=u.sent,u.abrupt("return",new u.t0(u.t1));case 6:case"end":return u.stop()}},i,this)}));function r(i){return e.apply(this,arguments)}return r}()},{key:"_finalizeAndAddPath",value:function(){var r=this._points;if(r.length<2){this.eventEmitter.dispatchEvent(new CustomEvent("cancel",{cancelable:!1}));return}var i=this.createPath(this.convertPointsToSVGPath(r)),s=hu(this.canvas.getObjects(),i);this.eventEmitter.dispatchEvent(new CustomEvent("end",{detail:{path:i,targets:s},cancelable:!0}))&&this.commit({path:i,targets:s}),this.canvas.clearContext(this.canvas.contextTop),this.canvas.requestRenderAll(),this._resetShadow()}},{key:"dispose",value:function(){var r=this.effectContext.canvas;r.width=r.height=0}}]),t}(ei);let Ds=[],ri=k(".single-panel#layers .layers-con"),mp=0;const du=(n,t=!1)=>{if(!n)return"";let e=n.src,r="",i="",s=n.class;return s=="image"||s=="shape"&&n.type!=="drawing"?r=`<img src="${e}" alt="img" class="layer-img">`:s=="text"?r=`<i class="layer-icon">${Xr.text}</i>`:n.type=="group"?(r=`<i class="layer-icon sub-layer-toggle cp">${Xr.folder}</i>`,i='<div class="sub-layers">'+vp(n.id)+"</div>"):n.type=="drawing"&&(r=`<i class="layer-icon">${Xr.drawing}</i>`),t||Ds.unshift(n.id),`<div class="single-layer" data-id="${n.id}" data-type="${s}">
                    <div class="layer-content">
                        <div class="left-side">
                            ${r}
                            <span class="title">Layer ${++mp}</span>
                        </div>
                        <div class="right-side">
                            <span class="action-btn" data-type="object-view" data-view="true"><span class="view">${Xr["eye-open"]}</span><span class="hide">${Xr["eye-close"]}</span></span>
                            <span class="action-btn" data-type="delete">${Xr["trash-alt"]}</span>
                        </div>
                    </div>

                    ${i}
                </div>`};function vp(n){let t=ze(n),e="";return t&&t._objects.forEach(r=>{r.originalItem&&(e+=du(r.originalItem,!0))}),e}const fu=n=>{let t=ze(n);if(!t||ri.find(`.single-layer[data-id="${t.id}"]`).length)return!1;let e=du(t.originalItem);ri.prepend(e)};function gu(n=null){n===null&&(n=[],ri.find(".single-layer").each(function(){n.push(k(this).attr("data-id"))}));let t=[];Ds.forEach(function(e,r){let i=r,s=n.indexOf(e),o=i-s;o<0&&t.push({layer_id:e,move_index:o})});for(let e=t.length-1;e>=0;e--)E.forEachObject(r=>{if(r.id==t[e].layer_id)for(let i=t[e].move_index;i<0;i++)E.sendObjectToBack(r)});E.requestRenderAll(),Ds=n}function yp(n){ri.find(".single-layer").removeClass("active"),ri.find(`.single-layer[data-id="${n}"]`).addClass("active");let t=ze(n);if(!t)return!1;pu(t)}function Ri(){ri.html(""),Ds=[],E.forEachObject(n=>{n.originalItem&&fu(n.id)})}k(document).on("click",".single-layer",function(){k(this).toggleClass("active");let n=k(this).dataVal("id"),t=ze(n);if(!t)return!1;pu(t)});k(document).on("click",".single-layer .action-btn[data-type='object-view'][data-view='true']",function(n){n.stopPropagation(),n.preventDefault();let t=k(this).parents(".single-layer"),e=t.attr("data-id");k(this).toggleClass("active");let r=k(this).hasClass("active")?0:1;E.forEachObject(i=>{e==i.id&&i.set("opacity",r),E.requestRenderAll()})});k(document).on("click",".single-layer .action-btn[data-type='delete']",function(n){n.stopPropagation(),n.preventDefault();let t=k(this).parents(".single-layer").first(),e=t.dataVal("id"),r=ze(e);r._objects&&r._objects.forEach(i=>{E.remove(i)}),E.remove(r),t.remove()});ri.find(".single-layer").on("click",function(){let n=k(this).dataVal("id");yp(n)});k(document).on("click",".single-layer .layer-content .sub-layer-toggle",function(n){console.log("clicking"),n.stopPropagation(),k(this).parents(".single-layer").first().find(".sub-layers").toggleClass("active")});function Rn(){return Aa(30)}function Bi(n,t){return"rgba("+parseInt(n.slice(-6,-4),16)+","+parseInt(n.slice(-4,-2),16)+","+parseInt(n.slice(-2),16)+","+t+")"}function xp(n="default",t=E){if(n.indexOf(".")!==-1&&(n=`url(${n}), auto`),t.defaultColor==n)return!0;t.defaultCursor=`${n}`,t.hoverCursor=`${n}`,t.moveCursor=`${n}`}function ze(n){let t=null;return E._objects.forEach(e=>{if(t)return!0;if(e.id==n)t=e;else if(e._objects){let r=e._objects.find(i=>i.id==n);r&&(t=r)}}),t}function bp(){let n=E.getActiveObject();if(!n||n.type!=="group")return!1;let t=n._objects;return E.remove(n),t.forEach(e=>{n.exitGroup(e,!1),E.add(e)}),E.renderAll(),Ri(),E.renderAll(),!0}function wp(){let n=E.getActiveObjects();if(n<2)return!1;let t=n[n.length-1].id,e=E._objects.findIndex(o=>o.id==t),r=Rn(),i=new $t(n,{id:r,originalItem:{id:r,type:"group",fileType:"group",class:"group"}});E.add(i),E.setActiveObject(i),n.map(o=>E.remove(o)),E.renderAll(),Ri();let s=[];return E.forEachObject(o=>{if(o.id==r)return!0;s.push(o.id)}),s.splice(e-1,0,r),gu(s.reverse()),!0}function _p(n){let t=E.getActiveObject();if(!n&&!t)return!1;n==="bringForward"?E.bringObjectForward(t):n==="sendBackwards"?E.sendObjectBackwards(t):n==="bringToFront"?E.bringToFront(t):n==="sendToBack"&&E.sendToBack(t),E.renderAll(),Ri()}function pu(n){mu(n.id)&&(n.hasBorders=!0,n.hasControls=!1),E.setActiveObject(n),E.renderAll()}function mu(n){let t=ze(n);return t?t.group!=null:!1}const Ir=k(".single-panel#drawing"),Kt=Ir.find(".tab-panels .tab-panel#brush"),Pi=Ir.find(".tab-panels .tab-panel#eraser"),ce=Ir.find(".tab-panels .tab-panel#pencil"),Cp=()=>{let n=Kt.find(".drawing-input[name='color']").val(),t=Kt.find(".drawing-input[name='opacity']").val(),e=Kt.find(".drawing-input[name='size']").val();const r=`
		<svg
			height="${e}"
			fill="${Bi(n,t)}"
			viewBox="0 0 ${e*2} ${e*2}"
			width="${e}"
			xmlns="http://www.w3.org/2000/svg"
		>
			<circle
				cx="50%"
				cy="50%"
				r="${e}" 
			/>
		</svg>
	`;return`data:image/svg+xml;base64,${window.btoa(r)}`},Sp=()=>{let n=Pi.find(".drawing-input[name='size']").val();const t=`
        <svg
            height="${n}"
            fill="#2f3e50"
            viewBox="0 0 ${n*2} ${n*2}"
            width="${n}"
            xmlns="http://www.w3.org/2000/svg"
        >
            <circle
                cx="50%"
                cy="50%"
                r="${n}" 
            />
        </svg>
`;return`data:image/svg+xml;base64,${window.btoa(t)}`};function Vs(n={}){let{width:t,color:e}=n;E.freeDrawingBrush=new ei(E),E.freeDrawingBrush.color=e,E.freeDrawingCursor=`url(${Cp()}) ${t/2} ${t/2}, crosshair`,E.freeDrawingBrush.width=t||1,E.isDrawingMode=!0,E.renderAll()}E.on("path:created",function(n){n.path.set({erasable:!0})});const As=(n=!1,t=20)=>{let e=new pp(E);e.on("end",async r=>{r.preventDefault();const{path:i,targets:s}=r.detail;await e.commit({path:i,targets:s}),E.renderAll()}),e.width=t||1,e.active=!0,e.fill="#ddd",E.freeDrawingBrush=e,E.freeDrawingCursor=`url(${Sp()}) ${t/2} ${t/2}, crosshair`,E.isDrawingMode=!0,E.renderAll()};Ir.find("input[type='range'].drawing-input").on("input",function(n){let t=k(this).val();k(this).parents(".canvas-tool").find(".editor-small-inp").val(t)});Ir.find("input.editor-small-inp").on("change",function(n){let t=k(this).val(),e=k(this).parents(".canvas-tool"),r=k(this).attr("min"),i=k(this).attr("max"),s=e.find('input[type="range"].drawing-input');t<r&&(t=r),t>i&&(t=i),k(this).val(t),s.val(t),s.trigger("change")});Ir.find('.tab-items .tab-btn[data-panel="brush"]').on("click",function(){E.isDrawingMode=!0,E.freeDrawingBrush;let n=Kt.find('.drawing-input[name="size"]').val(),t=Kt.find('.drawing-input[name="color"]').val(),e=Kt.find('.drawing-input[name="opacity"]').val();t=Bi(t,e),Vs({width:n,color:t}),Kt.find('.drawing-input[name="color"]').trigger("change"),E.renderAll()});Ir.find('.tab-items .tab-btn[data-panel="eraser"]').on("click",function(){let n=Pi.find('.drawing-input[name="size"]').val();As(!1,parseInt(n))});Ir.find('.tab-items .tab-btn[data-panel="pencil"]').on("click",function(){E.isDrawingMode=!0,E.freeDrawingCursor="crosshair",ce.find(".drawing-input[name='brush_type'] .item.selected").trigger("click"),E.renderAll()});Kt.find(".drawing-input[name='size']").on("change input",function(){let n=k(this).val(),t=Kt.find('.drawing-input[name="color"]').val(),e=Kt.find('.drawing-input[name="opacity"]').val();t=Bi(t,e),Vs({width:parseInt(n),color:t}),Kt.find(".brush-view .background-image .draw-circle").css({width:n+"px",height:n+"px","background-color":t})});Kt.find(".drawing-input[name='opacity']").on("change input",function(){let n=k(this).val(),t=Kt.find('.drawing-input[name="size"]').val(),e=Kt.find('.drawing-input[name="color"]').val();e=Bi(e,n),Vs({width:parseInt(t),color:e})});Kt.find(".drawing-input[name='color']").on("change input",function(){let n=k(this).val(),t=Kt.find('.drawing-input[name="opacity"]').val(),e=Kt.find('.drawing-input[name="size"]').val();n=Bi(n,t),Vs({width:parseInt(e),color:n}),Kt.find(".brush-view .background-image .draw-circle").css({"background-color":n})});Pi.find(".drawing-input[name='invert_eraser']").on("change",function(){let n=Pi.find(".drawing-input[name='size']");k(this).is(":checked")==!0?As(!0,n):As(!1,n)});Pi.find(".drawing-input[name='size']").on("input change",function(){let n=k(this).val();As(!1,parseInt(n)),Pi.find(".brush-view .background-image .draw-circle").css({width:n+"px",height:n+"px"})});const tr={vLine:null,hLine:null,square:null,diamond:null,texture:null};if(tr){for(const n in tr)tr[n]=new Oh(E);tr.vLine.getPatternSrc=function(){var n=document.createElement("canvas");n.width=n.height=10;var t=n.getContext("2d");return t.strokeStyle=this.color,t.lineWidth=5,t.beginPath(),t.moveTo(0,5),t.lineTo(10,5),t.closePath(),t.stroke(),n},tr.hLine.getPatternSrc=function(){var n=document.createElement("canvas");n.width=n.height=10;var t=n.getContext("2d");return t.strokeStyle=this.color,t.lineWidth=5,t.beginPath(),t.moveTo(5,0),t.lineTo(5,10),t.closePath(),t.stroke(),n},tr.square.getPatternSrc=function(){var n=10,t=2,e=document.createElement("canvas");e.width=e.height=n+t;var r=e.getContext("2d");return r.fillStyle=this.color,r.fillRect(0,0,n,n),e},tr.diamond.getPatternSrc=function(){var n=10,t=5,e=document.createElement("canvas"),r=new le({width:n,height:n,angle:45,fill:this.color}),i=r.getBoundingRect().width;e.width=e.height=i+t,r.set({left:i/2,top:i/2});var s=e.getContext("2d");return r.render(s),e};var rc=new Image;rc.src="../assets/honey_im_subtle.png",tr.texture.source=rc}ce.find(".drawing-input[name='brush_type']").on("change",function(){let n=k(this).attr("value");E.freeDrawingBrush=tr.hasOwnProperty(n)?tr[n]:new Yg[n+"Brush"](E);let t=E.freeDrawingBrush,e=ce.find('.drawing-input[name="size"]').val(),r=ce.find('.drawing-input[name="shadow_width"]').val(),i=ce.find('.drawing-input[name="shadow_color"]').val();t.color=ce.find('.drawing-input[name="color"]').val(),t.getPatternSrc&&(t.source=t.getPatternSrc.call(t)),t.width=parseInt(e,10)||1,t.shadow=new be({blur:parseInt(r,10)||0,offsetX:0,offsetY:0,affectStroke:!0,color:i}),E.freeDrawingBrush=t,E.renderAll()});ce.find('.drawing-input[name="size"]').on("input change",function(){let n=k(this).val(),t=ce.find('.drawing-input[name="color"]').val(),e=ce.find('.drawing-input[name="opacity"]').val();t=Bi(t,e),E.freeDrawingBrush.width=parseInt(n,10)||1,ce.find(".brush-view .background-image .draw-circle").css({width:n+"px",height:n+"px","background-color":t})});ce.find('.drawing-input[name="shadow_width"]').on("input change",function(){let n=k(this).val();E.freeDrawingBrush.shadow.blur=parseInt(n,10)||0});ce.find('.drawing-input[name="shadow_offset_x"]').on("input change",function(){let n=k(this).val();E.freeDrawingBrush.shadow.offsetX=parseInt(n,10)||0});ce.find('.drawing-input[name="shadow_offset_y"]').on("input change",function(){let n=k(this).val();E.freeDrawingBrush.shadow.offsetY=parseInt(n,10)||0});ce.find('.drawing-input[name="shadow_color"]').on("input change",function(){E.freeDrawingBrush.shadow.color=k(this).val()});ce.find('.drawing-input[name="color"]').on("input change",function(){let n=E.freeDrawingBrush;n.color=k(this).val(),n.getPatternSrc&&(n.source=n.getPatternSrc.call(n))});function Tp(){E.forEachObject(n=>{if(!n)return!1;n.set({erasable:!0}),E.renderAll()}),E.isDrawingMode=!1,E.renderAll(),xp(),Op()}function Op(){let n=Rn(),t=E._objects.filter(r=>r.type=="path"&&!r.rendered&&!r.originalItem);if(!t.length)return!1;t.map(r=>r.set({rendered:!0,dirty:!0}));let e=new $t(t);e.set({originalItem:{class:"shape",fileType:"path",id:n,src:"path",type:"drawing"},id:n,dirty:!0,options:{centerObject:!1}}),E.add(e),Jo(n)}function kp(n){n.forEachObject(function(t){}),n.setCoords(),E.renderAll()}k(document).ready(function(){E.on({"object:modified":Dp})});function Dp(n){n.target.isType("group")&&kp(n.target)}function Ko(n,t){let e=Rt.resizedWidth,r=Rt.resizedHeight;switch(t.set({objectCaching:!1}),n){case"left":t.set({left:0});break;case"right":t.set({left:e-t.getScaledWidth()});break;case"top":t.set({top:0});break;case"bottom":t.set({top:r-t.getScaledHeight()});break;case"centerH":t.set({left:e/2-t.getScaledWidth()/2});break;case"centerV":t.set({top:r/2-t.getScaledHeight()/2});break}}const Oo=k(".quick-options-bar"),Ur={$delete:Oo.find('.single-tool[data-type="delete"]'),$alignment:Oo.find(".alignment-btns"),$crop:Oo.find(".single-tool.crop-btn"),delete:function(n){n?this.$delete.removeAttr("disabled"):this.$delete.attr("disabled",!0)},alignment:function(n){n?this.$alignment.removeAttr("disabled"):this.$alignment.attr("disabled",!0)},crop:function(n){n?this.$crop.removeAttr("disabled"):this.$crop.attr("disabled",!0)}};k(document).on("click",".quick-options-bar .single-tool[data-type='delete']",function(){let n=E.getActiveObject(),t=n.id;k(`.layers-con .single-layer[data-id="${t}"]`).find('.action-btn[data-type="delete"]').trigger("click")});k(document).on("click",".quick-options-bar .alignment-btns .single-tool",function(){let n=E.getActiveObject(),t=k(this).dataVal("type");if(!n)return!1;Ko(t,n),n.setCoords(),E.setActiveObject(n),E.renderAll()});k(document).on("click",".editor-sidebar .tool-item",function(){let n=k(this).dataVal("type"),t=k(".editor-sidebar-panels"),e=t.find(`.single-panel#${n}`);t.find(".single-panel").not(e).removeClass("active"),k(".editor-sidebar .tool-item").not(k(this)).removeClass("active"),k(this).toggleClass("active"),e.toggleClass("active"),n=="drawing"?e.find('.tab-btn[data-panel="brush"]').trigger("click"):Tp()});function Ap(n){n=="curved-text"&&(n="text");let t=k(".cn-obj-editing-tools[data-type='text']"),e=k(".cn-obj-editing-tools[data-type='image']"),r=k(".cn-obj-editing-tools[data-type='shape']"),i=k(`.editor-sidebar .tool-item[data-type="${n}"]:not(.active)`);t.removeClass("active"),e.removeClass("active"),r.removeClass("active"),n=="text"?t.addClass("active"):(n=="image"||n=="shape")&&(i=k('.editor-sidebar .tool-item[data-type="uploads"]:not(.active)'),n=="image"?(e.addClass("active"),Ur.crop(!0)):(r.addClass("active"),Ur.crop(!1))),Ur.delete(!0),Ur.alignment(!0),i.trigger("click")}k(".single-panel.category-panel .media-component").find(".items .item").on("click",function(){let n=k(this).dataVal("url"),t=k(this).dataVal("name"),e=k(this).dataVal("category"),o={fileType:$h(t)==="svg"?"svg":"image",src:n,type:e==="mask"?"mask":"image"};ai(o)});let ir=k(".single-panel");function vu(n=k(".cn-obj-props-changer")){ir=k(".single-panel");let t=E.getActiveObject();if(!t||!t.originalItem||t.originalItem.type==="group")return!1;t.originalItem.class=="text"?ir=k(".single-panel#text"):ir=k(".single-panel#uploads"),n.each(function(){let e=k(this).dataVal("prop"),r=k(this).attr("type"),i=k(this).val(),s=k(this).dataVal("value-type")==="boolean",o=t[e],l=t.originalItem.class,h=["checkbox","radio"].includes(r);if(s&&Ea(i)&&(i=JSON.parse(i)),(r=="number"||r=="range")&&typeof o!="object"&&(o=parseFloat(o)),e==="charSpacing"&&t.type=="curved-text"&&(o=t.kerning),e==="stroke"&&t.type=="curved-text"&&(o=t.strokeStyle),e==="shadow"&&o){let u=ir.find(".cn-obj-props-shadow");u.find('.cn-obj-props-changer[name="color"]').val(o.color),u.find('.cn-obj-props-changer[name="blur"]').val(o.blur),u.find('.cn-obj-props-changer[name="offsetX"]').val(o.offsetX),u.find('.cn-obj-props-changer[name="offsetY"]').val(o.offsetY)}else if(e==="fontFamily"&&l=="text"){let u=k(".canvas-tool.font-family .editor-dropdown");u.attr("value",t.fontFamily),u.find(".dropdown-toggle-item .item-html").text(t.fontFamily),u.find(".item").removeClass("selected"),u.find(`.item[value="${t.fontFamily}"]`).addClass("selected")}else if(h)k(this).prop("checked",o===i),k(this).hasClass("prop-toggle-checkbox")&&k(this).trigger("canvasObjChanged");else{let u=k(this).dataVal("fill-val");u&&k(u).val(o),k(this).val(o)}})}function Ep(){k(".cn-obj-props-changer:not([data-launch-prop])").each(function(){k(this).attr("data-launch-prop","true");let n=k(this).tagName(),t=k(this).attr("type"),e=["checkbox","radio"].includes(t),r=n=="input"?"input":"click",i=k(this).dataVal("uncheck");(e||t=="file"||n==="select")&&(r="change"),k(this).on(r,function(){ir=k(".single-panel");let s=k(this).val(),o=E.getActiveObject(),l=o==null?void 0:o.type,h=e?k(this).is(":checked"):null,u=k(this).dataVal("prop"),p=k(this).dataVal("fill-val"),y=k(this).dataVal("prop-value");if(y&&(s=y),!u||(o.originalItem.class=="text"?ir=k(".single-panel#text"):ir=k(".single-panel#uploads"),k(this).dataVal("value-type")==="boolean"&&(Ea(s)&&(s=JSON.parse(s)),e&&(s=h)),e&&!h&&i&&(s=i),p&&k(p).not(this).val(s),(t=="number"||t=="range")&&(s=parseFloat(s),isNaN(s))))return!1;if(u=="shadow"&&o.shadowCheck){let b=ir.find(".cn-obj-props-shadow");s={color:b.find('.cn-obj-props-changer[name="color"]').val(),blur:parseInt(b.find('.cn-obj-props-changer[name="blur"]').val()),offsetX:parseInt(b.find('.cn-obj-props-changer[name="offsetX"]').val()),offsetY:parseInt(b.find('.cn-obj-props-changer[name="offsetY"]').val())}}if(u==="clipPath"){let b=Math.abs(s);if(o.originalItem.class==="shape"){let _=o.width+o.height,w=b*_/100;return o.set({rx:w/o.scaleX,ry:w/o.scaleY}),E.renderAll(),console.log("running"),!1}s=_=>{let w=_.width+_.height,S=b*w/100;return new le({width:_.width,height:_.height,rx:S/_.scaleX,ry:S/_.scaleY,left:-_.width/2,top:-_.height/2,objectCaching:!1,dirty:!0})}}if(l=="curved-text"&&u==="charSpacing"&&(u="kerning"),l=="curved-text"&&u==="stroke"&&(u="strokeStyle"),k(this).hasClass("prop-toggle-checkbox")&&o){let b=k(this).data("target-prop"),_=!!k(this).is(":checked"),w=`${u}Old`,S=o[w]||{};if(s=_,o.set(u,s),E.requestRenderAll(),b==="shadow"){_||(S.shadow={color:"#0000",blur:0,offsetX:0,offsetY:0});let F={};for(let M in S.shadow){let X=S.shadow[M],q=ir.find(`[data-prop="shadow"][name="${M}"]`);F[M]=q.val(),q.val(X)}return ir.find('[data-prop="shadow"][name="blur"]').trigger("input"),_||(S[u]=F),!0}return _||(o[w]=S),k(this).val(s.toString()),!0}u==="angle"&&(s=b=>{b.rotate(originalValue)}),u==="bringForward"&&(s=b=>{E.bringForward(b)}),u==="sendBackwards"&&(s=b=>{E.sendBackwards(b)}),Pp({[u]:s})})})}Ep();const Pp=(n={},t=null)=>{let e=E.getActiveObject();if(!e||t&&e.type!=t)return!1;let r=e._objects?e._objects:[e];Array.from(r).forEach(i=>{for(let s in n){let o=n[s];typeof o=="function"&&(n[s]=o(i)),n[s]===void 0&&delete n[s]}i.set(n),i.type=="curved-text"&&(i.refreshCtx(!0),i._updateObj("scaleX",i.scaleX),i._updateObj("scaleY",i.scaleY))}),E.renderAll()};function Mp(){["moving","scaling","rotating","skewing","resizing"].forEach(t=>{E.on(`object:${t}`,function(e){let r=e.target;r.type=="curved-text"&&t!=="moving"&&(k("#text-curve-range").val(Os(r.percentage)),k("#curve-text").val(r.rotateAngle?r.rotateAngle:0),r.refreshCtx(!0),r._updateObj("scaleX",r.scaleX),r._updateObj("scaleY",r.scaleY)),vu()})})}Mp();const Ma=n=>{var e;let t=E.getActiveObject();if(!t)return!1;Ap((e=t.originalItem)==null?void 0:e.class),vu()};E.on("selection:created",function(n){Ma()});E.on("selection:updated",function(n){Ma()});E.on("selection:cleared",function(){Ma()});k(".prop-toggle-checkbox").on("canvasObjChanged",function(){let n=k(this).is(":checked"),t=k(this).parents(".folding-card"),e=t.find(".card-header"),r=t.find(".card-body");n?(e.addClass("active"),r.slideDown(0)):(e.removeClass("active"),r.slideUp(0))});let hr={currentId:0};hr.setId=n=>{k(n).attr("data-ct-menu-id",hr.currentId)};hr.hide=()=>{k(".contextmenu-target").removeClass("selected"),k(".context-menu").removeClass("active")};const ic=n=>{let t=n.contextMenu;n.target;let e=n.event,r={top:e.pageY+10},i=window.innerWidth,s=window.innerHeight,o=e.pageX+20,l=e.pageY+10,h=t.width(),u=t.height();o+h>=i?(r.right=i-o+10,r.left="auto"):(r.left=e.pageX+10,r.right="auto"),l+u>s?(r.bottom=s-l+10,r.top="auto"):(r.top=l,r.bottom="auto"),t.css(r),t.addClass("active")};function jp(n,t){t=k(t);let e=!0;return n.forEach(r=>{(t.hasClass(r)||t.parents("."+r).length>0)&&(e=!1)}),e}k(window).on("click",function(n){let t=k(n.target),e=["context-menu"],r=!0;r=jp(e,t),r&&hr.hide()});k(".context-menu").each(function(){if(hr.currentId++,!k(this).attr("data-target"))return!1;let n=k(this).attr("data-target"),t=k(this);hr.setId(t),hr.setId(n),k(document).on("contextmenu",n,function(e){k(n).addClass("contextmenu-target"),!e.shiftKey&&(e.preventDefault(),t.dataVal("callbefore"),t.css({top:e.pageY+10,left:e.pageX+10}),k(this).hasClass(".selected")?(k(this).addClass("selected"),ic({event:e,contextMenu:t,target:k(this)})):(k(n).removeClass("selected"),k(this).addClass("selected"),ic({event:e,contextMenu:t,target:k(this)})))})});k(document).on("contextmenu",".canvas-container",function(n){let t=E.getActiveObject();if(E._objects.length||hr.hide(),!t)return!1;let{type:e}=t,r=k(".context-menu"),i=r.find('.ct-menu-opt[data-target="group"]'),s=r.find('.ct-menu-opt[data-target="object_lock"]');i.dnone(!(e==="activeSelection"||e==="group")),i.attr("data-group",e=="group"),s.attr("data-locked",t.lockMovementX==!0)});k(document).on("click",".context-menu .ct-menu-opt[data-target='group']",function(){let n=k(this),t=Uh(n.dataVal("group"));if(t=t==!1,!(t?wp():bp()))return!1;n.attr("data-group",t.toString())});k(document).on("click",".context-menu .ct-menu-opt.obj-pos",function(){let n=k(this).data("target");_p(n),hr.hide()});k(document).on("click",".context-menu .ct-menu-opt[data-target='object_lock']",function(){let n=Uh(k(this).dataVal("locked")),t=E.getActiveObjects();if(!t.length)return!1;n=n==!1,t.forEach(e=>{e.set({lockMovementY:n,lockMovementX:n,lockScalingX:n,lockScalingY:n})}),k(this).attr("data-locked",n.toString()),E.renderAll(),hr.hide()});const Je=(n,t)=>{let e=E.getActiveObject();if(!e)return!1;e.type==="image"&&(e.filters[n]=t,e.applyFilters(),E.renderAll())};function nc(n,t,e){let r=E.getActiveObject();if(!r||r.type!=="image")return!1;r.filters[n]&&(r.filters[n][t]=e,r.applyFilters(),E.renderAll())}function Fp(){let n=E.getActiveObject();if(!n)return!1;n.type==="image"&&(n.filters=[],n.applyFilters(),E.renderAll())}function Lp(n){let t=E.getActiveObject();if(!t||t.type!=="image")return;let e;switch(n){case"black_white":e=new Ht.Grayscale;break;case"brownie":e=new Ht.Brownie;break;case"grayscale":e=new Ht.Grayscale;break;case"invert":e=new Ht.Invert;break;case"sepia":e=new Ht.Sepia;break;case"kodachrome":e=new Ht.Kodachrome;break;case"technicolor":e=new Ht.Technicolor;break;case"polaroid":e=new Ht.Polaroid;break;case"sharpen":e=new Ht.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]});break;case"emboss":e=new Ht.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]});break;case"vintage":e=new Ht.Vintage;break;default:return}t.filters=[e],t.applyFilters(),E.renderAll()}function Ip(n,t){let e=null;switch(n){case"vibrance":Je(8,new Ht.Vibrance({vibrance:parseFloat(t)}));break;case"saturation":Je(7,new Ht.Saturation({saturation:parseFloat(t)}));break;case"hue":Je(21,new Ht.HueRotation({rotation:t}));break;case"brightness":Je(5,new Ht.Brightness({brightness:parseFloat(t)}));break;case"contrast":Je(6,new Ht.Contrast({contrast:parseFloat(t)}));case"sharpen":e=t!=0,Je(12,e&&new Ht.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}));break;case"blur":Je(11,new Ht.Blur({value:parseFloat(t)})),nc(11,"blur",parseFloat(t,10));break;case"pixelate":Je(10,new Ht.Pixelate({blocksize:parseInt(t,10)})),nc(10,"blocksize",parseInt(t,10));break;case"noise":e=t!=0,Je(9,e&&new Ht.Noise({noise:parseInt(t,10)}));break;case"emboss":e=t!=0,Je(13,e&&new Ht.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}));break}}k(document).on("input change",".image-filters .filter-inp",function(){let n=k(this).data("filter"),t=parseFloat(k(this).val());Ip(n,t)});k(document).on("click",".filter-previews .single-filter",function(){let n=k(this).dataVal("filter");Lp(n)});k(document).on("click",".reset-filter-btn",function(){Fp()});function Rp(n,t={}){if(!n)return!1;Jh();let e,r="downloadFile"in t?t.downloadFile:!0;if(n=="svg"){let s=E.toSVG(),o=btoa(s);b64Start="data:image/svg+xml;base64,",e=b64Start+o}else if(n=="png")e=E.toDataURL("image/png");else{let s=E.backgroundColor;s||(E.backgroundColor="#fff"),e=E.toDataURL("image/jpeg"),E.backgroundColor=s}if(r){var i=document.createElement("a");i.href=e,i.target="_blank",i.download="image."+n,i.click()}return Qh(),e}k(document).on("click",".download[data-target='download']",function(n){n.preventDefault();let t=k(this).attr("data-type");Rp(t)});function sc(n,t,e){let r=t+n,i=E._objects.find(u=>u.name===r),s={};n==="X"&&(s.top=t-.25),n==="Y"&&(s.left=t-.25);let o=[0,0,0,0],l=E.getActiveObject(),{p2:h}=e;if(n==="X"){let u=l.left+l.getScaledWidth()/2;e.pointType=="canvas"&&(u=Rt.resizedWidth),o=[h,0,u,0]}else if(n==="Y"){let u=l.top+l.getScaledHeight()/2;e.pointType=="canvas"&&(u=Rt.resizedHeight),o=[0,h,0,u]}if(i)return i.set({opacity:1,x1:o[0],y1:o[1],x2:o[2],y2:o[3],...s}),!0;i=new vr(o,{stroke:"red",strokeWidth:.8,selectable:!1,opacity:1,id:Rn(),name:r,isPositioningLine:!0,...s}),E.add(i)}function yu(){let n=E._objects.filter(t=>t.isPositioningLine);for(let t=0;t<n.length;t++)E.remove(n[t])}function Zo(n,t){let e=t+n,r=E._objects.find(i=>i.name===e);r&&r.set({opacity:0})}function xu(n){let t=n.getScaledWidth(),e=n.getScaledHeight(),r=n.left,i=n.top,s=[r,r+t/2,r+t],o=[i,i+e/2,i+e];s=s.map(u=>Math.round(u)),o=o.map(u=>Math.round(u));let l=[];s.forEach((u,p)=>{l.push({point:u,p2:o[0]})});let h=[];return o.forEach((u,p)=>{h.push({point:u,p2:s[0]})}),{x:l,y:h}}function Bp(){let n=Rt.resizedWidth,t=Rt.resizedHeight,e=[0,n/2,n],r=[0,t/2,t],i=e.map(o=>({point:o,p2:0,pointType:"canvas"})),s=r.map(o=>({point:o,p2:0,pointType:"canvas"}));return{x:i,y:s}}function Wp(){let n=[],t=[],e=Bp(),r=E.getActiveObject(),i=r.id;return n=n.concat(e.x),t=t.concat(e.y),mu(i)&&r.group&&(i=r.group.id),E._objects.forEach(s=>{if(s.id==i||r.type==="activeSelection"&&r._objects.find(h=>h.id==s.id))return!0;let o=xu(s);n=n.concat(o.x),t=t.concat(o.y)}),{x:n,y:t}}function oc(n,t,e){let r={onPoint:!1};return t.forEach(i=>{let{point:s,p2:o}=i;if(Zo(e,s),r.onPoint)return!0;let l=s-5,h=s+5,u=["left","center","right"];n.forEach((p,y)=>{let b=p.point;if(b>=l&&b<=h)return r=i,r.onPoint=!0,r.position=u[y],!1})}),r}E.on("object:moving",function(n){let t=n.target;t.left,t.top;let e=t.getScaledWidth(),r=t.getScaledHeight(),i=xu(t),s=Wp(),o=oc(i.x,s.x,"Y");if(o.onPoint){let h=o.point,u=h;o.position==="center"?u=u-e/2:o.position==="right"&&(u=u-e),t.set("left",u),sc("Y",h,o)}else s.x.forEach(h=>{Zo("Y",h)});let l=oc(i.y,s.y,"X");if(l.onPoint){let h=l.point,u=h;l.position==="center"?u=u-r/2:l.position==="right"&&(u=u-r),t.set("top",u),sc("X",h,l)}else s.y.forEach(h=>{Zo("X",h)});E.renderAll()});k(document).on("keydown",function(n){let t=E.getActiveObject();if(!t)return!0;let e=n.keyCode||n.which,r=[37,38,39,40],i={left:t.left,top:t.top};if(!r.includes(e)||k(":focus").length)return!0;n.preventDefault(),e==37?i.left-=1:e==38?i.top-=1:e==39?i.left+=1:e==40&&(i.top+=1),t.set(i),E.renderAll()});function bu(n){E._objects.forEach(t=>{n?"selectableCache"in t&&(t.selectable=t.selectableCache):(t.selectableCache=t.selectable,t.selectable=!1)}),E.renderAll()}const Kr=()=>{bu(!0);let n=E._objects.find(e=>e.name==="selectionRect");if(!n)return!0;let t=ze(n.cropObjId);t&&!t.clipPath&&t.clipPathOld&&(t.dirty=!0,t.clipPath=t.clipPathOld),E.remove(n)};function Hp(n=null){E.forEachObject(t=>{if(t.id===n)return!0;t.set("visible",!1)}),E.renderAll()}function Np(n=null){E.forEachObject(t=>{if(t.id===n)return!0;t.set("visible",!0)}),E.renderAll()}k(document).on("click",".cn-start-crop-btn",function(){let n=k(this).dataVal("crop-type"),t=E.getActiveObject();if(!t||t.originalItem.fileType!="image")return!1;k(this).dnone(!0),k(".cn-apply-crop-btn").dnone(!1),k(".cn-reset-crop-btn").dnone(!1);let e={top:0,left:0,width:Rt.resizedWidth,height:Rt.resizedHeight,cropType:"canvas",cropObjId:0};if(Kr(),t&&(t.name==="selectionRect"&&t.cropObjId&&(t=ze(t.cropObjId)),e={top:t.top,left:t.left,width:t.width,height:t.height,cropType:"object",cropObjId:t.id,scaleX:t.scaleX,scaleY:t.scaleY},t.set({dirty:!0,clipPathOld:t.clipPath,clipPath:null})),n==="free")return t&&cropShape(t.id),!0;bu(!1);let r=new le({fill:"rgba(0,0,0,0.3)",opacity:1,name:"selectionRect",hasRotatingPoint:!1,originalItem:{id:Rn(),type:"rect",fileType:"rect",class:"selectionRect"},...e});n==="circle"&&(r.rx=e.width,r.ry=e.height),E.add(r),r.controls.mtr.visible=!1,E.setActiveObject(r),E.renderAll()});k(document).on("click",".cn-apply-crop-btn",function(){k(this).dnone(!0),k(".cn-start-crop-btn").dnone(!1),k(".cn-reset-crop-btn").dnone(!0);let n=E._objects.find(s=>s.name==="selectionRect"),t={top:n.top,left:n.left,width:n.getScaledWidth(),height:n.getScaledHeight()};if(n.cropType==="canvas"){let s=E.toJSON(Ug);return E.loadFromJSON(s,function(){E.renderAll(),yu(),t&&resizeCanvas({width:t.width,height:t.height}),Kr()},function(o,l){l.top=l.top-t.top,l.left=l.left-t.left,E.renderAll()}),!1}let e=ze(n.cropObjId);if(!e)return!1;if(e.originalItem.fileType==="svg"){let s=-(n.width/2),o=-(n.height/2),l=(n.left-e.left)/n.getScaledWidth()*100,h=(n.top-e.top)/n.getScaledHeight()*100,u=l*n.width/100,p=h*n.height/100;u=s+u,p=o+p;let y=n.getScaledWidth()/e.getScaledWidth()*100,b=n.getScaledHeight()/e.getScaledHeight()*100,_=y*n.width/100,w=b*n.height/100,S={originX:"left",originY:"top",left:u,top:p,width:_,height:w,scaleX:1,scaleY:1},F=fabric.util.object.clone(n);return F.set(S),e.set("dirty",!0),e.set("clipPath",F),Kr(),!0}var i=new Image;Hp(n.cropObjId),Jh(),i.src=E.toDataURL(t),Qh(),Np(),i.onload=function(){let s=e.originalItem;s.fileType="image",s.resetSrc=s.src,s.src=i.src,ai(s,{top:t.top,left:t.left},{centerObject:!1}),E.remove(e),E.requestRenderAll(),Ri()},Kr(),E.renderAll()});k(document).on("click",".cn-reset-crop-btn",function(){let n=E._objects.find(i=>i.name==="selectionRect"),t=ze(n.cropObjId);if(!t)return!1;Kr();let e={top:t.top,left:t.left,width:t.getScaledWidth(),height:t.getScaledHeight()},r=t.originalItem;r.src=r.resetSrc,delete r.resetSrc,ai(r,{top:e.top,left:e.left},{centerObject:!1}),E.remove(t),k(".cn-apply-crop-btn").dnone(!0),k(".cn-reset-crop-btn").dnone(!0),k(".cn-start-crop-btn").dnone(!1),Ri()});k(document).on("click",".cn-crop-close-btn",function(){Kr(),Ri()});const mr={lastAngleRotation:null,currentAngle:null,isRotating:!1,cursorPos:new L};function Xp(n){const t=n-90,i=t===0?"translate(9.5 3.5)":`rotate(${t} ${{"-90":"9.25 5.25","-75":"9.972 3.863","-60":"10.84 1.756","-45":"11.972 -1.716","-30":"18.83 0.17","-15":"28.49 -9.49",15:"-7.985 46.77",30:"-0.415 27.57",45:"2.32 21.713",60:"3.916 18.243",75:"4.762 16.135",90:"5.25 14.75",105:"5.84 13.617",120:"6.084 12.666",135:"6.317 12.01",150:"6.754 11.325",165:"7.06 10.653",180:"7.25 10",195:"7.597 9.43",210:"7.825 8.672",225:"7.974 7.99",240:"8.383 7.332",255:"8.83 6.441"}[t]||"7.25 10"})`;return`url("data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
  <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='24' height='24'>
    <defs>
      <filter id='a' width='266.7%' height='156.2%' x='-75%' y='-21.9%' filterUnits='objectBoundingBox'>
        <feOffset dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/>
        <feGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/>
        <feColorMatrix in='shadowBlurOuter1' result='shadowMatrixOuter1' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0'/>
        <feMerge>
          <feMergeNode in='shadowMatrixOuter1'/>
          <feMergeNode in='SourceGraphic'/>
        </feMerge>
      </filter>
      <path id='b' d='M1.67 12.67a7.7 7.7 0 0 0 0-9.34L0 5V0h5L3.24 1.76a9.9 9.9 0 0 1 0 12.48L5 16H0v-5l1.67 1.67z'/>
    </defs>
    <g fill='none' fill-rule='evenodd'><path d='M0 24V0h24v24z'/>
      <g fill-rule='nonzero' filter='url(#a)' transform='${i}'>
        <use fill='#000' fill-rule='evenodd' xlink:href='#b'/>
        <path stroke='#FFF' d='M1.6 11.9a7.21 7.21 0 0 0 0-7.8L-.5 6.2V-.5h6.7L3.9 1.8a10.4 10.4 0 0 1 0 12.4l2.3 2.3H-.5V9.8l2.1 2.1z'/>
      </g>
    </g>
  </svg>`)}") 12 12, crosshair`}function Vp(n){return n-n%15}const Yp=encodeURIComponent(`
<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g filter="url(#filter0_d)">
    <circle cx="9" cy="9" r="5" fill="white"/>
    <circle cx="9" cy="9" r="4.75" stroke="black" stroke-opacity="0.3" stroke-width="0.5"/>
  </g>
    <path d="M10.8047 11.1242L9.49934 11.1242L9.49934 9.81885" stroke="black" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M6.94856 6.72607L8.25391 6.72607L8.25391 8.03142" stroke="black" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9.69517 6.92267C10.007 7.03301 10.2858 7.22054 10.5055 7.46776C10.7252 7.71497 10.8787 8.01382 10.9517 8.33642C11.0247 8.65902 11.0148 8.99485 10.9229 9.31258C10.831 9.63031 10.6601 9.91958 10.4262 10.1534L9.49701 11.0421M8.25792 6.72607L7.30937 7.73554C7.07543 7.96936 6.90454 8.25863 6.81264 8.57636C6.72073 8.89408 6.71081 9.22992 6.78381 9.55251C6.8568 9.87511 7.01032 10.174 7.23005 10.4212C7.44978 10.6684 7.72855 10.8559 8.04036 10.9663" stroke="black" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"/>
  <defs>
  <filter id="filter0_d" x="0" y="0" width="18" height="18" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
    <feFlood flood-opacity="0" result="BackgroundImageFix"/>
    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
    <feOffset/>
    <feGaussianBlur stdDeviation="2"/>
    <feColorMatrix type="matrix" values="0 0 0 0 0.137674 0 0 0 0 0.190937 0 0 0 0 0.270833 0 0 0 0.15 0"/>
    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
  </filter>
  </defs>
</svg>
`),zp=document.createElement("img");zp.src=`data:image/svg+xml;utf8,${Yp}`;function Gp(n,t){const e=`${mr.currentAngle.toFixed(0)}Â°`,r=5,i=35,s=22,o=6.01*e.length-2.317,{tl:l,br:h}=t.vptCoords,u=t.getActiveObject();if(!u)return;const p=u.oCoords.mtr,y=new L(p.x+10,p.y+10);n.save(),n.translate(Math.min(Math.max(y.x,l.x),h.x-i),Math.min(Math.max(y.y,l.y),h.y-s)),n.beginPath(),n.fillStyle="rgba(37,38,39,0.9)",n.roundRect(0,0,i,s,r),n.fill(),n.font="400 13px sans-serif",n.fillStyle="hsla(0,0%, 100%, 0.9)",n.fillText(e,i/2-o/2,s/2+4),n.restore()}E.on("object:rotating",function(n){const t=Vp(n.target.angle);mr.lastAngleRotation!==t&&(E.setCursor(Xp(t)),mr.lastAngleRotation=t),mr.isRotating=!0,mr.currentAngle=n.target.angle,mr.cursorPos.x=n.pointer.x,mr.cursorPos.y=n.pointer.y});E.on("after:render",function(n){mr.isRotating&&Gp(n.ctx,E)});let cs=k(".single-panel#uploads");cs.find("#upload-file-inp").on("change",async function(){let n=this.files;if(!n.length)return!1;n=Array.from(n);for(let t=0;t<n.length;t++)await qp(n[t]);k(this).val(""),cs.find("#file-upload-con .item .delete-btn").on("click",async function(){let t=k(this).parents(".item").first();t.dataVal("id"),t.remove()}),cs.find("#file-upload-con .item").on("click",async function(){let t=k(this).dataVal("file-type"),e=k(this).find("img").attr("src");await ai({type:"image",fileType:t,src:e},{radius:0})})});function qp(n){return new Promise(async(t,e)=>{if(!Gg(n))return!0;let r=cs.find("#file-upload-con"),i=n.name,s=$h(i),o=Aa(30),l=await qg(n),h=s=="svg"?"svg":"image",u=`<div class="item" data-file-type="${h}" data-id="${o}">
                    <img src="${l}" alt="">
                    <button class="no-btn-styles delete-btn">${Xr["trash-alt"]}</button>
                </div>`;r.prepend(u),t(!0)})}let Up=k(".single-panel#text"),$p={full:{fontSize:50,fontWeight:"bold"},sub:{fontSize:35,fontWeight:"bold"},paragraph:{fontSize:20,fontWeight:"normal"}};Up.find(".add-text-btn").on("click",function(){E.discardActiveObject();let n=k('.folding-card[data-name="shadow"] .card-header.active');n.length&&(n.click(),n.find(".prop-toggle-checkbox").prop("checked",!1)),ai({type:"text",src:"Lorem ipsum ...."},{strokeWidth:0})});k(document).on("click",".pre-built-headings .single-heading",function(){let n=k(this).dataVal("type"),t=$p[n];t.strokeWidth=0,ai({src:"Lorem ipsum ....",type:"text"},t)});let Oi=k(".single-panel#settings");function Kp(n){let t=E._objects.find(r=>r.name=="background-image");E.backgroundColor="",t&&(E.remove(t),E.renderAll());let e=new Image;e.src=n,e.onload=function(){ai({type:"background-image",src:n,fileType:"image"},{left:0,top:0,erasable:!1,name:"background-image",lockMovementX:!0,lockMovementY:!0,selectable:!1},{selected:!1,centerObject:!1}),Pa({width:e.width,height:e.height})}}Oi.find(".cn-bg-color").on("input",function(){let n=E._objects.find(e=>e.name=="background-image");n&&(E.remove(n),E.renderAll());let t=k(this).val();E.backgroundColor=t,E.renderAll()});Oi.find('.media-component[data-type="backgrounds"] .items .item').on("click",async function(){let n=k(this).dataVal("name");Kp("images/uploads/"+n)});Oi.find(".canvas-size-inp").on("change",function(){let n=k(this).attr("value"),t=n=="custom";if(n=n.split("x").map(e=>parseInt(e)),t)return k(".custom-canvas-size").dnone(!1),!1;k(".custom-canvas-size").dnone(!0),Pa({width:n[0],height:n[1]})});Oi.find(".apply-custom-cn-size").on("click",function(){let n=Oi.find(".custom-canvas-size .canvas-tool.width input").val(),t=Oi.find(".custom-canvas-size .canvas-tool.height input").val();n=parseInt(n),t=parseInt(t),console.log(n,t),Pa({width:n,height:t})});console.log("Fabric js Version : ",_n);async function ai(n,t={},e={}){let r=0,{src:i,type:s,fileType:o}=n,l=Rn();if(o||(o=s),!n.class){let h={svg:"shape"},u=o in h?h[o]:o;n.class=u}if(t.id=l,t.name=n.type,n.id=l,n.fileType=o,t.options=e,t.originalItem=n,t.centeredScaling=!0,o=="svg"){t={...t};let{objects:h,options:u}=await Nh(i),p=new $t(h,u);if(n.type==="mask"){let y=E.getActiveObject();if(!y)return!1;let b=p,{width:_,height:w}=y;b.set({left:-(_/2),top:-(w/2)});let S=_/b.width;return b.scaleX=S,S=w/b.height,b.scaleY=S,b.fill="transparent",y.dirty=!0,console.log(b),y.clipPath=b,E.renderAll(),!0}}else if(o=="text")t={fontFamily:"sans-serif",fill:"#262626",erasable:!1,editable:!0,textAlign:"center",width:400,...t},r=new He(i,t),E.add(r),Jo(l);else if(o=="image"){let h=await ee.fromURL(i);h.set(t),E.add(h),Jo(l)}}function Jo(n){let t=ze(n);if(!t)return!1;let e=t.options||{},r="centerObject"in e?e.centerObject:!0,i="selected"in e?e.selected:!0;e.beforeRender&&e.beforeRender(t),r&&(Ko("centerH",t),Ko("centerV",t)),i&&(t.erasable=!1),t.name==="background-image"?(t.moveTo(0),E.discardActiveObject()):(E.setActiveObject(t),fu(t.id)),E.renderAll(),E.requestRenderAll()}E.on("mouse:up",function(){let n=E.getActiveObject();mr.isRotating=!1,yu(),n||(Kr(),k(".cn-apply-crop-btn").dnone(!0),k(".cn-reset-crop-btn").dnone(!0),k(".cn-start-crop-btn").dnone(!1)),n||(Ur.delete(!1),Ur.alignment(!1),Ur.crop(!1))});function Zp(){k(".color-picker:not([data-launched])").each(function(){k(this).attr("data-launched","true");let n=Aa(20),t=`.color-picker[data-clr-id="${n}"]`,e=k(this).val()||"#000";k(this).attr("data-clr-id",n),Coloris({el:t,swatches:["#264653","#2a9d8f","#e9c46a","#f4a261","#e76f51","#d62828","#023e8a","#0077b6","#0096c7","#00b4d8"]}),Coloris.setInstance(t,{theme:"pill",themeMode:"light",formatToggle:!0,defaultColor:e}),k(this).on("close",function(){k(".color-picker.active").removeClass("active")}),k(this).on("open",function(){k(".color-picker.active").removeClass("active"),k(this).addClass("active")})})}(async()=>{let n=document.createElement("script");n.src="./js/Libraries/coloris.min.js",document.body.appendChild(n),n.onload=()=>{Zp()}})();window.$=window.jQuery=k;let ja=document.createElement("script");ja.src="./js/Libraries/jquery-ui.min.js";document.body.appendChild(ja);ja.onload=()=>{$(".single-panel#layers .layers-con").sortable({axis:"y",start:function(t,e){e.item.addClass("focused")},stop:function(t,e){e.item.removeClass("focused"),gu()}})};
